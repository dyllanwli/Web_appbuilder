// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(g,d,q,p,l){return d("dijit.layout.TabContainer",q,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(d){var k=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?g.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":k,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},d)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?p:l)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(g,d,q,p,l,k,n,r){return g("dijit.layout._TabContainerBase",[l,n],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:r,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&p.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
d.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(d.add(this.domNode,"dijitTabContainerNested"),d.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),d.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),d.add(this.containerNode,"dijitTabPaneWrapperNested")):d.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(g){d.add(g.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(g){d.remove(g.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var d=this.selectedChildWidget;if(this.doLayout){var h=this.tabPosition.replace(/-h/,"");this.tablist.region=h;h=[this.tablist,{domNode:this.tablistSpacer,region:h},{domNode:this.containerNode,region:"center"}];k.layoutChildren(this.domNode,this._contentBox,h);this._containerContentBox=k.marginBox2contentBox(this.containerNode,h[2]);d&&
d.resize&&d.resize(this._containerContentBox)}else{if(this.tablist.resize){h=this.tablist.domNode.style;h.width="0";var g=q.getContentBox(this.domNode).w;h.width="";this.tablist.resize({w:g})}d&&d.resize&&d.resize()}}},destroy:function(d){this.tablist&&this.tablist.destroy(d);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(g,d,q,p,l,k,n,r,u,h,w,f,e,b){k("dijit-legacy-requires")&&u(0,function(){require(["dijit/layout/StackController"])});q=q("dijit.layout.StackContainer",b,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);p.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(r(this.domNode,"keydown",n.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var a=this.getChildren();g.forEach(a,this._setupChild,
this);this.persist?this.selectedChildWidget=f.byId(d(this.id+"_selectedChild")):g.some(a,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var b=this.selectedChildWidget;!b&&a[0]&&(b=this.selectedChildWidget=a[0],b.selected=!0);h.publish(this.id+"-startup",{children:a,selected:b,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var a=this.selectedChildWidget;a&&this._showChild(a)}this.inherited(arguments)},
_setupChild:function(a){var b=a.domNode,c=l.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",a.domNode,"replace"),e=a["aria-label"]||a.title||a.label;e&&c.setAttribute("aria-label",e);l.place(b,c);a._wrapper=c;this.inherited(arguments);"none"==b.style.display&&(b.style.display="block");a.domNode.removeAttribute("title")},addChild:function(a,b){this.inherited(arguments);this._started&&(h.publish(this.id+"-addChild",a,b),this.layout(),this.selectedChildWidget||
this.selectChild(a))},removeChild:function(a){var b=g.indexOf(this.getChildren(),a);this.inherited(arguments);l.destroy(a._wrapper);delete a._wrapper;this._started&&h.publish(this.id+"-removeChild",a);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var c=this.getChildren();c.length&&this.selectChild(c[Math.max(b-1,0)])}this._started&&this.layout()}},selectChild:function(a,b){var c;a=f.byId(a);this.selectedChildWidget!=a&&(c=this._transition(a,
this.selectedChildWidget,b),this._set("selectedChildWidget",a),h.publish(this.id+"-selectChild",a,this._focused),this.persist&&d(this.id+"_selectedChild",this.selectedChildWidget.id));return w(c||!0)},_transition:function(a,b){b&&this._hideChild(b);var c=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return c},_adjacent:function(a){var b=this.getChildren(),c=g.indexOf(b,this.selectedChildWidget),c=c+(a?1:b.length-1);return b[c%b.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(a){h.publish(this.id+"-containerKeyDown",{e:a,page:this})},layout:function(){var a=this.selectedChildWidget;a&&a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize())},_showChild:function(a){var b=this.getChildren();a.isFirstChild=a==b[0];a.isLastChild=a==b[b.length-1];a._set("selected",!0);a._wrapper&&p.replace(a._wrapper,
"dijitVisible","dijitHidden");return a._onShow&&a._onShow()||!0},_hideChild:function(a){a._set("selected",!1);a._wrapper&&p.replace(a._wrapper,"dijitHidden","dijitVisible");a.onHide&&a.onHide()},closeChild:function(a){if(!a.onClose||a.onClose(this,a))this.removeChild(a),a.destroyRecursive()},destroyDescendants:function(a){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;g.forEach(this.getChildren(),function(b){a||this.removeChild(b);b.destroyRecursive(a)},this);this._descendantsBeingDestroyed=
!1}});q.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};n.extend(e,q.ChildWidgetProperties);return q})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(g,d,q,p,l,k,n,r,u,h,w,f){f=g("dijit.layout._TabButton"+(l("dojo-bidi")?"_NoBidi":
""),r.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:f,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);d.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var e=this.domNode;this.defer(function(){e.className=e.className},1)},_setCloseButtonAttr:function(e){this._set("closeButton",e);p.toggle(this.domNode,"dijitClosable",e);this.closeNode.style.display=e?"":"none";e&&(e=
k.getLocalization("dijit","common"),this.closeNode&&q.set(this.closeNode,"title",e.itemClose))},_setDisabledAttr:function(e){this.inherited(arguments);if(this.closeNode)if(e)q.remove(this.closeNode,"title");else{var b=k.getLocalization("dijit","common");q.set(this.closeNode,"title",b.itemClose)}},_setLabelAttr:function(e){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=n.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});l("dojo-bidi")&&(f=g("dijit.layout._TabButton",
f,{_setLabelAttr:function(e){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));g=g("dijit.layout.TabController",r,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:f,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var e=new h({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,
textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return p.contains(a,"dijitClosable")&&!p.contains(a,"dijitTabDisabled")}});this.own(e);var b=k.getLocalization("dijit","common"),a=this;e.addChild(new w({label:b.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(b){b=u.byNode(this.getParent().currentTarget);a.onCloseButtonClick(b.page)}}))}});g.TabButton=f;return g})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(g,d,q,p,l,k,n,r,u,h,w,f,e,b){p=d("dijit.layout._StackButton",b,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(a){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});d=d("dijit.layout.StackController",[w,f,e],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:p,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(a){return h.byId(this.id+
"_"+a)},postCreate:function(){this.inherited(arguments);this.own(r.subscribe(this.containerId+"-startup",k.hitch(this,"onStartup")),r.subscribe(this.containerId+"-addChild",k.hitch(this,"onAddChild")),r.subscribe(this.containerId+"-removeChild",k.hitch(this,"onRemoveChild")),r.subscribe(this.containerId+"-selectChild",k.hitch(this,"onSelectChild")),r.subscribe(this.containerId+"-containerKeyDown",k.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(n(this.containerNode,"click",
k.hitch(this,function(a){var b=h.getEnclosingWidget(a.target);if(b!=this.containerNode&&!b.disabled&&b.page)for(a=a.target;a!==this.containerNode;a=a.parentNode)if(q.contains(a,this.buttonWidgetCloseClass)){this.onCloseButtonClick(b.page);break}else if(a==b.domNode){this.onButtonClick(b.page);break}})))},onStartup:function(a){this.textDir=a.textDir;g.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected);var b=h.byId(this.containerId).containerNode,c=k.hitch(this,"pane2button");
a={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var e=function(a,e){return n(b,"attrmodified-"+a,function(a){var b=c(a.detail&&a.detail.widget&&a.detail.widget.id);b&&b.set(e,a.detail.newValue)})},f;for(f in a)this.own(e(f,a[f]))},destroy:function(a){this.destroyDescendants(a);this.inherited(arguments)},onAddChild:function(a,b){var c=new (k.isString(this.buttonWidget)?k.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+a.id,name:this.id+"_"+a.id,label:a.title,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||this.textDir,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip,page:a});this.addChild(c,b);a.controlButton=c;if(!this._currentChild)this.onSelectChild(a);c=a._wrapper.getAttribute("aria-labelledby")?a._wrapper.getAttribute("aria-labelledby")+" "+c.id:c.id;a._wrapper.removeAttribute("aria-label");a._wrapper.setAttribute("aria-labelledby",
c)},onRemoveChild:function(a){this._currentChild===a&&(this._currentChild=null);var b=this.pane2button(a.id);b&&(this.removeChild(b),b.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var b=this.pane2button(this._currentChild.id);b.set("checked",!1);b.focusNode.setAttribute("tabIndex","-1")}b=this.pane2button(a.id);b.set("checked",!0);this._currentChild=a;b.focusNode.setAttribute("tabIndex","0");h.byId(this.containerId)}},onButtonClick:function(a){var b=this.pane2button(a.id);
u.focus(b.focusNode);this._currentChild&&this._currentChild.id===a.id&&b.set("checked",!0);h.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){h.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button(this._currentChild.id))&&u.focus(a.focusNode||a.domNode)},adjacent:function(a){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(a=!a);var b=this.getChildren(),c=g.indexOf(b,this.pane2button(this._currentChild.id)),e=b[c],f;do c=(c+
(a?1:b.length-1))%b.length,f=b[c];while(f.disabled&&f!=e);return f},onkeydown:function(a,b){if(!this.disabled&&!a.altKey){var c=null;if(a.ctrlKey||!a._djpage){switch(a.keyCode){case l.LEFT_ARROW:case l.UP_ARROW:a._djpage||(c=!1);break;case l.PAGE_UP:a.ctrlKey&&(c=!1);break;case l.RIGHT_ARROW:case l.DOWN_ARROW:a._djpage||(c=!0);break;case l.PAGE_DOWN:a.ctrlKey&&(c=!0);break;case l.HOME:for(var e=this.getChildren(),f=0;f<e.length;f++){var d=e[f];if(!d.disabled){this.onButtonClick(d.page);break}}a.stopPropagation();
a.preventDefault();break;case l.END:e=this.getChildren();for(f=e.length-1;0<=f;f--)if(d=e[f],!d.disabled){this.onButtonClick(d.page);break}a.stopPropagation();a.preventDefault();break;case l.DELETE:case 87:this._currentChild.closable&&(a.keyCode==l.DELETE||a.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault());break;case l.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==c&&(this.onButtonClick(this.adjacent(c).page),
a.stopPropagation(),a.preventDefault())}}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});d.StackButton=p;return d})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(g,d,q,p,l,k,n,r,u,h,w,f,e,b,a,z,c,t,C,F){f=d("dijit.layout.ScrollingTabController",[b,z],{baseClass:"dijitTabController dijitScrollingTabController",templateString:f,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",q.add(a,"tabStrip-disabled"));q.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);l.set(this.domNode,"visibility","");this._postStartup=!0;this.own(r(this.containerNode,"attrmodified-label, attrmodified-iconclass",n.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,c){this.inherited(arguments);l.set(this.containerNode,"width",l.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,c){var b=this.pane2button(a.id);this._selectedTab===b.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=u("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=p.getMarginSize(a).w,!0;l.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var c=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-c.offsetLeft}return 0},_enableBtn:function(a){var c=this._getTabsWidth();a=a||l.get(this.scrollNode,"width");return 0<c&&a<c},resize:function(c){this._dim=c;this.scrollNode.style.height="auto";var b=this._contentBox=a.marginBox2contentBox(this.domNode,{h:0,w:c.w});b.h=this.scrollNode.offsetHeight;p.setContentSize(this.domNode,b);b=this._enableBtn(this._contentBox.w);
this._buttons.style("display",b?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";a.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:c.w}},_getScroll:function(){return this.isLeftToRight()||8>h("ie")||h("trident")&&h("quirks")||h("webkit")?this.scrollNode.scrollLeft:l.get(this.containerNode,"width")-l.get(this.scrollNode,"width")+(h("trident")||h("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>h("ie")||h("trident")&&h("quirks")||h("webkit"))return a;var c=l.get(this.containerNode,"width")-l.get(this.scrollNode,"width");return(h("trident")||
h("edge")?-1:1)*(a-c)},onSelectChild:function(a,c){var b=this.pane2button(a.id);if(b){var e=b.domNode;if(e!=this._selectedTab&&(this._selectedTab=e,this._postResize)){var f=this._getScroll();f>e.offsetLeft||f+l.get(this.scrollNode,"width")<e.offsetLeft+l.get(e,"width")?(e=this.createSmoothScroll(),c&&(e.onEnd=function(){b.focus()}),e.play()):c&&b.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),c=l.get(this.scrollNode,"width"),b=l.get(this.containerNode,"width")-
c,e=this._getTabsWidth();if(a.length&&e>c)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-c:b};a=this.isLeftToRight()?0:b;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,c=l.get(this.scrollNode,"width"),b=this._getScrollBounds(),a=a.offsetLeft+l.get(a,"width")/2-c/2;return a=Math.min(Math.max(a,b.min),b.max)},createSmoothScroll:function(a){if(0<arguments.length){var c=
this._getScrollBounds();a=Math.min(Math.max(a,c.min),c.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var b=this,e=this.scrollNode,f=new k.Animation({beforeBegin:function(){this.curve&&delete this.curve;var c=e.scrollLeft,d=b._convertToScrollLeft(a);f.curve=new k._Line(c,d)},onAnimate:function(a){e.scrollLeft=a}});this._anim=f;this._setButtonClass(a);return f},_getBtnNode:function(a){for(a=a.target;a&&!q.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,c){if(!c||!q.contains(c,"dijitTabDisabled")){var b=.75*l.get(this.scrollNode,"width")*a,b=this._getScroll()+b;this._setButtonClass(b);this.createSmoothScroll(b).play()}},_setButtonClass:function(a){var c=this._getScrollBounds();this._leftBtn.set("disabled",a<=c.min);this._rightBtn.set("disabled",a>=c.max)}});e=d("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:e,tabIndex:"",isFocusable:function(){return!1}});d("dijit.layout._ScrollingTabControllerButton",[C,e]);d("dijit.layout._ScrollingTabControllerMenuButton",[C,F,e],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new c({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var b=w.byId(this.containerId);g.forEach(b.getChildren(),function(a){var c=
new t({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||b.textDir,onClick:function(){b.selectChild(a)}});this.dropDown.addChild(c)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return f})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable ./utils".split(" "),
function(g,d,q,p,l,k,n,r,u){return g(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,constructor:function(d){this.map=d&&d.map;this.nls=d&&d.nls;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet={};this.relationshipTableSet={};this.currentRelationshipKey=null},setConfig:function(h){this.config=
d.clone(h||{})},setMap:function(d){this.map=d},updateLayerInfoResources:function(h){var g=new p;u.readConfigLayerInfosFromMap(this.map,!1,!0).then(d.hitch(this,function(f){this._layerInfosFromMap=f;this._processDelayedLayerInfos();h&&(0===this.config.layerInfos.length?(f=u.getConfigInfosFromLayerInfos(f),this.config.layerInfos=q.filter(f,function(e){return e.show})):this.config.layerInfos=q.filter(d.delegate(this.config.layerInfos),d.hitch(this,function(e){var b=this._getLayerInfoById(e.id);return e.show&&
b&&(e.name=b.name||b.title)})));g.resolve()}),function(f){g.reject(f)});return g},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return d.clone(this.config.layerInfos)},addLayerInfo:function(d){0===this._layerInfosFromMap.length?this._delayedLayerInfos.push(d):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(d.id)&&this._layerInfosFromMap.push(d)},addConfigInfo:function(d){this._getConfigInfoById(d.id)||(d=u.getConfigInfoFromLayerInfo(d),
this.config.layerInfos.push({id:d.id,name:d.name,layer:{url:d.layer.url,fields:d.layer.fields}}))},removeLayerInfo:function(d){d=this._getLayerInfoById(d);d=this._layerInfosFromMap.indexOf(d);this._layerInfosFromMap.splice(d,1)},removeConfigInfo:function(h){if(d.getObject("config.layerInfos",!1,this))for(var g=this.config.layerInfos.length,f=0;f<g;f++)if(this.config.layerInfos[f].id===h){this.featureTableSet[h]&&(this.featureTableSet[h].destroy(),delete this.featureTableSet[h]);this.config.layerInfos.splice(f,
1);break}},getQueryTable:function(h,g,f){var e=new p;this._activeLayerInfoId=h;this.featureTableSet[h]?e.resolve({isSupportQuery:!0,table:this.featureTableSet[h]}):this._getQueryTableInfo(h).then(d.hitch(this,function(b){if(b){var a=b.layerInfo,z=b.layerObject;b=b.tableInfo;if(this.featureTableSet[h])e.resolve({isSupportQuery:b.isSupportQuery,table:this.featureTableSet[h]});else if(d.getObject("isSupportQuery",!1,b)){var c=this._getConfigInfoById(h);c||(this.addConfigInfo(a),c=this._getConfigInfoById(h));
var t=d.getObject("layer.fields",!1,c);c.layer.fields=this._clipValidFields(t,z&&z.fields);a=new r({map:this.map,matchingMap:g,hideExportButton:f,layerInfo:a,configedInfo:c,nls:this.nls});this.featureTableSet[h]=a;e.resolve({isSupportQuery:b.isSupportQuery,table:a})}else e.resolve({isSupportQuery:!1})}else e.resolve(null)}),function(b){e.reject(b)});return e},getRelationTable:function(h,g,f,e){var b=new p,a=this.relationshipsSet[g];this._activeRelationshipKey=g;if(a){var z=this._getLayerInfoById(h);
h=d.getObject("shipInfo.id",!1,a);this.getQueryTable(h,f,e).then(d.hitch(this,function(c){if(c&&c.table){var e=c.table;e.set("relatedOriginalInfo",z);e.set("relationship",a)}b.resolve(c)}),d.hitch(function(){b.resolve(null)}))}else b.resolve(null);return b},removeRelationTable:function(d){this.relationshipTableSet[d]&&(this.relationshipTableSet[d].destroy(),this.relationshipTableSet[d]=null)},getCurrentTable:function(d){return this.featureTableSet[d]||this.relationshipTableSet[d]},collectRelationShips:function(d,
g){this._collectRelationShips(d,d.layerObject,g)},getConfigInfoById:function(d){return this._getConfigInfoById(d)},getLayerInfoById:function(d){return this._getLayerInfoById(d)},getRelationshipsByInfoId:function(d){var h=[],f;for(f in this.relationshipsSet){var e=this.relationshipsSet[f];e._layerInfoId===d&&h.push(e)}return h},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var d in this.relationshipsSet)this.relationshipsSet[d].shipInfo=null;this.relationshipsSet=
{};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(q.forEach(this._delayedLayerInfos,d.hitch(this,function(d){!this._getLayerInfoById(d&&d.id)&&this.map&&this.map.getLayer(d.id)&&this._layerInfosFromMap.push(d)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(d){for(var h=0,f=this._layerInfosFromMap.length;h<f;h++)if(this._layerInfosFromMap[h]&&this._layerInfosFromMap[h].id===
d)return this._layerInfosFromMap[h]},_getConfigInfoById:function(h){if(!d.getObject("layerInfos.length",!1,this.config))return null;for(var g=0,f=this.config.layerInfos.length;g<f;g++){var e=this.config.layerInfos[g];if(e&&e.id===h)return e}return null},_getQueryTableInfo:function(h){var g=new p,f=this._getLayerInfoById(h);if(f){var e=[],b=f.getUrl();e.push(f.getLayerObject());e.push(f.getSupportTableInfo());b&&e.push(f.getRelatedTableInfoArray());l(e).then(d.hitch(this,function(a){if(this._activeLayerInfoId===
h&&a){var e=a[0],c=a[1];a=b?a[2]:[];k.isDefined(a)&&k.isDefined(e)&&0<a.length&&this._collectRelationShips(f,e,a);g.resolve({layerInfo:f,layerObject:e,tableInfo:c})}else g.resolve(null)}),function(a){g.reject(a)})}else console.error("no activeLayerInfo!"),g.reject(Error());return g},_collectRelationShips:function(h,g,f){var e=g.relationships;if(e&&0<e.length&&g&&g.url){var b=g.url.split("/");q.forEach(e,d.hitch(this,function(a){b[b.length-1]=a.relatedTableId;var e=b.join("/"),c=q.filter(f,d.hitch(this,
function(a){a=a.getUrl();return k.isDefined(a)&&k.isDefined(e)&&n.removeProtocol(a.toString().toLowerCase())===n.removeProtocol(e.toString().toLowerCase())}));c&&0<c.length&&(a.shipInfo=c[0]);c=h.id+"_"+a.name+"_"+a.id;a._relKey=c;a._layerInfoId=h.id;this.relationshipsSet[c]||(this.relationshipsSet[c]=a,this.relationshipsSet[c].objectIdField=g.objectIdField)}))}},_getLayerInfoLabel:function(d){return d.name||d.title},_getLayerInfoId:function(d){return d&&d.id||""},_clipValidFields:function(g,k){if(!g||
!g.length)return k||[];if(!k||!k.length)return g;for(var f=[],e=0,b=g.length;e<b;e++)for(var a=g[e],z=0,c=k.length;z<c;z++)if(k[z].name===a.name){f.push(a);break}0===f.length&&0<g.length&&(e=d.clone(k),q.forEach(e,d.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,f.push(a))})));return f}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Popup jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dijit/Menu dijit/MenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query".split(" "),
function(g,d,q,p,l,k,n,r,u,h,w,f,e,b,a,z,c,t,C,F,J,G,D,v,x,O,L,P,M,H,E,Q,R,S,T,U,m,B,V,y,W,X,Y,Z,aa,K,I){return g([q,J],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,actived:!1,showSelected:!1,
tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,constructor:function(a){a=a||{};this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",a.relatedOriginalInfo||null);this.set("relationship",a.relationship||null);this.set("syncSelection",!!a.syncSelection||!0)},postCreate:function(){this.inherited(arguments);
this._relatedQueryIds=[];this.createToolbar();this.loading=new W;this.loading.placeAt(this.domNode);this.selectionManager=Y.getInstance();this._selectionResults=[];this.selectionRows=[];d.setAttr(this.domNode,"data-layerinfoid",m.getObject("layerInfo.id",!1,this));this.get("map")&&(this.own(B(this.map.root,G.release,m.hitch(this,function(){this._clickMap=!0}))),this.own(B(this.map,"extent-change",m.hitch(this,"_onExtentChange"))))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(d.getStyle(this.toolbar.domNode,
"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=m.clone(this._layerDefinition);return this._getFilterableFields(a.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this.loading.show():this.loading.hide()},active:function(){this.actived=
!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var A=new b({},d.create("div")),f=new z;this.showSelectedRecordsMenuItem=new e({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:m.hitch(this,this.toggleSelectedRecords)});f.addChild(this.showSelectedRecordsMenuItem);
this.showRelatedRecordsMenuItem=new e({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:m.hitch(this,this.onShowRelatedRecordsClick)});f.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new e({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:m.hitch(this,this.onFilterMenuItemClick)});f.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new e({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:m.hitch(this,
this.onToggleColumnsClick)});f.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new e({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:m.hitch(this,this.onExportCSVClick)}),f.addChild(this.exportCSVMenuItem));this.selectionMenu=new t({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:f});A.addChild(this.selectionMenu);this.matchingCheckBox=new c({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,
onChange:m.hitch(this,function(a){this.set("matchingMap",a);this._onMatchingCheckBoxChange(a)})});A.addChild(this.matchingCheckBox);this.zoomButton=new a({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:m.hitch(this,this.zoomTo)});A.addChild(this.zoomButton);this.clearSelectionButton=new a({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:m.hitch(this,this.clearSelection,!0,!0)});A.addChild(this.clearSelectionButton);this.refreshButton=new a({label:this.nls.refresh,
showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:m.hitch(this,this.refresh)});A.addChild(this.refreshButton);d.place(A.domNode,this.domNode);this.toolbar=A;this.own(B(this,"data-loaded,row-click,clear-selection",m.hitch(this,"changeToolbarStatus")))},startQuery:function(a){this.cancelThread();this._requestStatus="processing";this.loading.show();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=
this._getLayerObject();this._currentDef.then(m.hitch(this,function(c){this.domNode&&(this.layer=c,(c=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&c.spatialReference&&c.spatialReference.isWebMercator()?(this._currentDef=T.normalizeCentralMeridian([c],null,m.hitch(this,function(a){return a[0]}))).then(m.hitch(this,function(c){this._doQuery(c,a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()})):this._doQuery(c,
a))}),m.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this.loading.hide()}))},queryRecordsByRelationship:function(a){var c=a&&a.layer,b=a&&a.selectedIds;a&&a.relationship&&this.set("relationship",a.relationship);a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);var e=this.relationship;c&&e&&b&&0<b.length&&!aa.isEqual(this._relatedQueryIds,b)&&m.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this.loading.show(),this._requestStatus="processing",
this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(m.hitch(this,function(a){if(this.domNode){this.layer=a;var f=[],A=this.layer;y.forEach(A.fields,function(a){(!x.isDefined(a.show)||!0===a.show||"esriFieldTypeOID"===a.type||x.isDefined(A.objectIdField)&&a.name===A.objectIdField)&&f.push(a.name)});a=new P;a.objectIds=b;a.outFields=f.length?f:["*"];a.relationshipId=e.id;a.returnGeometry="esriGeometryPoint"===
this.layer.geometryType;(this._currentDef=c.queryRelatedFeatures(a,function(a){return a})).then(m.hitch(this,function(a){if(this.domNode){var c={displayFieldName:e.objectIdField,fields:A.fields,features:[],fieldAliases:null},f={},v=function(a){var b=a.attributes[this.layer.objectIdField];f[b]||(f[b]=!0,c.features.push(a))},N;for(N in a){var t=a[N];y.forEach(t&&t.features,v,this)}d.destroy(this.tipNode);0<c.features.length?(this.grid||(this._removeTable(),d.place(this.loading.domNode,this.domNode)),
a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,c.features.length,!1,c)):(this.tipNode=d.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),d.place(this.tipNode,this.domNode),d.place(this.loading.domNode,this.domNode));this._relatedQueryIds=b;this.emit("data-loaded");this.loading.hide()}}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);d.destroy(this.tipNode);this.tipNode=d.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+
"\x3c/div\x3e");this._removeTable();d.place(this.tipNode,this.domNode);d.place(this.loading.domNode,this.domNode);this.loading.hide();this.changeToolbarStatus()}))}}),m.hitch(this,function(a){console.error(a);this.loading.hide();this.changeToolbarStatus()}))):this.loading.hide()},getSelectedRows:function(){return this.tableCreated?this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?
(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):
(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(){this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:this.getSelectedRows()})},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(m.hitch(this,function(a){if(this.domNode){a=m.clone(a);var c=this.getFilterableFields();
a.fields=c;var b=new k({noFilterTip:this.nls.noFilterTip,style:"width:100%;"});this._filterPopup=new p({titleLabel:this.nls.filter,width:720,height:485,content:b,buttons:[{label:this.nls.ok,onClick:m.hitch(this,function(){var a=b.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new l({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});
(c=this.getFilterObj())?b.buildByFilterObj(this.layer.url,c,a):b.buildByExpr(this.layer.url,null,a)}}),m.hitch(this,function(a){this.domNode&&console.error(a)})).always(m.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",{layerInfoId:this.layerInfo.id})},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=new l({message:this.nls.exportMessage,titleLabel:this.nls.exportFiles,autoHeight:!0,
buttons:[{label:this.nls.ok,onClick:m.hitch(this,function(){this.exportToCSV();a.close()})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},onSelectionComplete:function(a){var c=a.features;c&&(0===c.length?this.clearSelection(!1):this._selectBySelf(c)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(a.features)))},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",
this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",
this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",!0);if(this.layerInfo&&this.isSupportQueryToServer()&&a&&0<a.length&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var c=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=c;c.then(m.hitch(this,function(a){if(this.domNode){var c=this.getSelectedRows();this.tableCreated&&a&&0<a.length&&c&&0<c.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}}))}this.tableCreated&&
this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",
!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",
!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=this.layer.objectIdField,c=this.getSelectedRows();0<c.length&&this.grid&&(this.grid.store instanceof D?this.grid.set("query",m.hitch(this,function(b){return"number"===typeof b&&-1<c.indexOf(b)||-1<c.indexOf(b[a])?
!0:!1})):this.grid.set("query",function(){return c}))}},showAllSelectedRecords:function(){if(this.tableCreated&&this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,c){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],a&&this.grid.set("query",{}),c&&(this.selectionManager.clearSelection(this.layer),this._selectionResults=[]),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},
refresh:function(){this.grid&&this.grid.clearSelection();this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a){if(this.layerInfo&&this.layer&&this.tableCreated){var c=null,c=this.layer.objectIdField,b=this.getSelectedRowsData(),c=this._getOutFieldsFromLayerInfos(c),c=this._processExecuteFields(this.layer.fields,c),e={};b&&0<b.length?e.datas=b:this.grid.store instanceof D&&(b=this.grid.store.data,e.datas=b);"datas"in e&&"esriGeometryPoint"===
this.layer.geometryType&&(b=m.clone(e.datas),y.forEach(b,function(a){var c=a.geometry;c&&"point"===c.type&&("x"in a?a._x=c.x:a.x=c.x,"y"in a?a._y=c.y:a.y=c.y);delete a.geometry}),e.datas=b,c=m.clone(c),b="",b=-1!==c.indexOf("x")?"_x":"x",c.push({name:b,alias:b,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),b=-1!==c.indexOf("y")?"_y":"y",c.push({name:b,alias:b,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));e.fromClient=!1;e.withGeometry="esriGeometryPoint"===
this.layer.geometryType;e.outFields=c;e.formatNumber=!1;e.formatDate=!0;e.formatCodedValue=!0;e.popupInfo=this.layerInfo.getPopupInfo();return Z.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,e)}},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&d.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=this.layer&&
"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!c},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||c},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=
null,this._selectionHandles&&y.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),
this.inherited(arguments))},_selectBySelf:function(a){a=a||[];return a.length!==this._selectionResults.length?!1:y.every(this._selectionResults,function(c){return-1<a.indexOf(c)})},_updateSelectRowsByFeatures:function(a){a=y.map(a,m.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(a)},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&(this.selectionRows=a,y.forEach(a,m.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),
this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(d.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&this._relatedQuery)if(a)this.queryByStoreObjectIds=y.map(this.grid.store.data,
m.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var c=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:c})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),c=a&&this._dblClickResult&&a===this._dblClickResult,a=a&&a._layer===this.layer;this.domNode&&(c||a)&&(this.map.infoWindow.hide(),this._dblClickResult=
null)},_getLayerObject:function(){function a(a){this._selectionHandles&&y.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(B(a,"selection-complete",m.hitch(this,"onSelectionComplete")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(m.hitch(this,function(c){var b=new C;"esri.layers.ArcGISImageServiceLayer"===c.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===c.declaredClass?(c=new M(c.url),this.own(B(c,
"load",m.hitch(this,function(c){m.hitch(this,a)(c.layer);b.resolve(c.layer)})))):(m.hitch(this,a)(c),b.resolve(c));return b}))},_getLayerDifinition:function(){return this._layerDefinition?F(m.clone(this._layerDefinition)):O({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(m.hitch(this,function(a){this.setLayerDefinition(a);return this.getLayerDefinition()}))},_getFilterableFields:function(a,c){return y.filter(a,function(a){return y.some(c,function(c){return a.name===
c.name&&(c.show||!x.isDefined(c.show))&&m.mixin(a,c)})})},_doQuery:function(a,c){if(this.layer){var b=this.layer.objectIdField;this.isSupportQueryToServer()?this._queryToServer(a,b,c):this.isSupportQueryOnClient()&&this._queryOnClient(a,b,c)}},_queryOnClient:function(a,c,b){var e={};e.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():y.filter(this.layer.graphics,m.hitch(this,function(a){return!a.wabIsTemp}));b&&0<b.length&&(e.features=y.filter(e.features,
function(a){return-1<b.indexOf(a.attributes[this.layer.objectIdField])},this));var f=this.layer.fields,d=this.configedInfo.layer.fields;e.fields=d?y.filter(d,m.hitch(this,function(a){x.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var b=0,e=f.length;b<e;b++)f[b].name!==a.name||a.type||(a.type=f[b].type);return a.show||a._pk})):y.filter(f,m.hitch(this,function(a){x.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==
a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var d=[],t=e.features.length,A=0;A<t;A++)e&&e.features&&e.features[A]&&e.features[A].geometry&&d.push(e.features[A].geometry);a&&v.defaults.geometryService&&0<d.length?a.spatialReference.equals(d[0].spatialReference)?(e.features=y.filter(e.features,m.hitch(this,function(c){return S.intersects(a,c.geometry)})),this.queryExecute(e.fields,e.features.length,!1,e,a)):(t=new L,t.geometries1=d,t.geometries2=[a],t.relation=L.SPATIAL_REL_INTERSECTION,
(this._currentDef=v.defaults.geometryService.relation(t,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(c,b){for(var e=b.length,d=[],f=0;f<e;f++)d.push(c.features[b[f].geometry1Index]);c.features=d;this.queryExecute(c.fields,c.features.length,!1,c,a)},e),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))):this.queryExecute(e.fields,e.features.length,!1,e,a)},_queryToServer:function(a,c,b){this._getFeatureCount(a,
b).then(m.hitch(this,function(e){if(this.domNode)if(b)this._queryFeatureLayer(a,c,e,!1,b);else{var d=this.layer,f=x.isDefined(d.maxRecordCount)?d.maxRecordCount:1E3;this._batchCount=Math.min(f,this._defaultBatchCount);if(e<=f||!this.layer.objectIdField)this._queryFeatureLayer(a,c,e,!1);else{var v=this._getOutFieldsFromLayerInfos(c),t={fields:this.layer.fields};this.layer._recordCounts=e;d.advancedQueryCapabilities&&d.advancedQueryCapabilities.supportsPagination?this.queryExecute(v,e,!0,t,a):this._getFeatureIds(c,
a).then(m.hitch(this,function(c){this.domNode&&(this.layer._objectIds=c,this.queryExecute(v,e,!0,t,a))}),m.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))}}}),m.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))},_getFeatureCount:function(a,c){var b=new C,e=new H(this.configedInfo.layer.url),d=new E;d.returnGeometry=!1;d.where=this._getLayerFilterExpression();c&&(d.where+=" AND "+this.layer.objectIdField+" IN ("+c.join()+")");a&&(d.geometry=a);(this._currentDef=
e.executeForCount(d,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(a){b.resolve(a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature count."));this.loading.hide();b.reject(a)}));return b},_queryFeatureLayer:function(a,c,b,e,d){var f=new H(this.configedInfo.layer.url),v=new E;v.where=this._getLayerFilterExpression();d&&c&&(v.where+=" AND "+c+" IN ("+d.join()+")");var t=this._getOutFieldsFromLayerInfos(c);0<t.length?
(d=y.map(t,function(a){return a.name}),v.outFields=d):v.outFields=["*"];a&&(v.geometry=a,v.spatialRelationship=E.SPATIAL_REL_INTERSECTS);v.outSpatialReference=m.clone(this.map.spatialReference);v.returnGeometry="esriGeometryPoint"===this.layer.geometryType;c&&(v.orderByFields=[c+" ASC"]);(this._currentDef=f.execute(v,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(c){this.queryExecute(t,b,e,c,a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();
this.loading.hide()}))},_getFeatureIds:function(a,c){var b=new C,e=new H(this.configedInfo.layer.url),d=new E;d.returnGeometry=!1;d.returnIdsOnly=!0;d.where=this._getLayerFilterExpression();if(this.layer._orderByFields||a)d.orderByFields=this.layer._orderByFields||[a+" ASC"];c&&(d.geometry=c);(this._currentDef=e.executeForIds(d,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(a){b.resolve(a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));
b.resolve([])}));return b},queryExecute:function(a,c,b,e,f){var v=[],v=null,t={};if(this.domNode){e.fields=this._processExecuteFields(this.layer.fields,a);b?v=K.generateCacheStore(this.layer,c,this._batchCount,this._getLayerFilterExpression(),f):(v=y.map(e.features,m.hitch(this,function(a){var c=m.clone(a.attributes);return m.mixin(c,{geometry:a.geometry})})),v=K.generateMemoryStore(v,this.layer.objectIdField));a=this.layer.typeIdField;var t=this.layer.types,g=m.getObject("advancedQueryCapabilities.supportsOrderBy",
!1,this.layer),z=m.getObject("advancedQueryCapabilities.supportsPagination",!1,this.layer),A=m.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),t=K.generateColumnsFromFields(this.layerInfo.getPopupInfo(),e.fields,a,t,g&&z||!b,A);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(t.attachmentsColumn=this.formatAttachmentsColumn());b=20+100*e.fields.length<d.getMarginBox(this.domNode).w;this.createTable(t,v,c,b);this._currentExtent=f;c=this.layer.getSelectedFeatures();
this.selectionRows&&0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):c&&0<c.length?this._updateSelectRowsByFeatures(c):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=m.hitch(this,function(a,c,b){var e=a[this.layer.objectIdField];
this.layer.queryAttachmentInfos(e,m.hitch(this,function(a){var c=y.map(a,m.hitch(this,function(a){var c=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",b=U.findCredential(this.layer.url);return'\x3cli class\x3d"'+c+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+e+"/attachments/"+a.id+(b?"?token\x3d"+b.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),f="";0<a.length&&(f=" "+this.nls.files);f='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
a.length+f+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+c.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+c.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";f=d.toDom(f);0<a.length&&(a=I(".show-attachments-div",f)[0],d.addClass(a,"has-attachments"));b.appendChild(f);this.own(B(b,"click",m.hitch(this,
function(a){a=a&&a.target;if(d.hasClass(a,"show-attachments-div")||d.hasClass(a,"show-attachments")||d.hasClass(a,"close")){a=this._visibleAttachmentPopup;var e=I(".attachment-popup",b)[0];e&&0<c.length&&d.toggleClass(e,"show");d.hasClass(e,"show")?this._visibleAttachmentPopup=e:this._visibleAttachmentPopup=null;a&&a!==e&&d.toggleClass(a,"show")}})))}),m.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,c,b,e){if(this.grid)this.grid.set("store",c),this.grid.set("columns",
a),this.grid.refresh();else{var f={};f.columns=a;f.store=c;f.keepScrollPosition=!0;f.pagingDelay=1E3;f.allowTextSelection=!0;f.deselectOnRefresh=!1;this.layer.objectIdField||(f.minRowsPerPage=this.layer.maxRecordCount||1E3,f.maxRowsPerPage=this.layer.maxRecordCount||1E3,f.selectionMode="none");this.grid=new (g([n,r,u,h,w]))(f,d.create("div"));d.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&d.destroy(this.tipNode);this.own(B(this.ownerDocument,"keydown",m.hitch(this,function(a){this.grid&&
this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(B(this.ownerDocument,"keyup",m.hitch(this,function(){this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.layer.objectIdField&&(this.own(B(this.grid,".dgrid-header .dgrid-cell:click",m.hitch(this,this._onHeaderClick))),this.own(B(this.grid,"dgrid-columnstatechange",m.hitch(this,this._onColumnStateChange))),this.own(B(this.grid,".selection-handle-column:click",m.hitch(this,
this._onSelectionHandleClick))),this.own(B(this.grid,".dgrid-row:dblclick",m.hitch(this,this._onDblclickRow))),this.own(B(this.grid,"dgrid-sort",m.hitch(this,function(a){this.emit("sort",a)}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(B(a,"click",m.hitch(this,this._onFeaturelayerClick))))}this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1);this.getParent()&&(a=I(".dgrid-scroller",this.grid.domNode)[0],f=I(".dgrid-header",this.grid.domNode)[0],c=d.getComputedStyle(a),
f=d.getMarginBox(f),c=parseInt(c.marginTop,10),isFinite(c)&&f&&c<f.h&&d.setStyle(a,"marginTop",f.h+"px"));e?d.addClass(this.domNode,"auto-width"):d.removeClass(this.domNode,"auto-width");this.footer?d.empty(this.footer):this.footer=d.create("div",{"class":"jimu-widget-attributetable-feature-table-footer"},this.domNode);b=d.create("div",{"class":"dgrid-status self-footer",innerHTML:b+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=
d.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},b,"after");b=d.getStyle(this.domNode,"height");this.changeHeight(b);this._requestStatus="fulfilled";this.tableCreated=!0;d.place(this.loading.domNode,this.grid.domNode);this.loading.hide()},getSelectedRowsData:function(){if(!this.grid)return null;var a=this.layer.objectIdField,c=this.grid.store,b=c._entityData||c.data,c=this.getSelectedRows();
return y.map(c,m.hitch(this,function(c){for(var e=0,f=b.length;e<f;e++)if(b[e]&&b[e][a]===c)return b[e];return{}}))||[]},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var a=this.getSelectedRows(),c=0;if(this.grid.store instanceof D){var b=y.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);y.forEach(a,function(a){-1<b.indexOf(a)&&c++})}else c=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+c+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},
_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(m.hitch(this,function(a){if(a&&this.domNode){var c=null;"point"===a.type?(c=15,c=-1<this.map.getMaxZoom()?this.map.getMaxZoom():.1,c=this.map.centerAndZoom(a,c)):c=this.map.setExtent(a.expand(1.1));return c.then(function(){return a})}}))},_showMapInfoWindowByFeatures:function(a,c){if(c&&0!==c.length&&this.domNode){var b=this.map.infoWindow,
e=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(b&&b.setFeatures&&1===c.length&&e){y.forEach(c,m.hitch(this,function(a){a._layer=this.layerInfo.layerObject;a.setInfoTemplate(e)}));b.setFeatures(c);var f=null,f="point"===a.type?c[0].geometry:a.getCenter();b.show(f,{closetFirst:!0});this._dblClickResult=c[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,c){c&&0<c.length?("rowclick"===a||"selectall"===a?this._setSelection(c):"zoom"!==a&&"row-dblclick"!==
a||this._zoomToExtentByFeatures(c).then(m.hitch(this,function(b){"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(b,c)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a)})),this.setSelectedNumber()):this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var c=this.map.infoWindow,b=m.isArray(a)?a:[a];B.once(c,"hide",m.hitch(this,function(){e&&e.remove&&(e.remove(),e=null)}));var e=V.after(c,"show",m.hitch(this,function(){var a=
c.getSelectedFeature(),a=a&&b[0]===a,f=-1;c.features&&(f=c.features.indexOf(b[0]));!a&&-1<f?c.select(f):this.domNode&&!a&&e&&e.remove&&(e.remove(),e=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var c=[],b,e,f=a.length,d=this.layer.graphics.length,v=this.layer.objectIdField,t=0;t<f;t++)for(var g=0;g<d;g++)if(b=this.layer.graphics[g].attributes[v]+"",e=a[t]+"",b===e){c.push(this.layer.graphics[g]);break}return c},getExtent:function(a){var c=new C,b,e,f=a.length;if(1===f&&a[0].geometry&&
"point"===a[0].geometry.type)b=a[0].geometry;else if(1!==f||a[0].geometry)for(var d=0;d<f;d++)a[d].geometry?"point"===a[d].geometry.type?(e||(e=new R(a[d].geometry.spatialReference)),e.addPoint(a[d].geometry),d===f-1&&(b=e.getExtent())):b=b?b.union(a[d].geometry.getExtent()):a[d].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[d]);else return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),c;if(!b||!b.spatialReference)return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),
c;a=this.map.spatialReference;b.spatialReference.equals(a)?c.resolve(b):(e=new Q,e.geometries=[b],e.outSR=a,v.defaults.geometryService.project(e,m.hitch(this,function(a){this.domNode&&(a&&a.length?c.resolve(a[0]):c.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),m.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));c.reject(a)})));return c},_onFeaturelayerClick:function(a,c){if(this.actived){var b=m.getObject("graphic",!1,a),e=m.getObject("graphic.attributes",
!1,a);e&&b&&b._layer===this.layer&&((b=this.map.infoWindow.getSelectedFeature())&&b._layer===this.layer&&!c&&this.map.infoWindow.hide(),e=e[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(e).then(m.hitch(this,function(c){-1!==c&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*c}),this.map.infoWindow.features&&(c=this.map.infoWindow.features.indexOf(a.graphic),this.map.infoWindow.select(c)),B.once(this.map.infoWindow,"selection-change",m.hitch(this,
function(){var c=this.map.infoWindow.getSelectedFeature(),b=m.getObject("_layer",!1,c);c!==a.graphic&&b===this.layer&&this._onFeaturelayerClick({graphic:c},!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var c=new C,b=-1,e=m.getObject("store.objectIds",!1,this.grid),b=null,b=this.grid.get("sort")[0];if(this._relatedQuery)return c.resolve(-1),c;if(this.grid.store instanceof D)a=this.grid.store.get(a),e=this.grid.store.data,a?b&&b.attribute&&x.isDefined(b.descending)?
(e=m.clone(e),b=function(a,c){return function(b,e){return b[a]===e[a]?0:b[a]<e[a]?c?1:-1:c?-1:1}}(b.attribute,b.descending),e.sort(b),e=y.map(e,function(a){return a[this.layer.objectIdField]},this),b=e.indexOf(a[this.layer.objectIdField])):b=e.indexOf(a):b=-1,c.resolve(b);else if(e&&0<e.length)b=e.indexOf(a),c.resolve(b);else{e=new E;e.returnGeometry=!1;e.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+a;if(b&&(b.attribute!==this.layer.objectIdField||b.descending))return c.resolve(-1),
c;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(e.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(e)).then(m.hitch(this,function(a){c.resolve(a)}),m.hitch(this,function(a){c.reject(a)}))}return c},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,c){if(0!==a.length){var b=this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==b.length?
this._queryFeaturesByIds(a,c):this.selectFeatures(c,b)}},_onDblclickRow:function(a){this.layerInfo&&this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},_queryFeaturesByIds:function(a,c){var b=new E;b.objectIds=a;b.returnGeometry=!0;b.outSpatialReference=m.clone(this.map.spatialReference);b.outFields=["*"];var e=this.layer,f="esri.layers.CSVLayer"===e.declaredClass;e.url&&!f?(new H(e.url)).execute(b,m.hitch(this,function(a){this.selectFeatures(c,a.features)}),
m.hitch(this,this._errorSelectFeatures)):e.selectFeatures(b,M.SELECTION_NEW,m.hitch(this,this.selectFeatures,c),m.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var c=this.grid.cell(a);this._showColumnMenu(c.column,c,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(a,c,b,v){var t=m.getObject("_cache",!1,a);if(t){var g=new f({});d.addClass(g.domNode,"jimu-widget-attributetable-feature-menu");var z=this;if(t.sortable){var C=["iconSortAscending","iconSortDescending"];y.forEach([this.nls.sortAsc,
this.nls.sortDes],function(c,b){var f=new e({label:c,iconClass:C[b],baseClass:"menuItemClass",onClick:function(){0===b?z.grid.set("sort",a.field,!1):1===b&&z.grid.set("sort",a.field,!0)}});g.addChild(f)})}t.statistics&&(t=new e({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:m.hitch(this,function(){var c={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[a.field]};this.matchingMap&&(c.geometry=this._currentExtent);if(this.showSelected){var b=
this._getSelectedIds();c.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+b.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(c.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new X;this.fieldStatistics.showContentAsPopup(c)})}),g.addChild(t));t=g.getChildren();g.startup();g._openMyself({target:b,delegatedTarget:c,iframe:null,coords:v});this.own(B(g,"Close",m.hitch(this,function(){var a=
this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",g);1>t.length&&B.emit(g,"Close")}},_onColumnStateChange:function(a){if(a&&a.grid&&a.grid.columns){var c=0,b;for(b in a.grid.columns)a.grid.columns[b].hidden||c++;20+100*c-1<d.getMarginBox(this.domNode).w?d.addClass(this.domNode,"auto-width"):d.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||
(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));this.setSelectedNumber();this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var c=m.getObject("delta.x",!1,a),b=m.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(c)&&isFinite(b)&&(0<Math.abs(c)||0<Math.abs(b)):!0;this._clickMap=!1;a&&this.matchingMap&&this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=
this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var c=this.configedInfo.layer.fields,b=[];c&&y.forEach(c,m.hitch(this,function(c){x.isDefined(c.show)||(c.show=!0);c.name!==a||"esriFieldTypeOID"!==c.type&&"esriFieldTypeInteger"!==c.type&&c.type||(c._pk=!0);(c.show||c._pk)&&b.push(c)}));return b},_processExecuteFields:function(a,c){if(a&&0<a.length){var b=[];if(!c.length)return a;for(var e=0,f=c.length;e<f;e++)for(var d=0;d<a.length;d++)c[e].name!==a[d].name||
c[e].type!==a[d].type&&c[e].type||(a[d]=m.mixin(a[d],c[e]),b.push(a[d]));return b}return c},_getSelectedIds:function(){var a=[],c=this.grid.selection,b;for(b in c)c[b]&&(isFinite(b)?a.push(parseInt(b,10)):a.push(b));return a},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var c=new l({message:a,buttons:[{label:this.nls.ok,onClick:m.hitch(this,function(){c.close()})}]});this.loading.hide()}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(g,d,q,p,l,k,n,r,u){function h(a,b){for(var c=a.unselectable=b?"on":"",e=a.getElementsByTagName("*"),f=e.length;--f;)"INPUT"!==e[f].tagName&&"TEXTAREA"!==e[f].tagName&&(e[f].unselectable=c)}function w(a,b){var c=a.bodyNode,f=b?"text":21>l("ff")?"-moz-none":"none";e&&"msUserSelect"!==e?c.style[e]=f:l("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=p(c,"selectstart",function(a){var c=a.target&&
a.target.tagName;"INPUT"!==c&&"TEXTAREA"!==c&&a.preventDefault()}):(h(c,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=k.after(a,"renderRow",function(a){h(a,!0);return a})}l.add("dom-comparedocumentposition",function(a,b,e){return!!e.compareDocumentPosition});l.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});l.add("css-user-select",function(a,b,e){a=e.style;
b=["Khtml","O","ms","Moz","Webkit"];e=b.length;var c="userSelect";do if("undefined"!==typeof a[c])return c;while(e--&&(c=b[e]+"UserSelect"));return!1});l.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=l("mac")?"metaKey":"ctrlKey",e=l("css-user-select"),b=(n=l("pointer"))&&"MS"===n.slice(0,2),a=n?n+(b?"Down":"down"):"mousedown",z=n?n+(b?"Up":"up"):"mouseup";"WebkitUserSelect"===e&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(e=!1);return d("dgrid.Selection",
null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:a+","+z+",dgrid-cellfocusin",selectionTouchEvents:l("touch")?r.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=
this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){g.deprecated("setSelectionMode(...)",
'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?w(this,a):w(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(c,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==c.type||"mousedown"!==c.parentType)&&(c.type!==z||b==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=c;if(!c.keyCode||!c.ctrlKey||32==c.keyCode)if(!c.shiftKey&&
c.type===a&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](c,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[f];this._lastSelected===b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,e=a.keyCode?a.ctrlKey:a[f],d;a.shiftKey||(d=e?null:!0,c=null);this.select(b,c,d);c||(this._lastSelected=b)},
_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[f])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};l("touch")&&!l("pointer")&&this.selectionTouchEvents?(p(b,r.selector(e,this.selectionTouchEvents),function(c){a._handleSelect(c,this);
a._ignoreMouseSelect=this}),p(b,p.selector(e,this.selectionEvents),function(c){a._ignoreMouseSelect!==this?a._handleSelect(c,this):c.type===z&&(a._ignoreMouseSelect=null)})):p(b,p.selector(e,this.selectionEvents),function(c){a._handleSelect(c,this)});this.addKeyHandler&&this.addKeyHandler(32,function(c){a._handleSelect(c,c.target)});if(this.allowSelectAll)this.on("keydown",function(c){c[f]&&65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className)&&(c.preventDefault(),a[a.allSelected?"clearSelection":
"selectAll"]())});this._setStore&&k.after(this,"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,e){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[e](a,null,c)}var b=this,e=this.store,f,d;this._removeDeselectSignals&&this._removeDeselectSignals();e&&e.notify?(f=k.before(e,"notify",function(c,b){c||a(c,b,"deselect")}),d=k.after(e,"notify",function(c,b){a(c,b,"select")},!0),this._removeDeselectSignals=
function(){f.remove();d.remove()}):(f=k.before(this,"removeRow",function(a,c){var b;c||(b=this.row(a))&&b.id in this.selection&&this.deselect(b)}),this._removeDeselectSignals=function(){f.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var c=this._selectionEventQueues[a],b=this._selectionTriggerEvent,e;e={bubbles:!0,grid:this};b&&(e.parentType=b.type);e[this._selectionTargetType]=c;this._selectionEventQueues[a]=[];p.emit(this.contentNode,"dgrid-"+a,e)},_fireSelectionEvents:function(){var a=
this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,e){var c,f,d;"undefined"===typeof e&&(e=!0);a.element||(a=this.row(a));if(!1===e||this.allowSelect(a))if(c=this.selection,f=!!c[a.id],null===e&&(e=!f),d=a.element,e||this.allSelected?c[a.id]=e:delete this.selection[a.id],d&&(e?u(d,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):u(d,"!dgrid-selected!ui-state-active")),e!==f&&d&&this._selectionEventQueues[(e?"":"de")+"select"].push(a),
b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(c=this._determineSelectionDirection(d,b),c||(b=document.getElementById(b.id),c=this._determineSelectionDirection(d,b));a.element!=b&&(a=this[c](a));)this._select(a,null,e)}else this._lastSelected=d,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:l("dom-comparedocumentposition")?function(a,b){var c=b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,e){this._select(a,b,e);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this,b=this.inherited(arguments);q.when(b,function(b){var c=a.selection,e,f,d;for(e=0;e<b.length;e++)f=a.row(b[e]),(d=f.id in c?c[f.id]:a.allSelected)&&a._select(f,null,d);a._fireSelectionEvents()});return b}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(g,d,q,p,l,k){var n,r,u=d("ie"),h=u&&d("quirks"),
w=8>u||h?"htmlFor":"for";return g("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:k,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var f=this.subRows,e=!0,b,a,d,c;delete this._columnHiderFirstCheckbox;d=0;for(b=f.length;d<b;d++)for(c=0,a=f[d].length;c<a;c++)this._renderHiderMenuEntry(f[d][c]),e&&(e=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[f[d][c].id])},_renderHiderMenuEntry:function(f){var e=
f.id,b=p.escapeCssIdentifier(e,"-"),a,d;f.hidden&&(f.hidden=!1,this._hideColumn(e),f.hidden=!0);f.unhidable||(a=l("div.dgrid-hider-menu-row"),d=this.domNode.id+"-hider-menu-check-"+b,e=this._columnHiderCheckboxes[e]=l(a,"input.dgrid-hider-menu-check.hider-menu-check-"+b+"[type\x3dcheckbox]"),e.id=d,l(a,"label.dgrid-hider-menu-label.hider-menu-label-"+b+"["+w+"\x3d"+d+"]",f.label||f.field||""),l(this.hiderMenuNode,a),f.hidden||(e.checked=!0))},renderHeader:function(){function f(a){a.stopPropagation()}
var e=this,b=this.hiderMenuNode,a=this.hiderToggleNode,d;this.inherited(arguments);if(b){for(d in this._columnHiderRules)this._columnHiderRules[d].remove();b.innerHTML=""}else a=this.hiderToggleNode=l(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(q(a,"click",function(a){e._toggleColumnHiderMenu(a)})),b=this.hiderMenuNode=l("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+
"]"),b.id=this.id+"-hider-menu",this._listeners.push(q(b,"keyup",function(b){27===(b.charCode||b.keyCode)&&(e._toggleColumnHiderMenu(b),a.focus())})),b.style.display="none",l(this.domNode,b),this._listeners.push(q(b,".dgrid-hider-menu-check:"+(9>u||h?"click":"change"),function(a){e._updateColumnHiddenState(a.target.id.substr(e.id.length+18),!a.target.checked)})),this._listeners.push(q(b,"mousedown",f),q(a,"mousedown",f)),r||(r=q.pausable(document,"mousedown",function(a){n&&n._toggleColumnHiderMenu(a)}),
r.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);for(var d in this._columnHiderRules)this._columnHiderRules[d].remove()},left:function(d,e){return this.right(d,-e)},right:function(d,e){d.element||(d=this.cell(d));for(var b=this.inherited(arguments),a=d;b.column.hidden;){b=this.inherited(arguments,[b,0<e?1:-1]);if(a.element===b.element)return d;a=b}return b},isColumnHidden:function(d){return!!this._columnHiderRules[d]},
_toggleColumnHiderMenu:function(){var d=this._hiderMenuOpened,e=this.hiderMenuNode,b=this.domNode,a;e.style.display=d?"none":"";d?e.style.height="":(e.offsetHeight>b.offsetHeight-12&&(e.style.height=b.offsetHeight-12+"px"),(a=this._columnHiderFirstCheckbox)&&a.focus());r[d?"pause":"resume"]();n=d?null:this;this._hiderMenuOpened=!d},_hideColumn:function(f){var e=this,b="#"+p.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",a;this._columnHiderRules[f]||(this._columnHiderRules[f]=p.addCssRule(b+
p.escapeCssIdentifier(f,"-"),"display: none;"),8!==d("ie")&&10!==d("ie")||d("quirks")||(a=p.addCssRule(".dgrid-row-table","display: inline-table;"),window.setTimeout(function(){a.remove();e.resize()},0)))},_showColumn:function(d){this._columnHiderRules[d]&&(this._columnHiderRules[d].remove(),delete this._columnHiderRules[d])},_updateColumnHiddenState:function(d,e){this[e?"_hideColumn":"_showColumn"](d);this.columns[d].hidden=e;q.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[d],
hidden:e,bubbles:!0});this.resize()},toggleColumnHiddenState:function(d,e){"undefined"===typeof e&&(e=!this._columnHiderRules[d]);this._updateColumnHiddenState(d,e);this._columnHiderCheckboxes[d].checked=!e}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(g,d,q,p,l,k,n,r,u){function h(a){for(var b=
a.length,c=b,e=a[0].length,d=Array(b);b--;)d[b]=Array(e);for(var f={},b=0;b<c;b++)for(var g=d[b],h=a[b],k=0,v=0;k<e;k++){var x=h[v],l;if("undefined"==typeof g[k]){g[k]=x.id;if(x.rowSpan&&1<x.rowSpan){l=d;for(var n=x.rowSpan,r=b,q=k,u=x.id,p=1;p<n;p++)l[r+p][q]=u}if(0<b&&x.colSpan&&1<x.colSpan)for(l=1;l<x.colSpan;l++)if(g[++k]=x.id,x.rowSpan&&1<x.rowSpan)for(var n=d,r=x.rowSpan,q=b,u=k,p=x.id,w=1;w<r;w++)n[q+w][u]=p;f[x.id]=a[0][k].id;v++}}return f}function w(a,b,c,e,f){if(!(0>=c)){var g=a.columns[b],
h;if(g&&(h={grid:a,columnId:b,width:c,bubbles:!0,cancelable:!0},e&&(h.parentType=e),!a._resizedColumns||d.emit(a.headerNode,"dgrid-columnresize",h)))return"auto"===c?delete g.width:(g.width=c,c+="px"),(e=a._columnSizes[b])?e.set("width",c):e=r.addCssRule("#"+r.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+r.escapeCssIdentifier(b,"-"),"width: "+c+";"),a._columnSizes[b]=e,!1!==f&&a.resize(),!0}}var f,e=0,b={create:function(){f=u("div.dgrid-column-resizer")},destroy:function(){u(f,"!");f=null},
show:function(a){a=k.position(a.domNode,!0);f.style.top=a.y+"px";f.style.height=a.h+"px";u(document.body,f)},move:function(a){f.style.left=a+"px"},hide:function(){f.parentNode.removeChild(f)}};return g("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);e++||b.create()},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--e||b.destroy()},
resizeColumnWidth:function(a,b){return w(this,a,b)},configStructure:function(){var a=this._oldColumnSizes=p.mixin({},this._columnSizes),b;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);for(b in a)b in this._columnSizes||a[b].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var b=a.id,c;"width"in a&&((c=this._oldColumnSizes[b])?c.set("width",a.width+"px"):c=r.addCssRule("#"+r.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+r.escapeCssIdentifier(b,
"-"),"width: "+a.width+"px;"),this._columnSizes[b]=c)},renderHeader:function(){this.inherited(arguments);var a=this,b;if(this.columnSets&&this.columnSets.length)for(var c=this.columnSets.length;c--;)b=p.mixin(b||{},h(this.columnSets[c]));else this.subRows&&1<this.subRows.length&&(b=h(this.subRows));for(var c=q(".dgrid-cell",a.headerNode),e=c.length;e--;){var f=c[e],g=f.columnId,k=a.columns[g],l=f.childNodes;if(k&&!1!==k.resizable){k=u("div.dgrid-resize-header-container");for(f.contents=k;0<l.length;)u(k,
l[0]);u(f,k,"div.dgrid-resize-handle.resizeNode-"+r.escapeCssIdentifier(g,"-")).columnId=b&&b[g]||g}}a.mouseMoveListen||(d(a.headerNode,".dgrid-resize-handle:mousedown"+(n("touch")?",.dgrid-resize-handle:touchstart":""),function(b){a._resizeMouseDown(b,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=d.pausable(document,"mousemove"+(n("touch")?",touchmove":""),r.throttleDelayed(function(b){a._updateResizerPosition(b)}))),a._listeners.push(a.mouseUpListen=
d.pausable(document,"mouseup"+(n("touch")?",touchend":""),function(b){a._resizeMouseUp(b);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,e){a.preventDefault();l.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=q(".dgrid-column-"+r.escapeCssIdentifier(e.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);b.show(this)},_resizeMouseUp:function(a){var e=this._columnSizes,
c,d,f;this.adjustLastColumn&&(f=this.headerNode.clientWidth-1);this._resizedColumns||(c=q(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?c=c.filter(function(a){return"0"==a.columnId.split("-")[0]&&!(a.columnId in e)}):this.subRows&&1<this.subRows.length&&(c=c.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in e)})),d=c.map(function(a){return a.offsetWidth}),c.forEach(function(a,b){w(this,a.columnId,d[b],null,!1)},this),this._resizedColumns=!0);l.setSelectable(this.domNode,
!0);c=this._targetCell;var g=this._getResizeMouseLocation(a)-this._startX,h=c.offsetWidth+g,k=this._getResizedColumnWidths(),n=k.totalWidth,k=k.lastColId,v=q(".dgrid-column-"+r.escapeCssIdentifier(k,"-"),this.headerNode)[0].offsetWidth;h<this.minWidth&&(h=this.minWidth);w(this,c.columnId,h,a.type)&&c.columnId!=k&&this.adjustLastColumn&&(n+g<f?w(this,k,"auto",a.type):v-g<=this.minWidth&&w(this,k,this.minWidth,a.type));b.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=
this._getResizeMouseLocation(a);var e=this._targetCell.offsetWidth,c=a;e+(a-this._startX)<this.minWidth&&(c=this._startX-(e-this.minWidth));b.move(c)}},_getResizeMouseLocation:function(a){var b=0;a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return b},_getResizedColumnWidths:function(){var a=0,b=q((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=b.length;if(!c)return{};for(var e=b[c-1].columnId;c--;)a+=
b[c].offsetWidth;return{totalWidth:a,lastColId:e}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),function(g,d,q,p,l,k,n){function r(d,e){var b=e[2],a=d[b?"columnSets":"subRows"][e[1]];return b?a[e[2]]:a}function u(d,e,b){e[2]?d.columnSets[e[1]][e[2]]=b:d.subRows[e[1]]=b}function h(d,e){return e.slice(("dgrid-"+d+"-").length)}
var w=/(\d+)(?:-(\d+))?$/;g=d(k,{copyState:function(){return!1},checkAcceptance:function(d,e){return d==this},_legalMouseDown:function(d){return-1<d.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(d){var e=this.grid,b=w.exec(h(e.id,d[0].getAttribute("dndType"))),a=b[2]?"columnSets":"subRows",f=r(e,b),c=e.columns;this.inherited(arguments);b&&setTimeout(function(){var g=q.map(d[0].parentNode.childNodes,function(a){return c[a.columnId]});u(e,b,g);
g={grid:e,subRow:g,column:c[d[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};g[a]=e[a];p.emit(e.domNode,"dgrid-columnreorder",g)?e.set(a,e[a]):(u(e,b,f),e.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});d=d("dgrid.extensions.ColumnReorder",null,{columnDndConstructor:g,_initSubRowDnd:function(d,e){var b,a,f,c;a=0;for(f=d.length;a<f;a++)c=d[a],!1!==c.reorderable&&(c=c.headerNode,"TH"!=c.tagName&&(c=c.parentNode),n(c,".dojoDndItem[dndType\x3d"+e+"]"),b||
(b=c.parentNode));b&&this._columnDndSources.push(new this.columnDndConstructor(b,{horizontal:!0,grid:this}))},renderHeader:function(){var d="dgrid-"+this.id+"-",e,b;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(b=0,e=this.columnSets.length;b<e;b++)q.forEach(this.columnSets[b],function(a,e){this._initSubRowDnd(a,d+b+"-"+e)},this);else q.forEach(this.subRows,function(a,b){this._initSubRowDnd(a,d+b)},this)},_destroyColumns:function(){this._columnDndSources&&q.forEach(this._columnDndSources,
function(d){d.destroy()});this.inherited(arguments)}});d.ColumnDndSource=g;return d})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(g,d,q,p,l,k,n,r){q("dijit-legacy-requires")&&l(0,function(){g(["dijit/ToolbarSeparator"])});return d("dijit.Toolbar",[k,r,n],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',
baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(g,d,q,p,l,k,n){g=g(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var d=q.map(this.geometries1,function(d){return d.toJson()}),
g=q.map(this.geometries2,function(d){return d.toJson()}),h={},k=this.geometries1;k&&0<k.length&&(h.geometries1=p.toJson({geometryType:n.getJsonType(k[0]),geometries:d}),d=this.geometries1[0].spatialReference,h.sr=d.wkid?d.wkid:p.toJson(d.toJson()));(d=this.geometries2)&&0<d.length&&(h.geometries2=p.toJson({geometryType:n.getJsonType(d[0]),geometries:g}));this.relation&&(h.relation=this.relation);this.relationParam&&(h.relationParam=this.relationParam);return h}});d.mixin(g,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",
SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",
SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});l("extend-esri")&&d.setObject("tasks.RelationParameters",g,k);return g})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(g,d,q,p,l,k,n,r,u,h){function w(f){var e=d.clone(f.attributes);(f=f.geometry)&&"point"===f.type&&("x"in e?e._x=f.x:e.x=f.x,"y"in e?e._y=f.y:e.y=f.y);return e}g.exportCSV=function(d,
e,b){return g._createCSVStr(e,b).then(function(a){return g._download(d+".csv",a)})};g.exportCSVFromFeatureLayer=function(d,e,b){b=b||{};return g._getExportData(e,{datas:b.datas,fromClient:b.fromClient,withGeometry:b.withGeometry,outFields:b.outFields,filterExpression:b.filterExpression}).then(function(a){return g._formattedData(e,a,{formatNumber:b.formatNumber,formatDate:b.formatDate,formatCodedValue:b.formatCodedValue,popupInfo:b.popupInfo}).then(function(a){return g.exportCSV(d,a.datas,a.columns)})})};
g.exportCSVByAttributes=function(f,e,b,a){a=d.mixin({},a);a.datas=b;return g.exportCSVFromFeatureLayer(f,e,a)};g.exportCSVByGraphics=function(d,e,b,a){b=q.map(b,function(a){return a.attributes});return g.exportCSVByAttributes(d,e,b,a)};g._createCSVStr=function(d,e){var b=new k,a="",f=0,c=0,g="",h="";try{q.forEach(e,function(b){a=a+g+b;g=","});for(var a=a+"\r\n",f=d.length,c=e.length,l=0;l<f;l++){for(var g="",n=0;n<c;n++)(h=d[l][e[n]])||"number"===typeof h||(h=""),h&&/[",\r\n]/g.test(h)&&(h='"'+h.replace(/(")/g,
'""')+'"'),a=a+g+h,g=",";a+="\r\n"}b.resolve(a)}catch(G){console.error(G),b.resolve("")}return b};g._isIE11=function(){return 11===n.has("ie")};g._isEdge=function(){return n.has("edge")};g._getDownloadUrl=function(d){return window.Blob&&window.URL&&window.URL.createObjectURL?(d=new Blob(["\ufeff"+d],{type:"text/csv"}),URL.createObjectURL(d)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(d)};g._download=function(d,e){var b=new k;try{if(l("ie")&&10>l("ie")){var a=window.top.open("about:blank",
"_blank");a.document.write("sep\x3d,\r\n"+e);a.document.close();a.document.execCommand("SaveAs",!0,d);a.close()}else if(10===l("ie")||g._isIE11()||g._isEdge()){var f=new Blob(["\ufeff"+e],{type:"text/csv"});navigator.msSaveBlob(f,d)}else{var c=p.create("a",{href:g._getDownloadUrl(e),target:"_blank",download:d},document.body);if(l("safari")){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);c.dispatchEvent(h)}else c.click();p.destroy(c)}b.resolve()}catch(C){b.reject(C)}return b};
g._getExportData=function(f,e){var b=new k,a=null,h=e.datas,c=e.withGeometry,a=e.outFields;a&&a.length||(a=f.fields);a=d.clone(a);if(c&&!(h&&0<h.length)){var l="",l=-1!==a.indexOf("x")?"_x":"x";a.push({name:l,alias:l,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});l=-1!==a.indexOf("y")?"_y":"y";a.push({name:l,alias:l,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?b.resolve({data:h||[],outFields:a}):e.fromClient?(h=q.map(f.graphics,function(a){return c?
w(a):d.clone(a)}),b.resolve({data:h||[],outFields:a})):g._getExportDataFromServer(f,a,e).then(function(c){b.resolve({data:c||[],outFields:a})});return b};g._getExportDataFromServer=function(d,e,b){var a=new k;if("esri.layers.FeatureLayer"!==d.declaredClass)return a.resolve([]),a;var f=new u(d.url),c=new h;c.where=b.filterExpression||d.getDefinitionExpression&&d.getDefinitionExpression()||"1\x3d1";0<e.length?(d=q.map(e,function(a){return a.name}),c.outFields=d):c.outFields=["*"];c.returnGeometry=b.withGeometry;
f.execute(c,function(b){b=q.map(b.features,function(a){return w(a)});a.resolve(b)},function(b){console.error(b);a.resolve([])});return a};g._formattedData=function(d,e,b){var a=new k,f=[],c=e.data;e=e.outFields;for(var h=0,l=c.length;h<l;h++){for(var n={},p=0;p<e.length;p++){var r=e[p];n[r.alias||r.name]=g._getExportValue(c[h][r.name],r,d.objectIdField,d.typeIdField,c[h][d.typeIdField],d.types,b)}f.push(n)}d=q.map(e,function(a){return a.alias||a.name});a.resolve({datas:f,columns:d});return a};g._getExportValue=
function(d,e,b,a,g,c,h){function f(a){if(k&&r.isDefined(k.fieldInfos))for(var b=0,c=k.fieldInfos.length;b<c;b++){var e=k.fieldInfos[b];if(e.fieldName===a)return e.format}return null}var k=h.popupInfo,l=!!e.domain&&h.formatCodedValue;h="esriFieldTypeDate"===e.type&&h.formatDate;var p=b&&e.name===b;a=a&&e.name===a;return h?n.fieldFormatter.getFormattedDate(d,f(e.name)):a?n.fieldFormatter.getTypeName(d,c):l?n.fieldFormatter.getCodedValue(e.domain,d):l||h||p||a?d:(l=null,b&&c&&0<c.length&&(b=(b=q.filter(c,
function(a){return a.id===g}))&&b[0])&&b.domains&&b.domains[e.name]&&b.domains[e.name].codedValues&&(l=n.fieldFormatter.getCodedValue(b.domains[e.name],d)),null!==l?l:d)}})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/utils".split(" "),function(g,d,q,p,l,k,n,r,u,h,w,f){function e(b,a){if(!b||
!b.length)return a||[];if(!a||!a.length)return b;for(var e=[],c=0,d=b.length;c<d;c++)for(var f=b[c],g=0,h=a.length;g<h;g++)if(a[g].name===f.name){e.push(f);break}return e}k.readLayerInfosObj=function(b){return q.getInstance(b,b.itemInfo)};k.readLayerInfosFromMap=function(b,a,e){var c=new p;q.getInstance(b,b.itemInfo).then(g.hitch(this,function(b){var f=[];a?b.traversalLayerInfosOfWebmap(function(a){f.push(a)}):b.traversal(function(a){f.push(a)});if(e){var g=[],h=b.getMapNotesLayerInfoArray();d.forEach(h,
function(a){g.push(a.id);a.traversal(function(a){g.push(a.id)})});f=d.filter(f,function(a){return-1===g.indexOf(a.id)})}b=b.getTableInfoArray();f=f.concat(b);c.resolve(f)}),g.hitch(this,function(a){console.error(a);c.reject(a)}));return c.promise};k.generateColumnsFromFields=function(b,a,e,c,f,l){function n(a){if(b&&h.isDefined(b.fieldInfos))for(var c=0,e=b.fieldInfos.length;c<e;c++){var d=b.fieldInfos[c];if(d.fieldName===a)return d.format}return null}var p={selectionHandle:{label:"",className:"selection-handle-column",
hidden:!1,unhidable:!0,filed:"selection-handle-column",sortable:!1,_cache:{sortable:!1,statistics:!1}}};d.forEach(a,g.hitch(k,function(a,b,v){b="field"+b;var x=!!a.domain,r="esriFieldTypeDate"===a.type,q=e&&a.name===e,u="esriFieldTypeDouble"===a.type||"esriFieldTypeSingle"===a.type||"esriFieldTypeInteger"===a.type||"esriFieldTypeSmallInteger"===a.type,t="esriFieldTypeString"===a.type;p[b]={label:a.alias||a.name,className:b,hidden:1===v.length?!1:!a.show&&h.isDefined(a.show),unhidable:1===v.length?
!1:!a.show&&h.isDefined(a.show)&&a._pk,field:a.name,sortable:!1,_cache:{sortable:!!f,statistics:l&&!x&&u}};t?p[b].formatter=g.hitch(k,k.urlFormatter):r?p[b].formatter=g.hitch(k,k.dateFormatter,n(a.name)):u&&(p[b].formatter=g.hitch(k,k.numberFormatter,n(a.name)));x?p[b].get=g.hitch(k,function(a,b){return this.getCodeValue(a.domain,b[a.name])},a):q?p[b].get=g.hitch(k,function(a,b,c){return this.getTypeName(c[a.name],b)},a,c):x||r||q||(p[b].get=g.hitch(k,function(a,b,c,e){var f=null;b&&c&&0<c.length&&
(c=(c=d.filter(c,g.hitch(k,function(a){return a.name===e[b]})))&&c[0]||null)&&c.domains&&c.domains[a.name]&&c.domains[a.name].codedValues&&(f=this.getCodeValue(c.domains[a.name],e[a.name]));return(a=null!==f?f:e[a.name])||isFinite(a)?a:""},a,e,c))}));return p};k.getTypeName=function(b,a){return f.fieldFormatter.getTypeName(b,a)};k.getCodeValue=function(b,a){return f.fieldFormatter.getCodedValue(b,a)};k.urlFormatter=function(b){return f.fieldFormatter.getFormattedUrl(b)};k.dateFormatter=function(b,
a){return f.fieldFormatter.getFormattedDate(a,b)};k.numberFormatter=function(b,a){return f.fieldFormatter.getFormattedNumber(a,b)};k.readLayerObjectsFromMap=function(b,a,e){var c=new p,f=[];this.readLayerInfosFromMap(b,a,e).then(g.hitch(this,function(a){d.forEach(a,g.hitch(this,function(a){f.push(a.getLayerObject())}));l(f).then(g.hitch(this,function(a){c.resolve(a)}),g.hitch(this,function(a){c.reject(a);console.error(a)}))}),g.hitch(this,function(a){c.reject(a)}));return c.promise};k.readSupportTableInfoFromLayerInfos=
function(b){var a=new p,e=[];d.forEach(b,g.hitch(this,function(a){e.push(a.getSupportTableInfo())}));l(e).then(g.hitch(this,function(c){c=g.clone(c);d.forEach(c,function(a,c){a.id=b[c].id});a.resolve(c)}),function(b){a.reject(b)});return a.promise};k.readConfigLayerInfosFromMap=function(b,a,e){var c=new p,f=[];this.readLayerInfosFromMap(b,a,e).then(g.hitch(this,function(a){var b=[];d.forEach(a,function(a){f.push(a.getSupportTableInfo())});l(f).then(g.hitch(this,function(e){d.forEach(e,g.hitch(this,
function(c,e){c.isSupportedLayer&&(a[e].name=a[e].title,b.push(a[e]))}));c.resolve(b)}),g.hitch(this,function(a){c.reject(a)}))}),g.hitch(this,function(a){c.reject(a)}));return c.promise};k.getConfigInfosFromLayerInfos=function(b){return d.map(b,function(a){return k.getConfigInfoFromLayerInfo(a)})};k.getConfigInfoFromLayerInfo=function(b){var a={};a.name=b.name||b.title;a.id=b.id;a.show=b.isShowInMap();a.layer={url:b.getUrl()};var f=b.getPopupInfo();f&&!f.description&&(a.layer.fields=d.map(f.fieldInfos,
function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),b=g.getObject("layerObject.fields",!1,b),a.layer.fields=e(a.layer.fields,b),d.some(a.layer.fields,function(a){return a.show})||(a.layer.fields&&0<a.layer.fields.length?a.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return a};k.generateCacheStore=function(b,a,e,c,d){b=new w({layer:b,objectIds:b._objectIds||null,totalCount:a,batchCount:e,where:c||"1\x3d1",spatialFilter:d});a=new u;return new r(b,
a,{})};k.generateMemoryStore=function(b,a){return new n(new u({data:b||[],idProperty:a}))};k.merge=function(b,a,e,c){for(var f=d.map(a,function(a){return a[e]}),g=0,h=b.length;g<h;g++){var k=f.indexOf(b[g][e]);-1<k&&c(b[g],a[k])}};k.syncOrderWith=function(b,a,e){function c(a,b){return d.map(a,function(a){return a[b]})}if(!g.isArray(a)||!e)return b;for(var f=c(b,e),h=[],k=0,l=a.length;k<l;k++){var n=f.indexOf(a[k][e]);-1<n&&(h=h.concat(b.splice(n,1)),f=c(b,e))}return h.concat(b)}})},"dojo/store/Cache":function(){define(["../_base/lang",
"../when"],function(g,d){var q=function(p,l,k){k=k||{};return g.delegate(p,{query:function(d,g){var n=p.query(d,g);n.forEach(function(d){k.isLoaded&&!k.isLoaded(d)||l.put(d)});return n},queryEngine:p.queryEngine||l.queryEngine,get:function(g,k){return d(l.get(g),function(n){return n||d(p.get(g,k),function(d){d&&l.put(d,{id:g});return d})})},add:function(g,k){return d(p.add(g,k),function(d){l.add(d&&"object"==typeof d?d:g,k);return d})},put:function(g,k){l.remove(k&&k.id||this.getIdentity(g));return d(p.put(g,
k),function(d){l.put(d&&"object"==typeof d?d:g,k);return d})},remove:function(g,k){return d(p.remove(g,k),function(d){return l.remove(g,k)})},evict:function(d){return l.remove(d)}})};g.setObject("dojo.store.Cache",q);return q})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(g,d,q,p,l,k){return g(null,{queryUrl:"",idProperty:"id",data:null,
_entityData:null,constructor:function(d){g.safeMixin(this,d);this.data=[];this._entityData=[];this.layer=d.layer;this.objectIds=d.objectIds;this.where=d.where;this.orderByFields=d.orderByFields;this.totalCount=d.totalCount;this.batchCount=d.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=d.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new l(this.layer.url))},get:function(d){return this.data[d]},getIdentity:function(d){return d[this.idProperty]},query:function(g,
l){var n=new p,h=l&&l.start||0,r=this.batchCount,f=null;"function"===typeof g?f=g(this._entityData):"[object Array]"===Object.prototype.toString.call(g)&&(f=g);this.objectIds?(f=f?f:this.objectIds,n.objectIds=f.length>=h+this.batchCount?f.slice(h,h+r):f.slice(h)):(f&&0<f.length?n.objectIds=f.length>=h+this.batchCount?f.slice(h,h+r):f.slice(h):(n.start=h,n.num=r,n.where=this.where,n.geometry=this.spatialFilter,n.spatialRelationship=p.SPATIAL_REL_INTERSECTS),(h=l.sort)&&0<h.length&&(h=q.map(h,function(b){return b.attribute+
" "+(b.descending?"DESC":"ASC")}),n.orderByFields=h));n.returnGeometry="esriGeometryPoint"===this.layer.geometryType;n.outFields=["*"];var e=this.totalCount,h=null,h=!n.where;if(!(n.objectIds&&0<n.objectIds.length)&&h)return new k([]);h=this.queryTask?this.queryTask.execute(n):this.layer.queryFeatures(n);h.total=h.then(d.hitch(this,function(b){var a=0,f=this.layer.objectIdField;if(this.objectIds){if(!f)for(a=0;a<b.fields.length;a++)if("esriFieldTypeOID"===b.fields[a].type){f=b.fields[a].name;break}for(var c=
{},a=0;a<b.features.length;a++)c[b.features[a].attributes[f]]=b.features[a];b.features=q.map(n.objectIds,function(a){return c[a]})}for(a=0;a<b.features.length;a++)if(b.features[a]){var g=b.features[a];b.features[a]=d.mixin(d.clone(g.attributes),{geometry:g.geometry});this.data[b.features[a][f]]=b.features[a];this._entityData.push(b.features[a])}b=b.features;return e}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new k(h)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),
function(g,d,q,p){var l=function(k){function n(d){k[d]||(k[d]=function(){var g=arguments;return p.when(k,function(h){Array.prototype.unshift.call(g,h.features||h);return l(q[d].apply(q,g))})})}if(!k)return k;k.then&&(k=d.delegate(k));k.total||(k.total=p.when(k,function(d){return g._isDefined(d.total)?d.total:d.length||0}));n("forEach");n("filter");n("map");n("some");n("every");return k};return l})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],
function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}',
"*now":function(g){g(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils".split(" "),function(g,d,q,p,l,k,n,r,u,h,w,f,e,b,a,z,c,t,C,F,J,G,D){g=g([p,q],{name:"AttributeTable",baseClass:"jimu-widget-attributetable",
normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);n.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.AttributeTableDiv=this._loadInfoDef=null;this._delayedLayerInfos=[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=
!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=J.getInstance();this._createUtilitiesUI();this._resourceManager=new G({map:this.map,nls:this.nls});this._resourceManager.setConfig(this.config);this.own(z.subscribe("changeMapPosition",e.hitch(this,this._onMapPositionChange)));
D.readLayerInfosObj(this.map).then(e.hitch(this,function(a){this.domNode&&a&&(this.own(b(a,"layerInfosIsShowInMapChanged",e.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",e.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",e.hitch(this,this.onLayerInfosFilterChanged))))}))},_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=d.create("div");d.addClass(this.arrowDiv,"jimu-widget-attributetable-move");
d.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);d.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var c=d.getMarginBox(this.arrowDiv);this.arrowDivHeight=c&&c.h?c.h:7}this.own(b(this.arrowDiv,"mousedown",e.hitch(this,this._onDragStart)));this.own(b(this.arrowDiv,a.press,e.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||(this.switchBtn=d.create("div",{className:"jimu-widget-attributetable-switch"},
this.domNode),this.own(b(this.switchBtn,"click",e.hitch(this,this._switchTable))))},_processOpenBarUI:function(){this._isOnlyTable()||(d.removeClass(this.switchBtn,"close"),d.addClass(this.switchBtn,"open"),d.setAttr(this.switchBtn,"title",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(d.removeClass(this.switchBtn,"open"),d.addClass(this.switchBtn,"close"),d.setAttr(this.switchBtn,"title",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():
this._openTable()},_openTable:function(){this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):(this._loadInfoDef=new u,this.own(this._loadInfoDef),this.loading||(this.loading=new F),this.loading.placeAt(this.domNode),this.loading.show(),this._resourceManager.updateLayerInfoResources(!0).then(e.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),
e.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;
d.setStyle(this.arrowDiv,"display","none");d.setStyle(this.domNode,"overflow","hidden");setTimeout(e.hitch(this,function(){this.domNode&&(d.setStyle(this.domNode,"overflow","visible"),d.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(b(window.document,"mouseup",e.hitch(this,this._onDragEnd)));this.own(b(window.document,"mousemove",e.hitch(this,this._onDraging)));this.own(b(window.document,a.move,e.hitch(this,
this._onDraging)));this.own(b(window.document,a.release,e.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(t.forEach(this._delayedLayerInfos,e.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(){this._activeTable&&this._activeTable.changeToolbarStatus()},onLayerInfosChanged:function(a,b,c){c&&a&&("added"===b?c.getSupportTableInfo().then(e.hitch(this,function(a){a.isSupportedLayer&&
this._resourceManager.addLayerInfo(c)})):"removed"===b&&(a=c.id,this.getExistLayerTabPage(a)&&this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){t.some(a,e.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},
destroy:function(){if(!this._destroyed){var a,b;if(this.layerTabPages&&0<this.layerTabPages.length){a=this.layerTabPages.length;for(b=0;b<a;b++){var c=this.layerTabPages[b].paneId,d=e.getObject("_resourceManager.featureTableSet."+c,!1,this);d&&(d=d.getFilterObj())&&f.isDefined(d.expr)&&this.filterManager.applyWidgetFilter(c,this.id,"");this.layerTabPages[b].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=
this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&this._openTable()},onClose:function(){this.showing&&this._closeTable()},_changeHeight:function(a){d.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&d.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);
z.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?d.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):d.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?d.setStyle(this.domNode,"left",parseFloat(a.right)+
"px"):d.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(d.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));d.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||
setTimeout(e.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=d.getStyle(this.domNode,"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(a,b){var c=this._resourceManager.getLayerInfoById(a),f=this.getExistLayerTabPage(a);c&&f&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton).then(e.hitch(this,function(c){this._activeLayerInfoId===a&&c&&(f=this.getExistLayerTabPage(a),
c.isSupportQuery?(c=c.table,c.getParent()!==f&&c.placeAt(f),this.setActiveTable(c,{h:this.openHeight-this.noGridHeight,featureSet:b})):(c=d.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),f.set("content",c),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),e.hitch(this,function(a){new r({message:a.message||a});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(a,b,c,f){var g=this._resourceManager.getLayerInfoById(f),h=this.getExistLayerTabPage(a);
g&&g.layerObject&&h&&this._resourceManager.getRelationTable(f,b,!1,this.config.hideExportButton).then(e.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(h=this.getExistLayerTabPage(a),b.isSupportQuery?(b=b.table,b.getParent()!==h&&b.placeAt(h),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,layer:g.layerObject,selectedIds:c})):(b=d.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),h.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},
tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,e=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),
b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=c,this._startQueryOnRelationTab(c,e,b,a))}},showRefreshing:function(a){this.loading&&(a?this.loading.show():this.loading.hide())},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=d.getStyle(this.domNode,"height");d.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([b(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),b(this.ownerDocumentBody,
"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;d.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){d.setStyle(this.domNode,
"top","auto");d.setStyle(this.domNode,"left","0px");d.setStyle(this.domNode,"right","0px");d.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(b(a._activeTable,"show-related-records",function(b){a._showRelatedRecords(b)})),a._activeTableHandles.push(b(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=
a._layerTypes.FEATURELAYER})),a._activeTableHandles.push(b(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(b(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(a,b){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(b.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&b.featureSet||b.layer&&b.selectedIds){var c=e.getObject("featureSet.features.length",!1,b);if(b.layer&&b.selectedIds)this._activeTable.queryRecordsByRelationship(b);
else if(c){var d=b.featureSet.displayFieldName,c=t.map(b.featureSet.features,function(a){return a.attributes[d]});this._activeTable.startQuery(c)}else this._activeTable.startQuery()}this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=d.create("div",{},this.domNode);d.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=d.create("div");d.place(a,this.AttributeTableDiv);this.tabContainer=new l({style:"width: 100%;"},a);
d.setStyle(this.tabContainer.domNode,"height",this.normalHeight+"px");this.tabContainer.startup();for(var a=this._resourceManager.getConfigInfos(),b=a.length,f=0;f<b;f++){var g=a[f];if(g.show){var g=e.clone(g),h={};h.paneId=g.id;h.title=g.name;h.name=g.name;h.layerType=this._layerTypes.FEATURELAYER;h.style="height: 100%; width: 100%; overflow: visible;";g=new k(h);this.layerTabPages[f]=g;this.tabContainer.addChild(g)}}0<b&&(this.noGridHeight=this._getGridTopSectionHeight()+5);n.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(c.after(this.tabContainer,"selectChild",e.hitch(this,this.tabChanged)))},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=C(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=d.position(this.domNode).y;return d.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=t.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecords:function(){var a=
this._activeTable;if(a){var b=a.layerInfo;if(b&&b.layerObject)for(var c=b.layerObject.relationships,a=a.getSelectedRows(),e=0,d=c.length;e<d;e++)this.addNewRelationTab(a,c[e],b.id)}},addNewLayerTab:function(a,c){var d=this._resourceManager.getLayerInfoById(a);if(d){var f=this.getExistLayerTabPage(a),g={};g.title=this.getLayerInfoLabel(d);g.name=g.title;g.paneId=this.getLayerInfoId(d);g.closable=!0;g.layerType=this._layerTypes.FEATURELAYER;g.featureSet=c;f?(e.mixin(f.params,g),this.onOpen()):(this._resourceManager.getConfigInfoById(d.id)||
this._resourceManager.addConfigInfo(d),this._resourceManager.getLayerInfoById(d.id)||this._resourceManager.addLayerInfo(d),this.onOpen(),g.style="height: 100%; width: 100%; overflow: visible",f=new k(g),this.layerTabPages.push(f),f.set("title",g.name),this.own(b(f,"close",e.hitch(this,this.layerTabPageClose,g.paneId))),this.tabContainer.addChild(f));this.tabContainer.selectChild(f)}},addNewRelationTab:function(a,c,d){var f=c&&c.shipInfo;if(f){var g=this.getExistLayerTabPage(c.shipInfo.id),h={};h.oids=
a;h.title=f.title||f.name||c.name;h.name=h.title;h.paneId=f.id;h.relKey=c._relKey;h.originalInfoId=d;h.closable=!0;h.layerType=this._layerTypes.RELATIONSHIPTABLE;g?e.mixin(g.params,h):(this._resourceManager.getConfigInfoById(f.id)||this._resourceManager.addConfigInfo(f),this._resourceManager.getLayerInfoById(f.id)||this._resourceManager.addLayerInfo(f),h.style="height: 100%; width: 100%; overflow: visible",g=new k(h),this.layerTabPages.push(g),g.set("title",h.name),this.own(b(g,"close",e.hitch(this,
this.layerTabPageClose,h.paneId))),this.tabContainer.addChild(g));this.tabContainer.selectChild(g)}},onReceiveData:function(a,b,c){c&&"AttributeTable"===c.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(c.layer=c.layer||c.layerInfo,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(c)})):this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(c.layer.id)?
this._addLayerToTable(c):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(c)}))}))))},_addLayerToTable:function(a){var c=null;if(e.getObject("layer.id",!1,a)||e.getObject("layerInfo.id",!1,a)){var d=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);d.getLayerObject().then(e.hitch(this,function(f){f?(f.id=a.layer.id,f.loaded?this.addNewLayerTab(d.id,a.featureSet):this.own(b(f,"load",e.hitch(this,this.addNewLayerTab,
d.id,a.featureSet)))):a.url&&(c=new w(a.url),this.own(b(c,"load",e.hitch(this,this.addNewLayerTab,d.id,a.featureSet))))}),e.hitch(this,function(a){new r({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===a)return this.layerTabPages[c];return null},layerTabPageClose:function(a,b){var c=this.layerTabPages.length;e.getObject("_activeTable.layerInfo.id",!1,this)===a&&this.setActiveTable(null);
for(var d=0;d<c;d++)if(this.layerTabPages[d]&&this.layerTabPages[d].paneId===a){var g=e.getObject("_resourceManager.featureTableSet."+a,!1,this);g&&(g=g.getFilterObj())&&f.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===b&&(this.tabContainer.removeChild(this.layerTabPages[d]),this.layerTabPages[d].destroyRecursive());this.layerTabPages&&this.layerTabPages[d]&&this.layerTabPages.splice(d,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);
if(1===c){this._activeLayerInfoId=null;this.onClose();break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[c-2]);break}},_processRelatedRecordsFromPopup:function(a,b){if(a){var c=[];c.push(a.getLayerObject());c.push(a.getRelatedTableInfoArray());h(c).then(e.hitch(this,function(c){if(c){var d=c[0];this._resourceManager.collectRelationShips(a,c[1]);c=d.relationships;for(var d=0,e=c.length;d<e;d++)this.addNewRelationTab(b,c[d],a.id)}}))}},showRelatedRecordsFromPopup:function(a,
b){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)})):this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,b):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)}))}))}});g.inPanel=!1;g.hasUIFile=!1;return g});