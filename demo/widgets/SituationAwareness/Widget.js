// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/dijit/Report":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented ./PageUtils dojo/text!./templates/ReportTemplate.html dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom dojo/string dojo/on esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/PrintTask".split(" "),function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z){return q([n,u],{baseClass:"jimu-report",_printService:null,_printWindow:null,
_sizeInPixels:{},_shownUnableToPrintMapMsg:!1,printTaskUrl:null,reportLogo:"",reportLayout:{},maxNoOfCols:3,alignNumbersToRight:!1,styleSheets:[],styleText:"",constructor:function(){this.inherited(arguments);this._sizeInPixels={};this.printTaskUrl=null;this.reportLayout={};this.styleSheets=[]},postMixInProperties:function(){this.nls=d.mixin(window.jimuNls.common,window.jimuNls.report)},postCreate:function(){var a;a={pageSize:m.PageSizes.A4,orientation:m.Orientation.Portrait};this.inherited(arguments);
this.setReportLayout(this.reportLayout,a);this.reportLayout.dpi=96;this.printTaskUrl&&this._createPrintTask()},setReportLayout:function(a,c){c||(c=this.reportLayout);this._validateParameters(a)?this.reportLayout=d.mixin(c,a):this.reportLayout=c},setMapLayout:function(a){var c;c=this.reportLayout.pageSize.MapLayout?this.reportLayout.pageSize.MapLayout:"MAP_ONLY";"MAP_ONLY"===c?(a.exportOptions={dpi:this.reportLayout.dpi},this.reportLayout.orientation.Type===m.Orientation.Landscape.Type&&this.reportLayout.pageSize!==
m.PageSizes.Custom?(a.exportOptions.width=this._sizeInPixels.Height,a.exportOptions.height=this._sizeInPixels.Width):(a.exportOptions.width=this._sizeInPixels.Width,a.exportOptions.height=this._sizeInPixels.Height)):c+=" "+this.reportLayout.orientation.Type;a.layout=c;return a},_validateParameters:function(){return this.reportLayout.pageSize!==m.PageSizes.Custom||this.reportLayout.size?!0:!1},_createPrintTask:function(){this._printService=new z(this.printTaskUrl,{async:!1})},_createPrintMapParameters:function(a){var c,
e;e=new f;a.printTemplate?(e=a.printTemplate,e.format?(c=e.format.toLowerCase(),"png32"!==c&&"png8"!==c&&"jpg"!==c&&"gif"!==c&&(e.format="jpg")):e.format="jpg"):(e=this.setMapLayout(e),e.layoutOptions={},e.preserveScale=!1,e.showAttribution=!0,e.format="jpg");c=new h;c.map=a.map;c.outSpatialReference=a.map.spatialReference;c.template=e;return c},print:function(a,c){var f,b;this._printService?(this._shownUnableToPrintMapMsg=!1,this._printWindow&&this._printWindow.close(),f=screen.width/2,b=screen.height/
1.5,f="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno,scrollbars\x3dyes, resizable\x3dyes, width\x3d"+f+", height\x3d"+b+", top\x3d"+(screen.height/2-b/2)+", left\x3d"+(screen.width/2-f/2),this._printWindow=window.open("","report",f,!0),setTimeout(d.hitch(this,function(){t.withDoc(this._printWindow.document,d.hitch(this,function(){this._printWindow.document.open("text/html","replace");this._printWindow.document.write(g);window.isRTL&&x.add(e.byId("reportBody"),"jimu-rtl");
(this.styleSheets&&0<this.styleSheets.length||this.styleText&&""!==this.styleText)&&this._addExternalStyleSheets();this._setPageSize();this._setButtonLabels();this._setReportSizeMessage();this._setReportLogo();this._setReportTitle(a);this._setReportData(c);this._setFootNotes();this._printWindow.document.close()}))}),500)):this.emit("reportError")},_addExternalStyleSheets:function(){var a=e.byId("reportHead");a&&(b.forEach(this.styleSheets,d.hitch(this,function(c){k.create("link",{rel:"stylesheet",
type:"text/css",href:c},a)})),this.styleText&&k.create("style",{type:"text/css",innerHTML:this.styleText},a))},_setPageSize:function(){var a,c,f;f=e.byId("reportMain");this.reportLayout&&(a=this.reportLayout.pageSize,this.reportLayout.pageSize===m.PageSizes.Custom&&this.reportLayout.size&&(a=this.reportLayout.size),a=m.getPageSizeInPixels(a,this.reportLayout.dpi));c=this.reportLayout.orientation.Type===m.Orientation.Landscape.Type&&this.reportLayout.pageSize!==m.PageSizes.Custom?a.Height:a.Width;
this._sizeInPixels=a;l.set(f,{width:c+"px"})},_setReportData:function(a){var c=e.byId("reportData"),f=e.byId("showErrorButton");f.innerHTML=this.nls.unableToPrintMapMsg;c&&b.forEach(a,d.hitch(this,function(a){var e=k.create("div",{},c);a.addPageBreak&&x.add(e,"esriCTPageBreak");"table"===a.type?this._formatAndRenderTables(e,a):"html"===a.type?this._renderHTMLData(e,a):"map"===a.type?(a.title&&this._addSectionTitle(a.title,e),x.add(e,"esriCTReportMap esriCTReportMapWait"),a.extent&&a.data.map.setExtent(a.extent),
this._executePrintTask(a,e,f)):"note"===a.type&&this._createReportNote(e,a)}))},_setFootNotes:function(){var a,c;(c=e.byId("footNotes"))&&this.footNotes&&(a=r.sanitizeHTML(this.footNotes?this.footNotes:""),c.innerHTML=r.fieldFormatter.getFormattedUrl(a))},_setReportLogo:function(){var a,f,b,h;(a=e.byId("reportLogo"))&&this.reportLogo&&(x.remove(a,"esriCTHidden"),a.src=this.reportLogo,h=e.byId("reportHeader"),f=e.byId("reportMain"),b=e.byId("printTitleDiv"),window.isRTL&&k.place(b,h,"first"),f&&b&&
(a.complete&&l.set(b,{width:f.clientWidth-a.clientWidth-51+"px"}),this.own(c(a,"load",d.hitch(this,function(){setTimeout(d.hitch(this,function(){l.set(b,{width:f.clientWidth-a.clientWidth-51+"px"})}),100)})))))},_setReportTitle:function(a){var c=e.byId("reportTitle");c&&a&&(c.value=a)},_createReportNote:function(a,f){var e,b="",h;f.title&&(b=f.title);b=this._addSectionTitle(b,a);x.add(b,"esriCTNotesTitle");e=k.create("textarea",{"class":"esriCTReportNotes",placeholder:this.nls.notesHint,rows:5},a);
h=k.create("p",{"class":"esriCTReportNotesParagraph"},a);x.add(a,"esriCTNotesContainer");f.defaultText&&(e.value=f.defaultText);this.own(c(e,"keydown, change",function(){e.style.height="auto";h.innerHTML=r.sanitizeHTML(e.value?e.value:"");e.style.height=e.scrollHeight+"px"}))},_setReportSizeMessage:function(){var c,f;this.reportLayout.pageSize===m.PageSizes.Custom&&this.reportLayout.size?(c=this.reportLayout.size,f=this.reportLayout.pageSize):(c=this.reportLayout.pageSize,f=this.reportLayout.pageSize.SizeName);
c=this.reportLayout.orientation.Type===m.Orientation.Landscape.Type&&this.reportLayout.pageSize!==m.PageSizes.Custom?" ("+c.Height+"'' X "+c.Width+"'') ":" ("+c.Width+"'' X "+c.Height+"'') ";e.byId("reportBarMsg").innerHTML=a.substitute(this.nls.reportDimensionsMsg,{paperSize:f+c+this.reportLayout.orientation.Text})},_setButtonLabels:function(){var a=e.byId("printButton");a.innerHTML=this.nls.printButtonLabel;a.title=this.nls.printButtonLabel;a=e.byId("closeButton");a.innerHTML=this.nls.close;a.title=
this.nls.close},_executePrintTask:function(a,c,f){a=this._createPrintMapParameters(a);this._printService.execute(a,d.hitch(this,function(a){c&&(x.remove(c,"esriCTReportMapWait"),a=k.create("img",{src:a.url,"class":"esriCTReportMapImg"},c),this.reportLayout.orientation.Type===m.Orientation.Landscape.Type&&x.add(a,"esriCTReportLandscapeMapImg"))}),d.hitch(this,function(){x.replace(c,"esriCTReportMapFail","esriCTPageBreak esriCTReportMapWait");this._shownUnableToPrintMapMsg||(this._shownUnableToPrintMapMsg=
!0,f.click())}))},_renderHTMLData:function(a,c){var f;f=k.create("div",{"class":"esriCTHTMLData"},a);c.title&&this._addSectionTitle(c.title,f);k.create("div",{innerHTML:c.data},f)},_addSectionTitle:function(a,c){var f=r.sanitizeHTML(a?a:"");return k.create("div",{innerHTML:f,"class":f?"esriCTSectionTitle":""},c)},_formatAndRenderTables:function(a,c){var f=c.data,e,b,h,d,l=this.maxNoOfCols;f.maxNoOfCols&&(l=f.maxNoOfCols);e=0;for(b=f.cols.length;e<b;e+=l){var t={cols:[],rows:[]};t.title=0===e?c.title:
"";h=f.cols.slice(e,e+l);d=[];for(var g=0;g<f.rows.length;g++)d.push(f.rows[g].slice(e,e+l));t.cols=h;t.rows=d;this._renderTable(k.create("div",{},a),t,c.data.showRowIndex)}},_renderTable:function(a,c,f){var e,h;this._addSectionTitle(c.title,a);a=k.create("table",{cellpadding:5,style:{width:"100%"},"class":"esriCTTable"},a);e=k.create("tbody",{},a);h=k.create("tr",{},e);f&&k.create("th",{innerHTML:"#",style:{width:"20px"}},h);b.forEach(c.cols,d.hitch(this,function(a){k.create("th",{innerHTML:a},h)}));
b.forEach(c.rows,d.hitch(this,function(a,c){var h;h=k.create("tr",{},e);f&&k.create("td",{innerHTML:c+1,style:{"word-wrap":"normal"}},h);b.forEach(a,d.hitch(this,function(a){var c=r.fieldFormatter.getFormattedUrl(a),c=k.create("td",{innerHTML:c},h);this.alignNumbersToRight&&!isNaN(parseFloat(a))&&x.add(c,"esriCTNumber")}))}))}})})},"jimu/dijit/PageUtils":function(){define([],function(){var q={};q.Orientation={Landscape:{Type:"Landscape",Text:window.jimuNls.report.landscape},Portrait:{Type:"Portrait",
Text:window.jimuNls.report.portrait}};q.PageSizes={A0:{Height:46.8,Width:33.1,SizeName:window.jimuNls.report.a0,MapLayout:"MAP_ONLY"},A1:{Height:33.1,Width:23.4,SizeName:window.jimuNls.report.a1,MapLayout:"MAP_ONLY"},A2:{Height:23.4,Width:16.5,SizeName:window.jimuNls.report.a2,MapLayout:"MAP_ONLY"},A3:{Height:16.5,Width:11.7,SizeName:window.jimuNls.report.a3,MapLayout:"A3"},A4:{Height:11.7,Width:8.3,SizeName:window.jimuNls.report.a4,MapLayout:"A4"},A5:{Height:8.3,Width:5.8,SizeName:window.jimuNls.report.a5,
MapLayout:"MAP_ONLY"},Letter_ANSI_A:{Height:11,Width:8.5,SizeName:window.jimuNls.report.letter+" "+window.jimuNls.report.ansi_a,MapLayout:"Letter ANSI A"},Tabloid_ANSI_B:{Height:17,Width:11,SizeName:window.jimuNls.report.tabloid+" "+window.jimuNls.report.ansi_b,MapLayout:"Tabloid ANSI B"},ANSI_C:{Height:22,Width:17,SizeName:window.jimuNls.report.ansi_c,MapLayout:"MAP_ONLY"},ANSI_D:{Height:34,Width:22,SizeName:window.jimuNls.report.ansi_d,MapLayout:"MAP_ONLY"},ANSI_E:{Height:44,Width:34,SizeName:window.jimuNls.report.ansi_e,
MapLayout:"MAP_ONLY"},Legal:{Height:14,Width:8.5,SizeName:window.jimuNls.report.legal,MapLayout:"MAP_ONLY"},Custom:window.jimuNls.common.custom};q.getPageSizeInPixels=function(n,r){return{Height:n.Height*r,Width:n.Width*r}};return q})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});r("extend-esri")&&
n.setObject("tasks.PrintParameters",q,u);return q})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,showAttribution:null,showLabels:!0});r("extend-esri")&&n.setObject("tasks.PrintTemplate",q,u);return q})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../urlUtils ./Task ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C){q=q(e,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,c){this.url=a;this.printGp=new f(this.url);this._handler=n.hitch(this,this._handler);c&&c.async&&(this.async=c.async);this._colorEvaluator=C("$..color")},_vtlExtent:null,_handler:function(a,c,f,e,b){try{var h;this.async?"esriJobSucceeded"===a.jobStatus&&this.printGp.getResultData(a.jobId,"Output_File",n.hitch(this,function(a){h=a.value;this._successHandler([h],"onComplete",f,
b)})):(h=a[0].value,this._successHandler([h],"onComplete",f,b))}catch(H){this._errorHandler(H,e,b)}},execute:function(a,c,f){var e=this._handler,h=this._errorHandler,d=a.template||new z;d.hasOwnProperty("showLabels")||(d.showLabels=!0);var l=d.exportOptions,v;l&&(v={outputSize:[l.width,l.height],dpi:l.dpi});var l=d.layoutOptions,t,B=[];if(l){this.legendAll=!1;l.legendLayers?r.forEach(l.legendLayers,function(a){var c={};c.id=a.layerId;a.subLayerIds&&(c.subLayerIds=a.subLayerIds);B.push(c)}):this.legendAll=
!0;var y,D;if("Miles"===l.scalebarUnit||"Kilometers"===l.scalebarUnit)y="esriKilometers",D="esriMiles";else if("Meters"===l.scalebarUnit||"Feet"===l.scalebarUnit)y="esriMeters",D="esriFeet";t={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};t={titleText:l.titleText,authorText:l.authorText,copyrightText:l.copyrightText,customTextElements:l.customTextElements,scaleBarOptions:{metricUnit:y,metricLabel:t[y],nonMetricUnit:D,nonMetricLabel:t[D]},legendOptions:{operationalLayers:B}}}y=this._getPrintDefinition(a.map,
d);a.outSpatialReference&&(y.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&b.isDefined(a.template.showAttribution)&&(y.mapOptions.showAttribution=a.template.showAttribution);n.mixin(y,{exportOptions:v,layoutOptions:t});this.allLayerslegend&&n.mixin(y.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(y.operationalLayers){v=y.operationalLayers;var E,g=function(a){return b.fixJson(n.mixin(a,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))};
for(t=0;t<v.length;t++)if(v[t].featureCollection&&v[t].featureCollection.layers)for(D=0;D<v[t].featureCollection.layers.length;D++){var w=v[t].featureCollection.layers[D];w.layerDefinition&&w.layerDefinition.drawingInfo&&w.layerDefinition.drawingInfo.renderer&&w.layerDefinition.drawingInfo.renderer.symbol&&(E=w.layerDefinition.drawingInfo.renderer,"esriCLS"===E.symbol.type?E.symbol=g(E.symbol):E.symbol.outline&&"esriCLS"===E.symbol.outline.type&&(E.symbol.outline=g(E.symbol.outline)));if(w.featureSet&&
w.featureSet.features)for(l=0;l<w.featureSet.features.length;l++)E=w.featureSet.features[l],E.symbol&&("esriCLS"===E.symbol.type?E.symbol=g(E.symbol):E.symbol.outline&&"esriCLS"===E.symbol.outline.type&&(E.symbol.outline=g(E.symbol.outline)))}}d={Web_Map_as_JSON:u.toJson(b.fixJson(y)),Format:d.format,Layout_Template:d.layout};a.extraParameters&&(d=n.mixin(d,a.extraParameters));var K=new m(k._dfdCanceller);a=function(a,y){e(a,y,c,f,K)};y=function(a){h(a,f,K)};K._pendingDfd=this.async?this.printGp.submitJob(d,
a,null,y):this.printGp.execute(d,a,y);return K},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",
geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=g("ie")||!a.path&&"image/svg+xml"!==a.contentType)){var c,f=F.createSurface(A.create("div"),1024,1024);c="image/svg+xml"===a.contentType?
f.createObject(F.Image,{src:"data:image/svg+xml;base64,"+a.imageData,width:I.pt2px(a.width),height:I.pt2px(a.height),x:0,y:0}):f.createObject(F.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in f&&f._render(!0);var e=f.rawNode.getContext("2d"),b=Math.ceil(c.getBoundingBox().width),h=Math.ceil(c.getBoundingBox().height);c=e.getImageData(c.getBoundingBox().x,c.getBoundingBox().y,b,h);e.canvas.width=b;e.canvas.height=h;e.putImageData(c,0,0);e=e.canvas.toDataURL("image/png");a={type:"esriPMS",
imageData:e.substr(22,e.length),angle:a.angle,contentType:"image/png",height:a.size?a.size:I.px2pt(h),width:a.size?b/h*a.size:I.px2pt(b),xoffset:a.xoffset,yoffset:a.yoffset};f.destroy();return a}},_convertSvgRenderer:function(a){"simple"===a.type&&a.symbol&&(a.symbol.path||"image/svg+xml"===a.symbol.contentType)?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===a.type?(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),
a.uniqueValueInfos&&r.forEach(a.uniqueValueInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this)):"classBreaks"===a.type&&(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&r.forEach(a.classBreakInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this))},
_createFeatureCollection:function(c,f,e){var b=this._createPolygonLayer(),h=this._createPolylineLayer(),d=this._createPointLayer(),l=this._createMultipointLayer(),v=this._createPointLayer();v.layerDefinition.name="textLayer";delete v.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===c.declaredClass||"esri.layers.StreamLayer"===c.declaredClass)b.layerDefinition.name=h.layerDefinition.name=d.layerDefinition.name=l.layerDefinition.name=n.getObject("arcgisProps.title",!1,c)||c.name||c.id;var t=
c.renderer&&"esri.renderer.SimpleRenderer"===c.renderer.declaredClass;if(!c.renderer||c.renderer._compiledFunc||n.isFunction(c.renderer.attributeField))delete b.layerDefinition.drawingInfo,delete h.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo;else{var B=c.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===B.type){var B={latestObservationRenderer:B.latestObservationRenderer,trackLinesRenderer:B.trackRenderer,observationAger:B.observationAger,
renderer:B.observationRenderer},y={};c._trackIdField&&(y.trackIdField=c._trackIdField);c._startTimeField&&(y.startTimeField=c._startTimeField);c._endTimeField&&(y.endTimeField=c._endTimeField);b.layerDefinition.drawingInfo=B;b.layerDefinition.timeInfo=y;h.layerDefinition.drawingInfo=B;h.layerDefinition.timeInfo=y;d.layerDefinition.drawingInfo=B;d.layerDefinition.timeInfo=y;l.layerDefinition.drawingInfo=B;l.layerDefinition.timeInfo=y}else b.layerDefinition.drawingInfo.renderer=B,h.layerDefinition.drawingInfo.renderer=
B,d.layerDefinition.drawingInfo.renderer=B,l.layerDefinition.drawingInfo.renderer=B}B=c.fields;B||!c.renderer||c.renderer._compiledFunc||n.isFunction(c.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===c.renderer.declaredClass?(B=[{name:c.renderer.attributeField,type:"esriFieldTypeDouble"}],c.renderer.normalizationField&&B.push({name:c.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===c.renderer.declaredClass&&(B=[{name:c.renderer.attributeField,
type:"esriFieldTypeString"}],c.renderer.attributeField2&&B.push({name:c.renderer.attributeField2,type:"esriFieldTypeString"}),c.renderer.attributeField3&&B.push({name:c.renderer.attributeField3,type:"esriFieldTypeString"})));B&&(b.layerDefinition.fields=B,h.layerDefinition.fields=B,d.layerDefinition.fields=B,l.layerDefinition.fields=B);var B=c.graphics.length,D;for(D=0;D<B;D++){var E=c.graphics[D];if(!1!==E.visible&&E.geometry){y=E.toJson();y.symbol&&y.symbol.outline&&y.symbol.outline.color&&y.symbol.outline.color[3]&&
(y.symbol.outline.color[3]=255);if(c.renderer&&!y.symbol&&(n.isFunction(c.renderer.attributeField)||c.renderer._compiledFunc||this._isFeatureCollectionRequired(c.renderer)||"esri.renderer.DotDensityRenderer"===c.renderer.declaredClass||e)){e=e||c.renderer;var k=null;try{k=e.getSymbol(E)}catch(O){}if(!k)continue;y.symbol=k.toJson();this._isFeatureCollectionRequired(e)&&this._applyVisualVariables(y.symbol,{renderer:e,graphic:E,symbol:k,mapResolution:f&&f.getResolutionInMeters(),mapScale:f&&f.getScale()})}y.symbol&&
(y.symbol.path||"image/svg+xml"===y.symbol.contentType?y.symbol=this._convertSvgSymbol(y.symbol):y.symbol.text&&delete y.attributes);switch(E.geometry.type){case "polygon":b.featureSet.features.push(y);break;case "polyline":h.featureSet.features.push(y);break;case "point":y.symbol&&y.symbol.text?v.featureSet.features.push(y):d.featureSet.features.push(y);break;case "multipoint":l.featureSet.features.push(y);break;case "extent":y.geometry=a.fromExtent(E.geometry).toJson(),b.featureSet.features.push(y)}}}f=
[];0<b.featureSet.features.length&&f.push(b);0<h.featureSet.features.length&&f.push(h);0<l.featureSet.features.length&&f.push(l);0<d.featureSet.features.length&&f.push(d);0<v.featureSet.features.length&&f.push(v);if(!f.length)return null;r.forEach(f,function(a){var c=r.every(a.featureSet.features,function(a){return a.symbol});if(t||c)r.forEach(a.featureSet.features,function(a){delete a.attributes}),delete a.layerDefinition.fields;c&&delete a.layerDefinition.drawingInfo});r.forEach(f,function(a){a.layerDefinition.drawingInfo&&
a.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(a.layerDefinition.drawingInfo.renderer)},this);return{id:c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0,featureCollection:{layers:f}}},_getPrintDefinition:function(a,c){var f={operationalLayers:this._createOperationalLayers(a,c)},e=this._vtlExtent||a.extent,b=a.spatialReference;this._vtlExtent=null;a.spatialReference._isWrappable()&&(e=e._normalize(!0),b=e.spatialReference);e={mapOptions:{showAttribution:a.showAttribution,
extent:e.toJson(),spatialReference:b.toJson()}};c.preserveScale&&n.mixin(e.mapOptions,{scale:c.outScale||a.getScale()});a.timeExtent&&n.mixin(e.mapOptions,{time:[a.timeExtent.startTime.getTime(),a.timeExtent.endTime.getTime()]});b={};n.mixin(b,e,f);return b},_createOperationalLayers:function(a,f){var e,b,h,d,k=[];this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var v=r.map(a.layerIds,a.getLayer,a);a._mapImageLyr&&v.push(a._mapImageLyr);for(e=0;e<v.length;e++)if(b=v[e],b.loaded&&b.visible)switch(h=
b.declaredClass,d={id:b.id,title:n.getObject("arcgisProps.title",!1,b)||b.id,opacity:b.opacity,minScale:b.minScale||0,maxScale:b.maxScale||0},d=n.mixin(d,this._getUrlAndToken(b)),b.getNode()&&w.get(b.getNode(),"data-reference")&&(d._isRefLayer=!0),h){case "esri.layers.ArcGISDynamicMapServiceLayer":var g=[];h=!!b._params.layers;if(b._params.dynamicLayers)h=u.fromJson(b._params.dynamicLayers),r.forEach(h,function(a){g.push({id:a.id,name:a.name,layerDefinition:a});delete a.id;delete a.name;delete a.maxScale;
delete a.minScale}),0===g.length&&(d.visibleLayers=[-1]);else if(b.supportsDynamicLayers){if(h||b.layerDefinitions||b.layerTimeOptions){var B=b.createDynamicLayerInfosFromLayerInfos(),y=null;h&&(y=b.visibleLayers);var y=t._getVisibleLayers(B,y),D=t._getLayersForScale(f.outScale||a.getScale(),B);r.forEach(B,function(a){if(!a.subLayerIds){var c=a.id;-1<r.indexOf(y,c)&&-1<r.indexOf(D,c)&&(a={source:a.source.toJson()},b.layerDefinitions&&b.layerDefinitions[c]&&(a.definitionExpression=b.layerDefinitions[c]),
b.layerTimeOptions&&b.layerTimeOptions[c]&&(a.layerTimeOptions=b.layerTimeOptions[c].toJson()),g.push({id:c,layerDefinition:a}))}});0===g.length&&(d.visibleLayers=[-1])}}else r.forEach(b.layerInfos,function(a){var c={id:a.id,layerDefinition:{}};b.layerDefinitions&&b.layerDefinitions[a.id]&&(c.layerDefinition.definitionExpression=b.layerDefinitions[a.id]);b.layerTimeOptions&&b.layerTimeOptions[a.id]&&(c.layerDefinition.layerTimeOptions=b.layerTimeOptions[a.id].toJson());(c.layerDefinition.definitionExpression||
c.layerDefinition.layerTimeOptions)&&g.push(c)}),h&&(d.visibleLayers=b.visibleLayers);g.length&&(d.layers=g);k.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:b.id,subLayerIds:b.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":d=n.mixin(d,{url:b.url,bandIds:b.bandIds,compressionQuality:b.compressionQuality,format:b.format,interpolation:b.interpolation});b.mosaicRule&&n.mixin(d,{mosaicRule:b.mosaicRule.toJson()});(b.renderingRule||b.renderer)&&(h=b.getExportImageRenderingRule())&&
n.mixin(d,{renderingRule:h.toJson()});k.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:b.id});break;case "esri.layers.WMSLayer":d=n.mixin(d,{url:b.url,title:b.title,type:"wms",version:b.version,transparentBackground:b.imageTransparency,visibleLayers:b.visibleLayers});k.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:b.id,subLayerIds:b.visibleLayers});break;case "esri.virtualearth.VETiledLayer":h=b.mapStyle;"roadOnDemand"===h?h="Road":"aerialWithLabels"===h&&(h="Hybrid");d=
n.mixin(d,{visibility:b.visible,type:"BingMaps"+h,culture:b.culture,key:b.bingMapsKey});k.push(d);break;case "esri.layers.OpenStreetMapLayer":d=n.mixin(d,{credits:b.copyright,type:"OpenStreetMap",url:l.getAbsoluteUrl(b.tileServers[0])});k.push(d);break;case "esri.layers.WMTSLayer":d=n.mixin(d,{url:b.url,type:"wmts",layer:b._identifier,style:b._style,format:b.format,tileMatrixSet:b._tileMatrixSetId});k.push(d);break;case "esri.layers.MapImageLayer":h=b.getImages();r.forEach(h,function(a,c){a.href&&
(d={id:b.id+"_image"+c,type:"image",title:b.id,minScale:b.minScale||0,maxScale:b.maxScale||0,opacity:b.opacity*a.opacity,extent:a.extent.toJson()},"data:image/png;base64,"===a.href.substr(0,22)?d.imageData=a.href.substr(22):d.url=a.href,k.push(d))});break;case "esri.layers.VectorTileLayer":d.type="image";d.url&&delete d.url;h=this._vtlExtent||a.extent.offset(0,0);var E=f.exportOptions&&f.exportOptions.dpi||96,B={format:"png",pixelRatio:E/96};"MAP_ONLY"!==f.layout||!f.preserveScale||f.outScale&&f.outScale!==
a.getScale()||96!==E||!f.exportOptions||f.exportOptions.width%2===a.width%2&&f.exportOptions.height%2===a.height%2||(B.area={x:0,y:0,width:a.width,height:a.height},f.exportOptions.width%2!==a.width%2&&--B.area.width,f.exportOptions.height%2!==a.height%2&&--B.area.height,this._vtlExtent||(E=a.toMap({x:B.area.width,y:B.area.height}),h.update(h.xmin,E.y,E.x,h.ymax,h.spatialReference),this._vtlExtent=h));d.extent=h._normalize(!0).toJson();h=b.takeScreenshot(B);h.isResolved()?h.then(function(a){"data:image/png;base64,"===
a.dataURL.substr(0,22)&&(d.imageData=a.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");d.imageData&&k.push(d);break;case "esri.layers.WebTiledLayer":h=b.url.replace(/\$\{/g,"{");d=n.mixin(d,{type:"WebTiledLayer",urlTemplate:h,credits:b.copyright});b.subDomains&&0<b.subDomains.length&&(d.subDomains=b.subDomains);b._wmtsInfo&&(d.wmtsInfo=b._wmtsInfo);delete d.url;k.push(d);break;default:if(b.getTileUrl||b.getImageUrl)d=n.mixin(d,{url:b.url}),
k.push(d)}for(e=0;e<a.graphicsLayerIds.length;e++)if(b=a.getLayer(a.graphicsLayerIds[e]),b.loaded&&b.visible)switch(h=b.declaredClass,h){case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.CSVLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===h&&!f.showLabels||b.renderer&&"esri.renderer.HeatmapRenderer"===b.renderer.declaredClass)continue;v=null;b.url&&b.renderer&&("esri.renderer.ScaleDependentRenderer"===b.renderer.declaredClass?"scale"===b.renderer.rangeType?
v=b.renderer.getRendererInfoByScale(a.getScale())&&b.renderer.getRendererInfoByScale(a.getScale()).renderer:"zoom"===b.renderer.rangeType&&(v=b.renderer.getRendererInfoByZoom(a.getZoom())&&b.renderer.getRendererInfoByZoom(a.getZoom()).renderer):v=b.renderer);if(v&&("esri.renderer.SimpleRenderer"===v.declaredClass||"esri.renderer.TemporalRenderer"===v.declaredClass||n.isString(v.attributeField)&&b._getField(v.attributeField,!0))&&!v._compiledFunc&&!this._isFeatureCollectionRequired(v)&&"esri.renderer.DotDensityRenderer"!==
v.declaredClass&&"esri.layers.CSVLayer"!==b.declaredClass&&"esri.layers.StreamLayer"!==b.declaredClass)if(d={id:b.id,title:n.getObject("arcgisProps.title",!1,b)||b.id,opacity:b.opacity,minScale:b.minScale||0,maxScale:b.maxScale||0,layerDefinition:{drawingInfo:{renderer:v.toJson({useLegacyRotationProperties:!0})}}},d=n.mixin(d,this._getUrlAndToken(b)),"esri.renderer.TemporalRenderer"===v.declaredClass&&(h=d.layerDefinition.drawingInfo,h.latestObservationRenderer=h.renderer.latestObservationRenderer,
h.trackLinesRenderer=h.renderer.trackRenderer,h.observationAger=h.renderer.observationAger,h.renderer=h.renderer.observationRenderer,b._trackIdField&&(d.layerDefinition.timeInfo={trackIdField:b._trackIdField})),this._convertSvgRenderer(d.layerDefinition.drawingInfo.renderer),1>b.opacity||"esri.renderer.TemporalRenderer"===v.declaredClass||this._updateLayerOpacity(d))if(b._params.source&&(v=b._params.source.toJson(),n.mixin(d.layerDefinition,{source:v})),b.getDefinitionExpression()&&n.mixin(d.layerDefinition,
{definitionExpression:b.getDefinitionExpression()}),2!==b.mode)0<b.getSelectedFeatures().length&&(v=r.map(b.getSelectedFeatures(),function(a){return a.attributes[b.objectIdField]}),0<v.length&&b.getSelectionSymbol()&&n.mixin(d,{selectionObjectIds:v,selectionSymbol:b.getSelectionSymbol().toJson()}));else{v=r.map(b.getSelectedFeatures(),function(a){return a.attributes[b.objectIdField]});if(0===v.length||!b._params.drawMode)break;n.mixin(d.layerDefinition,{objectIds:v});v=null;b.getSelectionSymbol()&&
(v=new c(b.getSelectionSymbol()));n.mixin(d.layerDefinition.drawingInfo,{renderer:v&&v.toJson()})}else d=this._createFeatureCollection(b,a);else d=v&&(v._compiledFunc||this._isFeatureCollectionRequired(v)||"esri.renderer.DotDensityRenderer"===v.declaredClass)?this._createFeatureCollection(b,a,v):this._createFeatureCollection(b,a);if(!d)continue;k.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:b.id});break;case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":if(d=this._createFeatureCollection(b,
a))k.push(d),this.allLayerslegend&&this.allLayerslegend.push({id:b.id})}a.graphics&&0<a.graphics.graphics.length&&(d=this._createFeatureCollection(a.graphics,a))&&k.push(d);a._labels&&f.showLabels&&(d=this._createFeatureCollection(a._labels,a))&&k.push(d);r.forEach(k,function(a,c,b){a._isRefLayer&&(delete a._isRefLayer,b.splice(c,1),b.push(a))});return k},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var c=this._colorEvaluator(a),
c=r.filter(c,function(a){return n.isArray(a)&&4===a.length}),b=!0;if(c.length){var f=c[0][3],e;for(e=1;e<c.length;e++)if(f!==c[e][3]){b=!1;break}if(b)for(a.opacity=f/255,e=0;e<c.length;e++)c[e][3]=255}return b},_isFeatureCollectionRequired:function(a){var c=!1,b=this._getVariable(a,"rotationInfo",!1);b&&(c=(c=b.field)&&n.isFunction(c)||b.valueExpression);return a.hasVisualVariables("sizeInfo")||a.hasVisualVariables("colorInfo")||a.hasVisualVariables("opacityInfo")||c},_getVariable:function(a,c,b){var f;
a&&(f=(a=a.getVisualVariablesForType(c,b))&&a[0]);return f},_applyVisualVariables:function(a,c){var b=c.renderer,f=c.graphic,e=c.symbol,d=c.mapResolution,l=c.mapScale,v=e.type;if("textsymbol"!==v&&"shieldlabelsymbol"!==v){var k=this._getVariable(b,"sizeInfo",!1),t=this._getVariable(b,"colorInfo",!1),y=this._getVariable(b,"opacityInfo",!1),D=this._getVariable(b,"rotationInfo",!1);e instanceof h&&(k=this._getVariable(b,"sizeInfo","outline")||k);k&&(e=b.getSize(f,{sizeInfo:k,shape:"simplemarkersymbol"===
v?e.style:null,resolution:d,scale:l}),null!=e&&("simplemarkersymbol"===v?a.size=I.px2pt(e):"picturemarkersymbol"===v?(a.width=I.px2pt(e),a.height=I.px2pt(e)):"simplelinesymbol"===v?a.width=I.px2pt(e):a.outline&&(a.outline.width=I.px2pt(e))));t&&(!(t=b.getColor(f,{colorInfo:t}))||"simplemarkersymbol"!==v&&"simplelinesymbol"!==v&&"simplefillsymbol"!==v||(a.color=x.toJsonColor(t)));y&&(v=b.getOpacity(f,{opacityInfo:y}),null!=v&&a.color&&(a.color[3]=Math.round(255*v)));D&&(b=b.getRotationAngle(f,{rotationInfo:D}))&&
(a.angle=-b)}}});g("extend-esri")&&n.setObject("tasks.PrintTask",q,d);return q})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(q,
n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C){q=q(l,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=n.hitch(this,this._jobUpdateHandler);this._getJobStatus=n.hitch(this,this._getJobStatus);this._getResultDataHandler=
n.hitch(this,this._getResultDataHandler);this._getResultImageHandler=n.hitch(this,this._getResultImageHandler);this._executeHandler=n.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,c,b){for(var f in a){var e=a[f];n.isArray(e)?a[f]=m.toJson(r.map(e,function(a){return this._gpEncode({item:a},!0).item},this)):e instanceof Date&&(a[f]=e.getTime())}return this._encode(a,c,b)},_decode:function(a){var c=a.dataType,
b=new A(a);if(-1!==r.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],c))return b;if("GPLinearUnit"===c)b.value=new h(b.value);else if("GPFeatureRecordSetLayer"===c||"GPRecordSet"===c)b.value=new e(b.value);else if("GPDataFile"===c)b.value=new f(b.value);else if("GPDate"===c)a=b.value,n.isString(a)?b.value=new w({date:a}):b.value=new Date(a);else if("GPRasterData"===c||"GPRasterDataLayer"===c)a=a.value.mapImage,b.value=a?new C(a):new z(b.value);else if(-1!==c.indexOf("GPMultiValue:")){var d=c.split(":")[1];
a=b.value;b.value=r.map(a,function(a){return this._decode({paramName:"_name",dataType:d,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+b.dataType),b=null;return b},submitJob:function(a,c,b,f,e){var h=this._getOutSR(),d=e.assembly;a=this._gpEncode(n.mixin({},this._url.query,{f:"json","env:outSR":h?h.wkid||m.toJson(h.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):
null},a),null,d&&d[0]);var v=this._jobUpdateHandler,l=this._errorHandler;return t({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,f){v(a,f,!1,c,b,e.dfd)},error:function(a){l(a,f,e.dfd)}})},_jobUpdateHandler:function(c,b,f,e,h,d){var l=c.jobId;b=new a(c);this._successHandler([b],"onStatusUpdate",h,f&&d);if(!f)switch(clearTimeout(this._updateTimers[l]),this._updateTimers[l]=null,d&&d.progress(b),c.jobStatus){case a.STATUS_SUBMITTED:case a.STATUS_EXECUTING:case a.STATUS_WAITING:case a.STATUS_NEW:var v=
this._getJobStatus;this._updateTimers[l]=setTimeout(function(){v(l,f,e,h,d)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",e,d)}},_getJobStatus:function(a,c,b,f,e){var h=this._jobUpdateHandler;t({url:this._url.path+"/jobs/"+a,content:n.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,d){h(a,d,c,b,f,e)},error:this._errorHandler})},_getResultDataHandler:function(a,c,b,f,e){try{var h=this._decode(a);this._successHandler([h],"onGetResultDataComplete",
b,e)}catch(H){this._errorHandler(H,f,e)}},getResultData:function(a,c,b,f){var e=this._getResultDataHandler,h=this._errorHandler,d=new u(k._dfdCanceller);d._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/results/"+c,content:n.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,c){e(a,c,b,f,d)},error:function(a){h(a,f,d)}});return d},checkJobStatus:function(a,c,b){var f=this._jobUpdateHandler,e=this._errorHandler,h=new u(k._dfdCanceller);h._pendingDfd=
t({url:this._url.path+"/jobs/"+a,content:n.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){f(a,b,!0,null,c,h)},error:function(a){e(a,b,h)}});return h},cancelJob:function(a,c,b){var f=this._errorHandler,e=new u(k._dfdCanceller);e._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/cancel",content:n.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:n.hitch(this,function(a,b){this._successHandler([a],"onJobCancel",c,e)}),error:function(a){f(a,b,e)}});
return e},execute:function(a,c,b,f){var e=this._getOutSR(),h=f.assembly;a=this._gpEncode(n.mixin({},this._url.query,{f:"json","env:outSR":e?e.wkid||m.toJson(e.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):null},a),null,h&&h[0]);var d=this._executeHandler,v=this._errorHandler;return t({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,e){d(a,e,c,b,f.dfd)},error:function(a){v(a,
b,f.dfd)}})},_executeHandler:function(a,b,f,e,h){try{var d=a.results,l,v,k=a.messages;l=0;for(v=d.length;l<v;l++)d[l]=this._decode(d[l]);l=0;for(v=k.length;l<v;l++)k[l]=new c(k[l]);this._successHandler([d,k],"onExecuteComplete",f,h)}catch(B){this._errorHandler(B,e,h)}},_getResultImageHandler:function(a,c,b,f,e){try{var h=this._decode(a);this._successHandler([h],"onGetResultImageComplete",b,e)}catch(H){this._errorHandler(H,f,e)}},getResultImage:function(a,c,b,f,e){var h=this._getResultImageHandler,
d=this._errorHandler;b=this._gpEncode(n.mixin({},this._url.query,{f:"json"},b.toJson()));var v=new u(k._dfdCanceller);v._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/results/"+c,content:b,callbackParamName:"callback",load:function(a,c){h(a,c,f,e,v)},error:function(a){d(a,e,v)}});return v},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,c,b,f){if(null==c){var e=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
e)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+c;this._url.query&&(a+="?"+d.objectToQuery(this._url.query));c=null==c?new F(a,{imageParameters:b}):new I(a,{imageParameters:b},!0);this.onGetResultImageLayerComplete(c);f&&f(c);return c},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});x._createWrappers(q);
g("extend-esri")&&n.setObject("tasks.Geoprocessor",q,b);return q})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(q,n,r,u,m){q=q(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(g){this.messages=[];n.mixin(this,g);g=this.messages;var d,b=g.length;for(d=0;d<b;d++)g[d]=new m(g[d])},jobId:"",jobStatus:""});n.mixin(q,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});r("extend-esri")&&n.setObject("tasks.JobInfo",q,u);return q})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(m){n.mixin(this,
m)}});n.mixin(q,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});r("extend-esri")&&n.setObject("tasks.GPMessage",q,u);return q})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(m){m&&n.mixin(this,m)},distance:0,units:null,toJson:function(){var m={};this.distance&&(m.distance=this.distance);this.units&&(m.units=this.units);return m}});r("extend-esri")&&n.setObject("tasks.LinearUnit",q,u);return q})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(m){m&&n.mixin(this,m)},url:null,itemID:null,toJson:function(){var m={};this.url&&(m.url=this.url);this.itemID&&(m.itemID=this.itemID);return m}});r("extend-esri")&&n.setObject("tasks.DataFile",q,u);return q})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.RasterData",constructor:function(m){m&&n.mixin(this,m)},url:null,format:null,itemID:null,toJson:function(){var m=
{};this.url&&(m.url=this.url);this.format&&(m.format=this.format);this.itemID&&(m.itemID=this.itemID);return m}});r("extend-esri")&&n.setObject("tasks.RasterData",q,u);return q})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(q,n,r,u,m){q=q(null,{declaredClass:"esri.tasks.Date",constructor:function(g){g&&(g.format&&(this.format=g.format),this.date=r.parse(g.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:r.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});u("extend-esri")&&n.setObject("tasks.Date",q,m);return q})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(m){n.mixin(this,m)}});r("extend-esri")&&n.setObject("tasks.ParameterValue",q,u);return q})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(q,n,r,u,m,g,d){q=q(d,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(b,d){d&&d.imageParameters&&d.imageParameters.extent&&(this.initialExtent=this.fullExtent=d.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=n.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(b,d,k,g){var l=b.spatialReference.wkid;g(this._url.path+"?"+m.objectToQuery(n.mixin(this._params,{f:"image",bbox:r.toJson(b.toJson()),bboxSR:l,imageSR:l,size:d+","+k})))}});u("extend-esri")&&n.setObject("tasks._GPResultImageLayer",q,g);return q})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e){function a(a,c,b,f,e,h,d,v,l,k){var y,D,E=c.length,t=0;k?(D=k.l/e,t=k.i):D=c[0]/e;for(;h<d;)h+D>d&&(y={l:(h+D-d)*e,i:t},D=d-h),t%2||(a.beginPath(),a.arc(b,f,e,h,h+D,v),l&&a.stroke()),h+=D,++t,D=c[t%E]/e;return y}function c(a,c,b,f){var h=0,d=0,y,D=0;f?(y=f.l,D=f.i):y=c[0];for(;1>d;)d=e.tAtLength(a,y),1==d&&(h=e.computeLength(a),h={l:y-h,i:D}),a=e.splitBezierAtT(a,d),D%2||b.push(a[0]),a=a[1],++D,y=c[D%c.length];return h}function h(a,b,f,e){var h=[b.last.x,b.last.y].concat(f),
d=!(a instanceof Array);f=4===f.length?"quadraticCurveTo":"bezierCurveTo";var y=[];b=c(h,b.canvasDash,y,e);for(e=0;e<y.length;++e)h=y[e],d?(a.moveTo(h[0],h[1]),a[f].apply(a,h.slice(2))):(a.push("moveTo",[h[0],h[1]]),a.push(f,h.slice(2)));return b}function f(a,c,b,f,h,d,v){var y=0,D=0,E=0,l=e.distance(b,f,h,d),k=0;c=c.canvasDash;var t=b,B=f,g,w=!(a instanceof Array);v?(E=v.l,k=v.i):E+=c[0];for(;.01<Math.abs(1-D);)E>l&&(y={l:E-l,i:k},E=l),D=E/l,v=b+(h-b)*D,g=f+(d-f)*D,k++%2||(w?(a.moveTo(t,B),a.lineTo(v,
g)):(a.push("moveTo",[t,B]),a.push("lineTo",[v,g]))),t=v,B=g,E+=c[k%c.length];return y}var z=q.canvas={},w=null,A=x.multiplyPoint,I=Math.PI,F=2*I,C=I/2;l=n.extend;if(m.global.CanvasRenderingContext2D){m=m.doc.createElement("canvas").getContext("2d");var K="function"==typeof m.setLineDash,T="function"==typeof m.fillText}var G={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],
longdashdotdot:[8,3,1,3,1,3]};z.Shape=u("dojox.gfx.canvas.Shape",b.Shape,{_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);this._renderShape(a);this._renderFill(a,!0);this._renderStroke(a,!0);a.restore()},_renderClip:function(a){this.canvasClip&&(this.canvasClip.render(a),a.clip())},_renderTransform:function(a){if("canvasTransform"in this){var c=this.canvasTransform;a.translate(c.dx,c.dy);a.rotate(c.angle2);a.scale(c.sx,c.sy);a.rotate(c.angle1)}},_renderShape:function(a){},
_renderFill:function(a,c){if("canvasFill"in this){var b=this.fillStyle;if("canvasFillImage"in this){var f=b.width,e=b.height,h=this.canvasFillImage.width,d=this.canvasFillImage.height,y=Math.min(f==h?1:f/h,e==d?1:e/d),D=(f-y*h)/2,v=(e-y*d)/2;w.width=f;w.height=e;var l=w.getContext("2d");l.clearRect(0,0,f,e);l.drawImage(this.canvasFillImage,0,0,h,d,D,v,y*h,y*d);this.canvasFill=a.createPattern(w,"repeat");delete this.canvasFillImage}a.fillStyle=this.canvasFill;c&&("pattern"!==b.type||0===b.x&&0===b.y||
a.translate(b.x,b.y),a.fill())}else a.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(a,c){var b=this.strokeStyle;b?(a.strokeStyle=b.color.toString(),a.lineWidth=b.width,a.lineCap=b.cap,"number"==typeof b.join?(a.lineJoin="miter",a.miterLimit=b.join):a.lineJoin=b.join,this.canvasDash?K?(a.setLineDash(this.canvasDash),c&&a.stroke()):this._renderDashedStroke(a,c):c&&a.stroke()):c||(a.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(a,c){},getEventSource:function(){return null},on:function(){},
connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(a){this.inherited(arguments);var c=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!c)return this;this.canvasClip=a?L(c,a):null;this.parent&&this.parent._makeDirty();return this}});var L=function(a,c){switch(a){case "ellipse":return{canvasEllipse:v({shape:c}),render:function(a){return z.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:n.delegate(c,{r:0}),
render:function(a){return z.Rect.prototype._renderShape.call(this,a)}};case "path":return{canvasPath:W(c),render:function(a){this.canvasPath._renderShape(a)}};case "polyline":return{canvasPolyline:c.points,render:function(a){return z.Polyline.prototype._renderShape.call(this,a)}}}return null},W=function(a){var c=new dojox.gfx.canvas.Path;c.canvasPath=[];c._setPath(a.d);return c},Q=function(a,c,b){var f=a.prototype[c];a.prototype[c]=b?function(){this.parent&&this.parent._makeDirty();f.apply(this,arguments);
b.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return f.apply(this,arguments)}};Q(z.Shape,"setTransform",function(){this.matrix?this.canvasTransform=q.decompose(this.matrix):delete this.canvasTransform});Q(z.Shape,"setFill",function(){var a=this.fillStyle,c;if(a){if("object"==typeof a&&"type"in a){var b=this.surface.rawNode.getContext("2d");switch(a.type){case "linear":case "radial":c="linear"==a.type?b.createLinearGradient(a.x1,a.y1,a.x2,a.y2):b.createRadialGradient(a.cx,
a.cy,0,a.cx,a.cy,a.r);r.forEach(a.colors,function(a){c.addColorStop(a.offset,q.normalizeColor(a.color).toString())});break;case "pattern":w||(w=document.createElement("canvas")),b=new Image,this.surface.downloadImage(b,a.src),this.canvasFillImage=b}}else c=a.toString();this.canvasFill=c}else delete this.canvasFill});Q(z.Shape,"setStroke",function(){var a=this.strokeStyle;if(a){var c=this.strokeStyle.style.toLowerCase();c in G&&(c=G[c]);if(c instanceof Array){this.canvasDash=c=c.slice();var b;for(b=
0;b<c.length;++b)c[b]*=a.width;if("butt"!=a.cap){for(b=0;b<c.length;b+=2)c[b]-=a.width,1>c[b]&&(c[b]=1);for(b=1;b<c.length;b+=2)c[b]+=a.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!K&&!!this.canvasDash});Q(z.Shape,"setShape");z.Group=u("dojox.gfx.canvas.Group",z.Shape,{constructor:function(){b.Container._init.call(this)},_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);for(var c=0;c<this.children.length;++c)this.children[c]._render(a);a.restore()},
destroy:function(){b.Container.clear.call(this,!0);z.Shape.prototype.destroy.apply(this,arguments)}});z.Rect=u("dojox.gfx.canvas.Rect",[z.Shape,b.Rect],{_renderShape:function(a){var c=this.shape,b=Math.min(c.r,c.height/2,c.width/2),f=c.x,e=f+c.width,h=c.y,c=h+c.height,d=f+b,v=e-b,l=h+b,y=c-b;a.beginPath();a.moveTo(d,h);b?(a.arc(v,l,b,-C,0,!1),a.arc(v,y,b,0,C,!1),a.arc(d,y,b,C,I,!1),a.arc(d,l,b,I,I+C,!1)):(a.lineTo(v,h),a.lineTo(e,y),a.lineTo(d,c),a.lineTo(f,l));a.closePath()},_renderDashedStroke:function(c,
b){var e=this.shape,h=Math.min(e.r,e.height/2,e.width/2),d=e.x,v=d+e.width,l=e.y,D=l+e.height,y=d+h,k=v-h,t=l+h,B=D-h;h?(c.beginPath(),e=f(c,this,y,l,k,l),b&&c.stroke(),e=a(c,this.canvasDash,k,t,h,-C,0,!1,b,e),c.beginPath(),e=f(c,this,v,t,v,B,e),b&&c.stroke(),e=a(c,this.canvasDash,k,B,h,0,C,!1,b,e),c.beginPath(),e=f(c,this,k,D,y,D,e),b&&c.stroke(),e=a(c,this.canvasDash,y,B,h,C,I,!1,b,e),c.beginPath(),e=f(c,this,d,B,d,t,e),b&&c.stroke(),a(c,this.canvasDash,y,t,h,I,I+C,!1,b,e)):(c.beginPath(),e=f(c,
this,y,l,k,l),e=f(c,this,k,l,v,B,e),e=f(c,this,v,B,y,D,e),f(c,this,y,D,d,t,e),b&&c.stroke())}});var H=[];(function(){var a=k.curvePI4;H.push(a.s,a.c1,a.c2,a.e);for(var c=45;360>c;c+=45){var b=x.rotateg(c);H.push(A(b,a.c1),A(b,a.c2),A(b,a.e))}})();var v=function(a){var b,f,e,h=[],d=a.shape,v=x.normalize([x.translate(d.cx,d.cy),x.scale(d.rx,d.ry)]);b=A(v,H[0]);h.push([b.x,b.y]);for(d=1;d<H.length;d+=3)f=A(v,H[d]),e=A(v,H[d+1]),b=A(v,H[d+2]),h.push([f.x,f.y,e.x,e.y,b.x,b.y]);if(a._needsDash){b=[];f=
h[0];for(d=1;d<h.length;++d)e=[],c(f.concat(h[d]),a.canvasDash,e),f=[h[d][4],h[d][5]],b.push(e);a._dashedPoints=b}return h};z.Ellipse=u("dojox.gfx.canvas.Ellipse",[z.Shape,b.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=v(this);return this},setStroke:function(){this.inherited(arguments);K||(this.canvasEllipse=v(this));return this},_renderShape:function(a){var c=this.canvasEllipse,b;a.beginPath();a.moveTo.apply(a,c[0]);for(b=1;b<c.length;++b)a.bezierCurveTo.apply(a,c[b]);
a.closePath()},_renderDashedStroke:function(a,c){var b=this._dashedPoints;a.beginPath();for(var f=0;f<b.length;++f)for(var e=b[f],h=0;h<e.length;++h){var d=e[h];a.moveTo(d[0],d[1]);a.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}c&&a.stroke()}});z.Circle=u("dojox.gfx.canvas.Circle",[z.Shape,b.Circle],{_renderShape:function(a){var c=this.shape;a.beginPath();a.arc(c.cx,c.cy,c.r,0,F,1)},_renderDashedStroke:function(a,c){var b=this.shape,f=0,e,h=this.canvasDash.length;for(i=0;f<F;)e=this.canvasDash[i%
h]/b.r,i%2||(a.beginPath(),a.arc(b.cx,b.cy,b.r,f,f+e,0),c&&a.stroke()),f+=e,++i}});z.Line=u("dojox.gfx.canvas.Line",[z.Shape,b.Line],{_renderShape:function(a){var c=this.shape;a.beginPath();a.moveTo(c.x1,c.y1);a.lineTo(c.x2,c.y2)},_renderDashedStroke:function(a,c){var b=this.shape;a.beginPath();f(a,this,b.x1,b.y1,b.x2,b.y2);c&&a.stroke()}});z.Polyline=u("dojox.gfx.canvas.Polyline",[z.Shape,b.Polyline],{setShape:function(){this.inherited(arguments);var a=this.shape.points,c=a[0],b,f;this.bbox=null;
this._normalizePoints();if(a.length)if("number"==typeof c)c=a;else for(c=[],f=0;f<a.length;++f)b=a[f],c.push(b.x,b.y);else c=[];this.canvasPolyline=c;return this},_renderShape:function(a){var c=this.canvasPolyline;if(c.length){a.beginPath();a.moveTo(c[0],c[1]);for(var b=2;b<c.length;b+=2)a.lineTo(c[b],c[b+1])}},_renderDashedStroke:function(a,c){var b=this.canvasPolyline,e=0;a.beginPath();for(var h=0;h<b.length;h+=2)e=f(a,this,b[h],b[h+1],b[h+2],b[h+3],e);c&&a.stroke()}});z.Image=u("dojox.gfx.canvas.Image",
[z.Shape,b.Image],{setShape:function(){this.inherited(arguments);var a=new Image;this.surface.downloadImage(a,this.shape.src);this.canvasImage=a;return this},_renderShape:function(a){var c=this.shape;a.drawImage(this.canvasImage,c.x,c.y,c.width,c.height)}});z.Text=u("dojox.gfx.canvas.Text",[z.Shape,b.Text],{_setFont:function(){this.fontStyle?this.canvasFont=q.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var a=this.shape,c=0,b;a.text&&(b=this.surface.rawNode.getContext("2d"),
b.save(),this._renderTransform(b),this._renderFill(b,!1),this._renderStroke(b,!1),this.canvasFont&&(b.font=this.canvasFont),c=b.measureText(a.text).width,b.restore());return c},_render:function(a){a.save();this._renderTransform(a);this._renderFill(a,!1);this._renderStroke(a,!1);this._renderShape(a);a.restore()},_renderShape:function(a){var c=this.shape;c.text&&(a.textAlign="middle"===c.align?"center":c.align,this.canvasFont&&(a.font=this.canvasFont),this.canvasFill&&a.fillText(c.text,c.x,c.y),this.strokeStyle&&
(a.beginPath(),a.strokeText(c.text,c.x,c.y),a.closePath()))}});Q(z.Text,"setFont");T||z.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var J={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};
z.Path=u("dojox.gfx.canvas.Path",[z.Shape,t.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);K||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(a){var c=n.clone(this.last);this[J[a.action]](this.canvasPath,a.action,a.args,this._needsDash?this._dashedPath:
null);this.last=c;this.inherited(arguments)},_renderShape:function(a){var c=this.canvasPath;a.beginPath();for(var b=0;b<c.length;b+=2)a[c[b]].apply(a,c[b+1])},_renderDashedStroke:K?function(){}:function(a,c){var b=this._dashedPath;a.beginPath();for(var f=0;f<b.length;f+=2)a[b[f]].apply(a,b[f+1]);c&&a.stroke()},_moveToA:function(a,c,b,e){a.push("moveTo",[b[0],b[1]]);e&&e.push("moveTo",[b[0],b[1]]);for(c=2;c<b.length;c+=2)a.push("lineTo",[b[c],b[c+1]]),e&&(this._dashResidue=f(e,this,b[c-2],b[c-1],b[c],
b[c+1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_moveToR:function(a,c,b,e){c="x"in this.last?[this.last.x+=b[0],this.last.y+=b[1]]:[this.last.x=b[0],this.last.y=b[1]];a.push("moveTo",c);e&&e.push("moveTo",c);for(c=2;c<b.length;c+=2)a.push("lineTo",[this.last.x+=b[c],this.last.y+=b[c+1]]),e&&(this._dashResidue=f(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(a,c,b,e){for(c=
0;c<b.length;c+=2)e&&(this._dashResidue=f(e,this,this.last.x,this.last.y,b[c],b[c+1],this._dashResidue)),a.push("lineTo",[b[c],b[c+1]]);this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_lineToR:function(a,c,b,e){for(c=0;c<b.length;c+=2)a.push("lineTo",[this.last.x+=b[c],this.last.y+=b[c+1]]),e&&(this._dashResidue=f(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(a,c,b,e){for(c=0;c<b.length;++c)a.push("lineTo",
[b[c],this.last.y]),e&&(this._dashResidue=f(e,this,e[e.length-1][0],e[e.length-1][1],b[c],this.last.y,this._dashResidue));this.last.x=b[b.length-1];this.lastControl={}},_hLineToR:function(a,c,b,e){for(c=0;c<b.length;++c)a.push("lineTo",[this.last.x+=b[c],this.last.y]),e&&(this._dashResidue=f(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(a,c,b,e){for(c=0;c<b.length;++c)a.push("lineTo",[this.last.x,b[c]]),e&&(this._dashResidue=
f(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,b[c],this._dashResidue));this.last.y=b[b.length-1];this.lastControl={}},_vLineToR:function(a,c,b,e){for(c=0;c<b.length;++c)a.push("lineTo",[this.last.x,this.last.y+=b[c]]),e&&(this._dashResidue=f(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(a,c,b,e){for(c=0;c<b.length;c+=6)a.push("bezierCurveTo",b.slice(c,c+6)),e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));
this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type="C"},_curveToR:function(a,c,b,e){for(c=0;c<b.length;c+=6)a.push("bezierCurveTo",[this.last.x+b[c],this.last.y+b[c+1],this.lastControl.x=this.last.x+b[c+2],this.lastControl.y=this.last.y+b[c+3],this.last.x+b[c+4],this.last.y+b[c+5]]),e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue)),this.last.x+=b[c+4],this.last.y+=b[c+5];this.lastControl.type="C"},
_smoothCurveToA:function(a,c,b,e){for(c=0;c<b.length;c+=4){var f="C"==this.lastControl.type;a.push("bezierCurveTo",[f?2*this.last.x-this.lastControl.x:this.last.x,f?2*this.last.y-this.lastControl.y:this.last.y,b[c],b[c+1],b[c+2],b[c+3]]);e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));this.lastControl.x=b[c];this.lastControl.y=b[c+1];this.lastControl.type="C"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_smoothCurveToR:function(a,c,b,e){for(c=0;c<b.length;c+=4){var f="C"==
this.lastControl.type;a.push("bezierCurveTo",[f?2*this.last.x-this.lastControl.x:this.last.x,f?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[c],this.last.y+b[c+1],this.last.x+b[c+2],this.last.y+b[c+3]]);e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));this.lastControl.x=this.last.x+b[c];this.lastControl.y=this.last.y+b[c+1];this.lastControl.type="C";this.last.x+=b[c+2];this.last.y+=b[c+3]}},_qCurveToA:function(a,c,b,e){for(c=0;c<b.length;c+=4)a.push("quadraticCurveTo",
b.slice(c,c+4));e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type="Q"},_qCurveToR:function(a,c,b,e){for(c=0;c<b.length;c+=4)a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+b[c],this.lastControl.y=this.last.y+b[c+1],this.last.x+b[c+2],this.last.y+b[c+3]]),e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue)),this.last.x+=b[c+
2],this.last.y+=b[c+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(a,c,b,e){for(c=0;c<b.length;c+=2){var f="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=f?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=f?2*this.last.y-this.lastControl.y:this.last.y,b[c],b[c+1]]);e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_qSmoothCurveToR:function(a,c,b,e){for(c=
0;c<b.length;c+=2){var f="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=f?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=f?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[c],this.last.y+b[c+1]]);e&&(this._dashResidue=h(e,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=b[c];this.last.y+=b[c+1]}},_arcTo:function(a,c,b,e){c="a"==c;for(var f=0;f<b.length;f+=7){var d=b[f+5],v=b[f+6];c&&(d+=this.last.x,v+=this.last.y);var l=
k.arcAsBezier(this.last,b[f],b[f+1],b[f+2],b[f+3]?1:0,b[f+4]?1:0,d,v);r.forEach(l,function(c){a.push("bezierCurveTo",c)});e&&(this._dashResidue=h(e,this,p,this._dashResidue));this.last.x=d;this.last.y=v}this.lastControl={}},_closePath:function(a,c,b,e){a.push("closePath",[]);e&&(this._dashResidue=f(e,this,this.last.x,this.last.y,e[1][0],e[1][1],this._dashResidue));this.lastControl={}}});r.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(a){Q(z.Path,a)});z.TextPath=u("dojox.gfx.canvas.TextPath",[z.Shape,t.TextPath],{_renderShape:function(a){},_setText:function(){},_setFont:function(){}});z.Surface=u("dojox.gfx.canvas.Surface",b.Surface,{constructor:function(){b.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){b.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(a,c){this.width=q.normalizedLength(a);this.height=q.normalizedLength(c);if(!this.rawNode)return this;
var b=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,b=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,b=!0);b&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(a){!this.rawNode||!a&&this.pendingImageCount||(a=this.rawNode.getContext("2d"),a.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(a),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(a){a.save();for(var c=0;c<this.children.length;++c)this.children[c]._render(a);a.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(n.hitch(this,this._render),0))},downloadImage:function(a,c){var b=n.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);a.onload=b;a.onerror=b;a.onabort=b;a.src=
c},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});z.createSurface=function(a,c,b){if(!c&&!b){var e=g.position(a);c=c||e.w;b=b||e.h}"number"==typeof c&&(c+="px");"number"==typeof b&&(b+="px");e=new z.Surface;a=d.byId(a);var f=a.ownerDocument.createElement("canvas");f.width=q.normalizedLength(c);f.height=q.normalizedLength(b);a.appendChild(f);
e.rawNode=f;e._parent=a;return e.surface=e};var B=b.Container;u={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(a){this._makeDirty();return B.add.apply(this,arguments)},remove:function(a,c){this._makeDirty();return B.remove.apply(this,arguments)},clear:function(){this._makeDirty();return B.clear.apply(this,arguments)},getBoundingBox:B.getBoundingBox,
_moveChildToFront:function(a){this._makeDirty();return B._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(a){this._makeDirty();return B._moveChildToBack.apply(this,arguments)}};t={createObject:function(a,c){var b=new a;b.surface=this.surface;b.setShape(c);this.add(b);return b}};l(z.Group,u);l(z.Group,b.Creator);l(z.Group,t);l(z.Surface,u);l(z.Surface,b.Creator);l(z.Surface,t);z.fixTarget=function(a,c){return!0};return z})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(q,n,r,u,m,g,d,b,t,k){function x(a,c){if(!l)return a.splice(c,1);var b=a.length;if(b){for(;c<b;)a[c]=a[c+1],c++;a.length--}}var l=!!m("chrome"),e=q.shape={};e.Shape=r("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(m("gfxRegistry")){var a=e.register(this);this.getUID=function(){return a}}},destroy:function(){m("gfxRegistry")&&e.dispose(this);this.rawNode&&"__gfxObject__"in
this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var c=this._getRealMatrix();return[k.multiplyPoint(c,a.x,
a.y),k.multiplyPoint(c,a.x+a.width,a.y),k.multiplyPoint(c,a.x+a.width,a.y+a.height),k.multiplyPoint(c,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=q.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var c=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":c=q.makeParameters(q.defaultLinearGradient,
a);break;case "radial":c=q.makeParameters(q.defaultRadialGradient,a);break;case "pattern":c=q.makeParameters(q.defaultPattern,a)}else c=q.normalizeColor(a);this.fillStyle=c;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||n.isArray(a)||a instanceof t)a={color:a};a=this.strokeStyle=q.makeParameters(q.defaultStroke,a);a.color=q.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=k.clone(a?k.normalize(a):k.identity);return this._applyTransform()},
_applyTransform:function(){return this},moveToFront:function(){var a=this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?
this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&this.parent.remove(this,a);return this},_setParent:function(a,c){this.parent=a;return this._updateParentMatrix(c)},_updateParentMatrix:function(a){this.parentMatrix=a?k.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,c=this.parent;c;)c.matrix&&(a=k.multiply(c.matrix,a)),c=c.parent;return a}});e._eventsProcessing={on:function(a,c){return g(this.getEventSource(),a,e.fixCallback(this,
q.fixTarget,c))},connect:function(a,c,b){"on"==a.substring(0,2)&&(a=a.substring(2));return this.on(a,b?n.hitch(c,b):c)},disconnect:function(a){return a.remove()}};e.fixCallback=function(a,c,b,e){e||(e=b,b=null);if(n.isString(e)){b=b||u.global;if(!b[e])throw['dojox.gfx.shape.fixCallback: scope["',e,'"] is null (scope\x3d"',b,'")'].join("");return function(f){return c(f,a)?b[e].apply(b,arguments||[]):void 0}}return b?function(f){return c(f,a)?e.apply(b,arguments||[]):void 0}:function(f){return c(f,
a)?e.apply(b,arguments):void 0}};n.extend(e.Shape,e._eventsProcessing);e.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var c=a.getParent();c&&c.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,c){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){c||(a.parent=null,a.parentMatrix=null);x(this.children,b);break}return this},clear:function(a){for(var c,
b=0;b<this.children.length;++b)c=this.children[b],c.parent=null,c.parentMatrix=null,a&&c.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var a=null;d.forEach(this.children,function(c){var b=c.getBoundingBox();b&&((c=c.getTransform())&&(b=k.multiplyRectangle(c,b)),a?(a.x=Math.min(a.x,b.x),a.y=Math.min(a.y,b.y),a.endX=Math.max(a.endX,b.x+b.width),a.endY=Math.max(a.endY,b.y+b.height)):a={x:b.x,y:b.y,endX:b.x+b.width,endY:b.y+b.height})});a&&(a.width=a.endX-a.x,a.height=
a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){x(this.children,c);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){x(this.children,c);this.children.unshift(a);break}return this}};e.Surface=r("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){d.forEach(this._nodes,
b.destroy);this._nodes=[];d.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;if(m("ie"))for(;this._parent.lastChild;)b.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,c){var b=n.hitch(a,c);if(this.isLoaded)b(this);else g.once(this,"load",function(a){b(a)})}});n.extend(e.Surface,e._eventsProcessing);
e.Rect=r("dojox.gfx.shape.Rect",e.Shape,{constructor:function(a){this.shape=q.getDefault("Rect");this.rawNode=a},getBoundingBox:function(){return this.shape}});e.Ellipse=r("dojox.gfx.shape.Ellipse",e.Shape,{constructor:function(a){this.shape=q.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});e.Circle=r("dojox.gfx.shape.Circle",e.Shape,{constructor:function(a){this.shape=
q.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});e.Line=r("dojox.gfx.shape.Line",e.Shape,{constructor:function(a){this.shape=q.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});e.Polyline=r("dojox.gfx.shape.Polyline",
e.Shape,{constructor:function(a){this.shape=q.getDefault("Polyline");this.rawNode=a},setShape:function(a,c){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),c&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,c=a&&a.length;if(c&&"number"==typeof a[0]){for(var b=[],e=0;e<c;e+=2)b.push({x:a[e],y:a[e+1]});this.shape.points=b}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=
this.shape.points,c=a.length,b=a[0],e=b.x,d=b.y,l=b.x,k=b.y,t=1;t<c;++t)b=a[t],e>b.x&&(e=b.x),l<b.x&&(l=b.x),d>b.y&&(d=b.y),k<b.y&&(k=b.y);this.bbox={x:e,y:d,width:l-e,height:k-d}}return this.bbox}});e.Image=r("dojox.gfx.shape.Image",e.Shape,{constructor:function(a){this.shape=q.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});e.Text=r(e.Shape,{constructor:function(a){this.fontStyle=null;this.shape=
q.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?q.splitFontString(a):q.makeParameters(q.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=q._base._computeTextBoundingBox(this));return a}});e.Creator={createShape:function(a){switch(a.type){case q.defaultPath.type:return this.createPath(a);case q.defaultRect.type:return this.createRect(a);case q.defaultCircle.type:return this.createCircle(a);
case q.defaultEllipse.type:return this.createEllipse(a);case q.defaultLine.type:return this.createLine(a);case q.defaultPolyline.type:return this.createPolyline(a);case q.defaultImage.type:return this.createImage(a);case q.defaultText.type:return this.createText(a);case q.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(q.Group)},createRect:function(a){return this.createObject(q.Rect,a)},createEllipse:function(a){return this.createObject(q.Ellipse,
a)},createCircle:function(a){return this.createObject(q.Circle,a)},createLine:function(a){return this.createObject(q.Line,a)},createPolyline:function(a){return this.createObject(q.Polyline,a)},createImage:function(a){return this.createObject(q.Image,a)},createText:function(a){return this.createObject(q.Text,a)},createPath:function(a){return this.createObject(q.Path,a)},createTextPath:function(a){return this.createObject(q.TextPath,{}).setText(a)},createObject:function(a,c){return null}};return e})},
"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(q,n,r,u,m){m=r("dojox.gfx.path.Path",m.Shape,{constructor:function(g){this.shape=n.clone(q.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=g;this.segmented=!1},setAbsoluteMode:function(g){this._confirmSegmented();this.absolute="string"==typeof g?"absolute"==g:g;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},
getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var g=this.bbox,d=this._getRealMatrix();this.bbox=null;for(var b=0,t=this.segments.length;b<t;++b)this._updateWithSegment(this.segments[b],d);d=this.bbox;this.bbox=g;return this.tbbox=d?[{x:d.l,y:d.t},{x:d.r,y:d.t},{x:d.r,y:d.b},{x:d.l,y:d.b}]:
null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(g,d,b){b&&(d=u.multiplyPoint(b,g,d),g=d.x,d=d.y);this.bbox&&"l"in this.bbox?(this.bbox.l>g&&(this.bbox.l=g),this.bbox.r<g&&(this.bbox.r=g),this.bbox.t>d&&(this.bbox.t=d),this.bbox.b<d&&(this.bbox.b=d)):this.bbox={l:g,b:d,r:g,t:d}},_updateWithSegment:function(g,d){var b=g.args,t=b.length,k;switch(g.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(k=
0;k<t;k+=2)this._updateBBox(b[k],b[k+1],d);this.last.x=b[t-2];this.last.y=b[t-1];this.absolute=!0;break;case "H":for(k=0;k<t;++k)this._updateBBox(b[k],this.last.y,d);this.last.x=b[t-1];this.absolute=!0;break;case "V":for(k=0;k<t;++k)this._updateBBox(this.last.x,b[k],d);this.last.y=b[t-1];this.absolute=!0;break;case "m":k=0;"x"in this.last||(this._updateBBox(this.last.x=b[0],this.last.y=b[1],d),k=2);for(;k<t;k+=2)this._updateBBox(this.last.x+=b[k],this.last.y+=b[k+1],d);this.absolute=!1;break;case "l":case "t":for(k=
0;k<t;k+=2)this._updateBBox(this.last.x+=b[k],this.last.y+=b[k+1],d);this.absolute=!1;break;case "h":for(k=0;k<t;++k)this._updateBBox(this.last.x+=b[k],this.last.y,d);this.absolute=!1;break;case "v":for(k=0;k<t;++k)this._updateBBox(this.last.x,this.last.y+=b[k],d);this.absolute=!1;break;case "c":for(k=0;k<t;k+=6)this._updateBBox(this.last.x+b[k],this.last.y+b[k+1],d),this._updateBBox(this.last.x+b[k+2],this.last.y+b[k+3],d),this._updateBBox(this.last.x+=b[k+4],this.last.y+=b[k+5],d);this.absolute=
!1;break;case "s":case "q":for(k=0;k<t;k+=4)this._updateBBox(this.last.x+b[k],this.last.y+b[k+1],d),this._updateBBox(this.last.x+=b[k+2],this.last.y+=b[k+3],d);this.absolute=!1;break;case "A":for(k=0;k<t;k+=7)this._updateBBox(b[k+5],b[k+6],d);this.last.x=b[t-2];this.last.y=b[t-1];this.absolute=!0;break;case "a":for(k=0;k<t;k+=7)this._updateBBox(this.last.x+=b[k+5],this.last.y+=b[k+6],d);this.absolute=!1}var m=[g.action];for(k=0;k<t;++k)m.push(q.formatNumber(b[k],!0));if("string"==typeof this.shape.path)this.shape.path+=
m.join("");else for(k=0,t=m.length;k<t;++k)this.shape.path.push(m[k])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(g,d){this.tbbox=null;var b=this._validSegments[g.toLowerCase()];"number"==typeof b&&(b?d.length>=b&&(b={action:g,args:d.slice(0,d.length-d.length%b)},this.segments.push(b),this._updateWithSegment(b)):(b={action:g,args:[]},this.segments.push(b),this._updateWithSegment(b)))},_collectArgs:function(g,d){for(var b=0;b<d.length;++b){var t=d[b];"boolean"==
typeof t?g.push(t?1:0):"number"==typeof t?g.push(t):t instanceof Array?this._collectArgs(g,t):"x"in t&&"y"in t&&g.push(t.x,t.y)}},moveTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"M":"m",g);return this},lineTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"L":"l",g);return this},hLineTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?
"H":"h",g);return this},vLineTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"V":"v",g);return this},curveTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"C":"c",g);return this},smoothCurveTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"S":"s",g);return this},qCurveTo:function(){this._confirmSegmented();var g=
[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"Q":"q",g);return this},qSmoothCurveTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"T":"t",g);return this},arcTo:function(){this._confirmSegmented();var g=[];this._collectArgs(g,arguments);this._pushSegment(this.absolute?"A":"a",g);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var g=
this.shape.path;this.shape.path=[];this._setPath(g);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(g){g=n.isArray(g)?g:g.match(q.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(g){for(var d="",b=[],t=g.length,k=0;k<t;++k){var m=g[k],l=parseFloat(m);isNaN(l)?(d&&this._pushSegment(d,b),b=[],d=m):b.push(l)}this._pushSegment(d,b)}},setShape:function(g){this.inherited(arguments,["string"==typeof g?{path:g}:g]);this.segmented=!1;this.segments=
[];q.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});r=r("dojox.gfx.path.TextPath",m,{constructor:function(g){"text"in this||(this.text=n.clone(q.defaultTextPath));"fontStyle"in this||(this.fontStyle=n.clone(q.defaultFont))},getText:function(){return this.text},setText:function(g){this.text=q.makeParameters(this.text,"string"==typeof g?{text:g}:g);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(g){this.fontStyle="string"==typeof g?
q.splitFontString(g):q.makeParameters(q.defaultFont,g);this._setFont();return this}});return q.path={Path:m,TextPath:r}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(q,n,r){function u(b){var d=Math.cos(b);b=Math.sin(b);var l={x:d+4/3*(1-d),y:b-4/3*d*(1-d)/b};return{s:{x:d,y:-b},c1:{x:l.x,y:-l.y},c2:l,e:{x:d,y:b}}}var m=2*Math.PI,g=Math.PI/4,d=Math.PI/8,b=g+d,t=u(d);return q.arc={unitArcAsBezier:u,curvePI4:t,arcAsBezier:function(k,n,l,e,a,c,h,f){a=!!a;c=!!c;
var z=r._degToRad(e);e=n*n;var w=l*l,A=r.multiplyPoint(r.rotate(-z),{x:(k.x-h)/2,y:(k.y-f)/2}),x=A.x*A.x,q=A.y*A.y;e=Math.sqrt((e*w-e*q-w*x)/(e*q+w*x));isNaN(e)&&(e=0);e={x:e*n*A.y/l,y:-e*l*A.x/n};a==c&&(e={x:-e.x,y:-e.y});e=r.multiplyPoint([r.translate((k.x+h)/2,(k.y+f)/2),r.rotate(z)],e);n=r.normalize([r.translate(e.x,e.y),r.rotate(z),r.scale(n,l)]);e=r.invert(n);k=r.multiplyPoint(e,k);f=r.multiplyPoint(e,h,f);h=Math.atan2(k.y,k.x);e=h-Math.atan2(f.y,f.x);c&&(e=-e);0>e?e+=m:e>m&&(e-=m);l=d;f=t;
l=c?l:-l;k=[];for(a=e;0<a;a-=g)a<b&&(l=a/2,f=u(l),l=c?l:-l,a=0),A=r.normalize([n,r.rotate(h+l)]),c?(e=r.multiplyPoint(A,f.c1),z=r.multiplyPoint(A,f.c2),A=r.multiplyPoint(A,f.e)):(e=r.multiplyPoint(A,f.c2),z=r.multiplyPoint(A,f.c1),A=r.multiplyPoint(A,f.s)),k.push([e.x,e.y,z.x,z.y,A.x,A.y]),h+=2*l;return k}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(q,n,r){function u(b,d){return Math.abs(b-d)<=1E-6*(Math.abs(b)+Math.abs(d))}function m(b,d,g,l){if(!isFinite(b))return g;
if(!isFinite(g))return b;d=Math.abs(d);l=Math.abs(l);return(d*b+l*g)/(d+l)}function g(b){b=r.normalize(b);var d=-b.xx-b.yy,t=b.xx*b.yy-b.xy*b.yx,l=Math.sqrt(d*d-4*t),d=-(d+(0>d?-l:l))/2,t=t/d,l=b.xy/(d-b.xx),e=1,a=b.xy/(t-b.xx),c=1;u(d,t)&&(l=1,a=e=0,c=1);isFinite(l)||(l=1,e=(d-b.xx)/b.xy,isFinite(e)||(l=(d-b.yy)/b.yx,e=1,isFinite(l)||(l=1,e=b.yx/(d-b.yy))));isFinite(a)||(a=1,c=(t-b.xx)/b.xy,isFinite(c)||(a=(t-b.yy)/b.yx,c=1,isFinite(a)||(a=1,c=b.yx/(t-b.yy))));b=Math.sqrt(l*l+e*e);var h=Math.sqrt(a*
a+c*c);isFinite(l/=b)||(l=0);isFinite(e/=b)||(e=0);isFinite(a/=h)||(a=0);isFinite(c/=h)||(c=0);return{value1:d,value2:t,vector1:{x:l,y:e},vector2:{x:a,y:c}}}function d(b,d){var k=0>b.xx*b.yy||0<b.xy*b.yx?-1:1,l=d.angle1=(Math.atan2(b.yx,b.yy)+Math.atan2(-k*b.xy,k*b.xx))/2,k=Math.cos(l),l=Math.sin(l);d.sx=m(b.xx/k,k,-b.xy/l,l);d.sy=m(b.yy/k,k,b.yx/l,l);return d}function b(b,d){var k=0>b.xx*b.yy||0<b.xy*b.yx?-1:1,l=d.angle2=(Math.atan2(k*b.yx,k*b.xx)+Math.atan2(-b.xy,b.yy))/2,k=Math.cos(l),l=Math.sin(l);
d.sx=m(b.xx/k,k,b.yx/l,l);d.sy=m(b.yy/k,k,-b.xy/l,l);return d}return q.decompose=function(t){var k=r.normalize(t);t={dx:k.dx,dy:k.dy,sx:1,sy:1,angle1:0,angle2:0};if(u(k.xy,0)&&u(k.yx,0))return n.mixin(t,{sx:k.xx,sy:k.yy});if(u(k.xx*k.yx,-k.xy*k.yy))return d(k,t);if(u(k.xx*k.xy,-k.yx*k.yy))return b(k,t);var m,l=new r.Matrix2D(k);m=n.mixin(l,{dx:0,dy:0,xy:l.yx,yx:l.xy});l=g([k,m]);m=g([m,k]);l=new r.Matrix2D({xx:l.vector1.x,xy:l.vector2.x,yx:l.vector1.y,yy:l.vector2.y});m=new r.Matrix2D({xx:m.vector1.x,
xy:m.vector1.y,yx:m.vector2.x,yy:m.vector2.y});k=new r.Matrix2D([r.invert(l),k,r.invert(m)]);d(m,t);k.xx*=t.sx;k.yy*=t.sy;b(l,t);k.xx*=t.sx;k.yy*=t.sy;return n.mixin(t,{sx:k.xx,sy:k.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(q){q=q.bezierutils={};q.tAtLength=function(d,b){var t=0,k=6==d.length,m=0,l=0,e=k?u:g,a=function(c,h){for(var f=0,g=0;g<c.length-2;g+=2)f+=r(c[g],c[g+1],c[g+2],c[g+3]);g=k?r(d[0],d[1],d[4],d[5]):r(d[0],d[1],d[6],d[7]);f-g>h||m+f>b+h?(++l,f=e(c,.5),
a(f[0],h),Math.abs(m-b)<=h||a(f[1],h)):(m+=f,t+=1/(1<<l))};b&&a(d,.5);return t};var n=q.computeLength=function(d){for(var b=6==d.length,g=0,k=0;k<d.length-2;k+=2)g+=r(d[k],d[k+1],d[k+2],d[k+3]);k=b?r(d[0],d[1],d[4],d[5]):r(d[0],d[1],d[6],d[7]);.1<g-k&&(d=b?u(d,.5):m(d,.5),g=n(d[0],b),g+=n(d[1],b));return g},r=q.distance=function(d,b,g,k){return Math.sqrt((g-d)*(g-d)+(k-b)*(k-b))},u=function(d,b){var g=1-b,k=g*g,m=b*b,l=d[0],e=d[1],a=d[2],c=d[3],h=d[4],f=d[5],z=k*l+2*g*b*a+m*h,k=k*e+2*g*b*c+m*f;return[[l,
e,g*l+b*a,g*e+b*c,z,k],[z,k,g*a+b*h,g*c+b*f,h,f]]},m=function(d,b){var g=1-b,k=g*g,m=k*g,l=b*b,e=l*b,a=d[0],c=d[1],h=d[2],f=d[3],z=d[4],w=d[5],n=d[6],r=d[7],q=m*a+3*k*b*h+3*g*l*z+e*n,m=m*c+3*k*b*f+3*g*l*w+e*r;return[[a,c,g*a+b*h,g*c+b*f,k*a+2*g*b*h+l*z,k*c+2*g*b*f+l*w,q,m],[q,m,k*h+2*g*b*z+l*n,k*f+2*g*b*w+l*r,g*z+b*n,g*w+b*r,n,r]]},g=q.splitBezierAtT=function(d,b){return 6==d.length?u(d,b):m(d,b)};return q})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],
function(q,n,r){n.getObject("json",!0,r);r.json._slice=function(n,m,g,d){var b=n.length,t=[];g=g||b;m=0>m?Math.max(0,m+b):Math.min(b,m);for(g=0>g?Math.max(0,g+b):Math.min(b,g);m<g;m+=d)t.push(n[m]);return t};r.json._find=function(n,m){function g(b){m&&(!0!==m||b instanceof Array?b[m]&&d.push(b[m]):d.push(b));for(var k in b){var t=b[k];m?t&&"object"==typeof t&&g(t):d.push(t)}}var d=[];if(m instanceof Array){if(1==m.length)return n[m[0]];for(var b=0;b<m.length;b++)d.push(n[m[b]])}else g(n);return d};
r.json._distinctFilter=function(n,m){for(var g=[],d={},b=0,t=n.length;b<t;++b){var k=n[b];m(k,b,n)&&("object"==typeof k&&k?k.__included||(k.__included=!0,g.push(k)):d[k+typeof k]||(d[k+typeof k]=!0,g.push(k)))}b=0;for(t=g.length;b<t;++b)g[b]&&delete g[b].__included;return g};return r.json.query=function(n,m){function g(d,e,a,c,h,f,g,k){return b[k].match(/[\*\?]/)||"~"==g?"/^"+b[k].substring(1,b[k].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==g?
"$/i":"$/")+".test("+e+")":d}var d=0,b=[];n=n.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(l){d+="["==l?1:"]"==l?-1:0;return"]"==l&&0<d?"`]":'"'==l.charAt(0)||"'"==l.charAt(0)?"`"+(b.push(l)-1):l});var t="";n.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});n=n.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(b){return"."==b.charAt(0)?b:"@"==b?"$obj":(b.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+b}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(b,e,a){return(e=b.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(a="",b.match(/^\./)&&(t="dojox.json._find("+t,a=",true)"),t=(e[1].match(/\=/)?"dojo.map":e[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+t,a+",function($obj){return "+e[2]+"})"):(e=b.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+e[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,e){return"var av\x3d "+e.replace(/\$obj/,
"a")+",bv\x3d "+e.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==b?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==b?-1:1)+";}\n"})+"return 0;})":(e=b.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(t="dojox.json._slice("+t,","+(e[1]||0)+","+(e[2]||0)+","+(e[3]||1)+")"):b.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(t="dojox.json._find("+t,("."==b.charAt(1)?",'"+a+"'":b.match(/,/)?","+b:"")+")"):b}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
g).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(b,e,a,c,d,f,k,w){return g(b,c,d,f,k,w,a,e)});n=t+("$"==n.charAt(0)?"":"$")+n.replace(/`([0-9]+|\])/g,function(d,e){return"]"==e?"]":b[e]});for(var k=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+n+"}"),r=0;r<arguments.length-1;r++)arguments[r]=arguments[r+1];return m?k.apply(this,arguments):k}})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x){q=q(k,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(b){this._geocodeHandler=n.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=n.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=n.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(b){this.outSpatialReference=b},_geocodeHandler:function(b,e,a,c,d){try{var f=b.candidates,h;e=[];var l,k=f.length,g=b.spatialReference,t;for(l=0;l<k;l++){h=f[l];if(t=h.location)t.spatialReference=g;e[l]=new x(h)}this._successHandler([e],"onAddressToLocationsComplete",a,d)}catch(C){this._errorHandler(C,c,d)}},_geocodeAddressesHandler:function(b,e,a,c,d){try{var f=b.locations;e=[];var h,l=f.length,k=b.spatialReference,g;for(h=0;h<l;h++){if(g=
f[h].location)g.spatialReference=k;e[h]=new x(f[h])}this._successHandler([e],"onAddressesToLocationsComplete",a,d)}catch(F){this._errorHandler(F,c,d)}},addressToLocations:function(d,e,a,c,h){var f,l,g,k,r,q,C;d.address&&(c=a,a=e,e=d.outFields,h=d.searchExtent,C=d.countryCode,f=d.magicKey,l=d.distance,q=d.categories,d.location&&this.normalization&&(g=d.location.normalize()),k=d.maxLocations,r=d.forStorage,d=d.address);h&&(h=h.shiftCentralMeridian());var x=this.outSpatialReference;d=this._encode(n.mixin({},
this._url.query,d,{f:"json",outSR:x&&m.toJson(x.toJson()),outFields:e&&e.join(",")||null,searchExtent:h&&m.toJson(h.toJson()),category:q&&q.join(",")||null,countryCode:C||null,magicKey:f||null,distance:l||null,location:g||null,maxLocations:k||null,forStorage:r||null}));var T=this._geocodeHandler,G=this._errorHandler,L=new u(t._dfdCanceller);L._pendingDfd=b({url:this._url.path+"/findAddressCandidates",content:d,callbackParamName:"callback",load:function(b,e){T(b,e,a,c,L)},error:function(a){G(a,c,L)}});
return L},suggestLocations:function(d){var e;e=new u(t._dfdCanceller);d.hasOwnProperty("location")&&this.normalization&&(d.location=d.location.normalize());d.searchExtent&&(d.searchExtent=d.searchExtent.shiftCentralMeridian());d=this._encode(n.mixin({},this._url.query,{f:"json",text:d.text,maxSuggestions:d.maxSuggestions,searchExtent:d.searchExtent&&m.toJson(d.searchExtent.toJson()),category:d.categories&&d.categories.join(",")||null,countryCode:d.countryCode||null,location:d.location||null,distance:d.distance||
null},{f:"json"}));d=b({url:this._url.path+"/suggest",content:d,callbackParamName:"callback"});e._pendingDfd=d;d.then(n.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);e.resolve(a)}),n.hitch(this,function(a){this._errorHandler(a);e.reject(a)}));return e},addressesToLocations:function(d,e,a){var c=this.outSpatialReference,h=[],f=d.categories,l=d.countryCode;r.forEach(d.addresses,function(a,b){h.push({attributes:a})});d=this._encode(n.mixin({},this._url.query,{category:f&&
f.join(",")||null,sourceCountry:l||null},{addresses:m.toJson({records:h})},{f:"json",outSR:c&&m.toJson(c.toJson())}));var g=this._geocodeAddressesHandler,k=this._errorHandler,q=new u(t._dfdCanceller);q._pendingDfd=b({url:this._url.path+"/geocodeAddresses",content:d,callbackParamName:"callback",load:function(b,c){g(b,c,e,a,q)},error:function(b){k(b,a,q)}});return q},_reverseGeocodeHandler:function(b,e,a,c,d){try{var f=new x({address:b.address,location:b.location,score:100});this._successHandler([f],
"onLocationToAddressComplete",a,d)}catch(z){this._errorHandler(z,c,d)}},locationToAddress:function(d,e,a,c){d&&this.normalization&&(d=d.normalize());var h=this.outSpatialReference;d=this._encode(n.mixin({},this._url.query,{outSR:h&&m.toJson(h.toJson()),location:d&&m.toJson(d.toJson()),distance:e,f:"json"}));var f=this._reverseGeocodeHandler,g=this._errorHandler,k=new u(t._dfdCanceller);k._pendingDfd=b({url:this._url.path+"/reverseGeocode",content:d,callbackParamName:"callback",load:function(b,e){f(b,
e,a,c,k)},error:function(a){g(a,c,k)}});return k},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});g("extend-esri")&&n.setObject("tasks.Locator",q,d);return q})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(q,n,r,u,m){q=q(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(g){n.mixin(this,
g);this.location=new m(this.location)}});r("extend-esri")&&n.setObject("tasks.AddressCandidate",q,u);return q})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(q,n,r,u,m,g,d,b){q=q(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,
toJson:function(){var g={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},k=this.distances,m=this.outSpatialReference,l=this.bufferSpatialReference,e=r.map(this.geometries,function(a){a="extent"===a.type?d.fromExtent(a):a;return a.toJson()},this),a=this.geometries;if(a&&0<a.length){var c="extent"===a[0].type?"esriGeometryPolygon":b.getJsonType(a[0]);g.geometries=u.toJson({geometryType:c,geometries:e});g.inSR=a[0].spatialReference.wkid?a[0].spatialReference.wkid:u.toJson(a[0].spatialReference.toJson())}k&&
(g.distances=k.join(","));m&&(g.outSR=m.wkid?m.wkid:u.toJson(m.toJson()));l&&(g.bufferSR=l.wkid?l.wkid:u.toJson(l.toJson()));return g}});m("extend-esri")&&n.setObject("tasks.BufferParameters",q,g);return q})},"esri/tasks/LegendLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,n,r,u){q=q(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null});r("extend-esri")&&n.setObject("tasks.LegendLayer",q,u);return q})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T,G,L,W,Q,H,v,J,B,y,D,E,V,O,M,U,S){var N=q([C,z,w],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:S,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(a,b){n.mixin(this,c.widgets.attributeInspector);a=a||{};a.featureLayer||a.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(a);this._layerInfos=a.layerInfos||[{featureLayer:a.featureLayer,options:a.options||[]}];this._layerInfos=r.filter(this._layerInfos,function(a){return!a.disableAttributeUpdate});this._hideNavButtons=a.hideNavButtons||!1},postCreate:function(){if(r.every(this._layerInfos,
function(a){return a.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var a=this._layerInfos.length;r.forEach(this._layerInfos,function(b){b=b.featureLayer;if(b.loaded)a--;else var c=u.connect(b,"onLoad",this,function(b){u.disconnect(c);c=null;a--;a||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();r.forEach(this._aiConnects,u.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(a,b){b&&(this._createOnlyFirstTime=!0);
this._updateSelection([a],b);this._updateUI()},onLayerSelectionChange:function(b,c,e){this._createOnlyFirstTime=!1;this._featureIdx=e===a.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(a,b,c,e){},onLayerError:function(a,b,c,e){},onLayerEditsError:function(a,
b,c,e){},onLayerEditsComplete:function(a,b,c,e){e=e||[];if(e.length){var d=this._selection,f=a.featureLayer.objectIdField;r.forEach(e,n.hitch(this,function(a){r.some(d,n.hitch(this,function(b,c){if(b.attributes[f]!==a.objectId)return!1;this._selection.splice(c,1);return!0}))}))}b=b||[];b.length&&(this._selection=T.findFeatures(b,a.featureLayer),this._featureIdx=0);e=this._numFeatures=this._selection?this._selection.length:0;if(b.length){if(b=e?this._selection[this._featureIdx]:null)e=b.getLayer().getEditCapabilities(),
e.canCreate&&!e.canUpdate||this._showFeature(b);this._updateUI()}c=c||[];if(c.length){var h=this._rollbackInfo;r.forEach(c,function(b){var e=T.findFeatures(c,a.featureLayer)[0];if(!b.success&&e.attributes[a.featureLayer.objectIdField]===b.objectId&&h){var d=h.field;b=h.graphic.attributes[d.name];var f=r.filter(this._currentLInfo.fieldInfos,function(a){return a.fieldName===d.name},this)[0].dijit;e.attributes[d.name]=b;"esriFieldTypeDate"===d.type&&(b=new Date(b));this._setValue(f,b)}},this)}this._rollbackInfo=
null},onFieldValueChange:function(a,b){var c=a.field,e=a.dijit,d=this._currentFeature,f=this._currentLInfo,h=c.name,v;if(""===e.displayedValue||"dijit.form.ValidationTextBox"!==e.declaredClass||e.isValid())if(""!==e.displayedValue&&e.displayedValue!==b&&e.isValid&&!e.isValid())this._setValue(e,d.attributes[c.name]);else{if(v=!("esriFieldTypeInteger"!==c.type&&"esriFieldTypeSmallInteger"!==c.type&&"esriFieldTypeSingle"!==c.type&&"esriFieldTypeDouble"!==c.type),b=""===b&&v||"undefined"===typeof b?null:
b,v&&null!==b&&(b=Number(b)),"esriFieldTypeDate"===c.type&&(e instanceof Array?(v=e[0].getValue(),e=e[1].getValue(),b=v&&e?new Date(v.getFullYear(),v.getMonth(),v.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()):v||e||null):b=e.getValue(),b=b&&b.getTime?b.getTime():b&&b.toGregorian?b.toGregorian().getTime():b),this._currentFeature.attributes[c.name]!==b){if(h===f.typeIdField){var g=this._findFirst(f.types,"id",b);r.forEach(f.fieldInfos,function(a){(c=a.field)&&c.name!==f.typeIdField&&
(a=a.dijit,this._setFieldDomain(a,g,c)&&a&&(this._setValue(a,d.attributes[c.name]+""),!1===a.isValid()&&this._setValue(a,null)))},this)}this.onAttributeChange(d,h,b)}}else this._setValue(e,d.attributes[c.name])},onDeleteBtn:function(a){this._deleteFeature()},onNextFeature:function(a){this._onNextFeature(1)},onPreviousFeature:function(a){this._onNextFeature(-1)},onFirstFeature:function(a){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(a){this._onNextFeature(this._numFeatures-1-this._featureIdx)},
_initLayerInfos:function(){var a=this._layerInfos;this._editorTrackingInfos={};r.forEach(a,this._initLayerInfo,this)},_initLayerInfo:function(a){var b=a.featureLayer,c,e;this._userIds={};e=b.id;b.credential&&(this._userIds[e]=b.credential.userId);a.userId&&(this._userIds[e]=a.userId);this._connect(b,"onSelectionComplete",n.hitch(this,"onLayerSelectionChange",a));this._connect(b,"onSelectionClear",n.hitch(this,"onLayerSelectionClear",a));this._connect(b,"onEditsComplete",n.hitch(this,"onLayerEditsComplete",
a));this._connect(b,"error",n.hitch(this,"onLayerError",a));this._connect(b,"onUpdateEnd",n.hitch(this,"onLayerUpdateEnd",a));a.showAttachments=b.hasAttachments?x.isDefined(a.showAttachments)?a.showAttachments:!0:!1;a.hideFields=a.hideFields||[];a.htmlFields=a.htmlFields||[];a.isEditable=b.isEditable()?x.isDefined(a.isEditable)?a.isEditable:!0:!1;a.typeIdField=b.typeIdField;a.layerId=b.id;a.types=b.types;b.globalIdField&&((c=this._findFirst(a.fieldInfos,"fieldName",b.globalIdField))||a.showGlobalID||
a.hideFields.push(b.globalIdField));(e=this._findFirst(a.fieldInfos,"fieldName",b.objectIdField))||a.showObjectID||a.hideFields.push(b.objectIdField);var d=this._getFields(a.featureLayer);if(d){var f=a.fieldInfos||[],f=r.map(f,function(a){return n.mixin({},a)});f.length?a.fieldInfos=r.filter(r.map(f,n.hitch(this,function(b){var c=b.stringFieldOption||(this._isInFields(b.fieldName,a.htmlFields)?N.STRING_FIELD_OPTION_RICHTEXT:N.STRING_FIELD_OPTION_TEXTBOX);return n.mixin(b,{field:this._findFirst(d,
"name",b.fieldName),stringFieldOption:c})})),"return item.field;"):(d=r.filter(d,n.hitch(this,function(b){return!this._isInFields(b.name,a.hideFields)})),a.fieldInfos=r.map(d,n.hitch(this,function(b){var c=this._isInFields(b.name,a.htmlFields)?N.STRING_FIELD_OPTION_RICHTEXT:N.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:b.name,field:b,stringFieldOption:c}})));a.showGlobalID&&!c&&f.push(this._findFirst(d,"name",b.globalIdField));a.showObjectID&&!e&&f.push(this._findFirst(d,"name",b.objectIdField));
c=[];b.editFieldsInfo&&(b.editFieldsInfo.creatorField&&c.push(b.editFieldsInfo.creatorField),b.editFieldsInfo.creationDateField&&c.push(b.editFieldsInfo.creationDateField),b.editFieldsInfo.editorField&&c.push(b.editFieldsInfo.editorField),b.editFieldsInfo.editDateField&&c.push(b.editFieldsInfo.editDateField));this._editorTrackingInfos[b.id]=c}},_createAttachmentEditor:function(){this._attachmentEditor=null;var a=r.filter(this._layerInfos,function(a){return a.showAttachments});a&&a.length&&(this._attachmentEditor=
new K({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(a){var b=this._currentLInfo?this._currentLInfo.featureLayer:null,c=a.featureLayer;if(b&&b.id===c.id&&!b.ownershipBasedAccessControlForFeatures&&(b=c.getEditCapabilities(),!b.canCreate||b.canUpdate))return;this._currentLInfo=a;this._createTable()},_updateSelection:function(a,b){this._selection=a||[];r.forEach(this._layerInfos,this._getSelection,this);var c=this._selection.length;
this._numFeatures=this._selection.length;this._showFeature(c?this._selection[this._featureIdx]:null,b)},_getSelection:function(a){a=a.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(a)},_updateUI:function(){var a=this._numFeatures,c=this._currentLInfo;this.layerName.innerHTML=c&&0!==a?c.featureLayer?c.featureLayer.name:"":this.NLS_noFeaturesSelected;b.set(this.attributeTable,"display",a?"":"none");b.set(this.editButtons,"display",a?"":"none");b.set(this.navButtons,"display",
!this._hideNavButtons&&1<a?"":"none");this.navMessage.innerHTML=x.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&b.set(this._attachmentEditor.domNode,"display",c&&c.showAttachments&&a?"":"none");b.set(this.deleteBtn.domNode,"display",c&&!1===c.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(a){this._featureIdx+=
a;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);a=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(a);this._updateUI();this.onNext(a)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(a,b){if(a){this._currentFeature=a;var c=b?b:a.getLayer(),e=c.getEditCapabilities({feature:a,userId:this._userIds[c.id]});this._canUpdate=e.canUpdate;this._canDelete=e.canDelete;if(e=
this._getLInfoFromFeatureLayer(c)){this._setCurrentLInfo(e);var d=a.attributes,f=this._findFirst(e.types,"id",d[e.typeIdField]),h=null;r.forEach(e.fieldInfos,function(a){h=a.field;var b=[];a.dijit&&1<a.dijit.length?r.forEach(a.dijit,function(a){b.push(a)}):b.push(a.dijit);r.forEach(b,n.hitch(this,function(a){if(a){var b=this._setFieldDomain(a,f,h),c=d[h.name],c=c&&b&&b.codedValues&&b.codedValues.length?b.codedValues[c]?b.codedValues[c].name:c:c;x.isDefined(c)||(c="");"dijit.form.DateTextBox"===a.declaredClass||
"dijit.form.TimeTextBox"===a.declaredClass?c=""===c?null:new Date(c):"dijit.form.FilteringSelect"===a.declaredClass&&(a._lastValueReported=null,c=d[h.name]+"");try{this._setValue(a,c),"dijit.form.FilteringSelect"===a.declaredClass&&!1===a.isValid()&&this._setValue(a,null)}catch(aa){a.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&e.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,c);(c=c.getEditSummary(a))?(this.editorTrackingInfoDiv.innerHTML=
c,l.show(this.editorTrackingInfoDiv)):l.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(a,b,c){if(!a)return null;var d=c.domain;b&&b.domains&&b.domains[c.name]&&!1===b.domains[c.name]instanceof e&&(d=b.domains[c.name]);if(!d)return null;d.codedValues&&0<d.codedValues.length?(a.set("store",this._toStore(r.map(d.codedValues,function(a){return{id:a.code+="",name:a.name}}))),this._setValue(a,d.codedValues[0].code)):(a.constraints={min:x.isDefined(d.minValue)?d.minValue:Number.MIN_VALUE,max:x.isDefined(d.maxValue)?
d.maxValue:Number.MAX_VALUE},this._setValue(a,a.constraints.min));return d},_setValue:function(a,b){a.set&&(a._onChangeActive=!1,a.set("value",b,!0),a._onChangeActive=!0)},_getFields:function(a){var b=a._getOutFields();if(!b)return null;a=a.fields;return"*"==b?a:r.filter(r.map(b,n.hitch(this,"_findFirst",a,"name")),x.isDefined)},_isInFields:function(a,b){return a&&(b||b.length)?r.some(b,function(b){return b.toLowerCase()===a.toLowerCase()}):!1},_isFieldNullable:function(a,b){return!(!1===a.nullable||
b.field&&!1===b.field.nullable)},_isFieldRequired:function(a,b){return!1!==a.editable&&!1!==b.isEditable&&!this._isFieldNullable(a,b)},_findFirst:function(a,b,c){return(a=r.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===c}))&&a.length?a[0]:null},_getLInfoFromFeatureLayer:function(a){return this._findFirst(this._layerInfos,"layerId",a?a.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=t.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var a=t.create("tbody",null,this._attributes),b=this._currentLInfo,c=this._findFirst(b.types,"id",this._currentFeature.attributes[b.typeIdField]);r.forEach(b.fieldInfos,n.hitch(this,"_createField",c,a),this);this._createOnlyFirstTime=!1},_createField:function(a,b,c){var e=this._currentLInfo,d=c.field;if(!this._isInFields(d.name,e.hideFields)&&!this._isInFields(d.name,this._editorTrackingInfos[e.featureLayer.id])){var f=!1,h,v,g;b=t.create("tr",null,b);h=t.create("td",{innerHTML:c.label||
d.alias||d.name,"class":this.css.label,"data-fieldname":d.name},b);this._isFieldRequired(d,c)&&t.create("span",{"class":this.css.red,innerHTML:" *"},h);b=t.create("td",null,b);if(c.customField)t.place(c.customField.domNode||c.customField,t.create("div",null,b),"first"),v=c.customField;else if(!1===e.isEditable||!1===d.editable||!1===c.isEditable||"esriFieldTypeOID"===d.type||"esriFieldTypeGlobalID"===d.type||!this._canUpdate&&!this._createOnlyFirstTime)f=!0;e=e.typeIdField&&d.name.toLowerCase()==
e.typeIdField.toLowerCase();h=!!this._getDomainForField(d,a);!v&&e?v=this._createTypeField(d,c,b):!v&&h&&(v=this._createDomainField(d,c,a,b));if(!v)switch(d.type){case "esriFieldTypeString":v=this._createStringField(d,c,b);break;case "esriFieldTypeDate":v=this._createDateField(d,c,b);c.format&&c.format.time&&(g=this._createTimeField(d,c,b));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":v=this._createIntField(d,c,b);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":v=
this._createFltField(d,c,b);break;default:v=this._createStringField(d,c,b)}c.tooltip&&c.tooltip.length&&this._toolTips.push(new E({connectId:[v.id],label:c.tooltip}));v.onChange=n.hitch(this,"onFieldValueChange",c);v.set("disabled",f);g?(c.dijit=[v,g],g.onChange=n.hitch(this,"onFieldValueChange",c),g.set("disabled",f)):c.dijit=v}},_createTypeField:function(a,b,c){c=t.create("div",null,c);var e=a.domain;return e&&"range"===e.type&&e.minValue===e.maxValue?new y({"class":this.css.field,trim:!0,maxLength:a.length,
name:a.alias||a.name,required:this._isFieldRequired(a,b)},c):new H({"class":this.css.field,name:a.alias||a.name,required:this._isFieldRequired(a,b),store:this._toStore(r.map(this._currentLInfo.types,function(a){return{id:a.id,name:a.name}})),searchAttr:"name"},c)},_getDomainForField:function(a,b){var c=a.domain,d=a.name;d&&b&&b.domains&&b.domains[d]&&!1===b.domains[d]instanceof e&&(c=b.domains[d]);return c||null},_createDomainField:function(a,b,c,e){c=this._getDomainForField(a,c);e=t.create("div",
null,e);return c.codedValues?new H({"class":this.css.field,name:a.alias||a.name,searchAttr:"name",required:this._isFieldRequired(a,b)},e):new v({"class":this.css.field},e)},_createStringField:function(a,b,c){c=t.create("div",null,c);var e={trim:!0,maxLength:a.length,required:this._isFieldRequired(a,b)};if(b.stringFieldOption===N.STRING_FIELD_OPTION_TEXTAREA)return e["class"]=this.css.field+" "+this.css.textArea,new B(e,c);if(b.stringFieldOption===N.STRING_FIELD_OPTION_RICHTEXT)return e["class"]=this.css.field+
" "+this.css.richText,e.height="100%",e.width="100%",e.plugins=b.richTextPlugins||this._defaultRichTextPlugins,c=new A(e,c),c.startup(),c;var d=this;e.validator=function(c,e){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return d._isFieldNullable(a,b)||!(""===c||null===c)};return new y(e,c)},_createTimeField:function(a,b,c){c=t.create("div",null,c);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,b),constraints:{formatLength:"medium"}};this._datePackage&&(a.datePackage=this._datePackage);
return new D(a,c)},_createDateField:function(a,b,c){c=t.create("div",null,c);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,b)};this._datePackage&&(a.datePackage=this._datePackage);return new L(a,c)},_createIntField:function(a,b,c){c=t.create("div",null,c);var e=/\de[-+]?\d/i,d=/^[-+]?\d+$/,f=this;return new y({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===a.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(a,
b),validator:function(c,h){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return""!==c&&null!==c||!f._isFieldNullable(a,b)?e.test(c)?!0:d.test(c)?("min"in h?0<=this.compare(c,h.min):1)&&("max"in h?0>=this.compare(c,h.max):1)?!0:!1:!1:!0}},c)},_createFltField:function(a,b,c){c=t.create("div",null,c);var e=/\de[-+]?\d/i,d=/[0-9]\d{0,2}(\.\d{3})*(,\d+)?$/i,f=this;return new y({"class":this.css.field,constraints:{places:"0,40",min:-Infinity,max:Infinity,exponent:!0},trim:!0,invalidMessage:this.NLS_validationFlt,
required:this._isFieldRequired(a,b),validator:function(c,h){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return""!==c&&null!==c||!f._isFieldNullable(a,b)?e.test(c)?!0:d.test(c)?("min"in h?0<=this.compare(c,h.min):1)&&("max"in h?0>=this.compare(c,h.max):1)?!0:!1:!1:!0}},c)},_toStore:function(a){return new V({data:{identifier:"id",label:"name",items:a}})},_connect:function(a,b,c){this._aiConnects.push(u.connect(a,b,c))},_getDatePackage:function(a){return null===a.datePackage?null:a.datePackage?
a.datePackage:"ar"===g.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){r.forEach(this._layerInfos,function(a){r.forEach(a.fieldInfos,function(a){var b=a.dijit;if(b){b._onChangeHandle=null;if(a.customField)return;b instanceof Array?r.forEach(b,n.hitch(this,function(a){a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy();a._onChangeHandle=null})):b.destroyRecursive?b.destroyRecursive():b.destroy&&b.destroy()}a.dijit=null},this)},this);r.forEach(this._toolTips,function(a){a.destroy()});
this._toolTips=[];this._attributes&&t.destroy(this._attributes)}});n.mixin(N,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});d("extend-esri")&&n.setObject("dijit.AttributeInspector",N,k);return N})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T){function G(a){return new A({command:a.name})}function L(a){return new A({buttonClass:w,command:a.name})}r=r("dijit.Editor",K,{plugins:null,extraPlugins:null,constructor:function(){x.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",I]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(l("ie")||l("trident")||l("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new u;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);x.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=m.getLocalization("dijit._editor",
"commands",this.lang);l("webkit")&&t.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new h({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));n.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);d.add(this.iframe.parentNode,"dijitEditorIFrameContainer");d.add(this.iframe,"dijitEditorIFrame");g.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){n.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(b,c){var e=x.isString(b)?{name:b}:x.isFunction(b)?{ctor:b}:b;if(!e.setEditor){var d={args:e,plugin:null,editor:this};e.name&&(A.registry[e.name]?d.plugin=A.registry[e.name](e):a.publish(T._scopeName+".Editor.getPlugin",d));if(!d.plugin)try{var f=
e.ctor||x.getObject(e.name)||q(e.name);f&&(d.plugin=new f(e))}catch(B){throw Error(this.id+": cannot find plugin ["+e.name+"]");}if(!d.plugin)throw Error(this.id+": cannot find plugin ["+e.name+"]");b=d.plugin}1<arguments.length?this._plugins[c]=b:this._plugins.push(b);b.setEditor(this);x.isFunction(b.setToolbar)&&b.setToolbar(this.toolbar)},resize:function(a){a&&z.prototype.resize.apply(this,arguments)},layout:function(){var a=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+b.getPadBorderExtents(this.iframe.parentNode).h+
b.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=a+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(a){var b,c=this.document.body,e=c.clientWidth,d=c.clientHeight,f=c.clientLeft,h=c.offsetWidth,g=c.offsetHeight,k=c.offsetLeft;/^rtl$/i.test(c.dir||"")?e<h&&a.x>e&&a.x<h&&(b=!0):a.x<f&&a.x>k&&(b=!0);b||d<g&&a.y>d&&a.y<g&&(b=!0);b||(delete this._cursorToStart,delete this._savedSelection,"BODY"==a.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0);"BODY"!=a.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(a){this._inEditing||(this._inEditing=!0,this._beginEditing(a));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(a){if(!this.customUndo||
"undo"!=a&&"redo"!=a){this.customUndo&&(this.endEditing(),this._beginEditing());var b=this.inherited(arguments);this.customUndo&&this._endEditing();return b}return this[a]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(a){var b;try{if(b=this.document.execCommand(a,!1,null),l("webkit")&&!b)throw{};}catch(H){b=e.substitute,alert(b(this.commands.systemShortcut,
[this.commands[a],b(this.commands[l("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[a]])])),b=!1}return b},queryCommandEnabled:function(a){return!this.customUndo||"undo"!=a&&"redo"!=a?this.inherited(arguments):"undo"==a?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(a){var b=a.mark,c=a.mark;a=a.isCollapsed;var e,d,f;c&&(9>l("ie")||9===l("ie")&&l("quirks")?x.isArray(c)?(b=[],n.forEach(c,function(a){b.push(C.getNode(a,this.editNode))},this),this.selection.moveToBookmark({mark:b,
isCollapsed:a})):c.startContainer&&c.endContainer&&(f=C.getSelection(this.window))&&f.removeAllRanges&&(f.removeAllRanges(),a=C.create(this.window),e=C.getNode(c.startContainer,this.editNode),d=C.getNode(c.endContainer,this.editNode),e&&d&&(a.setStart(e,c.startOffset),a.setEnd(d,c.endOffset),f.addRange(a))):(f=C.getSelection(this.window))&&f.removeAllRanges&&(f.removeAllRanges(),a=C.create(this.window),e=C.getNode(c.startContainer,this.editNode),d=C.getNode(c.endContainer,this.editNode),e&&d&&(a.setStart(e,
c.startOffset),a.setEnd(d,c.endOffset),f.addRange(a))))},_changeToStep:function(a,b){this.setValue(b.text);var c=b.bookmark;c&&this._moveToBookmark(c)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._steps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0);delete this._undoRedoActive}return a},redo:function(){var a=
!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._undoedSteps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0);delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var a=this.selection.getBookmark(),b=[];if(a&&a.mark){var c=
a.mark;if(9>l("ie")||9===l("ie")&&l("quirks")){var e=C.getSelection(this.window);if(x.isArray(c))n.forEach(a.mark,function(a){b.push(C.getIndex(a,this.editNode).o)},this),a.mark=b;else if(e){var d;e.rangeCount&&(d=e.getRangeAt(0));a.mark=d?d.cloneRange():this.selection.getBookmark()}}try{a.mark&&a.mark.startContainer&&(b=C.getIndex(a.mark.startContainer,this.editNode).o,a.mark={startContainer:b,startOffset:a.mark.startOffset,endContainer:a.mark.endContainer===a.mark.startContainer?b:C.getIndex(a.mark.endContainer,
this.editNode).o,endOffset:a.mark.endOffset})}catch(B){a.mark=null}}return a},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:F.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var a=F.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:a,bookmark:this._getBookmark()})},onKeyDown:function(a){l("ie")||this.iframe||a.keyCode!=k.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var b=a.keyCode;if(a.ctrlKey&&
!a.shiftKey&&!a.altKey){if(90==b||122==b){a.stopPropagation();a.preventDefault();this.undo();return}if(89==b||121==b){a.stopPropagation();a.preventDefault();this.redo();return}}this.inherited(arguments);switch(b){case k.ENTER:case k.BACKSPACE:case k.DELETE:this.beginEditing();break;case 88:case 86:if(a.ctrlKey&&!a.altKey&&!a.metaKey){this.endEditing();88==a.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!a.ctrlKey&&!a.altKey&&!a.metaKey&&(a.keyCode<
k.F1||a.keyCode>k.F15)){this.beginEditing();break}case k.ALT:this.endEditing();break;case k.UP_ARROW:case k.DOWN_ARROW:case k.LEFT_ARROW:case k.RIGHT_ARROW:case k.HOME:case k.END:case k.PAGE_UP:case k.PAGE_DOWN:this.endEditing(!0);case k.CTRL:case k.SHIFT:case k.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(W){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="\x26#160;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(a){this.setValueDeferred.then(x.hitch(this,function(){!this.disabled&&a||!this._buttonEnabledPlugins&&a?
n.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!a&&n.forEach(this._plugins,function(a){a.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&t.set(this.document.body,"color",t.get(this.iframe,"color"))}catch(W){}}});x.mixin(A.registry,{undo:G,redo:G,cut:G,copy:G,paste:G,insertOrderedList:G,insertUnorderedList:G,indent:G,outdent:G,justifyCenter:G,justifyFull:G,justifyLeft:G,justifyRight:G,
"delete":G,selectAll:G,removeFormat:G,unlink:G,insertHorizontalRule:G,bold:L,italic:L,underline:L,strikethrough:L,subscript:L,superscript:L,"|":function(){return new A({setEditor:function(a){this.editor=a;this.button=new f({ownerDocument:a.ownerDocument})}})}});return r})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(q,n,r,u,m,g,d,b){r("dijit-legacy-requires")&&m(0,function(){q(["dijit/ToolbarSeparator"])});
return n("dijit.Toolbar",[g,b,d],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],function(q,n,r,u){return q("dijit.ToolbarSeparator",[r,u],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',
buildRendering:function(){this.inherited(arguments);n.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(q,n,r,u,m){n=n("dijit._editor._Plugin",u,{constructor:function(g){this.params=g||{};r.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:m,
disabled:!1,getLabel:function(g){return this.editor.commands[g]},_initButton:function(){if(this.command.length){var g=this.getLabel(this.command),d=this.editor,b=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(g=r.mixin({label:g,ownerDocument:d.ownerDocument,dir:d.dir,lang:d.lang,showLabel:!1,iconClass:b,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete g.name,this.button=new this.buttonClass(g))}this.get("disabled")&&
this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(g,d,b){this.own(q.connect(g,d,this,b))},updateState:function(){var g=this.editor,d=this.command,b,t;if(g&&g.isLoaded&&d.length){var k=this.get("disabled");if(this.button)try{t=!k&&g.queryCommandEnabled(d),this.enabled!==t&&(this.enabled=t,this.button.set("disabled",!t)),t&&"boolean"==typeof this.button.checked&&(b=g.queryCommandState(d),
this.checked!==b&&(this.checked=b,this.button.set("checked",g.queryCommandState(d))))}catch(x){console.log(x)}}},setEditor:function(g){this.editor=g;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",r.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",r.hitch(this,"updateState")))},setToolbar:function(g){this.button&&
g.addChild(this.button)},set:function(g,d){if("object"===typeof g){for(var b in g)this.set(b,g[b]);return this}b=this._getAttrNames(g);if(this[b.s])var t=this[b.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(g,d);return t||this},get:function(g){var d=this._getAttrNames(g);return this[d.g]?this[d.g]():this[g]},_setDisabledAttr:function(g){this._set("disabled",g);this.updateState()},_getAttrNames:function(g){var d=this._attrPairNames;if(d[g])return d[g];var b=g.charAt(0).toUpperCase()+
g.substr(1);return d[g]={s:"_set"+b+"Attr",g:"_get"+b+"Attr"}},_set:function(g,d){this[g]=d}});n.registry={};return n})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(q,n,r,u,m,g,d,b,t,k,x){return q("dijit._editor.plugins.EnterKeyHandling",t,{blockNodeForEnter:"BR",constructor:function(b){b&&("blockNodeForEnter"in b&&(b.blockNodeForEnter=
b.blockNodeForEnter.toUpperCase()),u.mixin(this,b))},setEditor:function(b){if(this.editor!==b)if(this.editor=b,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,b.onLoadDeferred.then(u.hitch(this,function(a){this.own(m(b.document,"keydown",u.hitch(this,function(a){if(a.keyCode==r.ENTER){var b=u.mixin({},a);b.shiftKey=!0;this.handleEnterKey(b)||(a.stopPropagation(),a.preventDefault())}})));9<=g("ie")&&10>=g("ie")&&this.own(m(b.document,"paste",u.hitch(this,function(a){setTimeout(u.hitch(this,
function(){var a=this.editor.document.selection.createRange();a.move("character",-1);a.select();a.move("character",1);a.select()}),0)})));return a}));else if(this.blockNodeForEnter){var e=u.hitch(this,"handleEnterKey");b.addKeyHandler(13,0,0,e);b.addKeyHandler(13,0,1,e);this.own(this.editor.on("KeyPressed",u.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var b=this.editor.selection.getAncestorElement("LI");if(b){g("mozilla")&&
"LI"==b.parentNode.parentNode.nodeName&&(b=b.parentNode.parentNode);var e=b.firstChild;!e||1!=e.nodeType||"UL"!=e.nodeName&&"OL"!=e.nodeName||(b.insertBefore(e.ownerDocument.createTextNode("\u00a0"),e),e=x.create(this.editor.window),e.setStart(b.firstChild,0),b=x.getSelection(this.editor.window,!0),b.removeAllRanges(),b.addRange(e))}else k.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(b=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(b.innerHTML=
this.bogusHtmlContent,9>=g("ie")&&(b=this.editor.document.selection.createRange(),b.move("character",-1),b.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(d){var e,a,c,h,f=this.editor.document,
l,t,m;if(d.shiftKey){d=this.editor.selection.getParentElement();if(h=x.getAncestor(d,this.blockNodes)){if("LI"==h.tagName)return!0;d=x.getSelection(this.editor.window);e=d.getRangeAt(0);e.collapsed||(e.deleteContents(),d=x.getSelection(this.editor.window),e=d.getRangeAt(0));if(x.atBeginningOfContainer(h,e.startContainer,e.startOffset))l=f.createElement("br"),e=x.create(this.editor.window),h.insertBefore(l,h.firstChild),e.setStartAfter(l),d.removeAllRanges(),d.addRange(e);else if(x.atEndOfContainer(h,
e.startContainer,e.startOffset))e=x.create(this.editor.window),l=f.createElement("br"),h.appendChild(l),h.appendChild(f.createTextNode("\u00a0")),e.setStart(h.lastChild,0),d.removeAllRanges(),d.addRange(e);else return(t=e.startContainer)&&3==t.nodeType?(m=t.nodeValue,a=f.createTextNode(m.substring(0,e.startOffset)),c=f.createTextNode(m.substring(e.startOffset)),h=f.createElement("br"),""==c.nodeValue&&g("webkit")&&(c=f.createTextNode("\u00a0")),n.place(a,t,"after"),n.place(h,a,"after"),n.place(c,
h,"after"),n.destroy(t),e=x.create(this.editor.window),e.setStart(c,0),d.removeAllRanges(),d.addRange(e),!1):!0}else d=x.getSelection(this.editor.window),d.rangeCount?(e=d.getRangeAt(0))&&e.startContainer&&(e.collapsed||(e.deleteContents(),d=x.getSelection(this.editor.window),e=d.getRangeAt(0)),(t=e.startContainer)&&3==t.nodeType?(h=e.startOffset,t.length<h&&(c=this._adjustNodeAndOffset(t,h),t=c.node,h=c.offset),m=t.nodeValue,a=f.createTextNode(m.substring(0,h)),c=f.createTextNode(m.substring(h)),
h=f.createElement("br"),c.length||(c=f.createTextNode("\u00a0")),a.length?n.place(a,t,"after"):a=t,n.place(h,a,"after"),n.place(c,h,"after"),n.destroy(t)):(0<=e.startOffset&&(l=t.childNodes[e.startOffset]),h=f.createElement("br"),c=f.createTextNode("\u00a0"),l?(n.place(h,l,"before"),n.place(c,h,"after")):(t.appendChild(h),t.appendChild(c))),e=x.create(this.editor.window),e.setStart(c,0),e.setEnd(c,c.length),d.removeAllRanges(),d.addRange(e),this.editor.selection.collapse(!0)):k.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var r=!0;d=x.getSelection(this.editor.window);e=d.getRangeAt(0);e.collapsed||(e.deleteContents(),d=x.getSelection(this.editor.window),e=d.getRangeAt(0));l=x.getBlockAncestor(e.endContainer,null,this.editor.editNode);var q=l.blockNode;if(this._checkListLater=q&&("LI"==q.nodeName||"LI"==q.parentNode.nodeName))return g("mozilla")&&(this._pressedEnterInBlock=q),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(q.innerHTML)&&
(q.innerHTML="",g("webkit")&&(e=x.create(this.editor.window),e.setStart(q,0),d.removeAllRanges(),d.addRange(e)),this._checkListLater=!1),!0;if(!l.blockNode||l.blockNode===this.editor.editNode){try{k.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(C){}l={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(l.blockNode){if(l.blockNode!=this.editor.editNode&&!(l.blockNode.textContent||l.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(l.blockNode),!1}else l.blockNode=this.editor.editNode;d=x.getSelection(this.editor.window);e=d.getRangeAt(0)}q=f.createElement(this.blockNodeForEnter);q.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(l.blockNode);c=e.endOffset;r=e.endContainer;r.length<c&&(c=this._adjustNodeAndOffset(r,c),r=c.node,c=c.offset);if(x.atEndOfContainer(l.blockNode,r,c))l.blockNode===l.blockContainer?l.blockNode.appendChild(q):n.place(q,l.blockNode,"after"),r=!1,e=x.create(this.editor.window),
e.setStart(q,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&b.scrollIntoView(q);else if(x.atBeginningOfContainer(l.blockNode,e.startContainer,e.startOffset))n.place(q,l.blockNode,l.blockNode===l.blockContainer?"first":"before"),q.nextSibling&&this.editor.height&&(e=x.create(this.editor.window),e.setStart(q.nextSibling,0),d.removeAllRanges(),d.addRange(e),b.scrollIntoView(q.nextSibling)),r=!1;else{l.blockNode===l.blockContainer?l.blockNode.appendChild(q):n.place(q,l.blockNode,"after");r=
!1;l.blockNode.style&&q.style&&l.blockNode.style.cssText&&(q.style.cssText=l.blockNode.style.cssText);if((t=e.startContainer)&&3==t.nodeType){c=e.endOffset;t.length<c&&(c=this._adjustNodeAndOffset(t,c),t=c.node,c=c.offset);m=t.nodeValue;a=f.createTextNode(m.substring(0,c));c=f.createTextNode(m.substring(c,m.length));n.place(a,t,"before");n.place(c,t,"after");n.destroy(t);for(e=a.parentNode;e!==l.blockNode;){m=f.createElement(e.tagName);e.style&&m.style&&e.style.cssText&&(m.style.cssText=e.style.cssText);
"FONT"===e.tagName&&(e.color&&(m.color=e.color),e.face&&(m.face=e.face),e.size&&(m.size=e.size));for(;c;)t=c.nextSibling,m.appendChild(c),c=t;n.place(m,e,"after");a=e;c=m;e=e.parentNode}if(1==c.nodeType||3==c.nodeType&&c.nodeValue)q.innerHTML="";for(a=c;c;)t=c.nextSibling,q.appendChild(c),c=t}e=x.create(this.editor.window);f=a;if("BR"!==this.blockNodeForEnter){for(;f;)h=f,f=t=f.firstChild;h&&h.parentNode?(q=h.parentNode,e.setStart(q,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&b.scrollIntoView(q),
g("mozilla")&&(this._pressedEnterInBlock=l.blockNode)):r=!0}else e.setStart(q,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&b.scrollIntoView(q),g("mozilla")&&(this._pressedEnterInBlock=l.blockNode)}return r},_adjustNodeAndOffset:function(b,e){for(;b.length<e&&b.nextSibling&&3==b.nextSibling.nodeType;)e-=b.length,b=b.nextSibling;return{node:b,offset:e}},removeTrailingBr:function(b){if(b=/P|DIV|LI/i.test(b.tagName)?b:this.editor.selection.getParentOfType(b,["P","DIV","LI"]))b.lastChild&&
(1<b.childNodes.length&&3==b.lastChild.nodeType&&/^[\s\xAD]*$/.test(b.lastChild.nodeValue)||"BR"==b.lastChild.tagName)&&n.destroy(b.lastChild),b.childNodes.length||(b.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T,G,L,W,Q){var H=r("dijit._editor.RichText",[C,K],{constructor:function(a){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};a&&e.isString(a.value)&&(this.value=a.value);this.onLoadDeferred=new u},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[e.trim,e.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);f("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));f("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(f("ie")||f("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[e.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[e.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);w.publish(Q._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var a=e.hitch(this,function(a,b){return function(){return!this.execCommand(a,b)}}),b={b:a("bold"),i:a("italic"),u:a("underline"),a:a("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:a("formatblock",
"h1"),2:a("formatblock","h2"),3:a("formatblock","h3"),4:a("formatblock","h4"),"\\":a("insertunorderedlist")};f("ie")||(b.Z=a("redo"));for(var c in b)this.addKeyHandler(c,!0,!1,b[c])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(H._editorCommandsLocalized)this._local2NativeFormatNames=H._local2NativeFormatNames,this._native2LocalFormatNames=H._native2LocalFormatNames;else{H._editorCommandsLocalized=!0;H._local2NativeFormatNames={};
H._native2LocalFormatNames={};this._local2NativeFormatNames=H._local2NativeFormatNames;this._native2LocalFormatNames=H._native2LocalFormatNames;for(var a="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),c="",d,f=0;d=a[f++];)c="l"!==d.charAt(1)?c+("\x3c"+d+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+d+"\x3e\x3cbr/\x3e"):c+("\x3c"+d+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+d+"\x3e\x3cbr/\x3e");var h=b.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:c});this.ownerDocumentBody.appendChild(h);
a=e.hitch(this,function(){for(var a=h.firstChild;a;)try{this.selection.selectElement(a.firstChild);var c=a.tagName.toLowerCase();this._local2NativeFormatNames[c]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[c]]=c;a=a.nextSibling.nextSibling}catch(O){}b.destroy(h)});this.defer(a)}},open:function(c){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new u;this.isClosed||this.close();w.publish(Q._scopeName+"._editor.RichText::open",
this);1===arguments.length&&c.nodeName&&(this.domNode=c);var h=this.domNode,v;if(e.isString(this.value))v=this.value,h.innerHTML="";else if(h.nodeName&&"textarea"==h.nodeName.toLowerCase()){var l=this.textarea=h;this.name=l.name;v=l.value;h=this.domNode=this.ownerDocument.createElement("div");h.setAttribute("widgetId",this.id);l.removeAttribute("widgetId");h.cssText=l.cssText;h.className+=" "+l.className;b.place(h,l,"before");var t=e.hitch(this,function(){k.set(l,{display:"block",position:"absolute",
top:"-1000px"});if(f("ie")){var a=l.style;this.__overflow=a.overflow;a.overflow="hidden"}});f("ie")?this.defer(t,10):t();if(l.form){var z=l.value;this.reset=function(){this.getValue()!==z&&this.replaceValue(z)};a(l.form,"submit",e.hitch(this,function(){g.set(l,"disabled",this.disabled);l.value=this.getValue()}))}}else v=L.getChildrenHtml(h),h.innerHTML="";this.value=v;h.nodeName&&"LI"===h.nodeName&&(h.innerHTML=" \x3cbr\x3e");this.header=h.ownerDocument.createElement("div");h.appendChild(this.header);
this.editingArea=h.ownerDocument.createElement("div");h.appendChild(this.editingArea);this.footer=h.ownerDocument.createElement("div");h.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!n.useXDomain||n.allowXdRichTextSave)){if((v=m.byId(Q._scopeName+"._editor.RichText.value"))&&""!==v.value)for(var t=v.value.split(this._SEPARATOR),q=0,r;r=t[q++];)if(r=r.split(this._NAME_CONTENT_SEP),r[0]===this.name){this.value=r[1];t=t.splice(q,1);v.value=t.join(this._SEPARATOR);
break}H._globalSaveHandler||(H._globalSaveHandler={},A.addOnUnload(function(){for(var a in H._globalSaveHandler){var b=H._globalSaveHandler[a];e.isFunction(b)&&b()}}));H._globalSaveHandler[this.id]=e.hitch(this,"_saveContent")}this.isClosed=!1;v=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");v.id=this.id+"_iframe";v.style.border="none";v.style.width="100%";this._layoutMode?v.style.height="100%":7<=f("ie")?(this.height&&(v.style.height=this.height),this.minHeight&&(v.style.minHeight=
this.minHeight)):v.style.height=this.height?this.height:this.minHeight;v.frameBorder=0;v._loadFunc=e.hitch(this,function(a){this.window=a;this.document=a.document;this.selection=new T.SelectionManager(a);f("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});t=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");t=11>f("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+t+"');document.close()":"javascript: '"+
t+"'";this.editingArea.appendChild(v);v.src=t;"LI"===h.nodeName&&(h.lastChild.style.marginTop="-1.2em");d.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var a=k.getComputedStyle(this.domNode),b;if(this["aria-label"])b=this["aria-label"];else{var d=c('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||m.byId(this["aria-labelledby"],this.ownerDocument);d&&(b=d.textContent||d.innerHTML||"")}var d="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(b?" aria-label\x3d'"+z.escape(b)+"'":"")+"\x3e\x3c/div\x3e",h=[a.fontWeight,a.fontSize,a.fontFamily].join(" "),g=a.lineHeight,g=0<=g.indexOf("px")?parseFloat(g)/parseFloat(a.fontSize):0<=g.indexOf("em")?parseFloat(g):"normal",l="",t=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(a){a=a.replace(/^;/ig,"")+";";var b=a.split(":")[0];if(b){var b=e.trim(b),b=b.toLowerCase(),c,d="";for(c=0;c<b.length;c++){var f=b.charAt(c);switch(f){case "-":c++,f=b.charAt(c).toUpperCase();default:d+=
f}}k.set(t.domNode,d,"")}l+=a+";"});this.iframe.setAttribute("title",b);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||x.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",b?"\x3ctitle\x3e"+z.escape(b)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",h,";\n",this.height||f("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",g,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",f("ie")||f("trident")||f("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",b?" aria-label\x3d'"+z.escape(b)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+l+"'\x3e",d,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var b="",c=0,e,d=F.get(this.ownerDocument);e=a[c++];)e=(new I(d.location,e)).toString(),this.editingAreaStyleSheets.push(e),b+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+e+'"/\x3e';return b},addStyleSheet:function(a){var b=a.toString(),c=F.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new I(c.location,b)).toString();-1<q.indexOf(this.editingAreaStyleSheets,b)||(this.editingAreaStyleSheets.push(b),
this.onLoadDeferred.then(e.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(b);else{var a=this.document.getElementsByTagName("head")[0],c=this.document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=b;a.appendChild(c)}})))},removeStyleSheet:function(a){var b=a.toString(),e=F.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new I(e.location,b)).toString();a=q.indexOf(this.editingAreaStyleSheets,b);-1!==a&&(delete this.editingAreaStyleSheets[a],
c('link[href\x3d"'+b+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(a){a=!!a;this._set("disabled",a);if(this.isLoaded){var b=f("ie")&&(this.isLoaded||!this.focusOnLoad);b&&(this.editNode.unselectable="on");this.editNode.contentEditable=!a;this.editNode.tabIndex=a?"-1":this.tabIndex;b&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(f("mozilla")&&!a&&this._mozSettingProps){a=this._mozSettingProps;for(var c in a)if(a.hasOwnProperty(c))try{this.document.execCommand(c,
!1,a[c])}catch(y){}}this._disabledOK=!0}},onLoad:function(c){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=W.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var d=this;this.beforeIframeNode=b.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=b.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){d.editNode.focus()};this.focusNode=
this.editNode;var v=this.events.concat(this.captureEvents),g=this.iframe?this.document:this.editNode;this.own.apply(this,q.map(v,function(b){var c=b.toLowerCase().replace(/^on/,"");return a(g,c,e.hitch(this,b))},this));this.own(a(g,"mouseup",e.hitch(this,"onClick")));f("ie")&&(this.own(a(this.document,"mousedown",e.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);f("webkit")&&(this._webkitListener=this.own(a(this.document,"mouseup",e.hitch(this,"onDisplayChanged")))[0],this.own(a(this.document,
"mousedown",e.hitch(this,function(a){a=a.target;!a||a!==this.document.body&&a!==this.document||this.defer("placeCursorAtEnd")}))));if(f("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(D){}this.isLoaded=!0;this.set("disabled",this.disabled);v=e.hitch(this,function(){this.setValue(c);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&h(e.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(v):v()},onKeyDown:function(a){if(a.keyCode===l.SHIFT||a.keyCode===l.ALT||a.keyCode===l.META||a.keyCode===l.CTRL)return!0;a.keyCode===l.TAB&&this.isTabIndent&&(a.stopPropagation(),a.preventDefault(),this.queryCommandEnabled(a.shiftKey?"outdent":"indent")&&this.execCommand(a.shiftKey?"outdent":"indent"));if(a.keyCode==l.TAB&&!this.isTabIndent&&!a.ctrlKey&&!a.altKey)return a.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>f("ie")&&a.keyCode===l.BACKSPACE&&"Control"===this.document.selection.type&&(a.stopPropagation(),a.preventDefault(),this.execCommand("delete"));f("ff")&&(a.keyCode===l.PAGE_UP||a.keyCode===l.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&a.preventDefault();var b=this._keyHandlers[a.keyCode],c=arguments;b&&!a.altKey&&q.some(b,function(b){if(!(b.shift^a.shiftKey||b.ctrl^(a.ctrlKey||a.metaKey)))return b.handler.apply(this,c)||a.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){x.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(a){this.document?g.set(this.document.body,"spellcheck",!a):this.onLoadDeferred.then(e.hitch(this,function(){g.set(this.document.body,"spellcheck",!a)}));this._set("disableSpellCheck",a)},addKeyHandler:function(a,b,c,d){"string"==
typeof a&&(a=a.toUpperCase().charCodeAt(0));e.isArray(this._keyHandlers[a])||(this._keyHandlers[a]=[]);this._keyHandlers[a].push({shift:c||!1,ctrl:b||!1,handler:d})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(a){(f("ie")||f("trident"))&&this.defer(function(){W.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var b=this.getValue(!0);if(b!==this.value)this.onChange(b);
this._set("value",b)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!f("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>f("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(a,b){var c=a.toLowerCase();"formatblock"===c?f("safari")&&void 0===b&&(c="heading"):"hilitecolor"!==c||f("mozilla")||(c="backcolor");return c},_qcaCache:{},queryCommandAvailable:function(a){var b=this._qcaCache[a];return void 0!==
b?b:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(a){switch(a.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return f("ie")||f("trident")||f("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!f("webkit");default:return!1}},execCommand:function(a,b){var c;this.focused&&this.focus();a=this._normalizeCommand(a,b);if(void 0!==b){if("heading"===a)throw Error("unimplemented");"formatblock"===
a&&(f("ie")||f("trident"))&&(b="\x3c"+b+"\x3e")}var e="_"+a+"Impl";if(this[e])c=this[e](b);else if((b=1<arguments.length?b:null)||"createlink"!==a)c=this.document.execCommand(a,!1,b);this.onDisplayChanged();return c},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var b="_"+a+"EnabledImpl";return this[b]?this[b](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(J){return!1}},queryCommandValue:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);if(f("ie")&&"formatblock"===a)a=this._native2LocalFormatNames[this.document.queryCommandValue(a)];else if(f("mozilla")&&"hilitecolor"===a){var b;try{b=this.document.queryCommandValue("styleWithCSS")}catch(B){b=!1}this.document.execCommand("styleWithCSS",!1,!0);a=this.document.queryCommandValue(a);this.document.execCommand("styleWithCSS",
!1,b)}else a=this.document.queryCommandValue(a);return a},_sCall:function(a,b){return this.selection[a].apply(this.selection,b)},placeCursorAtStart:function(){this.focus();var a=!1;if(f("mozilla"))for(var b=this.editNode.firstChild;b;){if(3===b.nodeType){if(0<b.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(b);break}}else if(1===b.nodeType){var a=!0,c=b.tagName?b.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(c)?this.selection.selectElement(b):
this.selection.selectElementChildren(b);break}b=b.nextSibling}else a=!0,this.selection.selectElementChildren(this.editNode);a&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var a=!1;if(f("mozilla"))for(var b=this.editNode.lastChild;b;){if(3===b.nodeType){if(0<b.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(b);break}}else if(1===b.nodeType){a=!0;this.selection.selectElement(b.lastChild||b);break}b=b.previousSibling}else a=!0,this.selection.selectElementChildren(this.editNode);
a&&this.selection.collapse(!1)},getValue:function(a){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,a):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(a){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){a=this._preFilterContent(a);var b=this.isClosed?this.domNode:this.editNode;b.innerHTML=a;this._preDomFilterContent(b)}else this.textarea.value=a;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(e.hitch(this,function(){this.setValue(a)}))},replaceValue:function(a){this.isClosed?this.setValue(a):this.window&&this.window.getSelection&&!f("mozilla")?this.setValue(a):this.window&&this.window.getSelection?(a=this._preFilterContent(a),this.execCommand("selectall"),this.execCommand("inserthtml",a),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(a);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var b=
a;q.forEach(this.contentPreFilters,function(a){a&&(b=a(b))});return b},_preDomFilterContent:function(a){a=a||this.editNode;q.forEach(this.contentDomPreFilters,function(b){b&&e.isFunction(b)&&b(a)},this)},_postFilterContent:function(a,b){var c;e.isString(a)?c=a:(a=a||this.editNode,this.contentDomPostFilters.length&&(b&&(a=e.clone(a)),q.forEach(this.contentDomPostFilters,function(b){a=b(a)})),c=L.getChildrenHtml(a));e.trim(c.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(c="");q.forEach(this.contentPostFilters,
function(a){c=a(c)});return c},_saveContent:function(){var a=m.byId(Q._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,b){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");b||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){x.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return L.getNodeHtml(a)},getNodeChildrenHtml:function(a){x.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return L.getChildrenHtml(a)},close:function(a){if(!this.isClosed){arguments.length||(a=!0);a&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);f("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var c=this.textarea.style;c.position="";c.left=c.top="";f("ie")&&(c.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;b.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;d.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);H._globalSaveHandler&&delete H._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ \>])/gi,"\x3c$1b$2").replace(/<(\/)?em([ \>])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(a){if(!a)return!1;
if(f("ie")||f("trident")||f("edge"))return this.focused&&!this.disabled;var b=9>f("ie")?this.document.selection.createRange():this.document;try{return b.queryCommandEnabled(a)}catch(B){return!1}},_createlinkEnabledImpl:function(){var a=!0;return a=f("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var a=!0;return a=f("mozilla")||f("webkit")||f("ie")||f("trident")||f("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var a=!0;return a=f("mozilla")||f("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var a=!0;f("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("cut");return a},_copyEnabledImpl:function(){var a=!0;f("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("copy");
return a},_pasteEnabledImpl:function(){var a=!0;return f("webkit")?!0:a=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(a){return f("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,a)},_unlinkImpl:function(a){return this.queryCommandEnabled("unlink")&&(f("mozilla")||f("webkit"))?(a=this.selection.getAncestorElement("a"),this.selection.selectElement(a),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,a)},_hilitecolorImpl:function(a){var b;this._handleTextColorOrProperties("hilitecolor",a)||(f("mozilla")?(this.document.execCommand("styleWithCSS",!1,!0),console.log("Executing color command."),b=this.document.execCommand("hilitecolor",!1,a),this.document.execCommand("styleWithCSS",!1,!1)):b=this.document.execCommand("hilitecolor",!1,a));return b},_backcolorImpl:function(a){f("ie")&&(a=a?a:null);var b=this._handleTextColorOrProperties("backcolor",a);b||(b=this.document.execCommand("backcolor",
!1,a));return b},_forecolorImpl:function(a){f("ie")&&(a=a?a:null);var b=!1;(b=this._handleTextColorOrProperties("forecolor",a))||(b=this.document.execCommand("forecolor",!1,a));return b},_inserthtmlImpl:function(a){a=this._preFilterContent(a);var c=!0;if(9>f("ie")){var e=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var d=e.item(0);e.length;)e.remove(e.item(0));d.outerHTML=a}else e.pasteHTML(a);e.select()}else if(8>f("trident")){var h=G.getSelection(this.window);
if(h&&h.rangeCount&&h.getRangeAt){e=h.getRangeAt(0);e.deleteContents();var g=b.create("div");g.innerHTML=a;for(var k,d=this.document.createDocumentFragment();a=g.firstChild;)k=d.appendChild(a);e.insertNode(d);k&&(e=e.cloneRange(),e.setStartAfter(k),e.collapse(!1),h.removeAllRanges(),h.addRange(e))}}else f("mozilla")&&!a.length?this.selection.remove():c=this.document.execCommand("inserthtml",!1,a);return c},_boldImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("bold");
b||(b=this.document.execCommand("bold",!1,a));return b},_italicImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("italic");b||(b=this.document.execCommand("italic",!1,a));return b},_underlineImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("underline");b||(b=this.document.execCommand("underline",!1,a));return b},_strikethroughImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),
b=this._adaptIEFormatAreaAndExec("strikethrough");b||(b=this.document.execCommand("strikethrough",!1,a));return b},_superscriptImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("superscript");b||(b=this.document.execCommand("superscript",!1,a));return b},_subscriptImpl:function(a){var b=!1;if(f("ie")||f("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("subscript");b||(b=this.document.execCommand("subscript",!1,a));return b},
_fontnameImpl:function(a){var b;if(f("ie")||f("trident"))b=this._handleTextColorOrProperties("fontname",a);b||(b=this.document.execCommand("fontname",!1,a));return b},_fontsizeImpl:function(a){var b;if(f("ie")||f("trident"))b=this._handleTextColorOrProperties("fontsize",a);b||(b=this.document.execCommand("fontsize",!1,a));return b},_insertorderedlistImpl:function(a){var b=!1;if(f("ie")||f("trident")||f("edge"))b=this._adaptIEList("insertorderedlist",a);b||(b=this.document.execCommand("insertorderedlist",
!1,a));return b},_insertunorderedlistImpl:function(a){var b=!1;if(f("ie")||f("trident")||f("edge"))b=this._adaptIEList("insertunorderedlist",a);b||(b=this.document.execCommand("insertunorderedlist",!1,a));return b},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var b=0;if(a&&a.childNodes){var c;for(c=0;c<a.childNodes.length;c++)var e=t.position(a.childNodes[c]),
b=b+e.h}return b},_isNodeEmpty:function(a,b){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],b):!0:3===a.nodeType?""===a.nodeValue.substring(b):!1},_removeStartingRangeFromRange:function(a,b){if(a.nextSibling)b.setStart(a.nextSibling,0);else{for(var c=a.parentNode;c&&null==c.nextSibling;)c=c.parentNode;c&&b.setStart(c.nextSibling,0)}return b},_adaptIESelection:function(){var a=G.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var b=a.getRangeAt(0),c=
b.startContainer,e=b.startOffset;3===c.nodeType&&e>=c.length&&c.nextSibling;)e-=c.length,c=c.nextSibling;for(var d=null;this._isNodeEmpty(c,e)&&c!==d;)d=c,b=this._removeStartingRangeFromRange(c,b),c=b.startContainer,e=0;a.removeAllRanges();a.addRange(b)}},_adaptIEFormatAreaAndExec:function(a){var c=G.getSelection(this.window),e=this.document,d,f,h,g,k,l,t;if(a&&c&&c.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);h=c.getRangeAt(0);g=h.startContainer;3===g.nodeType&&(f=h.endOffset,
g.length<f&&(f=this._adjustNodeAndOffset(d,f),g=f.node,f=f.offset));for(;g&&g!==this.editNode;){d=g.tagName?g.tagName.toLowerCase():"";if(-1<q.indexOf(a,d)){t=g;break}g=g.parentNode}if(t&&(d=h.startContainer,a=e.createElement(t.tagName),b.place(a,t,"after"),d&&3===d.nodeType)){f=h.endOffset;d.length<f&&(f=this._adjustNodeAndOffset(d,f),d=f.node,f=f.offset);g=d.nodeValue;h=e.createTextNode(g.substring(0,f));var m=g.substring(f,g.length);m&&(k=e.createTextNode(m));b.place(h,d,"before");k&&(l=e.createElement("span"),
l.className="ieFormatBreakerSpan",b.place(l,d,"after"),b.place(k,l,"after"),k=l);b.destroy(d);f=h.parentNode;for(d=[];f!==t;){g=f.tagName;h={tagName:g};d.push(h);g=e.createElement(g);f.style&&g.style&&f.style.cssText&&(g.style.cssText=f.style.cssText,h.cssText=f.style.cssText);"FONT"===f.tagName&&(f.color&&(g.color=f.color,h.color=f.color),f.face&&(g.face=f.face,h.face=f.face),f.size&&(g.size=f.size,h.size=f.size));f.className&&(g.className=f.className,h.className=f.className);if(k)for(;k;)h=k.nextSibling,
g.appendChild(k),k=h;g.tagName==f.tagName?(l=e.createElement("span"),l.className="ieFormatBreakerSpan",b.place(l,f,"after"),b.place(g,l,"after")):b.place(g,f,"after");h=f;k=g;f=f.parentNode}if(k){if(1===k.nodeType||3===k.nodeType&&k.nodeValue)a.innerHTML="";for(;k;)h=k.nextSibling,a.appendChild(k),k=h}if(d.length){h=d.pop();k=e.createElement(h.tagName);h.cssText&&k.style&&(k.style.cssText=h.cssText);h.className&&(k.className=h.className);"FONT"===h.tagName&&(h.color&&(k.color=h.color),h.face&&(k.face=
h.face),h.size&&(k.size=h.size));for(b.place(k,a,"before");d.length;)h=d.pop(),t=e.createElement(h.tagName),h.cssText&&t.style&&(t.style.cssText=h.cssText),h.className&&(t.className=h.className),"FONT"===h.tagName&&(h.color&&(t.color=h.color),h.face&&(t.face=h.face),h.size&&(t.size=h.size)),k.appendChild(t),k=t;t=e.createTextNode(".");l.appendChild(t);k.appendChild(t)}else l=e.createElement("span"),l.className="ieFormatBreakerSpan",t=e.createTextNode("."),l.appendChild(t),b.place(l,a,"before");k=
G.create(this.window);k.setStart(t,0);k.setEnd(t,t.length);c.removeAllRanges();c.addRange(k);this.selection.collapse(!1);t.parentNode.innerHTML="";a.firstChild||b.destroy(a);return!0}return!1}h=c.getRangeAt(0);if((d=h.startContainer)&&3===d.nodeType)return f=h.startOffset,d.length<f&&(f=this._adjustNodeAndOffset(d,f),d=f.node,f=f.offset),g=d.nodeValue,h=e.createTextNode(g.substring(0,f)),m=g.substring(f),""!==m&&(k=e.createTextNode(g.substring(f))),l=e.createElement("span"),t=e.createTextNode("."),
l.appendChild(t),h.length?b.place(h,d,"after"):h=d,b.place(l,h,"after"),k&&b.place(k,l,"after"),b.destroy(d),k=G.create(this.window),k.setStart(t,0),k.setEnd(t,t.length),c.removeAllRanges(),c.addRange(k),e.execCommand(a),b.place(l.firstChild,l,"before"),b.destroy(l),k.setStart(t,0),k.setEnd(t,t.length),c.removeAllRanges(),c.addRange(k),this.selection.collapse(!1),t.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var c=G.getSelection(this.window);if(c.isCollapsed&&c.rangeCount&&
!this.queryCommandValue(a)){var e=c.getRangeAt(0),d=e.startContainer;if(d&&3==d.nodeType&&!e.startOffset)return e="ul","insertorderedlist"===a&&(e="ol"),a=this.document.createElement(e),e=b.create("li",null,a),b.place(a,d,"before"),e.appendChild(d),b.create("br",null,a,"after"),a=G.create(this.window),a.setStart(d,0),a.setEnd(d,d.length),c.removeAllRanges(),c.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(a,c){var e=G.getSelection(this.window),d=this.document,
h,g,l,t,m;c=c||null;if(a&&e&&e.isCollapsed&&e.rangeCount&&(g=e.getRangeAt(0),(h=g.startContainer)&&3===h.nodeType)){m=g.startOffset;h.length<m&&(g=this._adjustNodeAndOffset(h,m),h=g.node,m=g.offset);l=h.nodeValue;g=d.createTextNode(l.substring(0,m));""!==l.substring(m)&&(t=d.createTextNode(l.substring(m)));l=d.createElement("span");m=d.createTextNode(".");l.appendChild(m);d=d.createElement("span");l.appendChild(d);g.length?b.place(g,h,"after"):g=h;b.place(l,g,"after");t&&b.place(t,l,"after");b.destroy(h);
h=G.create(this.window);h.setStart(m,0);h.setEnd(m,m.length);e.removeAllRanges();e.addRange(h);if(f("webkit")){e="color";if("hilitecolor"===a||"backcolor"===a)e="backgroundColor";k.set(l,e,c);this.selection.remove();b.destroy(d);l.innerHTML="\x26#160;";this.selection.selectElement(l);this.focus()}else this.execCommand(a,c),b.place(l.firstChild,l,"before"),b.destroy(l),h.setStart(m,0),h.setEnd(m,m.length),e.removeAllRanges(),e.addRange(h),this.selection.collapse(!1),m.parentNode.removeChild(m);return!0}return!1},
_adjustNodeAndOffset:function(a,b){for(;a.length<b&&a.nextSibling&&3===a.nextSibling.nodeType;)b-=a.length,a=a.nextSibling;return{node:a,offset:b}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return c(".ieFormatBreakerSpan",a).forEach(function(a){for(;a.firstChild;)b.place(a.firstChild,a,"before");
b.destroy(a)}),a},_stripTrailingEmptyNodes:function(a){function c(a){return/^(p|div|br)$/i.test(a.nodeName)&&0==a.children.length&&/^[\s\xA0]*$/.test(a.textContent||a.innerText||"")||3===a.nodeType&&/^[\s\xA0]*$/.test(a.nodeValue)}for(;a.lastChild&&c(a.lastChild);)b.destroy(a.lastChild);return a},_setTextDirAttr:function(a){this._set("textDir",a);this.onLoadDeferred.then(e.hitch(this,function(){this.editNode.dir=a}))}});return H})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare",
"dojo/_base/lang"],function(q,n,r){var u={getIndex:function(d,b){for(var g=[],k=[],m=d,l,e;d!=b;){var a=0;for(l=d.parentNode;e=l.childNodes[a++];)if(e===d){--a;break}g.unshift(a);k.unshift(a-l.childNodes.length);d=l}if(0<g.length&&3==m.nodeType){for(e=m.previousSibling;e&&3==e.nodeType;)g[g.length-1]--,e=e.previousSibling;for(e=m.nextSibling;e&&3==e.nodeType;)k[k.length-1]++,e=e.nextSibling}return{o:g,r:k}},getNode:function(d,b){if(!r.isArray(d)||0==d.length)return b;var g=b;q.every(d,function(b){if(0<=
b&&b<g.childNodes.length)g=g.childNodes[b];else return g=null,!1;return!0});return g},getCommonAncestor:function(d,b,g){g=g||d.ownerDocument.body;var k=function(b){for(var a=[];b;)if(a.unshift(b),b!==g)b=b.parentNode;else break;return a};d=k(d);b=k(b);for(var k=Math.min(d.length,b.length),t=d[0],l=1;l<k;l++)if(d[l]===b[l])t=d[l];else break;return t},getAncestor:function(d,b,g){for(g=g||d.ownerDocument.body;d&&d!==g;){var k=d.nodeName.toUpperCase();if(b.test(k))return d;d=d.parentNode}return null},
BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(d,b,g){g=g||d.ownerDocument.body;b=b||u.BlockTagNames;for(var k=null,t;d&&d!==g;){var l=d.nodeName.toUpperCase();!k&&b.test(l)&&(k=d);!t&&/^(?:BODY|TD|TH|CAPTION)$/.test(l)&&(t=d);d=d.parentNode}return{blockNode:k,blockContainer:t||d.ownerDocument.body}},atBeginningOfContainer:function(d,b,g){var k=!1,t=0==g;t||3!=b.nodeType||/^[\s\xA0]+$/.test(b.nodeValue.substr(0,g))&&(t=!0);if(t)for(k=!0;b&&b!==d;){if(b.previousSibling){k=
!1;break}b=b.parentNode}return k},atEndOfContainer:function(d,b,g){var k=!1,t=g==(b.length||b.childNodes.length);t||3!=b.nodeType||/^[\s\xA0]+$/.test(b.nodeValue.substr(g))&&(t=!0);if(t)for(k=!0;b&&b!==d;){if(b.nextSibling){k=!1;break}b=b.parentNode}return k},adjacentNoneTextNode:function(d,b){for(var g=d,k=0-d.length||0,m=b?"nextSibling":"previousSibling";g&&3==g.nodeType;)k+=g.length,g=g[m];return[g,k]},create:function(d){d=d||window;return d.getSelection?d.document.createRange():new g},getSelection:function(d,
b){if(d.getSelection)return d.getSelection();var g=new m.selection(d);b||g._getCurrentSelection();return g}};if(!window.getSelection)var m=u.ie={cachedSelection:{},selection:function(d){this._ranges=[];this.addRange=function(b,d){this._ranges.push(b);d||b._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(b){return this._ranges[b]};this._getCurrentSelection=function(){this.removeAllRanges();var b;b=d.document.selection.createRange();
b="CONTROL"==d.document.selection.type.toUpperCase()?new g(m.decomposeControlRange(b)):new g(m.decomposeTextRange(b));this.addRange(b,!0),this.isCollapsed=b.collapsed}},decomposeControlRange:function(d){var b=d.item(0),g=d.item(d.length-1);d=b.parentNode;var k=g.parentNode,b=u.getIndex(b,d).o[0],g=u.getIndex(g,k).o[0]+1;return[d,b,k,g]},getEndPoint:function(d,b){var g=d.duplicate();g.collapse(!b);var k="EndTo"+(b?"End":"Start"),m=g.parentElement(),l,e,a;0<m.childNodes.length?q.every(m.childNodes,
function(b,c){var f;if(3!=b.nodeType)if(g.moveToElementText(b),0<g.compareEndPoints(k,d))if(a&&3==a.nodeType)l=a,f=!0;else return l=m,e=c,!1;else{if(c==m.childNodes.length-1)return l=m,e=m.childNodes.length,!1}else c==m.childNodes.length-1&&(l=b,f=!0);if(f&&l){l=(f=u.adjacentNoneTextNode(l)[0])?f.nextSibling:m.firstChild;var h=u.adjacentNoneTextNode(l);f=h[0];h=h[1];f?(g.moveToElementText(f),g.collapse(!1)):g.moveToElementText(m);g.setEndPoint(k,d);e=g.text.length-h;return!1}a=b;return!0}):(l=m,e=
0);if(!b&&1==l.nodeType&&e==l.childNodes.length){var c=l.nextSibling;c&&3==c.nodeType&&(l=c,e=0)}return[l,e]},setEndPoint:function(d,b,g){d=d.duplicate();var k;if(3!=b.nodeType)if(0<g){if(k=b.childNodes[g-1])if(3==k.nodeType)b=k,g=k.length;else if(k.nextSibling&&3==k.nextSibling.nodeType)b=k.nextSibling,g=0;else{d.moveToElementText(k.nextSibling?k:b);var m=k.parentNode;k=m.insertBefore(k.ownerDocument.createTextNode(" "),k.nextSibling);d.collapse(!1);m.removeChild(k)}}else d.moveToElementText(b),
d.collapse(!0);3==b.nodeType&&(k=u.adjacentNoneTextNode(b),m=k[0],k=k[1],m?(d.moveToElementText(m),d.collapse(!1),"inherit"!=m.contentEditable&&k++):(d.moveToElementText(b.parentNode),d.collapse(!0),d.move("character",1),d.move("character",-1)),g+=k,0<g&&d.move("character",g)!=g&&console.error("Error when moving!"));return d},decomposeTextRange:function(d){var b=m.getEndPoint(d),g=b[0],k=b[1],n=b[0],b=b[1];d.htmlText.length&&(d.htmlText==d.text?b=k+d.text.length:(b=m.getEndPoint(d,!0),n=b[0],b=b[1]));
return[g,k,n,b]},setRange:function(d,b,g,k,n,l){b=m.setEndPoint(d,b,g);d.setEndPoint("StartToStart",b);if(!l)var e=m.setEndPoint(d,k,n);d.setEndPoint("EndToEnd",e||b);return d}},g=u.W3CRange=n(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?u.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(d,b){b=parseInt(b);if(this.startContainer!==d||this.startOffset!=b)delete this._cachedBookmark,this.startContainer=d,this.startOffset=b,this.endContainer?this._updateInternal():this.setEnd(d,b)},setEnd:function(d,b){b=parseInt(b);if(this.endContainer!==d||this.endOffset!=b)delete this._cachedBookmark,
this.endContainer=d,this.endOffset=b,this.startContainer?this._updateInternal():this.setStart(d,b)},setStartAfter:function(d,b){this._setPoint("setStart",d,b,1)},setStartBefore:function(d,b){this._setPoint("setStart",d,b,0)},setEndAfter:function(d,b){this._setPoint("setEnd",d,b,1)},setEndBefore:function(d,b){this._setPoint("setEnd",d,b,0)},_setPoint:function(d,b,g,k){g=u.getIndex(b,b.parentNode).o;this[d](b.parentNode,g.pop()+k)},_getIERange:function(){var d=(this._body||this.endContainer.ownerDocument.body).createTextRange();
m.setRange(d,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return d},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var d=this.startContainer,b=this._getIERange();3!==d.nodeType||this.startOffset||this.setStartBefore(d);b.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var d=new g([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);d._body=this._body;return d},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});r.setObject("dijit.range",u);return u})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(q,n,r){var u={};n.setObject("dijit._editor.html",u);var m=u.escapeXml=function(g,d){g=g.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");d||(g=g.replace(/'/gm,"\x26#39;"));return g};u.getNodeHtml=function(g){var d=[];u.getNodeHtmlHelper(g,d);return d.join("")};u.getNodeHtmlHelper=function(g,d){switch(g.nodeType){case 1:var b=g.nodeName.toLowerCase();if(!b||"/"==b.charAt(0))return"";d.push("\x3c",b);var t=[],k={},n;if(r("dom-attributes-explicit")||r("dom-attributes-specified-flag"))for(var l=0;n=g.attributes[l++];){var e=n.name;"_dj"===e.substr(0,3)||r("dom-attributes-specified-flag")&&
!n.specified||e in k||(n=n.value,("src"==e||"href"==e)&&g.getAttribute("_djrealurl")&&(n=g.getAttribute("_djrealurl")),8===r("ie")&&"style"===e&&(n=n.replace("HEIGHT:","height:").replace("WIDTH:","width:")),t.push([e,n]),k[e]=n)}else{var a=(/^input$|^img$/i.test(g.nodeName)?g:g.cloneNode(!1)).outerHTML,k=a.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi),a=a.substr(0,a.indexOf("\x3e"));q.forEach(k,function(c){if(c){var e=c.indexOf("\x3d");if(0<e&&(c=c.substring(0,e),"_dj"!=c.substr(0,3)))if("src"!=c&&"href"!=
c||!g.getAttribute("_djrealurl")){var d;switch(c){case "style":d=g.style.cssText.toLowerCase();break;case "class":d=g.className;break;case "width":if("img"===b){(e=/width=(\S+)/i.exec(a))&&(d=e[1]);break}case "height":if("img"===b){(e=/height=(\S+)/i.exec(a))&&(d=e[1]);break}default:d=g.getAttribute(c)}null!=d&&t.push([c,d.toString()])}else t.push([c,g.getAttribute("_djrealurl")])}},this)}t.sort(function(a,b){return a[0]<b[0]?-1:a[0]==b[0]?0:1});for(k=0;n=t[k++];)d.push(" ",n[0],'\x3d"',"string"===
typeof n[1]?m(n[1],!0):n[1],'"');switch(b){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":d.push(" /\x3e");break;case "script":d.push("\x3e",g.innerHTML,"\x3c/",b,"\x3e");break;default:d.push("\x3e"),g.hasChildNodes()&&u.getChildrenHtmlHelper(g,d),d.push("\x3c/",b,"\x3e")}break;case 4:case 3:d.push(m(g.nodeValue,!0));break;case 8:d.push("\x3c!--",m(g.nodeValue,!0),"--\x3e");break;default:d.push("\x3c!-- Element not recognized - Type: ",g.nodeType," Name: ",
g.nodeName,"--\x3e")}};u.getChildrenHtml=function(g){var d=[];u.getChildrenHtmlHelper(g,d);return d.join("")};u.getChildrenHtmlHelper=function(g,d){if(g)for(var b=g.childNodes||g,m=!r("ie")||b!==g,k,n=0;k=b[n++];)m&&k.parentNode!=g||u.getNodeHtmlHelper(k,d)};return u})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(q,
n,r,u,m,g,d,b,t,k,x,l){var e=n("dijit._editor.plugins.LinkDialog",k,{buttonClass:x,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=m.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(a){q("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),m.hitch(this,function(b,c,e){var d=this;this.tag="insertImage"==this.command?"img":"a";b=m.delegate(b.getLocalization("dijit","common",this.lang),b.getLocalization("dijit._editor",
"LinkDialog",this.lang));var f=this.dropDown=this.button.dropDown=new c({title:b[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:m.hitch(this,"setValue"),onOpen:function(){d._onOpenDialog();c.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(m.hitch(d,"_onCloseDialog"),0)}});b.urlRegExp=this.urlRegExp;b.id=e.getUniqueId(this.editor.id);this._uniqueId=b.id;this._setContent(f.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
t.substitute(this.linkDialogTemplate,b));f.startup();this._urlInput=e.byId(this._uniqueId+"_urlInput");this._textInput=e.byId(this._uniqueId+"_textInput");this._setButton=e.byId(this._uniqueId+"_setButton");this.own(e.byId(this._uniqueId+"_cancelButton").on("click",m.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",m.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",m.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=m.hitch(this,function(){var a=this._urlInput.get("value");return this._urlRegExp.test(a)||this._emailRegExp.test(a)});this.own(g(f.domNode,"keydown",m.hitch(this,m.hitch(this,function(a){!a||a.keyCode!=u.ENTER||a.shiftKey||a.metaKey||a.ctrlKey||a.altKey||this._setButton.get("disabled")||(f.onExecute(),f.execute(f.get("value")))}))));a()}))},_checkAndFixInput:function(){var a=this,b=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var c=b,e=!1,d=!1;c&&1<c.length&&(c=m.trim(c),0!==c.indexOf("mailto:")&&(0<c.indexOf("/")?-1===c.indexOf("://")&&"/"!==c.charAt(0)&&c.indexOf("./")&&0!==c.indexOf("../")&&a._hostRxp.test(c)&&(e=!0):a._userAtRxp.test(c)&&(d=!0)));e&&a._urlInput.set("value","http://"+c);d&&a._urlInput.set("value","mailto:"+c);a._setButton.set("disabled",!a._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(m.hitch(this,
function(){this.own(g(this.editor.editNode,"dblclick",m.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(a){this.dropDown.set({parserScope:"dojo",content:a})},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));return a},setValue:function(a){this._onCloseDialog();if(9>d("ie")){var c=l.getSelection(this.editor.window).getRangeAt(0).endContainer;3===c.nodeType&&(c=c.parentNode);
c&&c.nodeName&&c.nodeName.toLowerCase()!==this.tag&&(c=this.editor.selection.getSelectedElement(this.tag));c&&c.nodeName&&c.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(c),this.editor.execCommand("unlink"))}a=this._checkValues(a);this.editor.execCommand("inserthtml",t.substitute(this.htmlTemplate,a));b("a",this.editor.document).forEach(function(a){a.innerHTML||r.has(a,"name")||a.parentNode.removeChild(a)},this)},_onCloseDialog:function(){this.editor.focused&&
this.editor.focus()},_getCurrentValues:function(a){var b,c,e;a&&a.tagName.toLowerCase()===this.tag?(b=a.getAttribute("_djrealurl")||a.getAttribute("href"),e=a.getAttribute("target")||"_self",c=a.textContent||a.innerText,this.editor.selection.selectElement(a,!0)):c=this.editor.selection.getSelectedText();return{urlInput:b||"",textInput:c||"",targetSelect:e||""}},_onOpenDialog:function(){var a,b;if(d("ie")){if(b=l.getSelection(this.editor.window),b.rangeCount){var e=b.getRangeAt(0);a=e.endContainer;
3===a.nodeType&&(a=a.parentNode);a&&a.nodeName&&a.nodeName.toLowerCase()!==this.tag&&(a=this.editor.selection.getSelectedElement(this.tag));if(!a||a.nodeName&&a.nodeName.toLowerCase()!==this.tag)(b=this.editor.selection.getAncestorElement(this.tag))&&b.nodeName&&b.nodeName.toLowerCase()==this.tag?(a=b,this.editor.selection.selectElement(a)):e.startContainer===e.endContainer&&(b=e.startContainer.firstChild)&&b.nodeName&&b.nodeName.toLowerCase()==this.tag&&(a=b,this.editor.selection.selectElement(a))}}else a=
this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(a))},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&r.get(a,"href"))){var b=this.editor;this.editor.selection.selectElement(a);b.onDisplayChanged();b._updateTimer&&(b._updateTimer.remove(),delete b._updateTimer);b.onNormalizedDisplayChanged();var c=this.button;setTimeout(function(){c.set("disabled",
!1);c.loadAndOpenDropDown().then(function(){c.dropDown.focus&&c.dropDown.focus()})},10)}}}),a=n("dijit._editor.plugins.ImgLinkDialog",[e],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(a){var b,c;a&&a.tagName.toLowerCase()===this.tag?(b=a.getAttribute("_djrealurl")||a.getAttribute("src"),c=a.getAttribute("alt"),this.editor.selection.selectElement(a,!0)):c=this.editor.selection.getSelectedText();return{urlInput:b||"",textInput:c||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(m.hitch(this,
function(){this.own(g(this.editor.editNode,"mousedown",m.hitch(this,"_selectTag")))}))},_selectTag:function(a){a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(a))},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));a&&a.textInput&&(a.textInput=a.textInput.replace(/"/g,"\x26quot;"));return a},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&r.get(a,
"src"))){var b=this.editor;this.editor.selection.selectElement(a);b.onDisplayChanged();b._updateTimer&&(b._updateTimer.remove(),delete b._updateTimer);b.onNormalizedDisplayChanged();var c=this.button;setTimeout(function(){c.set("disabled",!1);c.loadAndOpenDropDown().then(function(){c.dropDown.focus&&c.dropDown.focus()})},10)}}});k.registry.createLink=function(){return new e({command:"createLink"})};k.registry.insertImage=function(){return new a({command:"insertImage"})};e.ImgLinkDialog=a;return e})},
"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(q,n,r,u,m,g){var d=r("dijit._editor.plugins.TextColor",m,{buttonClass:g,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var b=this;this.button.loadDropDown=function(d){function g(g){b.button.dropDown=new g({dir:b.editor.dir,ownerDocument:b.editor.ownerDocument,
value:b.value,onChange:function(d){b.editor.execCommand(b.command,d)},onExecute:function(){b.editor.execCommand(b.command,this.get("value"))}});d()}"string"==typeof b.colorPicker?q([b.colorPicker],g):g(b.colorPicker)}},updateState:function(){var b=this.editor,d=this.command;if(b&&b.isLoaded&&d.length){if(this.button){var g=this.get("disabled");this.button.set("disabled",g);if(g)return;var m;try{m=b.queryCommandValue(d)||""}catch(l){m=""}}""==m&&(m="#000000");"transparent"==m&&(m="#ffffff");"string"==
typeof m?-1<m.indexOf("rgb")&&(m=n.fromRgb(m).toHex()):(m=((m&255)<<16|m&65280|(m&16711680)>>>16).toString(16),m="#000000".slice(0,7-m.length)+m);this.value=m;(b=this.button.dropDown)&&b.get&&m!==b.get("value")&&b.set("value",m,!1)}}});m.registry.foreColor=function(b){return new d(b)};m.registry.hiliteColor=function(b){return new d(b)};return d})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f){q=q([k,x],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:h,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},
_layerEditingCap:{},constructor:function(a,b){n.mixin(this,f.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=r.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=r.connect(this._uploadField,"onfocus",n.hitch(this,function(a){c.hide(this._attachmentError)}))},destroy:function(){u.forEach(this._aeConnects,r.disconnect);r.disconnect(this._uploadField_connect);r.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(a,b){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";u.forEach(this.domNode.children,function(a,b){c.show(a)});c.hide(this._attachmentError);a&&(this._featureLayer=a.getLayer()||b)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:a}).canUpdate,this._oid=a.attributes[this._featureLayer.objectIdField],this._getAttachments(a)):b&&b.getEditCapabilities()||(c.hide(this._uploadForm),u.forEach(this.domNode.children,function(a,b){c.hide(a)})))},_getAttachments:function(a){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
n.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){c.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(c.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,n.hitch(this,"_onAddAttachmentComplete"),n.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(a,b){this._tempUpload&&(c.show(this._attachmentProgress),b.addAttachment(a,this._tempUpload,n.hitch(this,"_onAddAttachmentComplete"),
n.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(a,b){c.show(this._attachmentProgress);this._featureLayer.deleteAttachments(a,[b],n.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(b){var c=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(c=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(c=this._listHtml+this._endHtml);var e=this._attachmentList;b=u.map(b,n.hitch(this,function(b){return a.substitute({href:b.url,name:b.name,oid:b.objectId,attid:b.id},c)}));e.innerHTML=b.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(e){c.hide(this._attachmentProgress.domNode);var d=this._attachmentList,
f=this._uploadField,h=f.value,g=h.lastIndexOf("\\");-1<g&&(h=h.substring(g+1,h.length));var h=h.replace(/\ /g,"_"),g=b.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()}),k=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(k=this._listHtml+this._endHtml);e=a.substitute({href:this._featureLayer._url.path+"/"+e.objectId+"/attachments/"+e.attachmentId+
(g?"?"+g:""),name:h,oid:e.objectId,attid:e.attachmentId},k);d.innerHTML=d.innerHTML==this.NLS_none?e:d.innerHTML+e;this._updateConnects();f.value=""},_onAddAttachmentError:function(b){c.hide(this._attachmentProgress.domNode);if(b&&a.isDefined(b.code)){var e=this._attachmentError;t.set(e,"innerHTML",(400===b.code?this.NLS_fileNotSupported:b.message||b.details&&b.details.length&&b.details[0])||this.NLS_error);c.show(e)}},_onDeleteAttachmentComplete:function(a){c.hide(this._attachmentProgress.domNode);
var b=this._attachmentList;u.every(a,function(a){return a.success})&&(m.query("#node_"+a[0].objectId+"_"+a[0].attachmentId).orphan(),b.children&&b.children.length||(b.innerHTML=this.NLS_none))},_updateConnects:function(){u.forEach(this._aeConnects,r.disconnect);m.query(".deleteAttachment").forEach(function(a){this._aeConnects.push(r.connect(a,"onclick",n.hitch(this,"_deleteAttachment",this._oid,a.id)))},this)}});g("extend-esri")&&n.setObject("dijit.editing.AttachmentEditor",q,e);return q})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(q,n,r,u,m,g,d,b){return n("dijit.ProgressBar",[g,d],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:b,_indeterminateHighContrastImagePath:q.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(b){var d="rtl"==b.toLowerCase();r.toggle(this.domNode,"dijitProgressBarRtl",d);r.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&d);this.inherited(arguments)},update:function(b){u.mixin(this,b||{});b=this.internalProgress;var d=this.domNode,g=1;this.indeterminate?d.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(g=Math.min(parseFloat(this.progress)/100,1),this.progress=g*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),g=this.maximum?this.progress/this.maximum:0),d.setAttribute("aria-valuenow",this.progress));d.setAttribute("aria-labelledby",this.labelNode.id);d.setAttribute("aria-valuemin",0);d.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(g);r.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);r.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());b.style.width=100*g+"%";this.onChange()},_setValueAttr:function(b){this._set("value",
b);Infinity==b?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:b})},_setLabelAttr:function(b){this._set("label",b);this.update()},_setIndeterminateAttr:function(b){this._set("indeterminate",b);this.update()},report:function(b){return this.label?this.label:this.indeterminate?"\x26#160;":m.format(b,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(q,n,r,u){var m={},m={findFeatures:function(g,d,b){var m=d.objectIdField;d=n.filter(d.graphics,function(b){return n.some(g,function(d){return b.attributes[m]===d.objectId})});if(b)b(d);else return d},getSelection:function(g){var d=[];n.forEach(g,function(b){b=b.getSelectedFeatures();n.forEach(b,function(b){d.push(b)})});return d}};r("extend-esri")&&q.setObject("dijit.editing.Util.LayerHelper",m,u);return m})},"dijit/form/TimeTextBox":function(){define(["dojo/_base/declare","dojo/keys","dojo/_base/lang",
"../_TimePicker","./_DateTimeTextBox"],function(q,n,r,u,m){return q("dijit.form.TimeTextBox",m,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:u,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(g){this.inherited(arguments);this.dropDown.on("input",r.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var g=this.get("displayedValue");this.filterString=g&&!this.parse(g,this.constraints)?g.toLowerCase():
"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h){return m("dijit._TimePicker",[c,h],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",
visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:u.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(a){b.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",
a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,b,c,e){a=this.ownerDocument.createDocumentFragment();for(b=0;b<this._maxIncrement;b++)(c=this._createOption(b))&&a.appendChild(c);return a},_showText:function(){var a=u.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);this._visibleIncrementDate=a(this.visibleIncrement);var b=function(a){return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds()},c=b(this._clickableIncrementDate),
b=b(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=a(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=b/c;a=a(this.pickerMax);a.setFullYear(1970,0,1);a=.001*(a.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((a+1)/c);c=this._getFilteredNodes();!c.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(c)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);
this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){for(var b in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})b in a&&(this[b]=a[b]);a.locale||(a.locale=this.lang)},_createOption:function(a){var b=new Date(this._refDate),c=this._clickableIncrementDate;b.setHours(b.getHours()+c.getHours()*a,b.getMinutes()+c.getMinutes()*a,b.getSeconds()+c.getSeconds()*a);"time"==this.constraints.selector&&b.setFullYear(1970,0,1);var e=r.format(b,this.constraints);if(this.filterString&&
0!==e.toLowerCase().indexOf(this.filterString))return null;c=this.ownerDocument.createElement("div");c.className=this.baseClass+"Item";c.date=b;c.idx=a;d.create("div",{"class":this.baseClass+"ItemInner",innerHTML:e},c);e=1>a%this._visibleIncrement&&-1<a%this._visibleIncrement;a=!e&&!(a%this._clickableIncrement);e?c.className+=" "+this.baseClass+"Marker":a&&(c.className+=" "+this.baseClass+"Tick");this.isDisabledDate(b)&&(c.className+=" "+this.baseClass+"ItemDisabled");this.value&&!n.compare(this.value,
b,this.constraints.selector)&&(c.selected=!0,c.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=c,e?c.className+=" "+this.baseClass+"MarkerSelected":a&&(c.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(c,!0));return c},onOpen:function(){this.inherited(arguments);this.set("selected",this._selectedDiv)},_onOptionSelected:function(a,b){var c=a.target.date||a.target.parentNode.date;c&&!this.isDisabledDate(c)&&(this._set("value",c),this.emit("input"),b&&(this._highlighted_option=
null,this.set("value",c),this.onChange(c)))},onChange:function(){},_highlightOption:function(a,b){if(a){if(b)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else{if(this._highlighted_option!==a)return;this._highlighted_option=null}g.toggle(a,this.baseClass+"ItemHover",b);g.contains(a,this.baseClass+"Marker")?g.toggle(a,this.baseClass+"MarkerHover",b):g.toggle(a,this.baseClass+"TickHover",b)}},handleKey:function(a){if(a.keyCode==t.DOWN_ARROW)return this.selectNextNode(),
this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==t.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==t.ENTER||a.keyCode===t.TAB){if(!this._keyboardSelected&&a.keyCode===t.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return a.keyCode===t.TAB}},onHover:function(a){this._highlightOption(a,
!0)},onUnhover:function(a){this._highlightOption(a,!1)},onSelect:function(a){this._highlightOption(a,!0)},onDeselect:function(a){this._highlightOption(a,!1)},onClick:function(a){this._onOptionSelected({target:a},!0)}})})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(q,n,r,u){var m=n.getObject("date.islamic",!0,q);m.getDaysInMonth=function(g){return g.getDaysInIslamicMonth(g.getMonth(),g.getFullYear())};m.compare=function(g,d,b){g instanceof
u&&(g=g.toGregorian());d instanceof u&&(d=d.toGregorian());return r.compare.apply(null,arguments)};m.add=function(g,d,b){var m=new u(g);switch(d){case "day":m.setDate(g.getDate()+b);break;case "weekday":var k=g.getDay();if(5>k+b&&0<k+b)m.setDate(g.getDate()+b);else{var n=d=0;5==k?(k=4,n=0<b?-1:1):6==k&&(k=4,n=0<b?-2:2);var k=0<b?5-k-1:-k,l=b-k,e=parseInt(l/5);0!=l%5&&(d=0<b?2:-2);d=d+7*e+l%5+k;m.setDate(g.getDate()+d+n)}break;case "year":m.setFullYear(g.getFullYear()+b);break;case "week":b*=7;m.setDate(g.getDate()+
b);break;case "month":g=g.getMonth();m.setMonth(g+b);break;case "hour":m.setHours(g.getHours()+b);break;case "minute":m._addMinutes(b);break;case "second":m._addSeconds(b);break;case "millisecond":m._addMilliseconds(b)}return m};m.difference=function(g,d,b){d=d||new u;b=b||"day";var n=d.getFullYear()-g.getFullYear(),k=1;switch(b){case "weekday":n=Math.round(m.difference(g,d,"day"));k=parseInt(m.difference(g,d,"week"));if(0==n%7)n=5*k;else{b=0;var q=g.getDay(),l=d.getDay(),k=parseInt(n/7);d=n%7;g=
new u(g);g.setDate(g.getDate()+7*k);g=g.getDay();if(0<n)switch(!0){case 5==q:b=-1;break;case 6==q:b=0;break;case 5==l:b=-1;break;case 6==l:b=-2;break;case 5<g+d:b=-2}else if(0>n)switch(!0){case 5==q:b=0;break;case 6==q:b=1;break;case 5==l:b=2;break;case 6==l:b=1;break;case 0>g+d:b=2}n=n+b-2*k}k=n;break;case "year":k=n;break;case "month":b=d.toGregorian()>g.toGregorian()?d:g;q=d.toGregorian()>g.toGregorian()?g:d;k=b.getMonth();l=q.getMonth();if(0==n)k=b.getMonth()-q.getMonth();else for(k=12-l+k,n=
q.getFullYear()+1,b=b.getFullYear(),n;n<b;n++)k+=12;d.toGregorian()<g.toGregorian()&&(k=-k);break;case "week":k=parseInt(m.difference(g,d,"day")/7);break;case "day":k/=24;case "hour":k/=60;case "minute":k/=60;case "second":k/=1E3;case "millisecond":k*=d.toGregorian().getTime()-g.toGregorian().getTime()}return Math.round(k)};return m})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(q,n,r){var u=n("dojox.date.islamic.Date",null,{_date:0,_month:0,
_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var m=arguments.length;m?1==m?(m=arguments[0],"number"==typeof m&&(m=new Date(m)),m instanceof Date?this.fromGregorian(m):""==m?this._date=new Date(""):(this._year=m._year,this._month=m._month,this._date=m._date,this._hours=m._hours,this._minutes=m._minutes,this._seconds=m._seconds,this._milliseconds=m._milliseconds)):3<=m&&(this._year+=arguments[0],this._month+=
arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(m){m=parseInt(m);if(!(0<m&&m<=this.getDaysInIslamicMonth(this._month,this._year))){var g;if(0<m)for(g=this.getDaysInIslamicMonth(this._month,this._year);m>g;m-=g,g=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(g=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=m;g=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),m+=g}this._date=m;return this},setFullYear:function(m){this._year=+m},setMonth:function(m){this._year+=Math.floor(m/12);this._month=0<m?Math.floor(m%12):Math.floor((m%12+12)%12)},setHours:function(){var m=arguments.length,g=0;1<=m&&(g=parseInt(arguments[0]));2<=m&&(this._minutes=parseInt(arguments[1]));3<=m&&(this._seconds=parseInt(arguments[2]));4==m&&(this._milliseconds=parseInt(arguments[3]));for(;24<=g;)this._date++,m=this.getDaysInIslamicMonth(this._month,
this._year),this._date>m&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=m),g-=24;this._hours=g},_addMinutes:function(m){m+=this._minutes;this.setMinutes(m);this.setHours(this._hours+parseInt(m/60));return this},_addSeconds:function(m){m+=this._seconds;this.setSeconds(m);this._addMinutes(parseInt(m/60));return this},_addMilliseconds:function(m){m+=this._milliseconds;this.setMilliseconds(m);this._addSeconds(parseInt(m/1E3));return this},setMinutes:function(m){this._minutes=
m%60;return this},setSeconds:function(m){this._seconds=m%60;return this},setMilliseconds:function(m){this._milliseconds=m%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var m=new Date;m.setHours(this._hours);m.setMinutes(this._minutes);m.setSeconds(this._seconds);m.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+m.toTimeString()},toGregorian:function(){var m=this._year,m=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(m-1)+Math.floor((3+11*m)/30)+this._ISLAMIC_EPOCH-1-.5)+.5,g=m-this._GREGORIAN_EPOCH,d=Math.floor(g/146097),b=this._mod(g,146097),g=Math.floor(b/36524),n=this._mod(b,36524),b=Math.floor(n/1461),n=this._mod(n,1461),n=Math.floor(n/365),d=400*d+100*g+4*b+n;4!=g&&4!=n&&d++;g=m-(this._GREGORIAN_EPOCH+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400));b=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor(739/12+(r.isLeapYear(new Date(d,
3,1))?-1:-2)+1);b=m<b?0:r.isLeapYear(new Date(d,3,1))?1:2;g=Math.floor((12*(g+b)+373)/367);b=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor((367*g-362)/12+(2>=g?0:r.isLeapYear(new Date(d,g-1,1))?-1:-2)+1);return new Date(d,g-1,m-b+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(m){m=new Date(m);var g=m.getFullYear(),d=m.getMonth(),b=m.getDate(),g=this._GREGORIAN_EPOCH-1+365*(g-1)+Math.floor((g-1)/4)+
-Math.floor((g-1)/100)+Math.floor((g-1)/400)+Math.floor((367*(d+1)-362)/12+(2>=d+1?0:r.isLeapYear(m)?-1:-2)+b),g=Math.floor(g)+.5,g=g-this._ISLAMIC_EPOCH,d=Math.floor((30*g+10646)/10631),b=Math.ceil((g-29-this._yearStart(d))/29.5),b=Math.min(b,11);this._date=Math.ceil(g-this._monthStart(d,b))+1;this._month=b;this._year=d;this._hours=m.getHours();this._minutes=m.getMinutes();this._seconds=m.getSeconds();this._milliseconds=m.getMilliseconds();this._day=m.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(m){return 354*(m-1)+Math.floor((3+11*m)/30)},_monthStart:function(m,g){return Math.ceil(29.5*g)+354*(m-1)+Math.floor((3+11*m)/30)},_civilLeapYear:function(m){return 11>(14+11*m)%30},getDaysInIslamicMonth:function(m,g){var d=0,d=29+(m+1)%2;11==m&&this._civilLeapYear(g)&&d++;return d},_mod:function(m,g){return m-g*Math.floor(m/g)}});u.getDaysInIslamicMonth=function(m){return(new u).getDaysInIslamicMonth(m.getMonth(),m.getFullYear())};return u})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(q,n,r,u,m,g,d,b,t){function k(a,b,e,g,k){return k.replace(/([a-z])\1*/ig,function(c){var e,f,h=c.charAt(0);c=c.length;var g=["abbr","wide","narrow"];switch(h){case "G":e=b.eraAbbr[0];break;case "y":e=String(a.getFullYear());break;case "M":e=a.getMonth();3>c?(e+=1,f=!0):(h=["months-format",g[c-3]].join("-"),e=b[h][e]);break;case "d":e=a.getDate(!0);f=!0;break;case "E":e=a.getDay();3>c?(e+=1,f=!0):(h=["days-format",g[c-3]].join("-"),e=b[h][e]);break;case "a":e=12>a.getHours()?"am":"pm";e=b["dayPeriods-format-wide-"+
e];break;case "h":case "H":case "K":case "k":f=a.getHours();switch(h){case "h":e=f%12||12;break;case "H":e=f;break;case "K":e=f%12;break;case "k":e=f||24}f=!0;break;case "m":e=a.getMinutes();f=!0;break;case "s":e=a.getSeconds();f=!0;break;case "S":e=Math.round(a.getMilliseconds()*Math.pow(10,c-3));f=!0;break;case "z":if(e=u.getTimezoneName(a.toGregorian()))break;c=4;case "Z":e=a.toGregorian().getTimezoneOffset();e=[0>=e?"+":"-",d.pad(Math.floor(Math.abs(e)/60),2),d.pad(Math.abs(e)%60,2)];4==c&&(e.splice(0,
0,"GMT"),e.splice(3,0,":"));e=e.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+k);}f&&(e=d.pad(e,c));return e})}function x(a,b,e,d){var c=function(a){return a};b=b||c;e=e||c;d=d||c;var f=a.match(/(''|[^'])+/g),h="'"==a.charAt(0);r.forEach(f,function(a,c){a?(f[c]=(h?e:b)(a),h=!h):f[c]=""});return d(f.join(""))}function l(a,b,e,d){d=g.escapeString(d);m.normalizeLocale(e.locale);return d.replace(/([a-z])\1*/ig,function(c){var d;d=c.charAt(0);var f=
c.length,h="";e.strict?1<f&&(h="0{"+(f-1)+"}"):h="0?";switch(d){case "y":d="\\d+";break;case "M":d=2<f?"\\S+ ?\\S+":h+"[1-9]|1[0-2]";break;case "d":d="[12]\\d|"+h+"[1-9]|3[01]";break;case "E":d="\\S+";break;case "h":d=h+"[1-9]|1[0-2]";break;case "k":d=h+"\\d|1[01]";break;case "H":d=h+"\\d|1\\d|2[0-3]";break;case "K":d=h+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":d=h+"\\d|[0-5]\\d";break;case "S":d="\\d{"+f+"}";break;case "a":f=e.am||b["dayPeriods-format-wide-am"];h=e.pm||b["dayPeriods-format-wide-pm"];
e.strict?d=f+"|"+h:(d=f+"|"+h,f!=f.toLowerCase()&&(d+="|"+f.toLowerCase()),h!=h.toLowerCase()&&(d+="|"+h.toLowerCase()));break;default:d=".*"}a&&a.push(c);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var e=n.getObject("date.islamic.locale",!0,q);e.format=function(a,b){b=b||{};var c=m.normalizeLocale(b.locale),d=b.formatLength||"short",h=e._getIslamicBundle(c),g=[],c=n.hitch(this,k,a,h,c,b.fullYear);if("year"==b.selector)return a.getFullYear();if("time"!=b.selector){var l=b.datePattern||h["dateFormat-"+
d];l&&g.push(x(l,c))}"date"!=b.selector&&(d=b.timePattern||h["timeFormat-"+d])&&g.push(x(d,c));return g.join(" ")};e.regexp=function(a){return e._parseInfo(a).regexp};e._parseInfo=function(a){a=a||{};var b=m.normalizeLocale(a.locale),b=e._getIslamicBundle(b),c=a.formatLength||"short",d=a.datePattern||b["dateFormat-"+c],c=a.timePattern||b["timeFormat-"+c],g=[];return{regexp:x("date"==a.selector?d:"time"==a.selector?c:"undefined"==typeof c?d:d+" "+c,n.hitch(this,l,g,b,a)),tokens:g,bundle:b}};e.parse=
function(a,d){a=a.replace(/[\u200E\u200F\u202A\u202E]/g,"");d||(d={});var c=e._parseInfo(d),h=c.tokens,g=c.bundle,c=c.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,""),c=(new RegExp("^"+c+"$")).exec(a);m.normalizeLocale(d.locale);if(!c)return null;var k=[1389,0,1,0,0,0,0],l="",n=["abbr","wide","narrow"];r.every(c,function(a,b){if(!b)return!0;var c=h[b-1],e=c.length;switch(c.charAt(0)){case "y":k[0]=Number(a);break;case "M":if(2<e){if(c=g["months-format-"+n[e-3]].concat(),d.strict||(a=a.replace(".",
"").toLowerCase(),c=r.map(c,function(a){return a?a.replace(".","").toLowerCase():a})),a=r.indexOf(c,a),-1==a)return!1}else a--;k[1]=Number(a);break;case "D":k[1]=0;case "d":k[2]=Number(a);break;case "a":c=d.am||g["dayPeriods-format-wide-am"];e=d.pm||g["dayPeriods-format-wide-pm"];if(!d.strict){var f=/\./g;a=a.replace(f,"").toLowerCase();c=c.replace(f,"").toLowerCase();e=e.replace(f,"").toLowerCase()}if(d.strict&&a!=c&&a!=e)return!1;l=a==e?"p":a==c?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":k[3]=
Number(a);break;case "m":k[4]=Number(a);break;case "s":k[5]=Number(a);break;case "S":k[6]=Number(a)}return!0});c=+k[3];"p"===l&&12>c?k[3]=c+12:"a"===l&&12==c&&(k[3]=0);return new b(k[0],k[1],k[2],k[3],k[4],k[5],k[6])};var a=[];e.addCustomFormats=function(b,e){a.push({pkg:b,name:e})};e._getIslamicBundle=function(b){var c={};r.forEach(a,function(a){a=m.getLocalization(a.pkg,a.name,b);c=n.mixin(c,a)},this);return c};e.addCustomFormats("dojo.cldr","islamic");e.getNames=function(a,b,d,g,k){var c;g=e._getIslamicBundle(g);
a=[a,d,b];"standAlone"==d&&(d=a.join("-"),c=g[d],1==c[0]&&(c=void 0));a[1]="format";return(c||g[a.join("-")]).concat()};e.weekDays=e.getNames("days","wide","format");e.months=e.getNames("months","wide","format");return e})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T,G,L,W,Q,H,v,J){return q("SummaryInfo",[n],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.baseLabel=""!==a.label?a.label:a.layerTitle?
a.layerTitle:a.layers},queryTabCount:function(b,c,e,d){var f=new m;this.incidentCount=b.length;var h=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(h=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var k;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?
(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(b,c,e,d,h).then(function(a){f.resolve(a)})):(k=new G(this.summaryLayer.url),k.infoTemplate=this.tab.tabLayers[0].infoTemplate,h=[k],this.tab.tabLayers=h,a(k,"load",g.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(b,c,e,d,h).then(function(a){f.resolve(a)})})))):this.loading||(k=new G(this.tab.tabLayers[0].url),this.loading=!0,a(k,"load",g.hitch(this,function(){this.summaryLayer=
k;this.summaryFields=this._getFields(this.summaryLayer);for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],g=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<g.length;l++){var m=g[l];if("undefined"!==typeof m.layerObject)if(m.layerObject.infoTemplates){if(m=m.layerObject.infoTemplates[a]){k.infoTemplate=m.infoTemplate;break}}else if(m.layerObject.infoTemplate){k.infoTemplate=m.layerObject.infoTemplate;break}}h=[k];this.tab.tabLayers=h;this.loading=!1;this._performQuery(b,c,e,d,h).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||
this._performQuery(b,c,e,d,h).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,e,d){var f=new m,h=[],k,l;0<b.length?l=J.getGeoms(b):0<a.length&&(l=J.getGeoms(a));this.summaryGeoms=l;if(0<l.length)for(a=0;a<l.length;a++)h=l[a],b=J.createDefArray(d,h),k=0===a?h=b:h=k.concat(b);(new u(h)).then(g.hitch(this,function(a){for(var b=0,d=0;d<a.length;d++){var h=a[d][1];isNaN(h)?h&&h.features?b+=h.features.length:h&&"undefined"!==typeof h.length&&(b+=h.length):b+=h}this.updateTabCount(b,
c,e);this.queryOnLoad&&g.hitch(this,this._queryFeatures(this.summaryGeoms));f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.featureCount=a;J.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(b,c,e,d,f,h,k){this.incidentCount=b.length;this.allFields="undefined"!==typeof h&&"undefined"!==typeof k?h?!0:k:!1;var l="undefined"!==typeof f,n;this.tabNum=d;l?n=new m:(this.container.innerHTML="",t.add(this.container,"loading"));this.summaryIds=
[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var q=this.summaryGeoms,r;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],r=new G(this.summaryLayer.url),r.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=r,this.summaryFields=this._getFields(this.tab.tabLayers[0]),l?this._queryFeatures(q,l).then(function(a){n.resolve(a)}):(this._initGraphicsLayer(e),g.hitch(this,this._queryFeatures(q)))):(r=new G(this.tab.tabLayers[0].url),
a(r,"load",g.hitch(this,function(){this.summaryLayer=r;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,c=0;c<b.length;c++){var d=b[c];if("undefined"!==typeof d.layerObject&&d.layerObject.infoTemplates&&(d=d.layerObject.infoTemplates[a])){r.infoTemplate=d.infoTemplate;break}}this.tab.tabLayers[1]=r;this.summaryFields=this._getFields(this.tab.tabLayers[1]);l?this._queryFeatures(q,l).then(function(a){n.resolve(a)}):
(this._initGraphicsLayer(e),g.hitch(this,this._queryFeatures(q)))})));if(l)return n}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(a,
b){var c;b&&(c=new m);var e=[],d=this.tab.tabLayers[0].id,f="";this.parent.opLayers.traversal(function(a){if(d===a.id&&a.getFilter())return f=a.getFilter(),!0});for(var h=new v,k=0;k<a.length;k++)h.geometry=a[k],h.where=f,e.push(this.summaryLayer.queryIds(h));(new u(e)).then(g.hitch(this,function(a){for(var e,d,f=0;f<a.length;f++)a[f][0]&&(e=a[f][1],d=e=0===f?e:d.concat(e));e?(this.summaryIds=e,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():
b||this._processResults()):b||this._processResults()}),g.hitch(this,function(a){console.error(a);new w({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new m);var e=this.summaryLayer.maxRecordCount||1E3,d=this.summaryIds.slice(0,e);this.summaryIds.splice(0,e);var f=new v,h=!1;r.some(this.summaryFields,g.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return h=!0}));a&&(h=!0);f.returnGeometry=h;f.outSpatialReference=this.parent.map.spatialReference;
var k=[];r.forEach(this.summaryFields,function(a){k.push(a.field)});this.symbolField&&k.push(this.symbolField);f.outFields=!0===this.config.csvAllFields||"true"===this.config.csvAllFields?["*"]:k;f.objectIds=d;for(c.push(this.summaryLayer.queryFeatures(f));0<this.summaryIds.length;)d=this.summaryIds.slice(0,e),this.summaryIds.splice(0,e),f.objectIds=d,c.push(this.summaryLayer.queryFeatures(f));(new u(c)).then(g.hitch(this,function(c){for(var e=0;e<c.length;e++)if(c[e][0]){var d=c[e][1];d.features&&
(this.summaryFeatures=this.summaryFeatures.concat(d.features))}a?this._processResults(a).then(g.hitch(this,function(a){this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing");b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing")}),g.hitch(this,function(a){console.error(a);new w({message:a})}));if(a)return b},_prepResults:function(){for(var a=
0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],c=b.field,e=b.total;switch(b.type){case "count":e=this.summaryFeatures.length;break;case "area":e=J.getArea(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "length":e=J.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "sum":e=J.getSum(this.summaryFeatures,c);break;case "avg":e=J.getSum(this.summaryFeatures,c)/this.summaryFeatures.length;
break;case "min":e=J.getMin(this.summaryFeatures,c);break;case "max":e=J.getMax(this.summaryFeatures,c)}b.total=e}},_processResults:function(b){this._prepResults();var c,d=this.summaryFields,f=0,h;if(b)c=new m;else{this.container.innerHTML="";t.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}h=k.create("div",{style:"width:"+220*(d.length+1)+"px;"},this.container);t.add(h,"SAT_tabPanelContent");var l=k.create("div",
{},h);t.add(l,"SATcolExport");t.add(l,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");l=k.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},l);t.add(l,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);a(l,"click",g.hitch(this,this._exportToCSV,d))}for(var l=[],n=0;n<d.length;n++){var q=d[n],r=z.stripHTML(q.alias?q.alias:"")+"\x3cbr/\x3e",f=q.alias===this.parent.nls.area||q.alias===this.parent.nls.length?q.total:Math.round(q.total);
isNaN(f)&&(f=0);q=e.format(f);if(b)l.push({num:q,info:r,total:f});else{f=k.create("div",{"class":"SATcol"},h);t.add(f,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var w=k.create("div",{style:"max-height: 60px;"},f);k.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:r},w);k.create("div",{"class":" colSummary",innerHTML:q},f)}}d=[];h=null!==this.graphicsLayer;!b&&h&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(n=
0;n<this.summaryFeatures.length;n++)r=this.summaryFeatures[n],this.lyrSymbol?r.symbol=this.lyrSymbol:h&&this.graphicsLayer.renderer?(q=this.graphicsLayer.renderer.getSymbol(r),r.symbol=q):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(r.symbol=this.summaryLayer.renderer.getSymbol(r)),!b&&h?(this.graphicsLayer.add(r),this.tab.tabLayers[1].add(r)):d.push(r);!b&&h&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",
{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(b)return c.resolve({graphics:d,analysisResults:l,context:this}),c},_exportToCSV:function(a,b,c,e){a=J.exportToCSV(this.summaryFeatures,b,c,e,{type:"summary",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields});this.summaryLayer=a.summaryLayer;return a.details},
_getFields:function(a){var b=J.getSkipFields(a),c=[];if("undefined"!==typeof this.tab.advStat){var e=this.tab.advStat.stats,d;for(d in e)0<e[d].length&&r.forEach(e[d],function(a){c.push({field:a.expression,alias:a.label+"",type:d,total:0})})}else{if(a.infoTemplate)e=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var f=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,e=null,k=0;k<h.length;k++){var l=
h[k];if(l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[f])){e=l.infoTemplate.info.fieldInfos;break}}else e=a.fields;e||(e=a.fields);for(f=0;f<e.length;f++)if(h=e[f],"undefined"!==typeof a.fields){var k=a.fields[f].type,m;h.name===a.objectIdField||"esriFieldTypeDouble"!==k&&"esriFieldTypeInteger"!==k&&"esriFieldTypeSmallInteger"!==k||("undefined"!==typeof h.visible?h.visible&&(m={field:h.fieldName,alias:h.label,type:"sum",total:0}):m={field:h.name,alias:h.alias,type:"sum",total:0},m&&
-1===b.indexOf(m.field)&&c.push(m),m=null)}}this.calcFields=g.clone(c);if(this.allFields)for(e=0;e<a.fields.length;e++){m=a.fields[e];f=!0;h=0;b:for(;h<c.length;h++)if(m.name===c[h].field){f=!1;break b}-1===b.indexOf(m.name)&&f&&c.push({field:m.name,alias:m.alias,type:m.type})}a=J.getSpecialFields(a);this.dateFields=a.dateFields;this.specialFields=a.specialFields;this.typeIdField=a.typeIdField;this.types=a.types;return c}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has esri/tasks/query esri/geometry/geometryEngine esri/geometry/Polyline ./CSVUtils jimu/utils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x){function l(b){return function(a,c){return a.attributes[b]<c.attributes[b]?-1:a.attributes[b]>c.attributes[b]?1:0}}return{getFields:function(b,a,c,d){var e=this.getSkipFields(b),h=[];if(!c&&a.advStat&&a.advStat.stats&&a.advStat.stats.outFields&&0<a.advStat.stats.outFields.length)q.forEach(a.advStat.stats.outFields,function(a){h.push(a.expression)});else{if(b.infoTemplate)a=b.infoTemplate.info.fieldInfos;else if(0<d.map.itemInfo.itemData.operationalLayers.length){d=d.map.itemInfo.itemData.operationalLayers;
a=null;var g=0;a:for(;g<d.length;g++){var k=d[g];if("ArcGISMapServiceLayer"===k.layerType&&"undefined"!==typeof k.layers)for(var l=0;l<k.layers.length;l++){var m=k.layers[l];if(m.id===b.layerId&&m.popupInfo){a=m.popupInfo.fieldInfos;break a}}}a||(a=b.fields)}else a=b.fields;if(a)for(d=0;d<a.length;d++)g=a[d],c||"undefined"===typeof g.visible?(g=g.name?g.name:g.fieldName,-1===e.indexOf(g)&&h.push(g)):g.visible&&-1===e.indexOf(g.fieldName)&&h.push(g.fieldName)}b=this.getSpecialFields(b);return{dateFields:b.dateFields,
specialFields:b.specialFields,typeIdField:b.typeIdField,types:b.types,fields:3<h.length&&!c?h.slice(0,3):h,allFields:h}},getField:function(b,a){for(var c=0;c<b.length;c++){var e=b[c];if(e.name===a||e.alias===a)return e}},getFieldValue:function(b,a,c,d,f,g,k){var e=a;c[b]&&(c=c[b],e="esriFieldTypeDate"===c.type?x.fieldFormatter.getFormattedDate(new Date(a),"undefined"!==d[b]?{dateFormat:d[b]}:{dateFormat:f}):b===g?x.fieldFormatter.getTypeName(a,k):x.fieldFormatter.getCodedValue(c.domain,a));return e},
getSkipFields:function(b){var a=[];if(b.fields)for(var c=0;c<b.fields.length;c++){var e=b.fields[c];e&&e.type&&e.name&&"esriFieldTypeGeometry"===e.type&&a.push(e.name)}b.globalIdField&&""!==b.globalIdField&&a.push(b.globalIdField);b.objectIdField&&""!==b.objectIdField&&a.push(b.objectIdField);return a},getSpecialFields:function(b){var a={},c=[];b.fields&&q.forEach(b.fields,n.hitch(this,function(e){if("esriFieldTypeDate"===e.type||e.domain||e.name===b.typeIdField){if("esriFieldTypeDate"===e.type&&
b.infoTemplate)for(var d in b.infoTemplate._fieldsMap)"undefined"!==typeof b.infoTemplate._fieldsMap[d].fieldName&&b.infoTemplate._fieldsMap[d].fieldName===e.name&&b.infoTemplate._fieldsMap[d].format&&"undefined"!==typeof b.infoTemplate._fieldsMap[d].format.dateFormat&&(c[e.name]=b.infoTemplate._fieldsMap[d].format.dateFormat);a[e.name]=e}}));return{specialFields:a,dateFields:c,typeIdField:b.typeIdField,types:b.types}},getSummaryFields:function(){},getPopupFields:function(b){var a=[];0<b.tabLayers.length&&
q.forEach(b.tabLayers,n.hitch(this,function(b){var c=this.getSkipFields(b);"undefined"!==typeof b.popupInfo?q.forEach(b.popupInfo.fieldInfos,n.hitch(this,function(b){if(b.visible&&-1===c.indexOf(b.fieldName)){var e={value:0};e.expression=b.fieldName;e.label=b.label;a.push(e)}})):b.infoTemplate&&q.forEach(b.infoTemplate.info.fieldInfos,n.hitch(this,function(b){if(b.visible&&-1===c.indexOf(b.fieldName)){var e={value:0};e.expression=b.fieldName;e.label=b.label;a.push(e)}}))}));return a},getDisplayFields:function(b){var a;
"undefined"!==typeof b.advStat&&"undefined"!==typeof b.advStat.stats&&"undefined"!==typeof b.advStat.stats.outFields?a=b.advStat.stats.outFields:(a=[],0<b.tabLayers.length&&q.forEach(b.tabLayers,n.hitch(this,function(b){"undefined"!==typeof b.popupInfo?q.forEach(b.popupInfo.fieldInfos,n.hitch(this,function(b){if(b.visible){var c={value:0};c.expression=b.fieldName;c.label=b.label;a.push(c)}})):b.infoTemplate?q.forEach(b.infoTemplate.info.fieldInfos,n.hitch(this,function(b){if(b.visible){var c={value:0};
c.expression=b.fieldName;c.label=b.label;a.push(c)}})):q.forEach((b.layerObject?b.layerObject:b).fields,n.hitch(this,function(b){var c={value:0};c.expression=b.name;c.label=b.alias;a.push(c)}))})));return a},exportToCSV:function(b,a,c,d,f){if(0===b.length)return!1;var e=f.baseLabel,h=[],g=[];"proximity"===f.type&&b.sort(this.compareDistance);var l;"undefined"===typeof a.altKey?l=a:(l=!1,c=f.csvAllFields);q.forEach(b,function(a){"proximity"!==f.type&&"closest"!==f.type||delete a.attributes.DISTANCE;
h.push(a.attributes)});if("summary"===f.type||"grouped"===f.type)if(!0===f.csvAllFields||"true"===f.csvAllFields)for(var m in h[0])g.push(m);else for(b=0;b<f.summaryFields.length;b++)g.push(f.summaryFields[b].field);else for(var t in h[0])g.push(t);b=f.layer;m=b.fields;if(b&&b.loaded&&m||l){t=a?[]:this.getSkipFields(b);var r={};if(f.opLayers&&f.opLayers._layerInfos){var u=f.opLayers.getLayerInfoById(b.id);u&&(r.popupInfo=u.getPopupInfo())}var u=[],x=0;for(;x<g.length;x++){var L=g[x];if(-1===t.indexOf(L)){var W=
!1,Q,H=0;b:for(;H<m.length;H++)if(Q=m[H],Q.name===L){W=!0;break b}W?u.push(Q):u.push({name:L,alias:L,show:!0,type:"esriFieldTypeString"})}}r.datas=h;r.fromClient=!1;r.withGeometry=!1;r.outFields=u;r.formatDate=!0;r.formatCodedValue=!0;r.formatNumber=!1;var v=[],J=[];if(!a&&c&&"undefined"!==typeof d)switch(f.type){case "proximity":v.push(f.nlsCount);J.push(d);break;case "closest":var B=0;q.forEach(d,n.hitch(this,function(a){0===B&&(q.forEach(a,function(a){v.push(a.label)}),B+=1);var b=[];q.forEach(a,
function(a){b.push(a.value)});J.push(b)}));break;case "summary":q.forEach(d,n.hitch(this,function(a){var b=a.info.replace("\x3cbr/\x3e",""),c=!1,e=0;a:for(;e<f.calcFields.length;e++)if(b===f.calcFields[e].alias){c=!0;break a}c&&(v.push(b),J.push(a.total))}));break;case "grouped":q.forEach(d,function(a){v.push(a.info.replace("\x3cbr/\x3e",""));J.push(a.total)})}if(l)return{summaryLayer:b,details:u};k.exportCSVFromFeatureLayer(e,b,r);return{summaryLayer:b,details:{appendColumns:v,appendDatas:J,name:e,
type:f.nlsValue}}}k.exportCSV(e,h,g)},isURL:function(b){return/(https?:\/\/|ftp:)/g.test(b)},isEmail:function(b){return/\S+@\S+\.\S+/.test(b)},queryTabCount:function(){},performQuery:function(){},getGeoms:function(e){for(var a=[],c=[],d=0;d<e.length;d++){var f=e[d].geometry?e[d].geometry:e[d];if("polygon"===f.type&&-1===a.indexOf(d)){for(var g=0;g<e.length;g++)if(g!==d&&-1===a.indexOf(g)){var k=e[g].geometry?e[g].geometry:e[g];"polygon"===k.type?b.intersects(f,k)&&(a.push(g),f=b.union(f,k)):a.push(g)}c.push(f)}}return c},
createDefArray:function(b,a){for(var c=[],e=0;e<b.length;e++){var f=b[e];if(f){var g=new d;g.returnGeometry=!1;g.geometry=a;"undefined"!==typeof f.queryCount?c.push(f.queryCount(g)):"undefined"!==typeof f.queryIds?c.push(f.queryIds(g)):"undefined"!==typeof f.queryFeatures&&c.push(f.queryFeatures(g))}}return c},updateTabCount:function(b,a,c,d,f){var e="undefined"!==typeof f&&0<f?!0:!1;f=u.position(a).w;"undefined"!==typeof b&&0===b?(r.remove(a,"noFeatures"),r.remove(a,"noFeaturesActive"),r.add(a,e?
"noFeaturesActive":"noFeatures")):(e&&r.contains(a,"noFeatures")&&r.remove(a,"noFeatures"),e&&r.contains(a,"noFeaturesActive")&&r.remove(a,"noFeaturesActive"));c&&(b="undefined"!==typeof b?d+" ("+x.localizeNumber(b).toString()+")":d,a.innerHTML=b);c=u.position(a).w;b=0;var g;c>f?(g=!0,b=c-f):f>c&&(g=!1,b=f-c);f=u.position(a.parentNode).w;if(0<f){g=g?f+b:f-b;m.set(a.parentNode,"width",g+"px");a=a.parentNode.parentNode;f=a.parentNode;var h;if(f&&f.children&&0<f.children.length)for(b=0;b<f.children.length;b++)if(c=
f.children[b],-1<c.className.indexOf("SA_panelRight")){h=c;break}h&&a&&(g>u.position(f).w?(m.set(a,"right","58px"),m.set(h,"display","block")):(m.set(a,"right","24px"),m.set(h,"display","none")))}},getSum:function(b,a){var c=0;q.forEach(b,function(b){c+=b.attributes[a]});return c},getMin:function(b,a){b.sort(l(a));return b[0].attributes[a]},getMax:function(b,a){b.sort(l(a));b.reverse();return b[0].attributes[a]},getArea:function(d,a,c,g){var e=0;c=n.clone(c);c.miles=109413;c.kilometers=109414;c.feet=
109405;c.meters=109404;c.yards=109442;c.nauticalMiles=109409;var h=c[g];q.forEach(d,function(c){for(var d=0;d<a.length;d++){var f=b.intersect(c.geometry,a[d]);null!==f&&(e+=b.geodesicArea(f,h))}});return e},getLength:function(d,a,c,g){var e=0,h=c[g];q.forEach(d,function(c){for(var d=0;d<a.length;d++){var f=b.intersect(c.geometry,a[d]);null!==f&&(e+=b.geodesicLength(f,h))}});return e},getDistance:function(d,a,c){var e="point"!==d.type?d.getExtent().getCenter():d;a="point"!==a.type?a.getExtent().getCenter():
a;e=new t([[e.x,e.y],[a.x,a.y]]);e.spatialReference=d.spatialReference;c="nauticalMiles"===c?"nautical-miles":c;return 4326!==d.spatialReference.wkid&&!d.spatialReference.isWebMercator()||g("safari")?b.planarLength(e,c):b.geodesicLength(e,c)},compareDistance:function(b,a){return b.attributes.DISTANCE<a.attributes.DISTANCE?-1:b.attributes.DISTANCE>a.attributes.DISTANCE?1:0}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),
function(q,n,r,u,m,g,d,b,t,k){function x(b){var d=n.clone(b.attributes);(b=b.geometry)&&"point"===b.type&&("x"in d?d._x=b.x:d.x=b.x,"y"in d?d._y=b.y:d.y=b.y);return d}q.exportCSV=function(b,d,a,c,g){return q._createCSVStr(d,a,c,g).then(function(a){return q._download(b+".csv",a)})};q.exportCalculatedResultsCSV=function(b,d){var a="",c=0;r.forEach(d,function(e){a+=e.name+" ("+e.type+")\r\n";q._createCSVStr([],[],e.appendColumns,e.appendDatas).then(function(e){a+=e;c++;if(c===d.length)return q._download(b+
".csv",a);a+="\r\n\r\n"})})};q.exportCSVFromFeatureLayer=function(b,d,a){a=a||{};return q._getExportData(d,{datas:a.datas,fromClient:a.fromClient,withGeometry:a.withGeometry,outFields:a.outFields,filterExpression:a.filterExpression}).then(function(c){return q._formattedData(d,c,{formatNumber:a.formatNumber,formatDate:a.formatDate,formatCodedValue:a.formatCodedValue,popupInfo:a.popupInfo,appendColumns:a.appendColumns,appendDatas:a.appendDatas}).then(function(a){return q.exportCSV(b,a.datas,a.columns,
a.appendColumns,a.appendDatas)})})};q.exportCSVByAttributes=function(b,d,a,c){c=n.mixin({},c);c.datas=a;return q.exportCSVFromFeatureLayer(b,d,c)};q.exportCSVByGraphics=function(b,d,a,c){a=r.map(a,function(a){return a.attributes});return q.exportCSVByAttributes(b,d,a,c)};q._createCSVStr=function(b,d,a,c){var e=new g,f="",k=0,l=0,m="",n="";try{if(d&&0<d.length){r.forEach(d,function(a){f=f+m+a;m=","});for(var f=f+"\r\n",k=b.length,l=d.length,t=0;t<k;t++){for(var m="",q=0;q<l;q++)(n=b[t][d[q]])||"number"===
typeof n||(n=""),n&&/[",\r\n]/g.test(n)&&(n='"'+n.replace(/(")/g,'""')+'"'),f=f+m+n,m=",";f+="\r\n"}}"undefined"!==typeof a&&"undefined"!==typeof c&&0<a.length&&0<c.length&&(m="",r.forEach(a,function(a){f=f+m+a;m=","}),m="",f+="\r\n",r.forEach(c,function(a){Array.isArray(a)?(r.forEach(a,function(a){f=f+m+a;m=","}),m="",f+="\r\n"):(f=f+m+a,m=",")}));e.resolve(f)}catch(K){console.error(K),e.resolve("")}return e};q._isIE11=function(){return 11===d.has("ie")};q._isEdge=function(){return d.has("edge")};
q._getDownloadUrl=function(b){return window.Blob&&window.URL&&window.URL.createObjectURL?(b=new Blob(["\ufeff"+b],{type:"text/csv"}),URL.createObjectURL(b)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(b)};q._download=function(b,d){var a=new g;try{if(m("ie")&&10>m("ie")){var c=window.top.open("about:blank","_blank");c.document.write("sep\x3d,\r\n"+d);c.document.close();c.document.execCommand("SaveAs",!0,b);c.close()}else if(10===m("ie")||q._isIE11()||q._isEdge()){var e=new Blob(["\ufeff"+
d],{type:"text/csv"});navigator.msSaveBlob(e,b)}else{var f=u.create("a",{href:q._getDownloadUrl(d),target:"_blank",download:b},document.body);if(m("safari")){var k=document.createEvent("MouseEvents");k.initEvent("click",!0,!0);f.dispatchEvent(k)}else f.click();u.destroy(f)}a.resolve()}catch(w){a.reject(w)}return a};q._getExportData=function(b,d){var a=new g,c=null,e=d.datas,f=d.withGeometry,c=d.outFields;c&&c.length||(c=b.fields);c=n.clone(c);if(f&&!(e&&0<e.length)){var k="",k=-1!==c.indexOf("x")?
"_x":"x";c.push({name:k,alias:k,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});k=-1!==c.indexOf("y")?"_y":"y";c.push({name:k,alias:k,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}e&&0<e.length?a.resolve({data:e||[],outFields:c}):d.fromClient?(e=r.map(b.graphics,function(a){return f?x(a):n.clone(a)}),a.resolve({data:e||[],outFields:c})):q._getExportDataFromServer(b,c,d).then(function(b){a.resolve({data:b||[],outFields:c})});return a};q._getExportDataFromServer=
function(b,d,a){var c=new g;if("esri.layers.FeatureLayer"!==b.declaredClass)return c.resolve([]),c;var e=new t(b.url),f=new k;f.where=a.filterExpression||b.getDefinitionExpression&&b.getDefinitionExpression()||"1\x3d1";0<d.length?(b=r.map(d,function(a){return a.name}),f.outFields=b):f.outFields=["*"];f.returnGeometry=a.withGeometry;e.execute(f,function(a){a=r.map(a.features,function(a){return x(a)});c.resolve(a)},function(a){console.error(a);c.resolve([])});return c};q._formattedData=function(b,d,
a){var c=new g,e=[],f=d.data;d=d.outFields;for(var k=0,m=f.length;k<m;k++){for(var l={},n=0;n<d.length;n++){var t=d[n];l[t.alias||t.name]=q._getExportValue(f[k][t.name],t,b.objectIdField,b.typeIdField,f[k][b.typeIdField],b.types,a)}e.push(l)}b=r.map(d,function(a){return a.alias||a.name});c.resolve({datas:e,columns:b,appendColumns:a.appendColumns,appendDatas:a.appendDatas});return c};q._getExportValue=function(g,e,a,c,h,f,k){function m(a){if(l&&b.isDefined(l.fieldInfos))for(var c=0,d=l.fieldInfos.length;c<
d;c++){var e=l.fieldInfos[c];if(e.fieldName===a)return e.format}return null}var l=k.popupInfo,n=!!e.domain&&k.formatCodedValue;k="esriFieldTypeDate"===e.type&&k.formatDate;var t=a&&e.name===a;c=c&&e.name===c;return k?d.fieldFormatter.getFormattedDate(g,m(e.name)):c?d.fieldFormatter.getTypeName(g,f):n?d.fieldFormatter.getCodedValue(e.domain,g):n||k||t||c?g:(n=null,a&&f&&0<f.length&&(a=(a=r.filter(f,function(a){return a.id===h}))&&a[0])&&a.domains&&a.domains[e.name]&&a.domains[e.name].codedValues&&
(n=d.fieldFormatter.getCodedValue(a.domains[e.name],g)),null!==n?n:g)}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T,G,L,W,Q,H,v,J){return q("GroupedCountInfo",[n],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.specialFields=
{};this.typeIdField="";this.types=[];this.dateFields={};this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(b,c,d,e){var f=new m;this.displayCount=e;this.incidentCount=b.length;var h=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(h=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var k;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?
(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)})):(k=new G(this.summaryLayer.url),k.infoTemplate=this.tab.tabLayers[0].infoTemplate,h=[k],this.tab.tabLayers=h,a(k,"load",g.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)})})))):
this.loading||(k=new G(this.tab.tabLayers[0].url),this.loading=!0,a(k,"load",g.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],g=this.parent.map.itemInfo.itemData.operationalLayers,m=0;m<g.length;m++){var l=g[m];if("undefined"!==typeof l.layerObject&&l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[a])){k.infoTemplate=l.infoTemplate;break}}h=[k];this.tab.tabLayers=h;this.loading=!1;
this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,d,e){var f=new m,h=[],k,l;0<b.length?l=J.getGeoms(b):0<a.length&&(l=J.getGeoms(a));this.summaryGeoms=l;if(0<l.length)for(a=0;a<l.length;a++)h=l[a],b=J.createDefArray(e,h),k=0===a?h=b:h=k.concat(b);(new u(h)).then(g.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var h=a[e][1];isNaN(h)?h&&h.features?b+=h.features.length:
h&&"undefined"!==typeof h.length&&(b+=h.length):b+=h}this.updateTabCount(b,c,d);this.queryOnLoad&&g.hitch(this,this._queryFeatures(this.summaryGeoms));f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.displayCount=c;this.featureCount=a;J.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(b,c,d,e,f,h,k){this.incidentCount=b.length;this.allFields="undefined"!==typeof h&&"undefined"!==typeof k?h?!0:k:!1;var l="undefined"!==typeof f,n;this.tabNum=
e;l?n=new m:(this.container.innerHTML="",t.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var q=[];if(0<c.length)q=c;else for(c=0;c<b.length;c++)e=b[c].geometry?b[c].geometry:b[c],"polygon"===e.type&&q.push(e);var r;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],r=new G(this.summaryLayer.url),r.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=r,this.summaryFields=
this._getFields(this.tab.tabLayers[0]),l?this._queryFeatures(q,l).then(function(a){n.resolve(a)}):(this._initGraphicsLayer(d),g.hitch(this,this._queryFeatures(q,l)))):(r=new G(this.tab.tabLayers[0].url),a(r,"load",g.hitch(this,function(){this.summaryLayer=r;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,c=0;c<b.length;c++){var e=b[c];if("undefined"!==typeof e.layerObject&&e.layerObject.infoTemplates&&
(e=e.layerObject.infoTemplates[a])){r.infoTemplate=e.infoTemplate;break}}this.tab.tabLayers[1]=r;this.summaryFields=this._getFields(this.tab.tabLayers[1]);l?this._queryFeatures(q,l).then(function(a){n.resolve(a)}):(this._initGraphicsLayer(d),g.hitch(this,this._queryFeatures(q)))})));if(l)return n}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&(this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=
this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol),null===this.specialFields&&J.getSpecialFields(this.summaryLayer)))},_queryFeatures:function(a,b){var c;b&&(c=new m);var d=[],e=this.tab.tabLayers[0].id,f="";this.parent.opLayers.traversal(function(a){if(e===a.id&&a.getFilter())return f=a.getFilter(),!0});for(var h=new v,k=0;k<a.length;k++)h.geometry=a[k],h.where=f,d.push(this.summaryLayer.queryIds(h));
(new u(d)).then(g.hitch(this,function(a){for(var d,e,f=0;f<a.length;f++)a[f][0]&&(d=a[f][1],e=d=0===f?d:e.concat(d));d?(this.summaryIds=d,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():b||this._processResults()):b||this._processResults()}),g.hitch(this,function(a){console.error(a);new w({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new m);var d=this.summaryLayer.maxRecordCount||1E3,e=this.summaryIds.slice(0,
d);this.summaryIds.splice(0,d);var f=new v,h=!1;r.some(this.summaryFields,g.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return h=!0}));a&&(h=!0);f.returnGeometry=h;f.outSpatialReference=this.parent.map.spatialReference;var k=[];r.forEach(this.summaryFields,function(a){k.push(a.field)});this.symbolField&&k.push(this.symbolField);if(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)f.outFields=["*"];else{if(0<this.popupFields.length)for(var l=0;l<
this.popupFields.length;l++){var n=this.popupFields[l];-1===k.indexOf(n)&&k.push(n)}f.outFields=k}f.objectIds=e;for(c.push(this.summaryLayer.queryFeatures(f));0<this.summaryIds.length;)e=this.summaryIds.slice(0,d),this.summaryIds.splice(0,d),f.objectIds=e,c.push(this.summaryLayer.queryFeatures(f));(new u(c)).then(g.hitch(this,function(c){for(var d=0;d<c.length;d++)if(c[d][0]){var e=c[d][1];e.features&&(this.summaryFeatures=this.summaryFeatures.concat(e.features))}a?this._processResults(a).then(g.hitch(this,
function(a){this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing");b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&t.replace(this.SA_SAT_download,"download","processing")}),g.hitch(this,function(a){console.error(a);new w({message:a})}));if(a)return b},_prepGroupedResults:function(){for(var a=0;a<this.summaryFeatures.length;a++){var b=this.summaryFeatures[a];if("undefined"!==typeof this.summaryFields&&
0<this.summaryFields.length){var c=J.getFieldValue(this.summaryFields[0].field,b.attributes[this.summaryFields[0].field],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types),c="undefined"!==typeof c&&null!==c?z.stripHTML(c.toString()):"";c in this.groupedResults?this.groupedResults[c].features.push(b):this.groupedResults[c]={features:[b]}}}},_prepResults:function(){for(var a in this.groupedResults){var b=this.summaryFields[0];b.total=this.groupedResults[a].features.length;
this.groupedResults[a].total=b.total;this.groupedResults[a].type=b.type;this.groupedResults[a].label=b.alias}},_processResults:function(b){this._prepGroupedResults();this._prepResults();var c=this.groupedResults,d=0,f,h;if(b)h=new m;else{this.container.innerHTML="";t.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var l=Object.keys(this.groupedResults).length+1;f=k.create("div",{style:"width:"+220*l+"px;"},
this.container);t.add(f,"SAT_tabPanelContent");l=k.create("div",{},f);t.add(l,"SATcolExport");t.add(l,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");l=k.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},l);t.add(l,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);a(l,"click",g.hitch(this,this._exportToCSV,c))}var n=Object.keys(c).sort(),l=[];this.displayCount&&l.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,
c:void 0});for(var q in n){var d=n[q],r=c[d],v=z.stripHTML(d.toString()),d=d===this.parent.nls.area||d===this.parent.nls.length?r.total:Math.round(r.total);isNaN(d)&&(d=0);var d=e.format(d),C="pre"===r.type?r.label.trim():v,v="pre"===r.type?v:r.label.trim(),r=""!==r.label?"colGroupedSummary":"colSummary";if(b)l.push({total:d,a:C,info:""===v?C:v,c:r});else{var u=k.create("div",{"class":"SATcol"},f);t.add(u,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var w=k.create("div",{style:"max-height: 45px;"},
u);k.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:C},w);k.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:v},w);k.create("div",{"class":r,innerHTML:d},u)}}c=[];q=null!==this.graphicsLayer;!b&&q&&(this.graphicsLayer.clear(),this.tab.tabLayers[1]&&this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(f=0;f<this.summaryFeatures.length;f++)n=this.summaryFeatures[f],this.lyrSymbol?n.symbol=this.lyrSymbol:this.graphicsLayer?
this.graphicsLayer.renderer&&(d=this.graphicsLayer.renderer.getSymbol(n),n.symbol=d):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(n.symbol=this.summaryLayer.renderer.getSymbol(n)),!b&&q?(this.graphicsLayer.add(n),this.tab.tabLayers[1].add(n)):c.push(n);!b&&q&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(b)return h.resolve({graphics:c,analysisResults:l,
context:this}),h},_exportToCSV:function(a,b,c,d){a=J.exportToCSV(this.summaryFeatures,b,c,d,{type:"grouped",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){var b=J.getSkipFields(a),c,d=[];if("undefined"!==typeof this.tab.advStat){var e=this.tab.advStat.stats,
f;for(f in e)0<e[f].length&&r.forEach(e[f],function(a){var b={field:a.expression,alias:a.label+"",type:f,total:0};c=a.expression;d.push(b)})}e=J.getSpecialFields(a);this.dateFields=e.dateFields;this.specialFields=e.specialFields;this.typeIdField=e.typeIdField;this.types=e.types;if(this.allFields)for(e=0;e<a.fields.length;e++){var g=a.fields[e];-1===b.indexOf(g.name)&&c!==g.name&&d.push({field:g.name,alias:g.alias,type:g.type})}return d}})})},"widgets/SituationAwareness/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),
function(q,n,r,u,m,g){return q("WeatherInfo",null,{constructor:function(d,b,g){this.tab=d;this.container=b;this.parent=g;this.weatherURL=d.url;this.weatherDict={119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain",
"light_rain.png","light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle","light_rain.png","light_rain.png"],263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet",
"sleet.png","sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain","sleet.png","sleet.png"],311:["Light freezing rain","sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow",
"snow4.png","snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],371:["Moderate or heavy snow showers","snow5.png","snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],
356:["Moderate or heavy rain shower","shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png","snow3_night.png"],329:["Patchy moderate snow","snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby",
"tstorm1.png","tstorm1_night.png"],179:["Patchy snow nearby","snow1.png","snow1_night.png"],176:["Patchy rain nearby","shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},queryTabCount:function(d,b,g){this.updateTabCount(this.parent.incidents.length,g,!1)},updateTabCount:function(d,b){d=this.parent.incidents.length;"undefined"!==typeof d&&0===d?r.contains(b,"noFeatures")||
r.add(b,"noFeatures"):r.contains(b,"noFeatures")&&r.remove(b,"noFeatures")},updateForIncident:function(d){this.container.innerHTML="";r.add(this.container,"loading");d=d.y+","+d.x;var b="";"Weather"!==this.tab.label?(b=this.weatherURL,this.container.innerHTML="\x3cimg style\x3d'height:100%;' src\x3d'"+this.weatherURL+"' /\x3e"):(b=this.weatherURL+"\x26q\x3d"+d,g({url:b,callbackParamName:"callback"},{useProxy:!1}).then(n.hitch(this,function(b){return this._resultsHandler(b)}),n.hitch(this,function(b){b=
this._errorHandler(b);console.log(b)})))},_resultsHandler:function(d){d=d.data;console.log(d);var b=d.current_condition;d=d.weather;var g=1;this.container.innerHTML="";r.remove(this.container,"loading");var k=u.create("div",{style:"width:"+165*(d.length+3)+"px;"},this.container);r.add(k,"SAT_tabPanelContent");var m=this.parent.config.celsius?"C":"F",l,e;if(0<b.length){b=b[0];l=b.localObsDateTime.split(" ");e=l[2];l=l[1].split(":");l=parseInt(l[0],10);if("AM"===e){if(6>l||12===l)g=2}else 6<l&&12>l&&
(g=2);e=b.temp_F;this.parent.config.celsius&&(e=b.temp_C);l=b.weatherCode;l=this.weatherDict[parseInt(l,10)];l=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+l[g]+"' /\x3e\x3cbr/\x3e"+e+"\x26deg;"+m;e=u.create("div",{innerHTML:l},k);r.add(e,"SATcolSmall");r.add(e,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");e=b.windspeedMiles;l=" mph";this.parent.config.celsius&&(e=b.windspeedKmph,l=" km/h");l=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+
b.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+e+l;b=u.create("div",{innerHTML:l},k);r.add(b,"SATcolSmall");r.add(b,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}for(e=0;e<d.length;e++){var b=d[e],a=this._getDay(b.date),c=b.tempMaxF||b.maxtempF,h=b.tempMinF||b.mintempF;this.parent.config.celsius&&(c=b.tempMaxC||b.maxtempC,h=b.tempMinC||b.mintempC);l=b.weatherCode;l=this.weatherDict[parseInt(l,10)];l=a+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+
l[g]+"' /\x3e\x3cbr/\x3e"+c+"\x26deg;"+m+" | "+h+"\x26deg;"+m;b=u.create("div",{innerHTML:l},k);r.add(b,"SATcolSmall");r.add(b,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}d=u.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3e'+this.parent.nls.poweredBy+'\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"http://www.worldweatheronline.com/" title\x3d"Free Weather API" target\x3d"_blank"\x3eWorld Weather Online\x3c/a\x3e\x3c/span\x3e'},
k);r.add(d,"SATcolSmall");r.add(d,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");r.add(d,"SATcolLast")},_getDay:function(d){d=d.split("-");d="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(d[0],d[1]-1,d[2])).getDay()];return this.parent.nls[d]},_errorHandler:function(d){console.log(d.message);d=u.create("div",{innerHTML:d.message},this.container);r.add(d,"SATcolSmall");r.add(d,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F){return q("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.map=c.map;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,d){var f=new g;this.incidentCount=
a.length;var k=this.parent.config.distanceSettings[this.parent.config.distanceUnits],m=this.parent.config.maxDistance;b=[];for(var l=0;l<a.length;l++)b.push(e.buffer(a[l].geometry,m,k));var r=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(r=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var q;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=
this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,d,r).then(function(a){f.resolve(a)})):(q=new h(this.summaryLayer.url),q.infoTemplate=this.tab.tabLayers[0].infoTemplate,r=[q],this.tab.tabLayers=r,x(q,"load",n.hitch(this,function(){this.summaryLayer=q;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,d,r).then(function(a){f.resolve(a)})})))):this.loading||
(q=new h(this.tab.tabLayers[0].url),this.loading=!0,x(q,"load",n.hitch(this,function(){this.summaryLayer=q;this.summaryFields=this._getFields(this.summaryLayer);for(var e=this.tab.tabLayers[0].url.split("MapServer/")[1],g=this.parent.map.itemInfo.itemData.operationalLayers,h=0;h<g.length;h++){var k=g[h];if("undefined"!==typeof k.layerObject&&k.layerObject.infoTemplates&&(k=k.layerObject.infoTemplates[e])){q.infoTemplate=k.infoTemplate;break}}r=[q];this.tab.tabLayers=r;this.loading=!1;this._performQuery(a,
b,c,d,r).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,d,r).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,d,e){var f=new g,h=[],k,l;this.summaryGeoms=b;if(0<b.length)for(a=0;a<b.length;a++)h=b[a],l=F.createDefArray(e,h),k=0===a?h=l:h=k.concat(l);(new m(h)).then(n.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var g=a[e][1];isNaN(g)?g&&g.features?0<g.features.length&&(b+=1):g&&"undefined"!==typeof g.length&&0<g.length&&(b+=1):0<
g&&(b+=1)}this.updateTabCount(b,c,d);f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.featureCount=0===parseInt(a,10)?0:a;F.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,d,e,f){this.incidentCount=a.length;this.allFields="undefined"!==typeof e&&"undefined"!==typeof f?e?!0:f:!1;var k="undefined"!==typeof d,l;u.forEach(this.tab.tabLayers,n.hitch(this,function(e){if("undefined"!==typeof e.empty&&e.url){var f=new h(e.url);x(f,"load",
n.hitch(this,function(){this.tab.tabLayers=[f];k?(l=new g,this.processIncident(a,b,c,d).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}))}else k?(l=new g,this.processIncident(a,b,c,d).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}));if(k)return l},processIncident:function(b,c,f,h){this.incidents=b;var k,l="undefined"!==typeof h;
l?k=new g:(this.container.innerHTML="",d.add(this.container,"loading"));var q=[];h=this.parent.config.distanceSettings[this.parent.config.distanceUnits];for(var r=[],t=0;t<b.length;t++){var u=b[t].geometry,w=e.buffer(u,c,h);r.push({geometry:u,buffer:w})}(this.graphicsLayer=f)&&this.graphicsLayer.clear();b=[];c=this.tab.tabLayers[0];var C=this._getFields(c);for(f=0;f<r.length;f++)h=new I,h.returnGeometry=!0,h.outSpatialReference=this.parent.map.spatialReference,h.geometry=r[f].buffer,h.outFields="true"===
this.parent.config.csvAllFields||!0===this.parent.config.csvAllFields?["*"]:C,"undefined"!==typeof c.queryFeatures&&b.push(c.queryFeatures(h));(new m(b)).then(n.hitch(this,function(b){for(var c=0;c<b.length;c++)if(b[c][0]){var d=b[c][1].features,e=[],f=r[c].geometry;if(d&&0<d.length){for(var g=0;g<d.length;g++){for(var h=new a(d[g].toJson()),m=F.getDistance(f,h.geometry,this.parent.config.distanceUnits),t={DISTANCE:m},v=0;v<C.length;v++)t[C[v]]=h.attributes[C[v]];!0===this.config.csvAllFields||"true"===
this.config.csvAllFields?h.attributes.DISTANCE=m:h.attributes=t;e.push(h)}e.sort(F.compareDistance);q.push(e[0])}}else b[c][1]&&b[c][1].message&&console.log(b[c][1].message);q.sort(F.compareDistance);l?this._processResults(q,!0).then(n.hitch(this,function(a){k.resolve(a)})):this._processResults(q)}),n.hitch(this,function(a){console.error(a);k.reject(a)}));if(l)return k},_processResults:function(e,h){var m,q,u=e&&0<e.length;if(u&&"point"!==e[0].geometry.type)for(var C=e.length-1;0<=C;C--)"undefined"===
typeof e[C].geometry.getExtent()&&e.splice(C,1);h?m=new g:(this.container.innerHTML="",d.remove(this.container,"loading"),u&&(q=b.create("div",{"class":"SAT_tabPanelContent"},this.container),C=b.create("div",{},q),d.add(C,"SATcolExport"),d.add(C,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),C=b.create("div",{title:this.parent.nls.downloadCSV},C),d.add(C,"btnExport"),x(C,"click",n.hitch(this,this._exportToCSV,e))));var C=this.parent.nls[this.parent.config.distanceUnits],K=[],H=220;if(u)for(var v=
0;v<e.length;v++){var I=v+1,B=e[v],y=B.geometry,D=y;"point"!==y.type&&(D=y.getExtent().getCenter());var y=B.attributes,E;"point"===this.incidents[0].geometry.type&&(E=Math.round(100*y.DISTANCE)/100+" "+C+" ("+this.parent.nls.approximate+")");var V="",O=0,M=[];if("undefined"!==typeof this.displayFields)for(var U=0;U<this.displayFields.length;U++){var S=this.displayFields[U],N;a:for(N in y)if("DISTANCE"!==N&&3>O&&S.expression===N){var P=F.getFieldValue(N,y[N],this.specialFields,this.dateFields,"longMonthDayYear",
this.typeIdField,this.types),P="undefined"!==typeof P&&null!==P?l.stripHTML(P.toString()):"",S="undefined"!==typeof S.label?S.label:void 0,R=B._layer&&B._layer.fields?B._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;R&&(R=F.getField(R,N))&&(S=R.alias);if("undefined"===typeof S||S in[""," ",null,void 0])S=N;F.isURL(P)?P='\x3ca href\x3d"'+P+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+S+"\x3c/a\x3e":F.isEmail(P)&&(P='\x3ca href\x3d"mailto:'+P+'" style\x3d"color: inherit;"\x3e'+
S+"\x3c/a\x3e");V+=P+"\x3cbr/\x3e";O+=1;M.push({value:-1<P.indexOf(",")?P.replace(",",""):P,label:S});break a}}K.push(M);h||(B=b.create("div",{},q),d.add(B,"SATcolRec"),d.add(B,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),O=b.create("div",{},B),d.add(O,"SATcolRecBar"),M=b.create("div",{innerHTML:I},O),d.add(M,"SATcolRecNum"),k.set(M,"backgroundColor",this.parent.config.activeColor),x(M,"click",n.hitch(this,this._zoomToLocation,D)),E&&(M=b.create("div",{innerHTML:E},O),d.add(M,"SATcolDistance")),
this.parent.config.enableRouting&&(O=b.create("div",{title:this.parent.nls.get_directions},O),d.add(O,"SATcolDir"),x(O,"click",n.hitch(this,this._routeToIncident,D))),V=b.create("div",{"class":"SATcolWrap",innerHTML:V},B),d.add(V,"SATcolInfo"),H+=t.position(B).w,V=new z(z.STYLE_SOLID,new r.fromRgb(this.parent.config.activeMapGraphicColor),1),V=new f(f.STYLE_CIRCLE,24,V,new r.fromRgb(this.parent.config.activeMapGraphicColor)),B=new w,B.family="Arial",B.size="12px",I=new A(I,B,new c(this.parent.config.fontColor)),
I.setOffset(0,-4),this.graphicsLayer.add(new a(D,V,y)),this.graphicsLayer.add(new a(D,I,y)))}if(!h&&u)k.set(q,"width",H);else if(u)return m.resolve({graphics:e,analysisResults:K,context:this}),m},_exportToCSV:function(a,b,c,d){a=F.exportToCSV(a,b,c,d,{type:"closest",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},
_getFields:function(a){a=F.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=a.specialFields;this.typeIdField=a.typeIdField;this.types=a.types;this.displayFields=F.getDisplayFields(this.tab);return a.fields},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F){return q("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(b,c,d,e){var f=new g;this.incidentCount=b.length;
var h=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(h=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var k;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)})):
(k=new a(this.summaryLayer.url),k.infoTemplate=this.tab.tabLayers[0].infoTemplate,h=[k],this.tab.tabLayers=h,x(k,"load",n.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)})})))):this.loading||(k=new a(this.tab.tabLayers[0].url),this.loading=!0,x(k,"load",n.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],
g=this.parent.map.itemInfo.itemData.operationalLayers,h=0;h<g.length;h++){var l=g[h];if("undefined"!==typeof l.layerObject&&l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[a])){k.infoTemplate=l.infoTemplate;break}}this.tab.tabLayers=[k];this.loading=!1;this._performQuery(b,c,d,e,this.tab.tabLayers).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(b,c,d,e,h).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,d,e){var f=new g,h=[],k,l;0<b.length?
l=F.getGeoms(b):0<a.length&&(l=F.getGeoms(a));this.summaryGeoms=l;if(0<l.length)for(a=0;a<l.length;a++)h=l[a],b=F.createDefArray(e,h),k=0===a?h=b:h=k.concat(b);(new m(h)).then(n.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var g=a[e][1];isNaN(g)?g&&g.features?b+=g.features.length:g&&"undefined"!==typeof g.length&&(b+=g.length):b+=g}this.updateTabCount(b,c,d);f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.featureCount=a;F.updateTabCount(this.featureCount,b,c,this.baseLabel,
this.incidentCount)},updateForIncident:function(b,c,d,e,f,h){this.incidentCount=b.length;this.allFields="undefined"!==typeof f&&"undefined"!==typeof h?f?!0:h:!1;var k="undefined"!==typeof e,l;u.forEach(this.tab.tabLayers,n.hitch(this,function(f){if("undefined"!==typeof f.empty&&f.url){var h=new a(f.url);x(h,"load",n.hitch(this,function(){this.tab.tabLayers=[h];k?(l=new g,this.processIncident(b,c,d,e).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):
this.processIncident(b,c,d,e)}))}else k?(l=new g,this.processIncident(b,c,d,e).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(b,c,d,e)}));if(k)return l},processIncident:function(a,b,c,e){this.incidents=a;var f=[],h;if(0===b.length)for(var k=0;k<a.length;k++)h=a[k],h=h.geometry?h.geometry:h,"polygon"===h.type?(b.push(h),f.push({geometry:h,buffer:h})):f.push({geometry:void 0,buffer:void 0});else for(k=0;k<a.length;k++){h=a[k];
var l=b[k].geometry?b[k].geometry:b[k];h=h.geometry?h.geometry:h;f.push({geometry:h,buffer:l})}if(0!==b.length){for(a=0;a<f.length;a++)if(b=f[a].buffer,"undefined"!==typeof b)for(h=0;h<f.length;h++)if(h!==a&&(k=f[h].buffer,"undefined"!==typeof k&&A.overlaps(b,k))){f[a].buffer=A.difference(b,k);f[h].buffer=A.difference(k,b);k=A.union(k,b);k=A.difference(k,f[a].buffer);k=A.difference(k,f[h].buffer);if(Array.isArray(f[a].geometry)){if(Array.isArray(f[h].geometry))for(l=0;l<f[h].geometry.length;l++)f[a].geometry.push(f[h].geometry[l]);
else f[a].geometry.push(f[h].geometry);l=f[a].geometry}else if(l=[],l.push(f[a].geometry),Array.isArray(f[h].geometry))for(var q=0;q<f[h].geometry.length;q++)l.push(f[h].geometry[q]);else l.push(f[h].geometry);f.push({geometry:l,buffer:k})}var r,t="undefined"!==typeof e;t?r=new g:(this.container.innerHTML="",d.add(this.container,"loading"));var u=[];this.graphicsLayer=c;c=this.tab.tabLayers[0];var C=this._getFields(c);e=[];for(a=0;a<f.length;a++)b=new w,b.returnGeometry=!0,b.outSpatialReference=this.parent.map.spatialReference,
b.geometry=f[a].buffer,b.outFields="true"===this.parent.config.csvAllFields||!0===this.parent.config.csvAllFields?["*"]:C,"undefined"!==typeof c.queryFeatures&&e.push(c.queryFeatures(b));(new m(e)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=a[b][1];if(c&&c.features)for(var c=c.features,d=f[b].geometry,e=0;e<c.length;e++){var h=c[e],g=h.geometry,k;if(Array.isArray(d)){var l;for(k=0;k<d.length;k++){var m=F.getDistance(d[k],g,this.parent.config.distanceUnits);if("undefined"===typeof l||
m<l)l=m}k=l;g={DISTANCE:l}}else k=F.getDistance(d,g,this.parent.config.distanceUnits),g={DISTANCE:k};for(m=0;m<C.length;m++)g[C[m]]=h.attributes[C[m]];!0===this.config.csvAllFields||"true"===this.config.csvAllFields?h.attributes.DISTANCE=k:h.attributes=g;u.push(h)}}u.sort(F.compareDistance);if(t){var q={graphics:u,analysisResults:u.length,context:this};this._processResults(u,!0).then(n.hitch(this,function(a){r.resolve(n.mixin(q,a))}))}else this._processResults(u)}),n.hitch(this,function(a){console.error(a);
r.reject(a)}));if(t)return r}},_processResults:function(a,m){var q,w,C=a&&0<a.length;if(C&&"point"!==a[0].geometry.type)for(var A=a.length-1;0<=A;A--)"undefined"===typeof a[A].geometry.getExtent()&&a.splice(A,1);m?q=new g:(this.container.innerHTML="",d.remove(this.container,"loading"),this.graphicsLayer.clear(),C&&(w=b.create("div",{"class":"SAT_tabPanelContent"},this.container),A=b.create("div",{},w),d.add(A,"SATcolExport"),d.add(A,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),A=b.create("div",
{title:this.parent.nls.downloadCSV},A),d.add(A,"btnExport"),x(A,"click",n.hitch(this,this._exportToCSV,a))));var A=this.parent.nls[this.parent.config.distanceUnits],K;"undefined"!==typeof this.tab.advStat&&"undefined"!==typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields?K=this.tab.advStat.stats.outFields:(K=[],0<this.tab.tabLayers.length&&u.forEach(this.tab.tabLayers,n.hitch(this,function(a){"undefined"!==typeof a.popupInfo?u.forEach(a.popupInfo.fieldInfos,n.hitch(this,
function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;K.push(b)}})):a.infoTemplate?u.forEach(a.infoTemplate.info.fieldInfos,n.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;K.push(b)}})):u.forEach((a.layerObject?a.layerObject:a).fields,n.hitch(this,function(a){var b={value:0};b.expression=a.name;b.label=a.alias;K.push(b)}))})));var H=220,v=[];if(C)for(var J=0;J<a.length;J++){var B=J+1,y=a[J],D=y.geometry,E=D;"point"!==D.type&&
(E=D.getExtent().getCenter());var D=y.attributes,V;"point"===this.incidents[0].geometry.type&&(V=Math.round(100*D.DISTANCE)/100+" "+A+" ("+this.parent.nls.approximate+")");var O="",M=0,U=[];if("undefined"!==typeof K){for(var S=0;S<K.length;S++){var N=K[S],P;for(P in D)if("DISTANCE"!==P&&3>M&&N.expression===P){var R=F.getFieldValue(P,D[P],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types),R="undefined"!==typeof R&&null!==R?I.stripHTML(R.toString()):"",Y,X=y._layer&&
y._layer.fields?y._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;X&&(X=F.getField(X,P))&&(Y=X.alias);if("undefined"===typeof Y||Y in[""," ",null,void 0])Y=P;F.isURL(R)?R='\x3ca href\x3d"'+R+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+Y+"\x3c/a\x3e":F.isEmail(R)&&(R='\x3ca href\x3d"mailto:'+R+'" style\x3d"color: inherit;"\x3e'+Y+"\x3c/a\x3e");O+=R+"\x3cbr/\x3e";M+=1;U.push({label:Y,value:R})}}0<U.length&&v.push(U)}m||(y=b.create("div",{},w),d.add(y,
"SATcolRec"),d.add(y,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),M=b.create("div",{},y),d.add(M,"SATcolRecBar"),U=b.create("div",{innerHTML:B},M),d.add(U,"SATcolRecNum"),k.set(U,"backgroundColor",this.parent.config.activeColor),x(U,"click",n.hitch(this,this._zoomToLocation,E)),V&&(U=b.create("div",{innerHTML:V},M),d.add(U,"SATcolDistance")),this.parent.config.enableRouting&&(M=b.create("div",{title:this.parent.nls.get_directions},M),d.add(M,"SATcolDir"),x(M,"click",n.hitch(this,this._routeToIncident,
E))),O=b.create("div",{"class":"SATcolWrap",innerHTML:O},y),d.add(O,"SATcolInfo"),H+=t.position(y).w,O=new h(h.STYLE_SOLID,new r.fromString(this.parent.config.activeMapGraphicColor),1),O=new c(c.STYLE_CIRCLE,24,O,new r.fromString(this.parent.config.activeMapGraphicColor)),y=new f,y.family="Arial",y.size="12px",B=new z(B,y,new e(this.parent.config.fontColor)),B.setOffset(0,-4),this.graphicsLayer.add(new l(E,O,D)),this.graphicsLayer.add(new l(E,B,D)))}if(!m&&C)k.set(w,"width",H+"px");else return q.resolve({reportResults:v}),
q},_exportToCSV:function(a,b,c,d){a=F.exportToCSV(a,b,c,d,{type:"proximity",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){a=F.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=a.specialFields;this.typeIdField=a.typeIdField;this.types=
a.types;this.displayFields=F.getDisplayFields(this.tab);return a.fields},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/SnapShotUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array esri/request esri/geometry/webMercatorUtils esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/tokenUtils jimu/dijit/Message jimu/dijit/SnapShot ./CSVUtils".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z){return q("SnapShotUtils",null,{portal:null,portalUrl:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(a){this.parent=a;this.snapshot=new f(a.appConfig,a.map);this.map=this.parent.map;this.extent=this.map.extent;this.nls=n.mixin({},a.nls,window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(a){var b=new r,c=l.stripHTML(a.name),d=this._getTime(a.time);
this.createLayerItems(a,d,c).then(n.hitch(this,function(e){this.snapshot.createSnapShot({folderOptions:{folderName:c+"_"+d,title:c+"_"+d,description:c+" "+this.nls.snapshot},mapTitle:c+" ("+this.nls.snapshot_append+" "+d+")",name:c+" ("+d+")",shareWith:{everyone:!1,org:!1,groups:a.groups.join()},mapExtent:this.map.extent,data:e}).then(function(){b.resolve()})}));return b},_getTime:function(a){a=new Date(a);var b=a.getTimezoneOffset();return l.fieldFormatter.getFormattedDate(a,{dateFormat:"shortDateShortTime"})+
" "+this.nls.utc+(0>b?"+"+Math.abs(b)/60:"-"+b/60)},createLayerItems:function(a,b,c){var d=new r,e=a.layers.reverse();this.buffers=a.buffers;this.incidents=a.incidents;a=[];for(var f=0;f<e.length;f++){var h=!0;e[f].analysisObject&&"undefined"!==typeof e[f].analysisObject.featureCount&&0===e[f].analysisObject.featureCount&&(h=!1);e[f].graphics&&0===e[f].graphics.length&&(h=!1);h&&a.push(this.createItem(e[f],this.incidents,this.buffers,b,this.nls,c))}var g=[];(new u(a)).then(n.hitch(this,function(a){for(var b=
0;b<a.length;b++){var c=a[b][1];if(Array.isArray(c))for(var e=0;e<c.length;e++)g.push(c[e]);else g.push(c)}d.resolve(g)}),n.hitch(this,function(a){d.reject(a)}));return d},createItem:function(a,b,c,d,e,f){var h=new r,g={label:a.label,title:a.label+"_"+d,desc:e.snapshot_append+" "+e.of_append+" "+(a.type?a.type:a.label)+" "+e.layer_append+" "+a.label+" ("+d+")",name:a.label+" ("+d+")",tags:[f+","+e.snapshot_append]};if(a.layerObject){var k=a.layerObject;f=a.analysisObject;var l;k.infoTemplate&&k.infoTemplate.info&&
(l=k.infoTemplate.info);g.popupInfo=l;"groupedSummary"===a.type||"summary"===a.type?f.updateForIncident(b,c,null,null,!0,!0,!0).then(n.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,k,e,d,g);h.resolve(a)})):f.updateForIncident(b,"closest"===a.type?this.parent.config.maxDistance:c,null,!0,!0,!0).then(n.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,k,e,d,g);h.resolve(a)}))}else a=this.createIncidentBufferLayerJSON(a.graphics,e,d,g),h.resolve(a);return h},createAnalysisLayerJSON:function(a,
b,c,d,e){c=a.graphics;d=a.context._exportToCSV(c,!0);a=[];for(var f=0;f<d.length;f++){var h=d[f];"esriFieldTypeOID"!==h.type&&a.push(h)}for(d=0;d<c.length;d++)f=c[d],f.geometry.cache&&(f.geometry.clearCache(),delete f.geometry.cahce);return{graphics:c,renderer:b.renderer,infoTemplate:e.popupInfo,fields:a,tags:e.tags,description:e.desc,name:e.name,visibleOnStartup:!1,typeIdField:b.typeIdField,types:b.types,minScale:b.minScale,maxScale:b.maxScale}},createIncidentBufferLayerJSON:function(a,b,c,d){var e=
[],f=[],h=[];b=[];m.forEach(a,function(a){switch(a.geometry.type){case "point":e.push(a);break;case "polyline":f.push(a);break;case "polygon":h.push(a)}});a=[];0<e.length&&a.push(e);0<f.length&&a.push(f);0<h.length&&a.push(h);c={point:this.nls.point,polyline:this.nls.line,polygon:this.nls.polygon};for(var g=0;g<a.length;g++){var k=a[g],l;0<k.length&&(l=k[0],l=c["undefined"!==typeof l.geometry?l.geometry.type:l.type],b.push({graphics:k,fields:[],tags:d.tags,description:d.desc,name:1===a.length?d.name:
l+" "+d.name,visibleOnStartup:!1}))}return b},createDownloadZip:function(a,b,c){var d=new r,e=this.nls.calculated_results;this._performAnalysis(a,b,c,this.downloadAll,!1).then(function(a){for(var b=[],c=0;c<a.length;c++){var f=a[c];(f=f.context._exportToCSV(f.graphics,!1,!0,f.analysisResults))&&b.push(f)}0<b.length&&z.exportCalculatedResultsCSV(e,b);d.resolve("success")},function(a){d.reject(a)});return d},_performAnalysis:function(a,b,c,d,e){for(var f=new r,h=[],g=0;g<a.length;g++){var k=a[g];console.log("AO: "+
k);var l=!0;k.analysisObject&&"undefined"!==typeof k.analysisObject.featureCount&&0===k.analysisObject.featureCount&&(l=!1);l&&("groupedSummary"===k.type||"summary"===k.type?h.push(k.analysisObject.updateForIncident(b,c,null,null,!0,e,d)):h.push(k.analysisObject.updateForIncident(b,"closest"===k.type?this.parent.config.maxDistance:c,null,!0,e,d)))}var m=[];(new u(h)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++)m.push(a[b][1]);f.resolve(m)}),n.hitch(this,function(a){console.error(a);f.reject(a)}));
return f}})})},"jimu/dijit/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/DeferredList jimu/utils esri/request esri/geometry/webMercatorUtils esri/geometry/Polygon esri/geometry/Polyline jimu/portalUtils jimu/tokenUtils jimu/dijit/Message".split(" "),function(q,n,r,u,m,g,d,b,t,k,x,l,e){return q("Snapshot",null,{_portal:null,_portalUrl:"",_layerArray:[],_originMapId:"",_originAppId:"",_credential:null,name:"",appendTimeStamp:null,baseMap:null,tags:"",
description:"",shareWith:null,logo:"",time:null,constructor:function(a,b){this.map=b;this.appConfig=a;this._originAppId=a.appId;this._originMapId=b.itemId;this._mapItemInfo=b.itemInfo;this._portalUrl=a.portalUrl;this._portal=x.getPortal(this._portalUrl);this._baseUrl=this._portalUrl+"sharing/rest/";this.nls=n.mixin({},window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(a){this.ids=[];this.layerArray=[];this.time=this._getDateString(Date.now());this.name=(a.appendTimeStamp&&a.name?
a.name+"_"+this.time:a.name)||this._mapItemInfo.item.title+"_"+this.time;this.extent=a.mapExtent||this.map.extent;this.logo=a.logo||this.appConfig.logo;this.mapName=a.mapTitle||this.name;this.shareWith=a.shareWith||{everyone:!1,org:!1,groups:""};var b=a.folderOptions;b.name=a.folderOptions.name||this.name;b.title=a.folderOptions.title||this.name;b.description=a.folderOptions.description||this.name;a=a.data.reverse();return this._createSnapshot(b,a)},_createSnapshot:function(a,b){var c=new u;this._portal.getUser().then(n.hitch(this,
this._processUser),function(a){c.reject(a)}).then(n.hitch(this,this._createFolder,a),function(a){c.reject(a)}).then(n.hitch(this,this._createItems,b),function(a){c.reject(a)}).then(n.hitch(this,this._addLayers),function(a){c.reject(a)}).then(n.hitch(this,this._createMap,this._mapItemInfo),function(a){c.reject(a)}).then(n.hitch(this,this._processMap),function(a){c.reject(a)}).then(n.hitch(this,this._shareItems),function(a){c.reject(a)}).then(n.hitch(this,this._showMessage),function(a){c.reject(a)}).then(function(){c.resolve()});
return c},_processUser:function(a){var b=new u;this.user=a;this.groups=a.groups;b.resolve();return b},_createFolder:function(a){var b=new u;a={url:this._baseUrl+"content/users/"+this.user.username+"/createFolder",content:n.mixin({f:"json"},a),handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(a.content.token=this._credential.token);d(a,{usePost:!0}).then(n.hitch(this,function(a){a.success?((this.folder=a.folder)&&this.folder.id&&this.ids.push(this.folder.id),b.resolve(a.folder)):
(console.log(a),b.reject(a))}),n.hitch(this,function(a){b.reject(a)}));return b},_createItems:function(a){var b=new u,d=[];r.forEach(a,n.hitch(this,function(a){a.graphics&&0<a.graphics.length&&d.push(this._createLayerItem(a))}));var e=[];(new m(d)).then(n.hitch(this,function(a){for(var c=0;c<a.length;c++)e.push(a[c][1]);b.resolve(e)}),n.hitch(this,function(a){b.reject(a)}));return b},_addLayers:function(a){for(var b=new u,d=[],e=0;e<a.length;e++)d.push(this.user.addItem(a[e],this.folder.id));var g=
[];(new m(d)).then(n.hitch(this,function(a){for(var c=0;c<a.length;c++){var d=a[c][1];d.success&&(g.push(d.id),this.ids.push(d.id))}b.resolve(g)}),n.hitch(this,function(a){b.reject(a)}));return b},_createMap:function(a,c){for(var d=a.itemData,e=this.name,g,k=[],l=0;l<d.baseMap.baseMapLayers.length;l++)g=d.baseMap.baseMapLayers[l],k.push({id:g.id,layerType:g.layerType,url:g.url,visibility:g.visibility,opacity:g.opacity,title:g.title}),g=g.resourceInfo.spatialReference;d={baseMapLayers:k};k=[];for(l=
0;l<this.layerArray.length;l++){var m=this.layerArray[l];k.push({id:m.layer.id,layerType:"ArcGISFeatureLayer",visibility:m.layer.visible,opacity:m.layer.opacity,title:m.label,type:"Feature Collection",itemId:c[l]})}l=b.webMercatorToGeographic(this.extent);e={title:e,type:"Web Map",item:e,extent:l.xmin+","+l.ymin+","+l.xmax+","+l.ymax,text:JSON.stringify({operationalLayers:k,baseMap:d,spatialReference:g,version:"2.4"}),tags:this.name+","+this.nls.snapshot_append,wabType:"HTML"};return this.user.addItem(e,
this.folder.id)},_processMap:function(a){var b=new u;a.id&&this.ids.push(a.id);a.success?b.resolve(a.id):b.reject("fail");return b},_shareItems:function(a){var b=new u,e={url:this._baseUrl+"content/users/"+this.user.username+"/shareItems",content:{f:"json",everyone:this.shareWith.everyone,org:this.shareWith.org,items:this.ids.join(),groups:this.shareWith.groups,confirmItemControl:this._validateGroupItemControl(this.shareWith.groups)},handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&
(e.content.token=this._credential.token);d(e,{usePost:!0}).then(n.hitch(this,function(c){c.results&&0<c.results.length?b.resolve(this._portalUrl+"home/webmap/viewer.html?webmap\x3d"+a):b.reject("fail")}),n.hitch(this,function(a){b.reject(a)}));return b},_validateGroupItemControl:function(a){var b=a.split(",");return 0<this.groups.filter(function(a){var c=a.capabilities||[];return-1<b.indexOf(a.id)&&-1<c.indexOf("updateitemcontrol")}).length},_showMessage:function(a){var b=new u;"fail"===a?(new e({message:this.nls.snapshot_failed}),
b.reject(a)):(new e({message:'\x3ca href\x3d"'+a+'" target\x3d"_blank"\x3e'+this.nls.snapshot_complete+"\x3c/a\x3e"}),b.resolve("success"));return b},_getDateString:function(a){a=new Date(a);var b=a.getTimezoneOffset();return g.fieldFormatter.getFormattedDate(a,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>b?"+"+Math.abs(b)/60:"-"+b/60)},_checkCredential:function(){var a=l.isValidCredential(this._credential);a||this._clearCredential();return a},_isValidCredential:function(){this._updateCredential();
return this._checkCredential()},_updateCredential:function(){this._checkCredential()||(this._credential=l.getPortalCredential(this._portalUrl))},_clearCredential:function(){this._credential=null},_createLayerItem:function(a){var b=new u;a=this._createLayer(a.graphics,n.mixin({},{description:a.name,name:a.name,tags:[a.name]},a));b.resolve(a);return b},_createLayer:function(a,b){var c=this.nls,d=this.time,e=a[0],g={point:"esriGeometryPoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"}["undefined"!==
typeof e.geometry?e.geometry.type:e.type],l=e.symbol?e.symbol.toJson():"",m=[],n=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:c.snapshot_append,alias:c.snapshot_append,type:"esriFieldTypeString"}];b.fields&&0<b.fields.length&&r.forEach(b.fields,function(a){n.push({name:a.name,alias:a.alias,type:a.type,domain:a.domain})});var q=0;r.forEach(a,function(a){var e;switch(g){case "esriGeometryPolyline":e=a.geometry.paths;break;case "esriGeometryPolygon":e=a.geometry.rings;break;case "esriGeometryPoint":e=
[a.geometry]}var f=0,h;r.forEach(e,function(e){switch(g){case "esriGeometryPolyline":h=new k(e);h.spatialReference=a.geometry.spatialReference;break;case "esriGeometryPolygon":h=new t(e);h.spatialReference=a.geometry.spatialReference;break;case "esriGeometryPoint":h=e}var l={attributes:{ObjectID:q+f},geometry:h};l.attributes[c.snapshot_append]=d;b.fields&&0<b.fields.length&&r.forEach(b.fields,function(b){l.attributes[b.name]=a.attributes[b.name]});m.push(l);f+=1});q+=1});e={xmin:this.extent.xmin,
ymin:this.extent.ymin,xmax:this.extent.xmax,ymax:this.extent.ymax,spatialReference:this.extent.spatialReference};l=b.renderer&&b.renderer.toJson?b.renderer.toJson():b.renderer?JSON.stringify(b.renderer):{type:"simple",label:"",description:"",symbol:l};this.layerArray.push({layer:{id:b.name,label:b.name,opacity:1,visible:b.visibleOnStartup},label:b.name});return{title:b.name,type:"Feature Collection",tags:b.tags,description:b.description,extent:e,name:b.name,text:JSON.stringify({layers:[{layerDefinition:{name:b.name,
geometryType:g,objectIdField:"ObjectID",typeIdField:b.typeIdField,types:b.types,type:"Feature Layer",extent:e,drawingInfo:{renderer:l},fields:n,minScale:b.minScale,maxScale:b.maxScale},popupInfo:b.infoTemplate&&b.infoTemplate.info?b.infoTemplate.info:b.infoTemplate?b.infoTemplate:void 0,featureSet:{features:m,geometryType:g}}]}),f:"json"}}})})},"widgets/SituationAwareness/js/PropertyHelper":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/query dojo/Deferred jimu/BaseWidget jimu/portalUtils dojo/Evented dojo/text!./PropertyHelper.html dijit/form/Select dijit/form/ValidationTextBox".split(" "),
function(q,n,r,u,m,g,d,b,t,k,x,l,e){return q([t,n,x],{templateString:l,baseClass:"jimu-widget-SAT-property-helper",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);"report"===this.type?this.initReportControls():this.initSnapshotControls();this.startup()},startup:function(){this.snapshotName.invalidMessage=this.invalidMessage;this.snapshotName.validator="report"===this.type?this.checkReportString:
this.checkString;this.btnCancel.innerText=this.nls.common.cancel;this.own(g(this.btnCancel,"click",r.hitch(this,function(){this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;this.own(g(this.btnOk,"click",r.hitch(this,function(){if(!m.contains(this.btnOk,"jimu-state-disabled")){var a={name:this.snapshotName.value.trim()};"report"===this.type?a=r.mixin(a,{reportLayout:{orientation:this.pageUtils.Orientation[this.orientationSelect.selectControl.value],pageSize:this.pageUtils.PageSizes[this.pageSizeSelect.selectControl.value]},
comments:this.commentTextArea.value}):a.groups=[this.shareSelect.selectControl.value!==this.nls.choose_group?this.shareSelect.selectControl.value:""];this.emit("ok",a)}})))},checkString:function(a){a=a.trim();a=50>a.length&&/^[\w ]+$/.test(a)?!0:!1;var b=d(".snapshot-name-footer")[0];b&&(this.hasNoGroups?u.addClass(b.children[0],"jimu-state-disabled"):a?u.removeClass(b.children[0],"jimu-state-disabled"):u.addClass(b.children[0],"jimu-state-disabled"));return a},checkReportString:function(a){a=0<a.trim().length?
!0:!1;var b=d(".snapshot-name-footer")[0];b&&(a?u.removeClass(b.children[0],"jimu-state-disabled"):u.addClass(b.children[0],"jimu-state-disabled"));return a},getPageUtilValues:function(a,b,d){var c="A3 A4 Letter_ANSI_A Tabloid_ANSI_B Landscape Portrait".split(" "),e=["Letter ANSI A","Portrait"],g=Object.keys(a),h=[],k;for(k in g){var l=g[k],m=a[l];l&&m.hasOwnProperty(b)&&-1<c.indexOf(l)&&h.push({label:m[b],value:l,selected:m[b]===d||-1<e.indexOf(m[b])})}return h},getGroupValues:function(a){var c=
new b;k.getPortal(this.portalUrl).getUser().then(r.hitch(this,function(b){var d=[],e;for(e in b.groups){var g=b.groups[e];d.push({label:g.title,value:g.id,selected:g.title===a})}c.resolve(d)}),r.hitch(this,function(a){console.log(a);c.resolve([])}));return c},initSnapshotControls:function(){this.nameSpan.innerHTML=this.nls.common.name+":";this.shareSpan.innerHTML=this.nls.select_group+":";this.toggleRow(this.shareRow,!1);this.toggleRow(this.orientationRow,!0);this.toggleRow(this.pageSizeRow,!0);this.toggleRow(this.commentsRow,
!0);var a;if(null!==this.storedProps){var b=JSON.parse(this.storedProps,!0);b.share&&(a=b.share)}this.getGroupValues(a).then(r.hitch(this,function(a){this.snapshotName.hasNoGroups=0===a.length?!0:!1;this.addSelect(this.shareSelect,a)}))},initReportControls:function(){this.nameSpan.innerHTML=this.nls.common.title+":";this.toggleRow(this.orientationRow,!1);this.toggleRow(this.pageSizeRow,!1);this.toggleRow(this.commentsRow,!1);this.toggleRow(this.shareRow,!0);var a,b;if(null!==this.storedProps){var d=
JSON.parse(this.storedProps,!0);d.reportLayout&&(b=d.reportLayout.pageSize,a=d.reportLayout.orientation.Text,b=b.SizeName)}this.addSelect(this.orientationSelect,this.getPageUtilValues(this.pageUtils.Orientation,"Text",a));this.addSelect(this.pageSizeSelect,this.getPageUtilValues(this.pageUtils.PageSizes,"SizeName",b))},addSelect:function(a,b){a.selectControl=new e({options:b,style:"width: 100%;"});a.selectControl.placeAt(a).startup()},toggleRow:function(a,b){m.contains(a,b?"display-on":"display-off")&&
m.remove(a,b?"display-on":"display-off");m.add(a,b?"display-off":"display-on")},destroy:function(){}})})},"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:jimu/dijit/templates/ReportTemplate.html":'\x3c!DOCTYPE HTML\x3e\r\n\x3chtml lang\x3d"en" dir\x3d"ltr"\x3e\r\n\r\n\x3chead id\x3d"reportHead"\x3e\r\n  \x3cmeta charset\x3d"utf-8"\x3e\r\n  \x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e\r\n  \x3ctitle\x3e\x3c/title\x3e\r\n  \x3cscript\x3e\r\n    // Show/hide text area controls based on the value\r\n    function onPrintButtonClicked() {\r\n      var notesContainer, i;\r\n      notesContainer \x3d document.getElementsByClassName("esriCTNotesContainer");\r\n      //process notes to show/hide based on contents\r\n      for (i \x3d 0; i \x3c notesContainer.length; i++) {\r\n        if (notesContainer[i]) {\r\n          //Hide the notes which are not having values\r\n          if (notesContainer[i].children[1].value.trim() \x3d\x3d\x3d "") {\r\n            notesContainer[i].className +\x3d " esriCTHideReportNotes";\r\n          }\r\n          else {\r\n            //Removes hidden class if available\r\n            notesContainer[i].className \x3d\r\n              notesContainer[i].className.replace("esriCTHideReportNotes", "");\r\n          }\r\n        }\r\n      }\r\n      //after processing notes, print the window\r\n      window.print();\r\n    }\r\n  \x3c/script\x3e\r\n  \x3c!-- Report prev page css --\x3e\r\n  \x3cstyle type\x3d"text/css"\x3e\r\n    .esriCTReportMapWait {\r\n      background: #fff url(\'data:image/gif;base64,R0lGODlhGAAYAPfRAPT09ODg4PLy8ufn5wC/7+Hh4evr6+7u7ujo6OLi4vPz8+3t7fHx8eXl5ebm5tbs8lLN7AvB7gK/7wTA7wbA7wO/7wG/7+vx8+Pj4xjD7lHN7Kfg7g/B7n3W7V7Q7PP09Kjg7uzy9HzW7YXY7V/Q7PHz9BnD7kDK7KXf7hLC7j/J7BXC7tXs8pzd7jTH7PL09Njt8iHE7dru83XT6ynF7Ory9Obo6Ovy9Nfu8xfC7Zze7nHU7Zfd7tTr8aDh8iPE7Zzg8SLF7mLQ7FfP7tXr8dfs8WvR6tzv9DrI7KLh8cPp8wjA73jV7bTl8dvv84/a7bTm86/k8ePv8sfm7k3M7Ony9EfK63DV787q8rPl8VDN7BrD7WHR7WDS7xvD7Z/h8hnD7U3O7o/d8bbl8YXT5qfi8V3P7FvM6aTi8d/t8VzP64zc8eTv8pjb7ArA7ijG7SbG7g3B7jnH6yTE7ZTV5WXQ7MPo8XTS6pPZ6wjA7lnQ7Znf8R/E7pbZ6nrX7kHJ697u8jTI7bvb4sLc4k7L62LP6xHC7p3e7qnd6n7V6wXA77zn8eLw9OTw9E/L6gnA7rrm8YvY6xjC7XDV7iDE7Zvf8Mvp8VHL6mrR61zP7Mrj6aPc6sbi6T/K7YzU5m/U7mrT7aHd7FnO7JPc7u/z9IfT5sDl7onX6tDs86Ph8SXF7rDg7C/G7EzM7GbR6xDB7h3D7azj8e7z9Kvj8UfL7HPT66Xg7ofc8tzu80XL7YDV693v9J3W5DvI61XM6hTC7izH7eXv8jnI7HfW7png8iXE7Z/g8EDK7QfA75Te8UfL7aTf7tfs8sXl7Zjf8c7s89Xt8////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MkQ3RDc3ODNCNjdFMTFFNThFMERBOTlFOTM1QUJEQzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MkQ3RDc3ODRCNjdFMTFFNThFMERBOTlFOTM1QUJEQzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyRDdENzc4MUI2N0UxMUU1OEUwREE5OUU5MzVBQkRDNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyRDdENzc4MkI2N0UxMUU1OEUwREE5OUU5MzVBQkRDNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAUKANEALAAAAAAYABgAAAjeAAEIHAjggQgVJigUwODAAAOCEAc+0FCBgEUCATJmHCAg4kBbESxCAPHgggIGBwZkLLDA4wgJBCA88AhAgMoABiC2sEDAA02CCDK2FPggJImfEIMW6AgAQkykEVUOAMAC5kyoBAVkFNDhKVaIKg2cILDhK8QDARxkIADDbNYACSgQuOB2oIKVARTUFXgXbgCmdbUmaBDgwF4AaBsGmLo3LIOtgTM+lFqXcs0CARCYVQp4QUbNUIMGGDrQwEbAEG1mzBnxAObFB5gKSLmSdETVGnOfxirAQIMEGQc79BgQACH5BAUKANEALAAAAAAUAAwAAAiFAKMJFBgCVZkdhYQZ+mHlzQ5jOAZKjFWHlYQJYCil4JCDAIFMayRG40Ej2q9cy+z4IGZJhygXFuKEGWiAQAQhWUpEK/FCYJVoUU5NICBwQYBSiUQqfYHoTDQBBQIgkPFBqVJN0QYEGGC169MAAQR4tWpg61irDgIcOKs0QVi2IqMqgCsxIAAh+QQFCgDRACwEAAAAFAAMAAAIbgABCBRgoEGCAhQynOjQQ6BDhwIGBJg4kYBFAhIgPHgI4ECBiQMOCFBwocgGCBYjtHgIUgBHhw9QWhjhMACCly9JYEQh8CbOlx4IRNj48ydKDUV/PiBQgWhSjihFPH0JgkCnqRyXmsD68AIBCgEBACH5BAUKANEALAwAAAAMABUAAAh9AAtgcGCAQbSDCKMFWLhwgICE0RQwODBgYYEFEBEKqDiISUaECDwRmPTxIKcJBNCUjKbLQqAXJYPBItBkZa1oQ1ZOycNnJbMVE1biyqFopQxJyFY+SLFkpSk3QUqWmEFAT0lAMThA+rgLEwEqJSNV4JCkpCACnxqtbHPjYEAAIfkEBQoA0QAsDAADAAwAFQAACHUAAQgEIGBAgAAGBioUiODggoUKGxYQAHGgwQEVBQo4SDGjwYQZDwRwkJFggAQlFRwseYEAhZIwCGQouYHAiZIQCHTI+ICAhB4Zc0LISIJAhAcVPRCw0ALig5wSRgwM8QBETqMoFBLYSqCCBqQKKZhQIYJIxYAAIfkEBQoA0QAsBAAMABQADAAACIYAowkcSLCgQAUBAhhcSFBAgAQMIx4I4CAiwwEBDFg06DAAg40FMQ6IZiPaB5AIAhQQEI2MEFk1IobA8yfAAoEECLRK5STmhxsCoQExE62CRoE85lTYokqHmFtQZl05FmNFhmEFx8z4IWFChBQrJryKwCHaniMGcUgBZYSQFzmXaHGpxMhgQAAh+QQFCgDRACwAAAwAFAAMAAAIbgApELgAoKDBgwgLmiDwIKHDgyoIgHhIUQQBCBQfEqnAMKNDDRc9JnwQgYAHkQURFEQhgQAJkQgCGBxh4WJDhwIGBJBp8FDJixtghAAg4IDOAAUWIHwAoSWBpzujDhDwkEWHExkoBEjQwAADgwEBACH5BAUKANEALAAAAwAMABUAAAiAAKMJHMJLoMGDfggUs3HQ4KJHEzZ9aChQCwFXFAWymDABS8ZoTwgo+xhNDYFRJJEQAELSBQEfJHtF+0LSUbRkJO9E60LqY6hoQZ59TOPCgjOSfaIBU/KRja9ocEg2o0EHwccSqwIEGCDg44ECWgccEACgoYABWtNmFGCgQYIAAQEAOw\x3d\x3d\') no-repeat center center;\r\n      height: 200px;\r\n    }\r\n\r\n    .esriCTHTMLData {\r\n      position: relative;\r\n      width: 100%;\r\n      height: auto;\r\n    }\r\n\r\n    .jimu-rtl .esriCTHTMLData {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable {\r\n      margin-top: 10px;\r\n      padding: 0;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n      width: 100%;\r\n      page-break-inside: avoid;\r\n      table-layout: fixed;\r\n    }\r\n\r\n    .jimu-rtl .esriCTTable {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n      background-color: #E4E4E4;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTNumber {\r\n      text-align: right;\r\n    }\r\n\r\n    .esriCTSectionTitle {\r\n      font-size: 18px;\r\n      color: #0f96cc;\r\n      font-weight: bold;\r\n      margin: 30px 0px;\r\n      width: calc(100% - 10px);\r\n      word-break: break-all;\r\n    }\r\n\r\n    .jimu-rtl .esriCTSectionTitle {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\r\n      float: none;\r\n    }\r\n\r\n    .esriCTReportLogo {\r\n      float: left;\r\n      max-width: calc(50% - 10px);\r\n      margin: auto 10px auto 0;\r\n      max-height: 90%;\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportLogo {\r\n      float: right;\r\n      margin: auto 0 auto 10px;\r\n    }\r\n\r\n    .esriCTPrintTitleDiv {\r\n      height: 56px;\r\n      float: right;\r\n      min-width: 50%;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintTitleDiv {\r\n      float: left;\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTInputTitle {\r\n      height: 55px;\r\n      line-height: 55px;\r\n      border: none;\r\n      font-size: 25px;\r\n      width: 100%;\r\n      padding: 0px;\r\n    }\r\n\r\n    .esriCTInputTitle::-ms-clear {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      background: #FFF;\r\n      border: solid 1px #000;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      width: 797px;\r\n    }\r\n\r\n    .esriCTReportMap {\r\n      text-align: center;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      max-width: 96%;\r\n      margin-top: 10px;\r\n    }\r\n\r\n    .esriCTReportLandscapeMapImg {\r\n      max-width: 80%;\r\n    }\r\n\r\n    .esriCTReportMapFail {\r\n      height: 50px;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      text-align: center;\r\n      font-size: 80%;\r\n      padding: 10px 0;\r\n      white-space: pre-wrap;\r\n    }\r\n\r\n    .esriCTPrintPage {\r\n      padding: 30px 0;\r\n      margin: 20px auto;\r\n      font-family: arial, sans-serif;\r\n      font-size: 13px;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      width: 100%;\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      z-index: 6;\r\n      height: 50px;\r\n      background: #e2f1fc;\r\n      border-bottom: 1px solid #000;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBar {\r\n      left: inherit;\r\n      right: 0;\r\n    }\r\n\r\n    .esriCTPrintButton,\r\n    .esriCTCloseButton {\r\n      color: #444;\r\n      font-family: Verdana, Helvetica, sans-serif;\r\n      font-size: 12px;\r\n      -moz-border-radius: 3px;\r\n      -webkit-border-radius: 3px;\r\n      border-radius: 3px;\r\n      border: 1px solid #8b8b8b;\r\n      box-shadow: none;\r\n      -webkit-box-shadow: none;\r\n      background: #F2F2F2;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\r\n      background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#F2F2F2\', endColorstr\x3d\'#D1D1D1\', GradientType\x3d0);\r\n      margin: 10px 20px;\r\n      line-height: 16px;\r\n      display: block;\r\n      padding: 5px 10px;\r\n      outline: 0;\r\n      text-decoration: none;\r\n      cursor: pointer;\r\n      font-weight: 400;\r\n      white-space: nowrap;\r\n      float: right;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintButton,\r\n    .jimu-rtl .esriCTCloseButton {\r\n      float: left;\r\n    }\r\n\r\n    .esriCTPrintButton:hover,\r\n    .esriCTPrintButton:focus,\r\n    .esriCTCloseButton:hover,\r\n    .esriCTCloseButton:focus {\r\n      background: #E5E6E6;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\r\n      background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#E5E6E6\', endColorstr\x3d\'#A0A1A1\', GradientType\x3d0);\r\n    }\r\n\r\n    .esriCTReportHeader {\r\n      display: block;\r\n      width: 100%;\r\n      height: 60px;\r\n      border-bottom: 1px solid #000;\r\n      margin-bottom: 5px;\r\n      position: relative;\r\n    }\r\n\r\n    .esriCTReportBarMsg {\r\n      text-align: center;\r\n      margin-top: 16px;\r\n    }\r\n\r\n    .esriCTNotesContainer {\r\n      width: 100%;\r\n      margin-top: 30px;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      resize: none;\r\n      width: calc(100% - 5px);\r\n      max-width: calc(100% - 5px);\r\n      font-family: "Arial";\r\n      font-size: 13px;\r\n      border: 1px solid gray;\r\n      overflow-y: hidden; /* prevents scroll bar flash */\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: none;\r\n      white-space: pre-wrap;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotes {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTHidden {\r\n      display: none;\r\n    }\r\n  \x3c/style\x3e\r\n  \x3c!-- Media print css --\x3e\r\n  \x3cstyle type\x3d"text/css" media\x3d"print"\x3e\r\n    .esriCTPrintPage {\r\n      padding: 0;\r\n      color: #000;\r\n      margin: 0;\r\n      float: none;\r\n      background: #fff url(none);\r\n    }\r\n\r\n    .esriCTTable {\r\n      page-break-inside: avoid;\r\n    }\r\n\r\n    .esriCTPageBreak {\r\n      page-break-after: always;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      font-size: 75%;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      box-shadow: none;\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: block;\r\n    }\r\n\r\n    .esriCTHideReportNotes {\r\n      display: none;\r\n    }\r\n  \x3c/style\x3e\r\n  \x3cscript\x3e\r\n    function showError(evt) {\r\n      alert(document.getElementById(\'showErrorButton\').innerHTML);\r\n    }\r\n  \x3c/script\x3e\r\n\x3c/head\x3e\r\n\r\n\x3cbody id\x3d"reportBody" class\x3d"esriCTPrintPage"\x3e\r\n  \x3cbutton id\x3d"showErrorButton" style\x3d"display: none" onclick\x3d"showError()"\x3e\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriCTReportBar"\x3e\r\n    \x3cdiv id\x3d"closeButton" class\x3d"esriCTCloseButton" title\x3d"Close" onclick\x3d"window.close();"\x3eClose\x3c/div\x3e\r\n    \x3cdiv id\x3d"printButton" class\x3d"esriCTPrintButton" title\x3d"Print" onclick\x3d"onPrintButtonClicked();"\x3ePrint\x3c/div\x3e\r\n    \x3cdiv id\x3d"reportBarMsg" class\x3d"esriCTReportBarMsg"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"reportMain" class\x3d"esriCTReportMain"\x3e\r\n    \x3cdiv id\x3d"reportHeader" class\x3d"esriCTReportHeader"\x3e\r\n      \x3cimg id\x3d"reportLogo" class\x3d"esriCTReportLogo esriCTHidden" src\x3d""\x3e\r\n      \x3cdiv id\x3d"printTitleDiv" class\x3d"esriCTPrintTitleDiv"\x3e\r\n        \x3cinput id\x3d"reportTitle" type\x3d"text" class\x3d"esriCTInputTitle"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"reportData"\x3e\x3c/div\x3e\r\n    \x3cdiv id\x3d"footNotes" class\x3d"esriCTReportFooter"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/body\x3e\r\n\r\n\x3c/html\x3e',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/PropertyHelper.html":'\x3cdiv\x3e  \r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3ctable class\x3d"width-all"\x3e\r\n      \x3c!--name--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"nameRow"\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cinput class\x3d"width-all" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox" /\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--share--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"shareRow"\x3e\r\n        \x3ctd class\x3d"width-all pad-top-10"\x3e\r\n          \x3cspan class\x3d"hintText"\x3e${nls.select_group_instruction}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"shareSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"shareSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--orientation--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"orientationRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"orientationSpan"\x3e${nls.orientation}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"orientationSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--page size--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"pageSizeRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"pageSizeSpan"\x3e${nls.pageSize}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"pageSizeSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--comments--\x3e\r\n  \x3cdiv class\x3d"display-off pad-top-10" data-dojo-attach-point\x3d"commentsRow"\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3cdiv class\x3d"jimu-r-row"\x3e\r\n        \x3cspan class\x3d"label" data-dojo-attach-point\x3d"commentsSpan"\x3e${nls.comments}:\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3ctextarea class\x3d"commentTextArea" data-dojo-attach-point\x3d"commentTextArea" rows\x3d"5"\x3e\x3c/textarea\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn ok pad-right-5 jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 650px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"clearIncident" class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e          \r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"spinnerValue" data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" value\x3d"15" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e       \r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"borderCol" class\x3d"borderCol display-off"\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reverseGeocodingDIV {visibility: hidden;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: block; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 5px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 5px;}.jimu-widget-SAT .borderCol {height: 100px; float: left;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 5px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px; max-width: 300px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .pad-top-5{padding-top: 5px;}.jimu-widget-SAT .pad-top-10{padding-top: 10px;}.jimu-widget-SAT-property-helper .pad-top-5{padding-top: 5px;}.jimu-widget-SAT-property-helper .pad-top-10{padding-top: 10px;}.jimu-widget-SAT-property-helper .pad-right-5{padding-right: 5px;}.jimu-rtl .jimu-widget-SAT-property-helper .pad-right-5{padding-left: 5px;}.jimu-widget-SAT-property-helper .commentTextArea{width: 100%;}.jimu-widget-SAT-property-helper .width-all{width: 100%;}.jimu-widget-SAT-property-helper .display-on{display: block;}.jimu-widget-SAT-property-helper .display-off{display: none;}.jimu-widget-SAT-property-helper .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden; max-width: 130px;}.jimu-widget-SAT-property-helper .hintText {font-size: 12px; color: #a0acbf; font-style: oblique;}.esriAttributeInspector .atiRichTextField{}.esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.esriAttributeInspector {display:inline-block;} .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.esriPopup .spinner {display: none;}",
"*now":function(q){q(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Report jimu/dijit/PageUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/has dojo/topic dojo/Deferred dojo/DeferredList dojo/string dojo/colors esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/tasks/ProjectParameters esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/SpatialReference esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/tasks/GeometryService esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/toolbars/draw esri/domUtils esri/dijit/AttributeInspector esri/dijit/Popup jimu/dijit/Popup esri/tasks/query esri/request ./js/SummaryInfo ./js/GroupedCountInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShotUtils ./js/PropertyHelper ./js/analysisUtils dojo/keys dojo/domReady!".split(" "),function(q,
n,r,u,m,g,d,b,t,k,x,l,e,a,c,h,f,z,w,A,I,F,C,K,T,G,L,W,Q,H,v,J,B,y,D,E,V,O,M,U,S,N,P,R,Y,X,Z,ca,ea,fa,va,ga,ia,ha,aa,wa,ja,xa,ka,la,ma,na,oa,pa,qa,ra,ba,sa,da,ta){return q([u,n],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},
startX:0,mouseDown:!1,btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments);this.nls=w.mixin(this.nls,window.jimuNls.units);this.widgetActive=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,null)},startup:function(){this.inherited(arguments);this.btnNodes=[];this.panelNodes=
[];this.tabNodes=[];this.reportSrc=this.folderUrl+"css/images/report.png";this.saveSrc=this.folderUrl+"css/images/save.png";this.downloadAllSrc=this.folderUrl+"css/images/download_all.png";this.snapshotSrc=this.folderUrl+"css/images/snapshot.png";this.processingSrc=this.folderUrl+"css/images/processing.gif";this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?
this.config.snapshotEnabled:!1;this.reportEnabled="undefined"!==typeof this.config.reportEnabled?this.config.reportEnabled:!1;this.allEnabled=this.saveEnabled&&this.snapshotEnabled&&this.reportEnabled;this.isSafari=K("safari");this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;this._mapLoaded()},onOpen:function(){this.inherited(arguments);
this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=a(window,"resize",w.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",w.hitch(this,this._mapResize)));this._mapResize();this.own(T.subscribe("changeMapPosition",w.hitch(this,this._onMapPositionChange)));(this.disableVisibilityManagement="undefined"!==typeof this.config.disableVisibilityManagement?this.config.disableVisibilityManagement:!1)||this._storeInitalVisibility();
this._checkHideContainer();this._initEditInfo();this._clickTab(0);this._updateCounts(!0);this._restoreIncidents()},_checkHideContainer:function(){this.hideContainer=!1;var b=this.map.infoWindow;b.popupInfoView&&b.popupInfoView.container&&(this.hideContainer=!0,this.own(a(b,"show",w.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow();this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize.remove();this.windowResize=
null;this._clear(!0);this.widgetActive=!1;this.saveEnabled&&(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this.disableVisibilityManagement||this._resetInitalVisibility();this.inherited(arguments);this._resetMapPosition()},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear(!0);this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);
this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);this.inherited(arguments)},onAppConfigChanged:function(a,b){switch(b){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(a);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,null);break;case "attributeChange":this._updateUI(a)}},
_handlePopup:function(){this._clearMobileSetAsIncidentStyle();var a=e.byId("main-page"),b,c,d;this.map.infoWindow.popupInfoView?(b=this.map.infoWindow.popupInfoView.container,c=".mainSection { overflow-y: auto; height: "+(a.clientHeight-60).toString()+"px; }",d=".atiAttributes {overflow: auto; height: "+(a.clientHeight-130).toString()+"px; }"):(b=F("div.atiAttributes",this.map.infoWindow.domNode)[0],c=".mainSection { overflow-y: none; }",d=".atiAttributes {overflow: none; }");a.clientHeight&&b&&(a=
document.createElement("style"),a.type="text/css",a.id="_tempMainSectionOverride",b.appendChild(a),a.sheet.insertRule(c,0),a.sheet.insertRule(d,1))},_updateUI:function(a){this._getStyleColor(a)},_updateFontColor:function(a){"undefined"===typeof a&&(a=this.appConfig);a=f.create("div",{id:"tempTitle",innerHTML:a.title}).getElementsByTagName("font");this.config.fontColor=a&&0<a.length?/^#[0-9A-F]{6}$/i.test(a[0].color)?a[0].color:"#ffffff":"#ffffff";f.destroy("tempTitle");a=document.querySelectorAll(".panelBottom ");
for(var b=0;b<a.length;b++)a[b].style.color=this.config.fontColor},_updateButtonBackgrounds:function(a,b){A.forEach(this.imgContainer.children,function(c){h.contains(c.children[0],a?"btn32img":"btn32imgBlack")&&h.remove(c.children[0],a?"btn32img":"btn32imgBlack");h.add(c.children[0],a?"btn32imgBlack":"btn32img");h.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&h.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");h.add(c.children[0],b?"lightThemeBackground":
"darkThemeBackground")});var c=this.allEnabled;A.forEach(this.saveOptions.children,function(d){c?A.forEach(d.children,function(c){h.contains(c.children[0],a?"btn32img":"btn32imgBlack")&&h.remove(c.children[0],a?"btn32img":"btn32imgBlack");h.add(c.children[0],a?"btn32imgBlack":"btn32img");h.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&h.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");h.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")}):
(h.contains(d.children[0],a?"btn32img":"btn32imgBlack")&&h.remove(d.children[0],a?"btn32img":"btn32imgBlack"),h.add(d.children[0],a?"btn32imgBlack":"btn32img"),h.contains(d.children[0],b?"darkThemeBackground":"lightThemeBackground")&&h.remove(d.children[0],b?"darkThemeBackground":"lightThemeBackground"),h.add(d.children[0],b?"lightThemeBackground":"darkThemeBackground"))})},_getStyleColor:function(a){this._updateFontColor(a);setTimeout(w.hitch(this,function(){var a=window.getComputedStyle(this.footerNode,
null).getPropertyValue("background-color");this.config.activeMapGraphicColor=a;a=x.fromRgb(a);this.lightTheme=210>.2126*a.r+.7152*a.g+.0722*a.b?!1:!0;this.config.color=a.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(h.remove(this.tabNodes[this.curTab],"active"),h.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor=
"rgb(53, 53, 53)"):(h.remove(this.tabNodes[this.curTab],"activeBlack"),h.add(this.tabNodes[this.curTab],"active"),this.config.activeColor="rgba(39, 39, 39, 0.3)");this._setupSymbols();this.dataValue&&(this._drawIncident(this.dataValue),this.dataValue=void 0);this._bufferIncident()}),300)},updateActiveNodes:function(a,b){var c,d,e;b?(c=[".SATcolLocate",".SATcol",".SATcolRec",".borderCol",".SATcolSmall"],d="lightThemeBorder",e="darkThemeBorder"):(c=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),
d="lightThemeBackground",e="darkThemeBackground");A.forEach(c,function(b){b=F(b);for(var c=0;c<b.length;c++){var f=b[c];h.remove(f,a?e:d);h.add(f,a?d:e)}})},setPosition:function(a,b){if(this.widgetActive){this.position="TabTheme"===this.appConfig.theme.name?{left:this.widgetManager.getControllerWidgets()[0].domNode.clientWidth,right:0,bottom:24,height:155,relativeTo:"browser"}:{left:0,right:0,bottom:0,height:155,relativeTo:"browser"};var c=g.getPositionStyle(this.position);c.position="absolute";l.place(this.domNode,
window.jimuConfig.layoutId);l.setStyle(this.domNode,c);this.started&&this.resize();T.publish("changeMapPosition",{bottom:155})}},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(a){var b=this.map.infoWindow.getSelectedFeature();if(a&&"add"===a.type)b={eventType:"IncidentLocationAdd",dataValue:b},this.incidents=[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();
else{for(var c=!0,d,e=0;e<this.lyrIncidents.graphics.length;e++){var f=this.lyrIncidents.graphics[e];if(f.geometry.type===b.geometry.type){var g=!v.equals(f.geometry,b.geometry);f.attributes&&b.attributes&&!g&&(g=g&&C.stringify(f.attributes)===C.stringify(b.attributes));c=c&&g;g||(d=f)}}b={eventType:c?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:b,removeGraphic:d}}this.onReceiveData("","",b);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();a&&(a=this.map.infoWindow,a.popupNavigationBar&&
(b=F(".esriMobileNavigationBar",a.popupNavigationBar.domNode),0<b.length&&l.setStyle(b[0],"display","none")),a.popupInfoView&&(b=F(".esriMobileInfoView",a.popupInfoView.domNode),0<b.length&&l.setStyle(b[0],"display","none")))},_initLayers:function(){this.gsvc=new ga(this.config.geometryService&&this.config.geometryService.url?this.config.geometryService.url:this.appConfig.geometryService);this.locator=new fa(this.config.geocodeService.url);this.own(a(this.locator,"location-to-address-complete",w.hitch(this,
this._showIncidentAddress)));this.own(a(this.locator,"error",w.hitch(this,this._onAddressError)));this.lyrBuffer=new N;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new N;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new N;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new N;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity);this.summaryDisplayEnabled&&(this.lyrSummary=new N,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),
this.lyrGroupedSummary=new N,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary))},_mapLoaded:function(){F("[data-reference]").style("z-index",0);this.map.itemId&&d.getInstance(this.map,this.map.itemInfo).then(w.hitch(this,function(b){this.opLayers=b;this._processOperationalLayers();if(this.saveEnabled){b=this.map.infoWindow;this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&
(this.config.savePolys=!0,this.config.polyEditLayer=this.config.editLayer,this.polyTemplate=this.config.editTemplate,this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,"point");this.config.saveLines&&this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,"poly");this.scSignal=a(b,"selection-change",w.hitch(this,this._selectionChanged));this.sfSignal=a(b,"set-features",w.hitch(this,this._setPopupFeature));
var c=F(".esriPopupWrapper",b.domNode);0<c.length&&"undefined"!==typeof c[0].clientHeight&&"undefined"!==typeof c[0].clientWidth&&(this.defaultPopupSize={width:c[0].clientWidth});b.highlight=!0}}));var b=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];"ArcGISTiledMapServiceLayer"===b.layerType&&b.resourceInfo.singleFusedMapCache||(this.config.defaultZoomLevel=.5);this._clickTab(0)},_initEditLayer:function(b,c){var d;"point"===c?(this.pointEditLayer=this.opLayers.getLayerInfoById(b).layerObject,
this.isPointEditable=this._isEditable(this.pointEditLayer),d=this.pointEditLayer,d.templates&&0<d.templates.length?this.pointTemplate=d.templates[0]:d.types&&0<d.types.length&&(this.pointTemplate=d.types[0].templates[0]),this.pointTemplate&&(this.pointEditLayerPrototype=this.pointTemplate.prototype)):"line"===c?(this.lineEditLayer=this.opLayers.getLayerInfoById(b).layerObject,this.isLineEditable=this._isEditable(this.lineEditLayer),d=this.lineEditLayer,d.templates&&0<d.templates.length?this.lineTemplate=
d.templates[0]:d.types&&0<d.types.length&&(this.lineTemplate=d.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=this.lineTemplate.prototype)):"poly"===c&&(this.polyEditLayer=this.opLayers.getLayerInfoById(b).layerObject,this.isPolyEditable=this._isEditable(this.polyEditLayer),d=this.polyEditLayer,this.honorTemplate||(d.templates&&0<d.templates.length?this.polyTemplate=d.templates[0]:d.types&&0<d.types.length&&(this.polyTemplate=d.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=
this.polyTemplate.prototype));d&&this.own(a(d,"click",w.hitch(this,function(a){if(a.graphic)switch(a=a.graphic,a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "polygon":this.polyUpdateFeature=a}})))},_isEditable:function(a){var b=!1;a.isEditable()&&a.getEditCapabilities&&(b=a.getEditCapabilities());return b&&b.canUpdate&&b.canCreate},_initEditInfo:function(){if(this.saveEnabled){var a=!1;this.polyEditLayer&&this.isPolyEditable&&(a=
!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(w.hitch(this,this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(a=!0,this.defaultLineContent=this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:void 0,this.lineEditLayer.infoTemplate.setContent(w.hitch(this,this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(a=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?
this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(w.hitch(this,this._setEditLayerPopup)));a&&this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "poly":this.polyUpdateFeature=a}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var a=
this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "poly":this.polyUpdateFeature=a}}},_setEditLayerPopup:function(b){var c;"polygon"===b.geometry.type&&(c=this.polyEditLayer);"polyline"===b.geometry.type&&(c=this.lineEditLayer);"point"===b.geometry.type&&(c=this.pointEditLayer);for(var d=[],e=this._getPopupFields(c),g=0;g<e.length;g++){var h=e[g];h.isEditable&&h.isEditableOnLayer&&d.push({fieldName:h.fieldName,
isEditable:h.isEditable})}this.attInspector=new ja({layerInfos:[{featureLayer:c,showAttachments:!1,isEditable:!0,fieldInfos:d}]},f.create("div"));d=new r({label:this.nls.update_btn},f.create("div"));f.place(d.domNode,this.attInspector.deleteBtn.domNode.parentNode);this.own(a(d,"click",w.hitch(this,function(){c.applyEdits(null,[b],null,w.hitch(this,function(){this.map.infoWindow.hide()}),function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);
new m({message:b})})})));this.own(a(this.attInspector,"attribute-change",w.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;this.pointUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polyline":this.lineUpdateFeature=a.feature;this.lineUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polygon":this.polyUpdateFeature=a.feature,this.polyUpdateFeature.attributes[a.fieldName]=a.fieldValue}})));this.own(a(this.attInspector,
"next",w.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;break;case "polyline":this.pointUpdateFeature=a.feature;break;case "poly":this.pointUpdateFeature=a.feature}})));this.own(a(this.attInspector,"delete",w.hitch(this,function(a){var b=!1;if(0<this.incidents.length){for(var d=0;d<this.incidents.length;d++)v.equals(a.feature.geometry,this.incidents[d].geometry)&&(b=!0);if(!b&&0<this.lyrBuffer.graphics.length)for(d=0;d<length;d++)v.equals(a.feature.geometry,
this.lyrBuffer.graphics[d].geometry)&&(b=!0)}c.applyEdits(null,null,[a.feature],function(){},function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new m({message:b})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);b&&this._clear(!1);this.map.infoWindow.hide()})));
switch(b.geometry.type){case "point":this.pointUpdateFeature=b;break;case "polyline":this.lineUpdateFeature=b;break;case "polygon":this.polyUpdateFeature=b}this.attInspector.showFeature(b);return this.attInspector.domNode},_getPopupFields:function(a){var b;if(a.infoTemplate)b=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var c=this.tab.tabLayers[0].url.split("MapServer/")[1],d=this.parent.map.itemInfo.itemData.operationalLayers;b=null;for(var e=0;e<d.length;e++){var f=
d[e];if(f.layerObject.infoTemplates&&(f=f.layerObject.infoTemplates[c])){b=f.infoTemplate.info.fieldInfos;break}}}else b=a.fields;b||(b=a.fields);return b},_updatePopup:function(a,b,c){b=[];for(c=0;c<a.length;c++){var d=a[c],e=new la;e.objectIds=[d.oid];b.push(d.layer.selectFeatures(e,P.SELECTION_NEW))}(new L(b)).then(w.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d[0]){d=d[1][0];b.push(d);switch(d.geometry.type){case "point":this.pointUpdateFeature=d;break;case "polyline":this.lineUpdateFeature=
d;break;case "poly":this.polyUpdateFeature=d}this.attInspector||this._setEditLayerPopup(d);this.attInspector&&this.attInspector.showFeature(d)}}}))},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];b.layers&&""!==b.layers&&(this.hasLayerTitle="undefined"!==typeof b.layerTitle,b.layers="weather"===b.type&&b.layers.split?b.layers.split(","):b.layers,b.tabLayers=this._getTabLayers(b.layers))}},_createUI:function(){var b=g.stripHTML(this.config.bufferLabel?
this.config.bufferLabel:"");this.buffer_lbl.innerHTML=b;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];b=this.config.bufferRange.minimum;this.spinnerValue.set("data-dojo-props","constrains: {min: "+b+", max: "+this.config.bufferRange.maximum+"}, intermediateChanges: true, places:0");this.spinnerValue.set("value",b);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;this.config.tabs.splice(0,
0,{type:"incidents",label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);for(var b=this.panelContainer,d=this.tabsNode,e=0,k=0;k<this.config.tabs.length;k++){var l=this.config.tabs[k],m=l.label;"weather"===l.type&&(m=this.nls.weather);m&&""!==m||(m=l.layerTitle?l.layerTitle:l.layers);m=f.create("div",{"data-dojo-attach-point":"SA_tab"+k,innerHTML:g.stripHTML(m?m:"")},d);this.tabNodes.push(m);
h.add(m,"SATTab");e+=z.position(m).w;a(m,"click",w.hitch(this,this._clickTab,k));0<k&&(m=f.create("div",{"data-dojo-attach-point":"SA_tabPanel"+k,innerHTML:""},b),this.panelNodes.push(m),h.add(m,"SAT_tabPanel"),"summary"===l.type&&(l.summaryInfo=new na(l,m,this),this.own(a(l.summaryInfo,"summary-complete",w.hitch(this,this.restore)))),"groupedSummary"===l.type&&(l.groupedSummaryInfo=new oa(l,m,this),this.own(a(l.groupedSummaryInfo,"summary-complete",w.hitch(this,this.restore)))),"weather"===l.type&&
(l.weatherInfo=new pa(l,m,this)),"closest"===l.type&&(l.closestInfo=new qa(l,m,this)),"proximity"===l.type&&(l.proximityInfo=new ra(l,m,this)))}e+=10;c.set(d,"width",e+"px");e>z.position(this.footerNode).w&&(c.set(this.footerContentNode,"right","58px"),c.set(this.panelRight,"display","block"));a(d,"scroll",w.hitch(this,this._onPanelScroll))},restore:function(a){a.tab===this.curTab&&this._clickTab(a.tab)},validateSavePrivileges:function(){var a=new G;b.getPortal(this.appConfig.portalUrl).getUser().then(w.hitch(this,
function(b){b&&b.privileges?a.resolve(-1<b.privileges.indexOf("features:user:edit")?!0:!1):a.resolve(!0)}),w.hitch(this,function(b){console.log(b);a.resolve(!0)}));return a},validateSnapshotPrivileges:function(){var a=new G;b.getPortal(this.appConfig.portalUrl).getUser().then(w.hitch(this,function(b){b&&b.privileges?a.resolve(-1<b.privileges.indexOf("portal:publisher:publishFeatures")&&-1<b.privileges.indexOf("portal:user:createItem")?!0:!1):a.resolve(!1)}),w.hitch(this,function(b){console.log(b);
a.resolve(!1)}));return a},_loadUI:function(){var b=this.allEnabled?f.create("div",{"class":"displayT pad-top-5"},this.saveOptions):this.saveOptions,c=this.allEnabled?f.create("div",{"class":"displayT pad-top-10"},this.saveOptions):this.saveOptions,d=this.allEnabled?"displayTC":"displayTR";this.reportEnabled&&(this.createReportButtonSpan=f.create("span",{"class":"btn32 "+d},b),this.createReportButton=f.create("img",{"class":"btn32img",title:this.nls.createReport,src:this.reportSrc},this.createReportButtonSpan),
this.own(a(this.createReportButton,"click",w.hitch(this,this._createReport))));this.saveEnabled&&(this.saveButtonSpan=f.create("span",{"class":"btn32 "+d},b),this.validateSavePrivileges().then(w.hitch(this,function(b){this.userCanSave=b;this.saveButton=f.create("img",{"class":b?"btn32img":"btn32img btnDisabled",title:b?this.nls.saveIncident:this.nls.user_credentials,src:this.saveSrc},this.saveButtonSpan);b&&this.own(a(this.saveButton,"click",w.hitch(this,this._saveIncident)))}),function(a){console.log(a)}));
b=f.create("span",{"class":"btn32 "+d},c);this.downloadAllButon=f.create("img",{"class":"btn32img",title:this.nls.downloadAll,src:this.downloadAllSrc},b);this.own(a(this.downloadAllButon,"click",w.hitch(this,this._downloadAll)));this.snapshotEnabled&&(this.createSnapshotButtonSpan=f.create("span",{"class":"btn32 "+d},c),this.validateSnapshotPrivileges().then(w.hitch(this,function(b){this.userCanSnapshot=b;this.createSnapshotButton=f.create("img",{"class":b?"btn32img":"btn32img btnDisabled",title:b?
this.nls.createSnapshot:this.nls.user_credentials,src:this.snapshotSrc},this.createSnapshotButtonSpan);b&&this.own(a(this.createSnapshotButton,"click",w.hitch(this,this._createSnapshot)))}),function(a){console.log(a)}));c={0:this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];for(d=0;3>d;d++)b=this.btnNodes[d],l.setAttr(b,"src",this.folderUrl+"images/btn"+d+".png"),l.setAttr(b,"title",c[d]),this.own(a(b,"click",w.hitch(this,this._clickIncidentsButton,
d)));this.toolbar=new aa(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",w.hitch(this,this._drawIncident));this.own(a(this.spinnerValue,"change",w.hitch(this,this._sliderTextChange)));this.own(a(this.spinnerValue,"blur",w.hitch(this,function(a){this._updateSpinnerValue(!0)})));this.own(a(this.spinnerValue,"keyup",w.hitch(this,function(a){a.keyCode===ta.ENTER?this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?
a:a.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(a){var b;if(3>a){for(var c=0;3>c;c++)b=this.btnNodes[c],h.remove(b,"btnOn");-1<a&&a!==this.tool?(b=this.btnNodes[a],3>a&&h.add(b,"btnOn"),this.tool=a):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear(!1);this.toolbar.activate(aa.POINT);
this.disableWebMapPopup();break;case 1:this._clear(!1);this.toolbar.activate(aa.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(!1),this.toolbar.activate(aa.POLYGON),this.disableWebMapPopup()}}else this._clear(!0)},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,!0,this.saveSrc);var a=[];this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&
(this.config.savePolys=!0);if(this.config.savePolys){var b=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<b.length&&a.push({layer:this.polyEditLayer,graphics:b})}this.config.saveLines&&(b=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<b.length&&a.push({layer:this.lineEditLayer,graphics:b}));this.config.savePoints&&(b=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<b.length&&a.push({layer:this.pointEditLayer,graphics:b}));0<a.length?this._applyEdits(a):
this._updateProcessing(this.saveButton,!1,this.saveSrc);this._clickIncidentsButton(-1)},_getIncidentGraphics:function(a,b){var c=[],d=C.parse(C.stringify(b));if("polygon"===a)for(var e=0;e<this.lyrBuffer.graphics.length;e++){var f=this.lyrBuffer.graphics[e],g=new M;g.geometry=f.geometry;g.setAttributes(d.attributes);c.push(g)}for(e=0;e<this.incidents.length;e++)f=this.incidents[e],f.geometry.type===a&&(g=new M,g.geometry=f.geometry,g.setAttributes(d.attributes),c.push(g));return c},_applyEdits:function(a){for(var b=
new G,c=[],d=[],e=0;e<a.length;e++){var f=a[e];f.layer.visible||f.layer.setVisibility(!0);var g=[];if(1<f.graphics.length&&"polygon"===f.graphics[0].geometry.type){var h=f.graphics[0],k=f.graphics.map(function(a){return a.geometry});if(k=v.union(k))h.geometry=k,g.push(h)}c.push(f.layer.applyEdits(0<g.length?g:f.graphics,null,null))}(new L(c)).then(w.hitch(this,function(c){for(var e=!1,f=0;f<c.length;f++){var g=c[f][1][0];g.success&&(e=!0,g.hasOwnProperty("objectId")&&d.push({oid:g.objectId,layer:a[f].layer}))}if(!this.map.infoWindow.isShowing){c=
this.incidents[0].geometry;var h;switch(c.type){case "point":h=c;break;case "polyline":h=c.paths[0][parseInt(c.paths[0].length/2,10)];h=new B(h[0],h[1],c.spatialReference);break;case "polygon":h=c.getCentroid()}c=this.map.toScreen(h);0<d.length&&this._updatePopup(d,h,c);this._updateProcessing(this.saveButton,!1,this.saveSrc);this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:c,mapPoint:h})}b.resolve(e)}),w.hitch(this,function(a){console.error(a);this._updateProcessing(this.saveButton,!1,
this.saveSrc);new m({message:a});b.reject(a)}));return b},_clear:function(a){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();this.summaryDisplayEnabled&&this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();this.saveOptions&&(h.remove(this.saveOptions,"displayT"),h.add(this.saveOptions,"display-off"));this.borderCol&&(h.remove(this.borderCol,
"display-on"),h.add(this.borderCol,"display-off"));this.clearIncident&&(h.remove(this.clearIncident,"display-on"),h.add(this.clearIncident,"display-off"));this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML="");this.div_reverse_geocoding&&l.setStyle(this.div_reverse_geocoding,"visibility","hidden");this._updateCounts(!0);this._clearGraphics();a&&this.spinnerValue.set("value",this.config.bufferRange.minimum);this.pointEditLayer&&(this.pointUpdateFeature=
this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){f.destroy(e.byId("_tempMainSectionOverride"))},_sliderTextChange:function(){this._bufferIncident()},_updateSpinnerValue:function(a){var b=this.spinnerValue.displayedValue;"string"===typeof b&&(b=parseInt(b,10));b<this.config.bufferRange.minimum?
this.spinnerValue.set("value",this.config.bufferRange.minimum):b>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);a&&this._bufferIncident()},_clickTab:function(a){this._validateFeatureCount(a)&&(this._toggleTabs(a),this._toggleTabLayers(a),this.curTab=a,this._clickIncidentsButton(-1))},_validateFeatureCount:function(a){var b=!0;a=this.config.tabs[a];switch(a.type){case "summary":b=0<a.summaryInfo.featureCount;break;case "groupedSummary":b=0<a.groupedSummaryInfo.featureCount;
break;case "weather":b=0<this.incidents.length;break;case "closest":b=0<a.closestInfo.featureCount;break;case "proximity":b=0<a.proximityInfo.featureCount}return b},_toggleTabs:function(a){for(var b=0;b<this.config.tabs.length;b++)b===a?(h.add(this.tabNodes[b],this.isBlackTheme?"activeBlack":"active"),c.set(this.panelNodes[b],"display","block")):(h.remove(this.tabNodes[b],"active"),h.remove(this.tabNodes[b],"activeBlack"),c.set(this.panelNodes[b],"display","none"));this._scrollToTab(a)},_toggleTabLayers:function(a){this._toggleTabLayersOld();
this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];if(a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),this.disableVisibilityManagement||a.tabLayers&&A.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}),a.mapLayers)){var b=this.opLayers,c=[];A.forEach(a.mapLayers,function(a){var d=
b.getLayerInfoById(a.id).getRootLayerInfo();-1===c.indexOf(d.id)&&(c.push(d.id),a.layerOptions&&d.resetLayerObjectVisibility(a.layerOptions))})}},_toggleTabLayersNew:function(a){var b=this.config.tabs[a];switch(b.type){case "summary":var c=!1;this.lyrSummary&&(this.currentSumLayer!==a&&(c=!0),this.lyrSummary.clear());b.tabLayers&&1<b.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=b.tabLayers[1].infoTemplate,A.forEach(b.tabLayers[1].graphics,w.hitch(this,function(a){this.lyrSummary.add(a)})),
this.lyrSummary.setVisibility(!0)),c&&(this.currentSumLayer=a,this._toggleTabLayersNew(a)));0<this.incidents.length&&!0===b.updateFlag&&(b.summaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,a),b.updateFlag=!1,this.currentSumLayer=a);break;case "groupedSummary":this.lyrGroupedSummary&&(this.currentSumLayer!==a&&(c=!0),this.lyrGroupedSummary.clear());b.tabLayers&&1<b.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=
b.tabLayers[1].infoTemplate,A.forEach(b.tabLayers[1].graphics,w.hitch(this,function(a){this.lyrGroupedSummary.add(a)})),this.lyrGroupedSummary.setVisibility(!0)),c&&(this.currentSumLayer=a,this._toggleTabLayersNew(a)));0<this.incidents.length&&!0===b.updateFlag&&(b.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrGroupedSummary:null,a),b.updateFlag=!1,this.currentGrpLayer=a);break;case "weather":if((a=b.mapLayers&&0<b.mapLayers.length?b.mapLayers:
b.tabLayers&&0<b.tabLayers.length?b.tabLayers:[])&&0<a.length){var d=this.opLayers,e=[];A.forEach(a,function(a){var b=d.getLayerInfoById(a.id);a.layerOptions={};var c=b.getRootLayerInfo();-1===e.indexOf(c.id)&&(e.push(c.id),c.traversal(w.hitch(this,function(b){a.layerOptions[b.id]={visible:b.isVisible()}})));b.show()})}0<this.incidents.length&&!0===b.updateFlag&&(c=a=this.incidents[0].geometry,"point"!==a.type&&(c=a.getExtent().getCenter()),this._getPoint(c).then(w.hitch(this,function(a){b.weatherInfo.updateForIncident(a)}),
function(a){console.log(a)}),b.updateFlag=!1);break;case "closest":this.disableVisibilityManagement||b.tabLayers&&A.forEach(b.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)});this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(b.closestInfo&&b.closestInfo.container&&(b.closestInfo.container.innerHTML="",h.add(b.closestInfo.container,"loading")),!1===b.updateFlag&&this.lyrClosest.clear(),b.closestInfo.updateForIncident(this.incidents,this.config.maxDistance,this.lyrClosest),
b.updateFlag=!1);break;case "proximity":this.disableVisibilityManagement||b.tabLayers&&A.forEach(b.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)}),this.lyrProximity.setVisibility(!0),0<this.incidents.length&&(b.proximityInfo&&b.proximityInfo.container&&(b.proximityInfo.container.innerHTML="",h.add(b.proximityInfo.container,"loading")),!1===b.updateFlag&&this.lyrProximity.clear(),b.proximityInfo.updateForIncident(this.incidents,this.buffers,this.lyrProximity),b.updateFlag=
!1)}b.updateFlag=!1},_drawIncident:function(a,b,c){a=Array.isArray(a)?a:[a];for(var d=!1,e=0;e<a.length;e++){var f=a[e],g=f.geometry.type;null===this.symPoint&&this._getStyleColor();var k=this.symPoint;"polyline"===g&&(k=this.symLine,d=this.isLineEditable);"polygon"===g&&(k=this.symPoly,d=this.isPolyEditable);"point"===g&&(this._getIncidentAddress(f.geometry),d=this.isPointEditable);f=new M(f.geometry,k,f.attributes,f.infoTemplate);this.incidents.push(f);this.lyrIncidents.add(f)}this.div_reversed_address.innerHTML=
"";l.setStyle(this.div_reverse_geocoding,"visibility","hidden");this.toolbar.deactivate();this._clickIncidentsButton(-1);this.saveEnabled&&(h.remove(this.saveButton,"display-off"),(d=d&&this.userCanSave)&&h.contains(this.saveButton,"btnDisabled")&&h.remove(this.saveButton,"btnDisabled"),h.add(this.saveButton,d?"displayT":"displayT btnDisabled"));h.remove(this.saveOptions,"display-off");h.add(this.saveOptions,"displayT");h.remove(this.borderCol,"display-off");h.add(this.borderCol,"display-on");h.remove(this.clearIncident,
"display-off");h.add(this.clearIncident,"display-on");this._bufferIncident(b,c)},_getIncidentAddress:function(a){this.incidentPoint=a;this.map.graphics.clear();this._getPoint(a).then(w.hitch(this,function(a){this.locator.locationToAddress(a,100)}),function(a){console.log(a)})},_getPoint:function(a){var b=new G,c=new R(3857);E.canProject(a,c)?b.resolve(E.webMercatorToGeographic(E.project(a,c))):(c=v.buffer(a,100,9001),c={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,
outSR:4326,extentOfInterest:C.stringify(c.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"},ma(c,{usePost:!1}).then(w.hitch(this,function(c){c=(c=c&&c.transformations?c.transformations:void 0)&&0<c.length?c[0].wkid:void 0;var d=new V;d.outSR=new R(4326);d.geometries=[a];d.transformForward=!0;d.transformation=c;this.gsvc.project(d,w.hitch(this,function(a){b.resolve(a[0])}),function(a){b.reject(a)})}),w.hitch(this,function(a){b.reject(a)})));return b},_showIncidentAddress:function(a){if(a.address.address){var b=
a.address.address.Address,c=new Y;c.family="Arial";c.size="18px";c=new ea(b,c,new S("#000000"));c.setOffset(20,-4);c.horizontalAlignment="left";this.map.graphics.add(new M(this.incidentPoint,c,{}));this.div_reversed_address.innerHTML=b+"\x3c/br\x3e"+a.address.address.City+", "+a.address.address.Region+" "+a.address.address.Postal;l.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;l.setStyle(this.div_reverse_geocoding,
"visibility","visible")},_bufferIncident:function(a,b){if(0!==this.incidents.length){for(var c=0;c<this.config.tabs.length;c++)this.config.tabs[c].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();for(var c=!1,d=0;d<this.incidents.length;d++){var e=this.incidents[d],f=this.spinnerValue.get("value"),g=this.config.distanceSettings[this.config.distanceUnits];0<f?(e=4326!==e.geometry.spatialReference.wkid&&!e.geometry.spatialReference.isWebMercator()||this.isSafari?v.buffer(e.geometry,f,g):v.geodesicBuffer(e.geometry,
f,g),this.buffers.push(e)):(a=!1,e=e.geometry.type,"polyline"!==e||c||(c=this.isLineEditable),"polygon"!==e||c||(c=this.isPolyEditable),"point"!==e||c||(c=this.isPointEditable))}0<this.buffers.length?(this.saveEnabled&&(h.remove(this.saveButton,"display-off"),h.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&this.userCanSave&&h.remove(this.saveButton,"btnDisabled"),h.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,a)):(this.saveEnabled&&(c&&this.userCanSave?h.contains(this.saveButton,
"btnDisabled")&&h.remove(this.saveButton,"btnDisabled"):h.add(this.saveButton,"btnDisabled")),this.zoomToIncidents(b))}},_handleBuffers:function(a,b){this.bufferLookUp=[];for(var c=0;c<this.buffers.length;c++){var d=new M(this.buffers[c],a);this.lyrBuffer.add(d);this.bufferLookUp[c]=d}b||this._locateBuffer(v.union(this.buffers));this._performAnalysis()},_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},_updateCounts:function(a){for(var b=[],c=0;c<this.config.tabs.length;c++){a&&
0<c&&this.panelNodes[c]&&(this.panelNodes[c].innerHTML="");var d=this.config.tabs[c],e=this.tabNodes[c],f=null,g=!1;d.advStat&&d.advStat.stats&&("undefined"!==typeof d.advStat.stats.tabCount?g=d.advStat.stats.tabCount:d.advStat.stats.count&&(g=!0));"proximity"===d.type?f=d.proximityInfo:"closest"===d.type?f=d.closestInfo:"summary"===d.type?f=d.summaryInfo:"groupedSummary"===d.type?f=d.groupedSummaryInfo:"weather"===d.type&&(f=d.weatherInfo);f&&(a?("undefined"!==typeof f.incidentCount&&(f.incidentCount=
0),f.updateTabCount(0,e,g)):"weather"===d.type?f.queryTabCount(this.incidents,this.buffers,e,g):b.push(f.queryTabCount(this.incidents,this.buffers,e,g)))}(new L(b)).then(w.hitch(this,function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c][1];isNaN(d)||(b+=d)}this._updateBtnState(this.downloadAllButon,"btnDisabled",b);this.userCanSnapshot&&this._updateBtnState(this.createSnapshotButton,"btnDisabled",b)}))},_updateBtnState:function(a,b,c){a&&(0===c?h.add(a,b):h.contains(a,b)&&h.remove(a,b))},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=
!1;var a=this.appConfig.getConfigElementsByName("Directions");A.forEach(a,w.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var a=this.appConfig.getConfigElementsByName("AttributeTable");A.forEach(a,w.hitch(this,function(a){"AttributeTable"===a.name&&(this.attributeTable=a)}))},zoomToIncidents:function(a){var b,c=!1;if(0<this.incidents.length){var d;1<this.buffers.length?d=v.union(this.buffers):1===this.buffers.length&&
(d=this.buffers[0]);b=this.incidents;var e;d&&(c=!0,e=new M(d,d.spatialReference),b.push(e));this.geomExtent=U.graphicsExtent(this.incidents);e&&e.destroy&&e.destroy()}"undefined"===typeof a&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):b&&(a=b[0].geometry&&"point"===b[0].geometry.type?b[0].geometry:b[0].geometry.getCentroid(),this.map.centerAndZoom(a,this.config.defaultZoomLevel)));if(!c){for(a=0;a<this.incidents.length;a++)if("polygon"===this.incidents[a].geometry.type){c=!0;
break}this._performAnalysis()}c&&this._performAnalysis()},zoomToLocation:function(a){var b;if(.5===this.config.defaultZoomLevel){var c;if(0<this.buffers.length)c=v.union(this.buffers)._extent;else if(0<this.incidents.length){for(var d=[],e=[],f=[],g=0;g<this.incidents.length;g++){var h=this.incidents[g];switch(h.geometry.type){case "point":d.push(h.geometry._extent);break;case "polyline":e.push(h.geometry);break;case "polygon":f.push(h.geometry)}}g=[];0<d.length&&g.push(v.union(d)._extent);0<e.length&&
g.push(v.union(e)._extent);0<f.length&&g.push(v.union(f)._extent);1<g.length?c=v.union(g)._extent:1===g.length&&(1<d.length||0<e.length||0<f.length)&&(c=g[0])}c&&(b=c.expand(.5))}"undefined"===typeof a&&(a=b.getCentroid());b&&this.map.setExtent(b);this.map.centerAt(a)},routeToIncident:function(a){var b=this.incidents[0].geometry,c=b;"point"!==b.type&&(c=null);this.stops=[c,a];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(w.hitch(this,function(a){if(a&&"closed"!==a.state){var b=a._dijitDirections;
b?this._addStops(b):a.getDirectionsDijit().then(w.hitch(this,function(a){this._addStops(a)}))}}))},_addStops:function(a){a.clearDirections();a.removeStops();a.reset();a.addStops(this.stops)},_getTabLayers:function(a){var b=[];A.forEach(this.opLayers._layerInfos,w.hitch(this,function(c){if(0<c.newSubLayers.length)this._recurseOpLayers(c.newSubLayers,b,a);else{var d=this.hasLayerTitle?c.id:c.title;if(Array.isArray(a)?-1<a.indexOf(d):a===d)b.push(c.layerObject),"undefined"===typeof c.layerObject.visible||
c.layerObject.visible||(c.layerObject.setVisibility(!0),c.layerObject.setVisibility(!1))}}));return b},_recurseOpLayers:function(a,b,c){A.forEach(a,w.hitch(this,function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,b,c);else{var d=this.hasLayerTitle?a.id:a.title;(Array.isArray(c)?-1<c.indexOf(d):c===d)&&b.push(a.layerObject)}}))},_setupSymbols:function(){var a=x.fromString(this.config.color),b=a.toRgb();b.push(.2);var c=x.fromString("#000000"),a=x.blendColors(a,c,.2).toRgb(),
c=new X(X.STYLE_SOLID,new x([255,255,255,.25]),1);this.symPoint=new ca(ca.STYLE_CIRCLE,20,c,new x([a[0],a[1],a[2],.7]));this.symLine=new X(X.STYLE_SOLID,new x([a[0],a[1],a[2],.7]),3);this.symPoly=new Z(Z.STYLE_SOLID,this.symLine,new x([a[0],a[1],a[2],.3]));this.symBuffer=new Z(Z.STYLE_SOLID,c,new x(b));this.symSelection=new Z(Z.STYLE_NULL,new X(X.STYLE_SOLID,new x([0,255,255]),2),new x([0,0,0,0]))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocationAdd"===c.eventType?c.dataValue&&
null!==c.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=c.dataValue:this._drawIncident(c.dataValue)):"IncidentLocationRemove"===c.eventType?(a=this.incidents.indexOf(c.removeGraphic),this.incidents.splice(a,1),this.lyrIncidents.remove(c.removeGraphic),this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[a]),this.bufferLookUp.splice(a,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(a,1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=
!0,this._performAnalysis()):this._clear(!1)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<this.incidents.length){for(var a=[],b=0;b<this.incidents.length;b++)a.push(C.stringify(this.incidents[b].geometry.toJson()));a={location:C.stringify(a),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,extent:C.stringify(this.map.extent.toJson())};a=C.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,
a);console.log("Incident saved to storage")}},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var a=C.parse(a,!0),b=a.buffer_dist,c=C.parse(a.location);this.curTab=a.curTab;for(var d=[],e=0;e<c.length;e++)d.push({geometry:O.fromJson(C.parse(c[e]))});this.spinnerValue.set("value",b);for(b=0;b<this.config.tabs.length;b++)this.config.tabs[b].restore=!0;this._drawIncident(d,
!0,!0);this._clickTab(0,!0);this._toggleTabs(a.curTab);this._toggleTabLayers(a.curTab);this.curTab=a.curTab;this._clickIncidentsButton(-1);this._updateW();a=O.fromJson(C.parse(a.extent));v.equals(a,this.map.extent)||this.map.setExtent(a,!1)}else h.remove(this.saveOptions,"displayT"),h.add(this.saveOptions,"display-off"),h.remove(this.borderCol,"display-on"),h.add(this.borderCol,"display-off"),h.remove(this.clearIncident,"display-on"),h.add(this.clearIncident,"display-off")},_updateW:function(){for(var a=
0,b=0;b<this.tabNodes.length;b++)a+=z.position(this.tabNodes[b]).w;a+=10;c.set(this.tabsNode,"width",a+"px");a>z.position(this.footerNode).w&&(c.set(this.footerContentNode,window.isRTL?"left":"right","58px"),c.set(this.panelRight,"display","block"))},_mapResize:function(){var a=c.getComputedStyle(this.map.container);if(a){var b=this._getSAPanelHeight(),a=parseFloat(a.bottom.replace("px",""));if("opened"===this.state||"active"===this.state){var d=this._getAttributeTableHeight();d>b&&(b=d);a<=b&&T.publish("changeMapPosition",
{bottom:b})}}},_onMapPositionChange:function(a){a&&(this.left=a.left,this.right=a.right,isFinite(this.left)&&"number"===typeof this.left&&c.set(this.domNode,window.isRTL?"right":"left",parseFloat(this.left)+"px"),isFinite(this.right)&&"number"===typeof this.right&&c.set(this.domNode,window.isRTL?"left":"right",parseFloat(this.right)+"px"));this._onPanelScroll()},_resetMapPosition:function(){T.publish("changeMapPosition",{bottom:this._getAttributeTableHeight()})},_getSAPanelHeight:function(){var a=
parseInt(this.position.height.toString().replace("px",""),10),b=parseInt(this.position.bottom.toString().replace("px",""),10);return a+b},_getAttributeTableHeight:function(){var a=parseInt(this.position.bottom.toString().replace("px",""),10);if(this.attributeTable){var b=e.byId(this.attributeTable.id);b&&(b=c.getComputedStyle(b))&&b.height&&(a+=parseInt(b.height.toString().replace("px",""),10))}return a},_resize:function(a){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),
this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(),this._initEditInfo(),this._checkHideContainer()}catch(ua){console.log(ua)}},_onPanelScroll:function(a){var b,d,e,f;a=this.footerContentNode.getBoundingClientRect();for(var g=0;g<this.tabsNode.children.length;g++)if(f=this.tabsNode.children[g],f=f.getBoundingClientRect(),f=window.isRTL?f.right:f.left,0<=f){b=g;e=f;break}for(g=0;g<this.tabsNode.children.length;g++)if(f=this.tabsNode.children[g],f=f.getBoundingClientRect(),(window.isRTL?f.left:
f.right)>(window.isRTL?a.left:a.right)){d=g;break}a=this.footerContentNode;d=d<=this.tabsNode.children.length;c.set(a,window.isRTL?"left":"right",d?"58px":"24px");c.set(this.panelRight,"display",d?"block":"none");d=0;"TabTheme"===this.appConfig.theme.name&&(d+=window.isRTL?this.right:this.left);b=1<=b||e<d;c.set(a,window.isRTL?"right":"left",b?"34px":"0px");c.set(this.panelLeft,"display",b?"block":"none");c.set(this.panelLeft,"width",b?"34px":"0px")},_scrollToTab:function(a){var b=z.position(this.footerContentNode).w;
if(z.position(this.tabsNode).w>b){var c=z.getMarginBox(this.tabNodes[a]);this.footerContentNode.scrollLeft=c.l-(b-c.w)/2}this._onPanelScroll(a)},_navLeft:function(a){},_navRight:function(a){},_navTabsLeft:function(a){this._navTabs(!1)},_navTabsRight:function(a){this._navTabs(!0)},_navTabs:function(a){for(var b=this.footerContentNode.getBoundingClientRect(),c=0;c<this.tabsNode.children.length;c++){var d=this.tabsNode.children[c].getBoundingClientRect();if(a){if(d.right>b.right){this._scrollToTab(c);
break}}else if(0<d.right){this._scrollToTab(c);break}}},_storeInitalVisibility:function(){A.forEach(this.config.tabs,w.hitch(this,function(a){A.forEach(a.tabLayers,w.hitch(this,function(a){"undefined"!==typeof a.visible&&(a.id in this.initalLayerVisibility||(this.initalLayerVisibility[a.id]=a.visible),a.setVisibility(!1))}))}))},_resetInitalVisibility:function(){A.forEach(this.config.tabs,w.hitch(this,function(a){A.forEach(a.tabLayers,w.hitch(this,function(a){"undefined"!==typeof a.visible&&a.id in
this.initalLayerVisibility&&(a.setVisibility(this.initalLayerVisibility[a.id]),a.hasOwnProperty("visible")&&(a.visible=this.initalLayerVisibility[a.id]),a.redraw?a.redraw():a.refresh&&a.refresh())}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){A.forEach(this.config.tabs,w.hitch(this,function(a){if("summary"===a.type&&a.tabLayers&&1<a.tabLayers.length)for(var b=1;b<a.tabLayers.length;b++)a.tabLayers.pop()}))},_resetInfoWindow:function(){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);
this.defaultLineContent&&this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,"auto");this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var a=this.downloadAllButon.classList?this.downloadAllButon.classList:this.downloadAllButon.className.split(" "),
b=!0,c=0;c<a.length;c++)if("btnDisabled"===a[c]){b=!1;break}b&&(this._updateProcessing(this.downloadAllButon,!0,this.downloadAllSrc),this._verifyIncident(!1)&&(a=this._getAnalysisObjects(),(new ba(this)).createDownloadZip(a,this.incidents,this.buffers).then(w.hitch(this,function(a){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc)}),function(a){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc);new m({message:a.message})})))},_updateProcessing:function(a,b,c){l.setAttr(a,
"src",b?this.processingSrc:c)},_getAnalysisObjects:function(){var a=["proximity","closest","summary","groupedSummary"],b=[];A.forEach(this.config.tabs,function(c){if(-1<a.indexOf(c.type)){var d;switch(c.type){case "proximity":d=c.proximityInfo;break;case "closest":d=c.closestInfo;break;case "summary":d=c.summaryInfo;break;case "groupedSummary":d=c.groupedSummaryInfo}var e="undefined"!==typeof c.layerTitle?c.layerTitle:c.layers;b.push({layerObject:c.tabLayers[0],label:""!==c.label?c.label:e,analysisObject:d,
type:c.type})}});return b.reverse()},_verifyIncident:function(a,b){if(0===this.buffers.length){for(var c=!1,d=0;d<this.incidents.length;d++)if("polygon"===this.incidents[d].geometry.type){c=!0;break}c||new m({message:a?this.nls.notPolySnapShot:b?this.nls.notPolyReport:this.nls.notValidDownload});return c}return!0},_createSnapshot:function(){for(var a=this.createSnapshotButton.classList?this.createSnapshotButton.classList:this.createSnapshotButton.className.split(" "),b=!0,c=0;c<a.length;c++)if("btnDisabled"===
a[c]){b=!1;break}b&&this._verifyIncident(!0)&&this._getName("snapshot").then(w.hitch(this,function(a){if(a&&"cancel"!==a){this._updateProcessing(this.createSnapshotButton,!0,this.snapshotSrc);var b=[];0<this.buffers.length&&b.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});b.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});(new ba(this)).createSnapShot({layers:b.concat(this._getAnalysisObjects()),
incidents:this.incidents,buffers:this.buffers,time:Date.now(),name:a.name,groups:a.groups}).then(w.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc)}),w.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);new m({message:a.message})}))}else this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc)}))},_initReportDijit:function(b){var c="";b.logo&&(c=b.logo,c=-1<c.indexOf("${appPath}")?W.substitute(c,{appPath:this.folderUrl.slice(0,
this.folderUrl.lastIndexOf("widgets"))}):c);this.reportDijit=new t({alignNumbersToRight:window.isRTL,reportLogo:c,appConfig:this.appConfig,footNotes:b.footnote,printTaskUrl:b.printTaskURL,reportLayout:b.reportLayout,styleSheets:[this.folderUrl+"/css/reportDijitOverrides.css"],styleText:".esriCTTable th{background-color: "+b.textColor+"; color: "+this.getTextColor(b.textColor)+";} .esriCTSectionTitle{color: black;} .esriCTHTMLData{height:100%;}",maxNoOfCols:7});this.own(a(this.reportDijit,"reportError",
w.hitch(this,function(){new m({message:window.jimuNls.common.error})})))},getTextColor:function(a){a=(new Q(a)).toRgb();return.5>1-(.299*a[0]+.587*a[1]+.114*a[2])/255?"#000":"#fff"},_getName:function(b){var c=new G,d=new sa({nls:this.nls,type:b,pageUtils:k,storedProps:this._getStoredPropData("SA-REPORT-PROPS"),portalUrl:this.appConfig.portalUrl}),e=new ka({width:450,autoHeight:!0,content:d,titleLabel:"report"===b?this.nls.report_name:this.nls.snapshot_name,invalidMessage:"report"===b?this.nls.invalid_report_name:
this.nls.invalid_snapshot_name});this.own(a(d,"ok",w.hitch(this,function(a){d.destroy();d=null;e.close();this._storePropData("SA-REPORT-PROPS",a);c.resolve(a)})));this.own(a(d,"cancel",w.hitch(this,function(){d.destroy();d=null;e.close();c.resolve("cancel")})));return c},_storePropData:function(a,b){window.localStorage.setItem(a,C.stringify(b))},_getStoredPropData:function(a){return window.localStorage.getItem(a)},_createReport:function(){this.reportEnabled&&this._verifyIncident(!1,!0)&&(this._updateProcessing(this.createReportButton,
!0,this.reportSrc),this._getReportData().then(w.hitch(this,function(a){this._updateProcessing(this.createReportButton,!1,this.reportSrc);this._getName("report").then(w.hitch(this,function(b){if(b&&"cancel"!==b){this._updateProcessing(this.createReportButton,!0,this.reportSrc);this._initReportDijit(w.mixin(this.config.reportSettings,b));for(var c,d=0;d<a.length;d++){var e=a[d];if("map"===e.type){c=d;e.printTemplate=this._getPrintTemplate();break}}b.comments&&""!==b.comments&&a.splice(c+1,0,{type:"html",
data:"\x3cp style\x3d'white-space: pre-wrap;'\x3e"+b.comments+"\x3c/p\x3e"});this.reportDijit.maxNoOfCols="Landscape"===b.reportLayout.orientation.Type?12:7;this.reportDijit.print(b.name,a)}this._updateProcessing(this.createReportButton,!1,this.reportSrc)}))})))},_getReportData:function(a){var b=new G,c=[];c.push({addPageBreak:!0,type:"map",map:this.map});a=this._getAnalysisObjects().reverse();var d=this.nls;(new ba(this))._performAnalysis(a,this.incidents,this.buffers,!1,!0).then(function(a){A.forEach(a,
w.hitch(this,function(a){if(a){for(var b=a.context.tab.type,e="summary"===b?d.summary:"closest"===b?d.closest:"proximity"===b?d.proximity:d.groupedSummary,f=[],g=[],h=[],k="proximity"===b?a.reportResults:a.analysisResults,l=0;l<k.length;l++){var m=k[l];if("summary"!==b&&"groupedSummary"!==b)h=[],0===l&&A.forEach(m,function(a){f.push(a.label)}),A.forEach(m,function(a){h.push(a.value)}),g.push(h);else if("summary"===b){var n=[];A.forEach(a.context.calcFields,function(a){n.push(a.alias?a.alias:a.field)});
0<n.length&&-1<n.indexOf(m.info.replace("\x3cbr/\x3e",""))&&(f.push(m.info.replace("\x3cbr/\x3e","")),h.push(m.num))}else f.push(-1===["",null,void 0].indexOf(m.a)?m.a+" "+m.info:m.info),h.push(m.total)}"summary"!==b&&"groupedSummary"!==b||g.push(h);c.push({title:a.context.baseLabel+" ("+e+")",addPageBreak:!1,type:"table",data:{cols:f,rows:g}});var q={},f=[],g=[],h=[],b=da.getPopupFields(a.context.tab);if(0<b.length){A.forEach(b,function(a){q[a.expression]=a.label});for(b=0;b<a.graphics.length;b++){var h=
[],r=a.graphics[b].attributes,e=Object.keys(r);0===b&&A.forEach(e,function(a){q.hasOwnProperty(a)&&f.push(q[a])});A.forEach(e,function(b){q.hasOwnProperty(b)&&h.push(da.getFieldValue(b,r[b],a.context.specialFields,a.context.dateFields,a.context.defaultDateFormat,a.context.typeIdField,a.context.types))});g.push(h)}c.push({title:a.context.baseLabel,addPageBreak:!1,type:"table",data:{cols:f,rows:g}})}}}));b.resolve(c)},function(a){this._updateProcessing(this.createReportButton,!1,this.reportSrc);new m({message:a.message})});
return b},_getPrintTemplate:function(){var a,b=[];a=new ia;this.reportDijit._printService.legendAll=!0;this.reportDijit._printService._getPrintDefinition(this.map,a);A.forEach(this.reportDijit._printService.allLayerslegend,w.hitch(this,function(a){var c;a.id!==this.lyrIncidents.id&&a.id!==this.lyrBuffer.id&&(c=new ha,c.layerId=a.id,a.subLayerIds&&(c.subLayerIds=a.subLayerIds),b.push(c))}));this.reportDijit._printService.legendAll=!1;a.layoutOptions={legendLayers:b,customTextElements:[{Date:(new Date).toLocaleString()}]};
a=this.reportDijit.setMapLayout(a);a.preserveScale=!1;a.showAttribution=!0;a.format="jpg";return a}})});