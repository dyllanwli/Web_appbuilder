// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/BasemapGallery/esri_tileinfo.json":'{\r\n  "rows": 256,\r\n  "cols": 256,\r\n  "dpi": 96,\r\n  "compressionQuality": 75,\r\n  "origin": {\r\n   "x": -2.0037508342787E7,\r\n   "y": 2.0037508342787E7\r\n  },\r\n  "spatialReference": {\r\n   "wkid": 102100,\r\n   "latestWkid": 3857\r\n  },\r\n  "lods": [\r\n   {\r\n    "level": 0,\r\n    "resolution": 156543.03392800014,\r\n    "scale": 5.91657527591555E8\r\n   },\r\n   {\r\n    "level": 1,\r\n    "resolution": 78271.51696399994,\r\n    "scale": 2.95828763795777E8\r\n   },\r\n   {\r\n    "level": 2,\r\n    "resolution": 39135.75848200009,\r\n    "scale": 1.47914381897889E8\r\n   },\r\n   {\r\n    "level": 3,\r\n    "resolution": 19567.87924099992,\r\n    "scale": 7.3957190948944E7\r\n   },\r\n   {\r\n    "level": 4,\r\n    "resolution": 9783.93962049996,\r\n    "scale": 3.6978595474472E7\r\n   },\r\n   {\r\n    "level": 5,\r\n    "resolution": 4891.96981024998,\r\n    "scale": 1.8489297737236E7\r\n   },\r\n   {\r\n    "level": 6,\r\n    "resolution": 2445.98490512499,\r\n    "scale": 9244648.868618\r\n   },\r\n   {\r\n    "level": 7,\r\n    "resolution": 1222.992452562495,\r\n    "scale": 4622324.434309\r\n   },\r\n   {\r\n    "level": 8,\r\n    "resolution": 611.4962262813797,\r\n    "scale": 2311162.217155\r\n   },\r\n   {\r\n    "level": 9,\r\n    "resolution": 305.74811314055756,\r\n    "scale": 1155581.108577\r\n   },\r\n   {\r\n    "level": 10,\r\n    "resolution": 152.87405657041106,\r\n    "scale": 577790.554289\r\n   },\r\n   {\r\n    "level": 11,\r\n    "resolution": 76.43702828507324,\r\n    "scale": 288895.277144\r\n   },\r\n   {\r\n    "level": 12,\r\n    "resolution": 38.21851414253662,\r\n    "scale": 144447.638572\r\n   },\r\n   {\r\n    "level": 13,\r\n    "resolution": 19.10925707126831,\r\n    "scale": 72223.819286\r\n   },\r\n   {\r\n    "level": 14,\r\n    "resolution": 9.554628535634155,\r\n    "scale": 36111.909643\r\n   },\r\n   {\r\n    "level": 15,\r\n    "resolution": 4.77731426794937,\r\n    "scale": 18055.954822\r\n   },\r\n   {\r\n    "level": 16,\r\n    "resolution": 2.388657133974685,\r\n    "scale": 9027.977411\r\n   },\r\n   {\r\n    "level": 17,\r\n    "resolution": 1.1943285668550503,\r\n    "scale": 4513.988705\r\n   },\r\n   {\r\n    "level": 18,\r\n    "resolution": 0.5971642835598172,\r\n    "scale": 2256.994353\r\n   },\r\n   {\r\n    "level": 19,\r\n    "resolution": 0.29858214164761665,\r\n    "scale": 1128.497176\r\n   },\r\n   {\r\n    "level": 20,\r\n    "resolution": 0.14929107082380833,\r\n    "scale": 564.248588\r\n   },\r\n   {\r\n    "level": 21,\r\n    "resolution": 0.07464553541190416,\r\n    "scale": 282.124294\r\n   },\r\n   {\r\n    "level": 22,\r\n    "resolution": 0.03732276770595208,\r\n    "scale": 141.062147\r\n   },\r\n   {\r\n    "level": 23,\r\n    "resolution": 0.01866138385297604,\r\n    "scale": 70.5310735\r\n   }\r\n  ]\r\n }'}});
define("dojo/_base/lang dojo/Deferred dojo/json dojo/_base/array dojo/promise/all esri/SpatialReference jimu/portalUtils jimu/shared/basePortalUrlUtils esri/request dojo/text!./esri_tileinfo.json".split(" "),function(k,m,w,p,x,r,q,y,z,A){function t(a){if(!a)return null;var b=a.indexOf("?");return 0===a.search(/http|\/\//)&&-1!==b?a.slice(0,b).replace(/\/*$/g,""):a}function n(a){return a?y.removeProtocol(t(a)):null}function u(a){var b=[];p.forEach(a,function(a){b.push(a.url)});b.sort();a="";for(var c=
0,c=0;c<b.length;c++){var d=b[c].indexOf("?"),e="",e=-1!==d?b[c].slice(0,d):b[c];a+=e}return a.replace(/\ /,"")}function B(a){var b=new m;q.getPortalSelfInfo(a).then(k.hitch(this,function(c){var d=c.basemapGalleryGroupQuery;!0===c.useVectorBasemaps&&c.vectorBasemapGalleryGroupQuery&&(d=c.vectorBasemapGalleryGroupQuery);f.getBasemapGalleryGroup(a,d).then(k.hitch(this,function(a){a.queryItems({start:1,num:100,f:"json",q:q.webMapQueryStr}).then(k.hitch(this,function(a){b.resolve(a)}),k.hitch(this,function(){b.reject()}))}),
k.hitch(this,function(){b.reject()}))}));return b}function v(a){return z({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){return a},function(){return null})}var f={},C=w.parse(A);f._loadPortalBaseMaps=function(a,b){var c=new m,d=[];B(a).then(function(a){p.forEach(a.results,function(a){var c=new m,e=n(a.thumbnailUrl);d.push(c);a.getItemData().then(function(d){f._getBasemapSpatialReference(a,d).then(k.hitch(this,function(g){var l=d.baseMap.baseMapLayers;f.isBasemapCompatibleWithMap(g,
l,b).then(k.hitch(this,function(b){b?c.resolve({layers:l,title:a.title||d.baseMap.title,thumbnailUrl:e,spatialReference:g}):c.resolve({})}))}))})});x(d).then(function(a){a=p.filter(a,function(a){return a&&a.title?!0:!1},this);c.resolve(a)})},function(a){c.reject(a)});return c};f.isBasemapCompatibleWithMap=function(a,b,c){var d=new m,e=c.spatialReference,g=c.width>c.height?c.width:c.height;if(!e||!b||0>=b.length||!a||!e.equals(new r(+a.wkid)))return d.resolve(!1),d;0===c.getNumLevels()?"OpenStreetMap"===
b[0].type||b[0].type&&-1<b[0].type.indexOf("BingMaps")||"WebTiledLayer"===b[0].type||"VectorTileLayer"===b[0].type||"ArcGISTiledImageServiceLayer"===b[0].layerType?d.resolve(!1):d.resolve(!0):b[0].layerType&&0===b[0].layerType.indexOf("ArcGIS")&&b[0].url?v(b[0].url).then(function(a){(b[0].serviceInfoResponse=a)&&a.tileInfo?d.resolve(f.tilingSchemeCompatible(c.__tileInfo,a.tileInfo,g)):a&&a.capabilities&&(0<=a.capabilities.indexOf("Map")||a.capabilities.indexOf("Image"))?d.resolve(!0):d.resolve(!1)}):
"WMS"===b[0].layerType?d.resolve(!0):f.isNoUrlLayerMap(b)||"VectorTileLayer"===b[0].layerType?d.resolve(f.tilingSchemeCompatible(c.__tileInfo,C,g)):d.resolve(f.tilingSchemeCompatible(c.__tileInfo,b[0].tileInfo,g));return d};f.tilingSchemeCompatible=function(a,b,c){if(a&&b){var d=!1,e=!1,g,f;for(g=0;g<a.lods.length;g++){var k=a.lods[g].scale;a.dpi!==b.dpi&&(k=a.lods[g].scale/a.dpi);for(f=0;f<b.lods.length;f++){var h=b.lods[f].scale;a.dpi!==b.dpi&&(h=b.lods[f].scale/b.dpi);if(Math.abs(h-k)/h<1/c)if(d){e=
!0;break}else d=!0;if(h<k)break}if(e)break}a=e?!0:!d||1!==a.lods.length&&1!==b.lods.length?!1:!0;return a}return!0};f.compareSameBasemap=function(a,b){var c=b.layers,d="",e="",d=u(a.layers),e=u(c);return d===e};f.compareSameBasemapByOrder=function(a,b){var c=a.layers,d=b.layers,e,g,l,k;if(c.length!==d.length)return!1;for(var h=0;h<c.length;h++){g=e="";l=c[h].layerType||c[h].type;k=d[h].layerType||d[h].type;if(l!==k)return!1;"WebTiledLayer"===l||"WMTSLayer"===l?c[h].wmtsInfo&&d[h].wmtsInfo?(e=c[h].wmtsInfo.url,
g=d[h].wmtsInfo.url):c[h].templateUrl&&d[h].templateUrl&&(e=c[h].templateUrl,g=d[h].templateUrl):"VectorTileLayer"===l?(e=n(c[h].styleUrl),g=n(d[h].styleUrl)):f.isNoUrlLayerMap([c[h]])||f.isNoUrlLayerMap([d[h]])||(e=n(c[h].url),g=n(d[h].url));if(typeof e!==typeof g||e&&g&&e.toLowerCase()!==g.toLowerCase())return!1}return!0};f.isBingMap=function(a){if(!a||!a.layers)return!1;for(var b=0;b<a.layers.length;b++)if("BingMapsAerial"===a.layers[b].type||"BingMapsRoad"===a.layers[b].type||"BingMapsHybrid"===
a.layers[b].type)return!0;return!1};f.isNoUrlLayerMap=function(a){for(var b=0;b<a.length;b++)if("BingMapsAerial"===a[b].type||"BingMapsRoad"===a[b].type||"BingMapsHybrid"===a[b].type||"OpenStreetMap"===a[b].type)return!0;return!1};f.getToken=function(a){a=q.getPortal(a);a.updateCredential();return a.credential?"?token\x3d"+a.credential.token:""};f.removeUrlQuery=function(a){return t(a)};f.getStanderdUrl=function(a){return n(a)};f.getUniqueTitle=function(a,b){if(!b||0===b.length)return a;var c=p.filter(b,
function(b){return b===a?!0:0===b.indexOf(a)?(b=b.substr(a.length+1),!isNaN(+b)):!1});if(0===c.length)return a;c=p.map(c,function(b){return b===a?0:+b.substr(a.length+1)});c=c.sort();return a+" "+(c[c.length-1]+1)};f.getBasemapInfo=function(a,b){var c,d;return q.getPortal(a).getItemById(b).then(function(a){c=a;return a.getItemData()}).then(function(a){d=a;return f._getBasemapSpatialReference(c,a)}).then(function(a){return{thumbnailUrl:c.thumbnailUrl,title:c.title||d.baseMap.title,layers:d.baseMap.baseMapLayers,
spatialReference:new r(a)}})};f.getBasemapGalleryGroup=function(a,b){var c=new m,d=q.getPortal(a),e=b.indexOf("esri_");if(0<=e){var e=b.slice(e,e+7),f="esri_"+dojoConfig.locale.slice(0,2);b=b.replace(e,f)}d.queryGroups({f:"json",q:b}).then(k.hitch(this,function(a){0<a.results.length?c.resolve(a.results[0]):c.reject()}),k.hitch(this,function(){c.reject()}));return c};f._getBasemapSpatialReference=function(a,b){var c=null,d=!1,e=new m;if(a.owner&&0===a.owner.indexOf("esri_")||f.isNoUrlLayerMap(b.baseMap.baseMapLayers))c=
{wkid:"102100"};else if(b.spatialReference||a.spatialReference)c=b.spatialReference||a.spatialReference;else if(b.baseMap.baseMapLayers&&b.baseMap.baseMapLayers[0]){var g=b.baseMap.baseMapLayers[0];if(g.url&&0<g.url.indexOf("rest/services"))d=!0,v(b.baseMap.baseMapLayers[0].url).then(k.hitch(this,function(a){a&&a.spatialReference&&(c=a.spatialReference);e.resolve(c)}),function(a){console.error(a);e.resolve(null)});else if("VectorTileLayer"===g.layerType)c={wkid:"102100"};else if(g=g.fullExtent||g.initialExtent)c=
g.spatialReference}d||e.resolve(c);return e};return f});