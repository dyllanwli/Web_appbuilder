// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(f,l,h,r,d,v,w){f=f(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(d,f){d=d||{};d.layers||d.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=d.id;this.itemId=d.itemId;this.layers=
d.layers;this.title=d.title||"";this.thumbnailUrl=d.thumbnailUrl;this.basemapGallery=f},getLayers:function(f){if(this.layers)return this.layers;if(this.itemId)return f=v({url:(f||d.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:h.hitch(this,function(d,f){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),f.addCallback(h.hitch(this,
function(d,f){if(d.baseMap)return this.layers=[],l.forEach(d.baseMap.baseMapLayers,function(d){this.layers.push(new w(d))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),f}});r("extend-esri")&&h.setObject("dijit.Basemap",f,d);return f})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(f,l,h,r){f=f(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(d){d=d||{};d.url||d.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=d.url;this.type=d.type;this.isReference=!0===d.isReference?!0:!1;this.opacity=d.opacity;this.visibleLayers=d.visibleLayers;this.displayLevels=d.displayLevels;this.exclusionAreas=d.exclusionAreas;this.bandIds=d.bandIds;this.templateUrl=d.templateUrl;this.copyright=d.copyright;this.subDomains=
d.subDomains;this.fullExtent=d.fullExtent;this.initialExtent=d.initialExtent;this.tileInfo=d.tileInfo;this.tileServers=d.tileServers;this.styleUrl=d.styleUrl}});h("extend-esri")&&l.setObject("dijit.BasemapLayer",f,r);return f})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(f,l,h,r,d,v,w,C,D,y,z,t,u,A,B,g,x,b,c,e,m,q,n,J,E,p,K,F,L,G,H,I,M,N,O){l=l([N,B,g],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:O,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,k){a=a||{};a.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=a.map;this._hasUI=k?!0:!1;this.bingMapsKey=a.bingMapsKey&&0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1!==a.showArcGISBasemaps;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=x.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=c.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);h.forEach(this.basemaps,function(a){a.id&&0!==a.id.length||(a.id=this._getUniqueId());h.forEach(a.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&h.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&h.forEach(this.referenceIds,
function(a){a=this.map.getLayer(a);a._basemapGalleryLayerType="reference";a.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(d.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(d.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup();this._checkVTLSupport().then(d.hitch(this,function(a){this._supportsVTL=a}))},startup:function(){this.loaded?
this._refreshUI():r.connect(this,"onLoad",d.hitch(this,function(){this._refreshUI()}))},select:function(a){this._select(a)},getSelected:function(){return this._selectedBasemap},get:function(a){var k;for(k=0;k<this.basemaps.length;k++)if(this.basemaps[k].id===a)return this.basemaps[k];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},
remove:function(a){var k;for(k=0;k<this.basemaps.length;k++){var c=this.basemaps[k];if(c.id===a)return this._selectedBasemap&&this._selectedBasemap.id===c.id&&(this._selectedBasemap=null),this.basemaps.splice(k,1),this._refreshUI(),this.onRemove(c),c}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=
!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);
else{var c=this.arcgisUrl+"/portals/self",b={f:"json"};b.culture=v.locale;e({url:c,content:b,callbackParamName:"callback",load:d.hitch(this,function(c,b){this._basemapGalleryGroupQuery=c&&c.basemapGalleryGroupQuery?c.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)}),error:d.hitch(this,function(a,c){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var c=d.hitch(this,"_findArcGISBasemaps"),
b=this.arcgisUrl+"/community/groups",m={};m.q=this._basemapGalleryGroupQuery;m.f="json";e({url:b,content:m,callbackParamName:"callback",load:d.hitch(this,function(b,k){if(0<b.results.length)c(b.results[0].id,a,b.results[0].sortField,b.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:d.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,c,b,m){var k=d.hitch(this,
function(a,c,b,k){var m=this.arcgisUrl+"/search",g={};g.q="group:"+a+' AND type:"web map" NOT type:"web mapping application"';g.sortField=b;g.sortOrder="asc"===k?"desc":"asc";g.num=50;g.f="json";e({url:m,content:g,callbackParamName:"callback",load:d.hitch(this,function(a,b){if(0<a.results.length)c(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:d.hitch(this,function(a,c){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});
b&&m?k(a,c,b,m):e({url:this.arcgisUrl+"/community/groups/"+a,content:{f:"json"},callbackParamName:"callback",load:d.hitch(this,function(b,e){b.sortField?k(a,c,b.sortField,b.sortOrder):k(a,c,"name","desc")}),error:d.hitch(this,function(b,e){k(a,c,"name","desc")})})},_handleArcGISBasemapsResponse:function(a){0<a.length&&(h.forEach(a,function(a,b){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1===a.title.indexOf("Bing Maps")){var k={};k.id=this._getUniqueId();k.title=a.title;k.thumbnailUrl="";if(a.thumbnail&&
a.thumbnail.length&&(k.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,x.id)){var e=x.id.findCredential(c.urlToObject(this.arcgisUrl).path);e&&(k.thumbnailUrl+="?token\x3d"+e.token)}k.itemId=a.id;k=new M(k,this);this.basemaps.splice(0,0,k)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(u.empty(this.flowContainer),h.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);this.flowContainer.appendChild(this._buildNodeLayout(a))},this),u.create("br",
{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var b=u.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),c=u.create("a",{href:"javascript:void(0);"},b);r.connect(c,"onclick",d.hitch(this,"_onNodeClick",a));var e=a.title||"";a.thumbnailUrl?u.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl,title:e,alt:e},c):u.create("img",{"class":"esriBasemapGalleryThumbnail",src:f.toUrl("./images/transparent.gif"),
title:e,alt:e},c);a=u.create("div",{"class":"esriBasemapGalleryLabelContainer"},b);u.create("span",{innerHTML:e,alt:e,title:e},a);return b},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},_markSelected:function(a){a&&(h.forEach(v.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){A.remove(a,"esriBasemapGallerySelectedNode")}),(a=t.byId("galleryNode_"+a.id))&&A.add(a,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=
!0;var b=this.get(a);b?(b.layers?this._getServiceInfos(b):(a=b.getLayers(this.arcgisUrl),d.isArray(a)?this._getServiceInfos(b):a.addCallback(d.hitch(this,function(a){this._getServiceInfos(b)}))),this._markSelected(b)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"===location.protocol&&h.forEach(a.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:","https:")},this);this._selectedBasemap=a;var b=[];h.forEach(a.layers,function(a){a.url&&
0<a.url.length&&!a.isReference&&!a.type&&(a.deferredsPos=b.length,b.push(this._getServiceInfo(a.url)))},this);0<b.length?(new z(b)).addCallback(d.hitch(this,function(b){var c=null;h.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=b[a.deferredsPos][1];var e=a.serviceInfoResponse.fullExtent;e||(e=a.serviceInfoResponse.extent);c=c?c.union(new m(e)):new m(e)}},this);this.map.extent&&5>this._getIntersectionPercent(c,this.map.extent)&&this.map.setExtent(c,!0);this._switchBasemapLayers(a);
this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},_checkVTLSupport:function(){var a=new y;w("ie")?a.resolve(!1):a.resolve(F.supported());return a},_switchBasemapLayers:function(a){var b=a.layers,c=!1,e,g,x;h.forEach(b,function(a){"VectorTileLayer"===a.type&&(c=!0)});if(c&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()&&("OpenStreetMap"===b[0].type||b[0].type&&-1<b[0].type.indexOf("BingMaps")||"WebTiledLayer"===b[0].type||"VectorTileLayer"===b[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{h.forEach(b,function(a){if(!a.isReference&&a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var f=0;h.forEach(b,
function(a,c){if(!a.isReference){var k;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}k=new J({id:"layer_osm",opacity:a.opacity})}else if(a.type&&-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}k=n.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===a.type?k=n.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(k=n.MAP_STYLE_ROAD);k=new n({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:k,opacity:a.opacity})}else if("WebTiledLayer"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}k=a.initialExtent||a.fullExtent;k=
new K(a.templateUrl||a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new m(a.fullExtent),initialExtent:k&&new m(k),subDomains:a.subDomains,tileInfo:a.tileInfo?new L(a.tileInfo):null,tileServers:a.tileServers})}else if("VectorTileLayer"===a.type){k=new F(a.styleUrl,{visible:a.visibility,opacity:a.opacity});0===c&&1<b.length&&this._removeBasemapLayers();var h=this;r.connect(k,"onLoad",d.hitch(this,function(a,c,e){var k;if(h._sameSpatialReference(e.spatialReference,
h.map.spatialReference))if(0<h.map.getNumLevels())if(k=h._sameTilingScheme(e.tileInfo,h.map.__tileInfo))0===c&&1===b.length&&h._removeBasemapLayers(),e._basemapGalleryLayerType="basemap",h.map.addLayer(e,a);else h.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");else h.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else h.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.")},
f,c))}else if(a.serviceInfoResponse&&a.serviceInfoResponse.mapName){e=new q(a.serviceInfoResponse.spatialReference);g=this._sameSpatialReference(e,this.map.spatialReference);if(this.map.spatialReference&&!g){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===a.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(x=this._sameTilingScheme(a.serviceInfoResponse.tileInfo,this.map.__tileInfo),!x){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}}else if(!0===a.serviceInfoResponse.singleFusedMapCache&&-1<a.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}k=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a)}else if(a.serviceInfoResponse&&
a.serviceInfoResponse.pixelSizeX){e=new q(a.serviceInfoResponse.spatialReference);g=this._sameSpatialReference(e,this.map.spatialReference);if(!g){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===a.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&(x=this._sameTilingScheme(a.serviceInfoResponse.tileInfo,this.map.__tileInfo),!x)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}a.serviceInfoResponse.singleFusedMapCache?k=new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(k=new H,k.bandIds=a.bandIds,!a.bandIds&&a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount,10)&&(k.bandIds=[0,1,2]),k=new G(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:k})):(k=new I,k.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&
-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(k.format="png32"),k=new p(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:k}))}"VectorTileLayer"===a.type?f++:k&&(0===c&&this._removeBasemapLayers(),k._basemapGalleryLayerType="basemap",this.map.addLayer(k,f),f++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];h.forEach(a,function(a){a=this.map.getLayer(a);
"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&h.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&
this.map.removeLayer(b)}},_addReferenceLayer:function(a){"VectorTileLayer"===a.type?this._handleReferenceServiceInfoResponse(a):this._getServiceInfo(a.url,d.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,c){var e;a.serviceInfoResponse=b;"VectorTileLayer"===a.type?e=new F(a.styleUrl,{visible:a.visibility,opacity:a.opacity}):b&&b.mapName?e=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(a.serviceInfoResponse.singleFusedMapCache?
e=new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(c=new H,c.bandIds=a.bandIds,!a.bandIds&&b.bandCount&&3<parseInt(b.bandCount,10)&&(c.bandIds=[0,1,2]),e=new G(a.url,{resourceInfo:b,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c})):(b=new I,b.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(b.format="png32"),b.transparent=!0,
e=new p(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:b})));e&&(e._basemapGalleryLayerType="reference",e.attr("data-reference",!0),this.map.addLayer(e))},_getServiceInfo:function(a,b){return e({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:d.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=h.map(a.serviceInfoResponse.tileInfo.lods,
function(a){return a.level}));var c=null;a.exclusionAreas&&a.exclusionAreas.length&&(c=[],h.forEach(a.exclusionAreas,function(a){c.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new m(a.geometry)})}));return new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:c,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new p(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});
a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){var c=b.intersects(a);if(c){var c=c.getWidth()*c.getHeight(),e=b.getWidth()*b.getHeight();return c/e*100}return 0},_getIds:function(){var a=[];h.forEach(this.basemaps,function(b){a.push(b.id)},this);return a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+
",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return a?-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(a){return a?-1!==a.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(a,c){return a&&c&&a.wkt==c.wkt&&(a.wkid===c.wkid||b.isDefined(a.latestWkid)&&a.latestWkid===c.wkid||b.isDefined(c.latestWkid)&&a.wkid===c.latestWkid||b.isDefined(a.latestWkid)&&a.latestWkid===c.latestWkid)||a&&c&&a.isWebMercator()&&c.isWebMercator()?
!0:!1},_sameTilingScheme:function(a,b){var c=this.map,c=c.width>c.height?c.width:c.height,e=!1,m=!1,g,n;for(g=0;g<a.lods.length;g++){var d=a.lods[g].scale;a.dpi!==b.dpi&&(d=a.lods[g].scale/a.dpi);for(n=0;n<b.lods.length;n++){var q=b.lods[n].scale;a.dpi!==b.dpi&&(q=b.lods[n].scale/b.dpi);if(Math.abs(q-d)/q<1/c)if(e){m=!0;break}else e=!0;if(q<d)break}if(m)break}return m||e&&(1===a.lods.length||1===b.lods.length)?!0:!1}});C("extend-esri")&&d.setObject("dijit.BasemapGallery",l,x);return l})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(f,l,h,r,d,v,w,C,D,y,z,t,u,A,B){f=f(u,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(g){try{if(g=l.mixin({bingMapsKey:null,culture:"en-US"},g||{}),this.url=y.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=y.urlToObject(this.url),this.spatialReference=new z({wkid:102100}),this.tileInfo=new t({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new A(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new z({wkid:102100})),l.mixin(this,g),this.hasAttributionData=this.showAttribution,this._initLayer=l.hitch(this,this._initLayer),this._errorHandler=l.hitch(this,this._errorHandler),this._getTileInfo=l.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(x){throw this.onError(x),x;}},_unsetMap:function(g,d){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var g=this._url.path+"/Imagery/Metadata/"+this.mapStyle,d=window.location.protocol;if(this.bingMapsKey){var b=this.resourceInfo;!this.loaded&&b?this._initLayer(b):B({url:g,content:l.mixin({},{uriScheme:"https:"===d?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(g,d){if(200!==g.statusCode){var b=Error();b.code=g.statusCode;b.message=g.statusDescription;b.details=g.errorDetails;b.authenticationResultCode=g.authenticationResultCode;this.onError(b)}else try{this.resourceInfo=h.toJson(g);var b=g.resourceSets[0].resources[0],c=b.imageUrl.replace("{","${");this.tileServers=r.map(b.imageUrlSubdomains,function(b){var e=y.getProtocolForWebResource();return w.substitute(c,{subdomain:b}).replace("http:",e)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var e=this.loadCallback;e&&(delete this.loadCallback,e(this))}}catch(m){this.onError(m)}},getAttributionData:function(){var g=new C,f=h.fromJson(this.resourceInfo),b;this.hasAttributionData&&f&&(b=l.getObject("resourceSets.0.resources.0.imageryProviders",!1,f));b?g.callback({contributors:b}):
(f=Error("Layer does not have attribution data"),f.log=d.isDebug,g.errback(f));return g},getTileUrl:function(g,d,b){return w.substitute(this.tileServers[d%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(g,d,b),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(g,d,b){var c="",e,m;for(m=g;0<m;m--)g="0",e=1<<m-1,0!=(b&e)&&g++,0!=(d&e)&&(g++,g++),c+=g;return c},setMapStyle:function(g){this.mapStyle=g;this._getTileInfo()},setCulture:function(g){this.culture=g;this._getTileInfo()},
setBingMapsKey:function(g){this.bingMapsKey=g},onMapStyleChange:function(){}});l.mixin(f,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"roadOnDemand"});v("extend-esri")&&l.setObject("virtualearth.VETiledLayer",f,D);return f})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(f,l,h,r,d,v,w,C,D,y,z,t,u,A){function B(g,d){var b=[],c,e;if(g&&d&&(d.customLayerParameters||d.customParameters)){c=l.clone(d.customParameters||{});l.mixin(c,d.customLayerParameters||{});e=y.urlToObject(g);for(var m in e.query)c.hasOwnProperty(m)||b.push(m+"\x3d"+e.query[m]);g=e.path+(b.length?"?"+b.join("\x26"):"")}return g}f=f(u,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(g,f){f||(f={});this.urlTemplate=g=B(g,f.wmtsInfo);var b=new t(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new z({wkid:102100})),c=new t(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new z({wkid:102100}));this.initialExtent=f.initialExtent||b;this.fullExtent=f.fullExtent||c;this.tileInfo=f.tileInfo?f.tileInfo:new A({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new z(this.tileInfo.spatialReference.toJson());this.copyright=f.copyright||"";var e=new r(g),b=e.scheme+"://"+e.authority+"/";this.urlPath=g.substring(b.length);this.tileServers=f.tileServers||[];-1===e.authority.indexOf("{subDomain}")&&
this.tileServers.push(b);if(f.subDomains&&0<f.subDomains.length&&1<e.authority.split(".").length){this.subDomains=f.subDomains;var m;h.forEach(f.subDomains,function(b){-1<e.authority.indexOf("${subDomain}")?m=e.scheme+"://"+v.substitute(e.authority,{subDomain:b})+"/":-1<e.authority.indexOf("{subDomain}")&&(m=e.scheme+"://"+e.authority.replace(/\{subDomain\}/gi,b)+"/");this.tileServers.push(m)},this)}this.tileServers=h.map(this.tileServers,function(b){"/"!==b.charAt(b.length-1)&&(b+="/");return b});
this._levelToLevelValue=[];h.forEach(this.tileInfo.lods,function(b){this._levelToLevelValue[b.level]=b.levelValue||b.level},this);this._wmtsInfo=f.wmtsInfo;var q=l.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(d("chrome")){var b=this.getTileUrl(0,0,0),c=w.defaults.io,n="with-credentials"===c.useCors?y.canUseXhr(b,!0):-1;(c=-1<n?c.corsEnabledServers[n]:null)&&c.withCredentials?D({url:b,handleAs:"arraybuffer"}).addBoth(function(b){q()}):q()}else q()},getTileUrl:function(g,d,b){g=this._levelToLevelValue[g];
var c=this.tileServers[d%this.tileServers.length]+v.substitute(this.urlPath,{level:g,col:b,row:d}),c=c.replace(/\{level\}/gi,g).replace(/\{row\}/gi,d).replace(/\{col\}/gi,b),c=this._appendCustomLayerParameters(c),c=this.addTimestampToURL(c);return y.addProxy(c)},_appendCustomLayerParameters:function(g){var d,b;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters))for(d in b=l.clone(this._wmtsInfo.customParameters||{}),l.mixin(b,this._wmtsInfo.customLayerParameters||
{}),b)g+=(-1===g.indexOf("?")?"?":"\x26")+d+"\x3d"+encodeURIComponent(b[d]);return g}});d("extend-esri")&&l.setObject("layers.WebTiledLayer",f,C);return f})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(f,l,h,r,d,v){f=f(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,
bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(d){var f=this.bbox||this.extent;d=(f=f&&d&&f._normalize(!0))?f.spatialReference.wkid||h.toJson(f.spatialReference.toJson()):null;var l=this.imageSpatialReference,f={bbox:f?f.xmin+","+f.ymin+","+f.xmax+","+f.ymax:null,bboxSR:d,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:l?l.wkid||h.toJson(l.toJson()):
d,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?h.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?h.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?h.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,
lercVersion:this.lercVersion};d=this.timeExtent;f.time=d?d.toJson().join(","):null;return v.filter(f,function(d){if(null!==d&&void 0!==d)return!0})}});l.mixin(f,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});r("extend-esri")&&l.setObject("layers.ImageServiceParameters",f,d);
return f})},"widgets/BasemapGallery/utils":function(){define("dojo/_base/lang dojo/Deferred dojo/json dojo/_base/array dojo/promise/all esri/SpatialReference jimu/portalUtils jimu/shared/basePortalUrlUtils esri/request dojo/text!./esri_tileinfo.json".split(" "),function(f,l,h,r,d,v,w,C,D,y){function z(b){if(!b)return null;var c=b.indexOf("?");return 0===b.search(/http|\/\//)&&-1!==c?b.slice(0,c).replace(/\/*$/g,""):b}function t(b){return b?C.removeProtocol(z(b)):null}function u(b){var c=[];r.forEach(b,
function(b){c.push(b.url)});c.sort();b="";for(var e=0,e=0;e<c.length;e++){var d=c[e].indexOf("?"),g="",g=-1!==d?c[e].slice(0,d):c[e];b+=g}return b.replace(/\ /,"")}function A(b){var c=new l;w.getPortalSelfInfo(b).then(f.hitch(this,function(e){var d=e.basemapGalleryGroupQuery;!0===e.useVectorBasemaps&&e.vectorBasemapGalleryGroupQuery&&(d=e.vectorBasemapGalleryGroupQuery);g.getBasemapGalleryGroup(b,d).then(f.hitch(this,function(b){b.queryItems({start:1,num:100,f:"json",q:w.webMapQueryStr}).then(f.hitch(this,
function(b){c.resolve(b)}),f.hitch(this,function(){c.reject()}))}),f.hitch(this,function(){c.reject()}))}));return c}function B(b){return D({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(b){return b},function(){return null})}var g={},x=h.parse(y);g._loadPortalBaseMaps=function(b,c){var e=new l,m=[];A(b).then(function(b){r.forEach(b.results,function(b){var e=new l,d=t(b.thumbnailUrl);m.push(e);b.getItemData().then(function(m){g._getBasemapSpatialReference(b,
m).then(f.hitch(this,function(n){var q=m.baseMap.baseMapLayers;g.isBasemapCompatibleWithMap(n,q,c).then(f.hitch(this,function(c){c?e.resolve({layers:q,title:b.title||m.baseMap.title,thumbnailUrl:d,spatialReference:n}):e.resolve({})}))}))})});d(m).then(function(b){b=r.filter(b,function(b){return b&&b.title?!0:!1},this);e.resolve(b)})},function(b){e.reject(b)});return e};g.isBasemapCompatibleWithMap=function(b,c,e){var d=new l,f=e.spatialReference,n=e.width>e.height?e.width:e.height;if(!f||!c||0>=c.length||
!b||!f.equals(new v(+b.wkid)))return d.resolve(!1),d;0===e.getNumLevels()?"OpenStreetMap"===c[0].type||c[0].type&&-1<c[0].type.indexOf("BingMaps")||"WebTiledLayer"===c[0].type||"VectorTileLayer"===c[0].type||"ArcGISTiledImageServiceLayer"===c[0].layerType?d.resolve(!1):d.resolve(!0):c[0].layerType&&0===c[0].layerType.indexOf("ArcGIS")&&c[0].url?B(c[0].url).then(function(b){(c[0].serviceInfoResponse=b)&&b.tileInfo?d.resolve(g.tilingSchemeCompatible(e.__tileInfo,b.tileInfo,n)):b&&b.capabilities&&(0<=
b.capabilities.indexOf("Map")||b.capabilities.indexOf("Image"))?d.resolve(!0):d.resolve(!1)}):"WMS"===c[0].layerType?d.resolve(!0):g.isNoUrlLayerMap(c)||"VectorTileLayer"===c[0].layerType?d.resolve(g.tilingSchemeCompatible(e.__tileInfo,x,n)):d.resolve(g.tilingSchemeCompatible(e.__tileInfo,c[0].tileInfo,n));return d};g.tilingSchemeCompatible=function(b,c,e){if(b&&c){var d=!1,g=!1,f,h;for(f=0;f<b.lods.length;f++){var l=b.lods[f].scale;b.dpi!==c.dpi&&(l=b.lods[f].scale/b.dpi);for(h=0;h<c.lods.length;h++){var p=
c.lods[h].scale;b.dpi!==c.dpi&&(p=c.lods[h].scale/c.dpi);if(Math.abs(p-l)/p<1/e)if(d){g=!0;break}else d=!0;if(p<l)break}if(g)break}b=g?!0:!d||1!==b.lods.length&&1!==c.lods.length?!1:!0;return b}return!0};g.compareSameBasemap=function(b,c){var e=c.layers,d="",g="",d=u(b.layers),g=u(e);return d===g};g.compareSameBasemapByOrder=function(b,c){var e=b.layers,d=c.layers,f,n,h,l;if(e.length!==d.length)return!1;for(var p=0;p<e.length;p++){n=f="";h=e[p].layerType||e[p].type;l=d[p].layerType||d[p].type;if(h!==
l)return!1;"WebTiledLayer"===h||"WMTSLayer"===h?e[p].wmtsInfo&&d[p].wmtsInfo?(f=e[p].wmtsInfo.url,n=d[p].wmtsInfo.url):e[p].templateUrl&&d[p].templateUrl&&(f=e[p].templateUrl,n=d[p].templateUrl):"VectorTileLayer"===h?(f=t(e[p].styleUrl),n=t(d[p].styleUrl)):g.isNoUrlLayerMap([e[p]])||g.isNoUrlLayerMap([d[p]])||(f=t(e[p].url),n=t(d[p].url));if(typeof f!==typeof n||f&&n&&f.toLowerCase()!==n.toLowerCase())return!1}return!0};g.isBingMap=function(b){if(!b||!b.layers)return!1;for(var c=0;c<b.layers.length;c++)if("BingMapsAerial"===
b.layers[c].type||"BingMapsRoad"===b.layers[c].type||"BingMapsHybrid"===b.layers[c].type)return!0;return!1};g.isNoUrlLayerMap=function(b){for(var c=0;c<b.length;c++)if("BingMapsAerial"===b[c].type||"BingMapsRoad"===b[c].type||"BingMapsHybrid"===b[c].type||"OpenStreetMap"===b[c].type)return!0;return!1};g.getToken=function(b){b=w.getPortal(b);b.updateCredential();return b.credential?"?token\x3d"+b.credential.token:""};g.removeUrlQuery=function(b){return z(b)};g.getStanderdUrl=function(b){return t(b)};
g.getUniqueTitle=function(b,c){if(!c||0===c.length)return b;var e=r.filter(c,function(c){return c===b?!0:0===c.indexOf(b)?(c=c.substr(b.length+1),!isNaN(+c)):!1});if(0===e.length)return b;e=r.map(e,function(c){return c===b?0:+c.substr(b.length+1)});e=e.sort();return b+" "+(e[e.length-1]+1)};g.getBasemapInfo=function(b,c){var e,d;return w.getPortal(b).getItemById(c).then(function(b){e=b;return b.getItemData()}).then(function(b){d=b;return g._getBasemapSpatialReference(e,b)}).then(function(b){return{thumbnailUrl:e.thumbnailUrl,
title:e.title||d.baseMap.title,layers:d.baseMap.baseMapLayers,spatialReference:new v(b)}})};g.getBasemapGalleryGroup=function(b,c){var e=new l,d=w.getPortal(b),g=c.indexOf("esri_");if(0<=g){var g=c.slice(g,g+7),h="esri_"+dojoConfig.locale.slice(0,2);c=c.replace(g,h)}d.queryGroups({f:"json",q:c}).then(f.hitch(this,function(b){0<b.results.length?e.resolve(b.results[0]):e.reject()}),f.hitch(this,function(){e.reject()}));return e};g._getBasemapSpatialReference=function(b,c){var d=null,h=!1,q=new l;if(b.owner&&
0===b.owner.indexOf("esri_")||g.isNoUrlLayerMap(c.baseMap.baseMapLayers))d={wkid:"102100"};else if(c.spatialReference||b.spatialReference)d=c.spatialReference||b.spatialReference;else if(c.baseMap.baseMapLayers&&c.baseMap.baseMapLayers[0]){var n=c.baseMap.baseMapLayers[0];if(n.url&&0<n.url.indexOf("rest/services"))h=!0,B(c.baseMap.baseMapLayers[0].url).then(f.hitch(this,function(b){b&&b.spatialReference&&(d=b.spatialReference);q.resolve(d)}),function(b){console.error(b);q.resolve(null)});else if("VectorTileLayer"===
n.layerType)d={wkid:"102100"};else if(n=n.fullExtent||n.initialExtent)d=n.spatialReference}h||q.resolve(d);return q};return g})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/BasemapGallery/esri_tileinfo.json":'{\r\n  "rows": 256,\r\n  "cols": 256,\r\n  "dpi": 96,\r\n  "compressionQuality": 75,\r\n  "origin": {\r\n   "x": -2.0037508342787E7,\r\n   "y": 2.0037508342787E7\r\n  },\r\n  "spatialReference": {\r\n   "wkid": 102100,\r\n   "latestWkid": 3857\r\n  },\r\n  "lods": [\r\n   {\r\n    "level": 0,\r\n    "resolution": 156543.03392800014,\r\n    "scale": 5.91657527591555E8\r\n   },\r\n   {\r\n    "level": 1,\r\n    "resolution": 78271.51696399994,\r\n    "scale": 2.95828763795777E8\r\n   },\r\n   {\r\n    "level": 2,\r\n    "resolution": 39135.75848200009,\r\n    "scale": 1.47914381897889E8\r\n   },\r\n   {\r\n    "level": 3,\r\n    "resolution": 19567.87924099992,\r\n    "scale": 7.3957190948944E7\r\n   },\r\n   {\r\n    "level": 4,\r\n    "resolution": 9783.93962049996,\r\n    "scale": 3.6978595474472E7\r\n   },\r\n   {\r\n    "level": 5,\r\n    "resolution": 4891.96981024998,\r\n    "scale": 1.8489297737236E7\r\n   },\r\n   {\r\n    "level": 6,\r\n    "resolution": 2445.98490512499,\r\n    "scale": 9244648.868618\r\n   },\r\n   {\r\n    "level": 7,\r\n    "resolution": 1222.992452562495,\r\n    "scale": 4622324.434309\r\n   },\r\n   {\r\n    "level": 8,\r\n    "resolution": 611.4962262813797,\r\n    "scale": 2311162.217155\r\n   },\r\n   {\r\n    "level": 9,\r\n    "resolution": 305.74811314055756,\r\n    "scale": 1155581.108577\r\n   },\r\n   {\r\n    "level": 10,\r\n    "resolution": 152.87405657041106,\r\n    "scale": 577790.554289\r\n   },\r\n   {\r\n    "level": 11,\r\n    "resolution": 76.43702828507324,\r\n    "scale": 288895.277144\r\n   },\r\n   {\r\n    "level": 12,\r\n    "resolution": 38.21851414253662,\r\n    "scale": 144447.638572\r\n   },\r\n   {\r\n    "level": 13,\r\n    "resolution": 19.10925707126831,\r\n    "scale": 72223.819286\r\n   },\r\n   {\r\n    "level": 14,\r\n    "resolution": 9.554628535634155,\r\n    "scale": 36111.909643\r\n   },\r\n   {\r\n    "level": 15,\r\n    "resolution": 4.77731426794937,\r\n    "scale": 18055.954822\r\n   },\r\n   {\r\n    "level": 16,\r\n    "resolution": 2.388657133974685,\r\n    "scale": 9027.977411\r\n   },\r\n   {\r\n    "level": 17,\r\n    "resolution": 1.1943285668550503,\r\n    "scale": 4513.988705\r\n   },\r\n   {\r\n    "level": 18,\r\n    "resolution": 0.5971642835598172,\r\n    "scale": 2256.994353\r\n   },\r\n   {\r\n    "level": 19,\r\n    "resolution": 0.29858214164761665,\r\n    "scale": 1128.497176\r\n   },\r\n   {\r\n    "level": 20,\r\n    "resolution": 0.14929107082380833,\r\n    "scale": 564.248588\r\n   },\r\n   {\r\n    "level": 21,\r\n    "resolution": 0.07464553541190416,\r\n    "scale": 282.124294\r\n   },\r\n   {\r\n    "level": 22,\r\n    "resolution": 0.03732276770595208,\r\n    "scale": 141.062147\r\n   },\r\n   {\r\n    "level": 23,\r\n    "resolution": 0.01866138385297604,\r\n    "scale": 70.5310735\r\n   }\r\n  ]\r\n }',
"url:widgets/BasemapGallery/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"basemapGalleryDiv" \x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n\r\n',"url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemapgallery {height: 100%;}.jimu-widget-basemapgallery .esriBasemapGalleryNode:hover{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {border: 1px solid #fff; margin: 1px; -moz-box-shadow: 0px 0px 0px #000; -webkit-box-shadow: 0px 0px 0px #000; box-shadow: 0px 0px 7px #000;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryLabelContainer{padding-top: 2px;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail{width: 100px; height: 67px;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode .esriBasemapGalleryThumbnail{border-color: #51B1FE !important;}.jimu-widget-basemapgallery .esriBasemapGalleryNode {width: 85px; margin: 5px 10px 0 10px;}.jimu-rtl .jimu-widget-basemapgallery .esriBasemapGalleryNode {float: right;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {display: block; margin: 1px auto;}",
"*now":function(f){f(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/Deferred jimu/BaseWidget jimu/portalUtils jimu/PanelManager jimu/portalUrlUtils jimu/utils esri/dijit/Basemap esri/dijit/BasemapLayer esri/dijit/BasemapGallery dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/on dojo/promise/all ./utils jimu/dijit/LoadingIndicator".split(" "),function(f,l,h,r,d,v,w,C,D,y,z,t,u,A,B,g,x,b){return f([r,l],{name:"BasemapGallery",baseClass:"jimu-widget-basemapgallery",basemapGallery:null,spatialRef:null,
startup:function(){this.inherited(arguments);this.initBasemaps()},resize:function(){this._responsive()},_responsive:function(){setTimeout(t.hitch(this,function(){var b=B("#"+this.id)[0],b=A.getStyle(b,"width"),d=parseInt(b/105,10);if(0<d){var g=parseInt(b%105/d,10);B(".esriBasemapGalleryNode",this.id).forEach(function(b){A.setStyle(b,"width",85+g+"px")})}}),100)},initBasemaps:function(){var c,e,f=t.clone(this.config.basemapGallery);this.loadingShelter.show();1===f.mode?c=b._loadPortalBaseMaps(this.appConfig.portalUrl,
this.map):(c=new h,c.resolve(f.basemaps));e=d.getPortal(this.appConfig.portalUrl).loadSelfInfo();x({portalSelf:e,basemaps:c}).then(t.hitch(this,function(c){for(var d=c.basemaps,e=[],h=0,l=this._getWebmapBasemap(),d=u.filter(d,function(d){if(!d||!d.title)return!1;var e;e=b.isBingMap(d)?c.portalSelf.bingKey?!0:!1:!0;return d.title&&e},this),h=0;h<d.length&&!b.compareSameBasemapByOrder(d[h],l);h++);h===d.length&&d.push(l);for(h=0;h<d.length;h++){for(var l=d[h].layers.length,m=[],q=0;q<l;q++)m.push(new y(d[h].layers[q]));
d[h].layers=m;d[h].thumbnailUrl?/^(https?:)?\/\//.test(d[h].thumbnailUrl)?d[h].thumbnailUrl+=b.getToken(this.appConfig.portalUrl):d[h].thumbnailUrl=C.processUrlInWidgetConfig(d[h].thumbnailUrl,this.folderUrl):d[h].thumbnailUrl=this.folderUrl+"images/default.jpg";e.push(new D(d[h]))}f.map=this.map;this.appConfig.portalUrl&&(f.portalUrl=this.appConfig.portalUrl);f.basemaps=e;f.showArcGISBasemaps=!1;f.bingMapsKey=c.portalSelf.bingKey;this.basemapGallery=new z(f,this.basemapGalleryDiv);this.basemapGallery.startup();
this.own(g(this.basemapGallery,"selection-change",t.hitch(this,this.selectionChange)));this._responsive();this.loadingShelter.hide()}))},_getWebmapBasemap:function(){var b;b=this.map.itemInfo.item.thumbnail?w.getItemUrl(this.appConfig.portalUrl,this.map.itemInfo.item.id)+"/info/"+this.map.itemInfo.item.thumbnail:null;return{title:this.map.itemInfo.itemData.baseMap.title,thumbnailUrl:b,layers:this.map.itemInfo.itemData.baseMap.baseMapLayers,spatialReference:this.map.spatialReference}},selectionChange:function(){this.updateExtent();
"widgetOnScreen"===this.gid&&v.getInstance().closePanel(this.id+"_panel")},updateExtent:function(){if(0<this.map.getNumLevels()){var b=this.basemapGallery.getSelected().getLayers(),d=this.map.__tileInfo.lods[this.map.getLevel()],f;if(0<b.length&&(b=b[0],(f=b.tileInfo||b.serviceInfoResponse&&b.serviceInfoResponse.tileInfo)&&d)){var g=d.scale/this.map.__tileInfo.dpi,h;u.forEach(f.lods,function(b){b=b.scale/f.dpi;if(!h||Math.abs(b-g)<Math.abs(h-g))h=b});Math.abs(h-g)/g>1/this.map.width&&this.map.setScale(h*
f.dpi)}}}})});