// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Infographic/setting/dijitsSetting/ChartDijitSetting.html":'\x3cdiv\x3e\r\n  \x3cdiv style\x3d"font-size: 14px;"\x3e${nls.chartSettings}\x3c/div\x3e\r\n  \x3cdiv class\x3d"section data-section" data-dojo-attach-point\x3d"dataSection"\x3e\r\n    \x3cdiv class\x3d"section-item chart-mode-section-item feature-mode category-mode count-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.displayMode}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"chartModeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onChartModeChnaged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item label-field-section-item feature-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.labelField}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"labelFieldSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onLabelFieldChanged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item category-field-section-item category-mode count-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.categoryField}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"categoryFieldSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onCategoryFieldChanged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item operation-section-item category-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.operation}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"operationSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onOperationSelectChanged" class\x3d"restrict-select-width"\x3e\r\n        \x3coption value\x3d"sum"\x3e${nls.sumOption}\x3c/option\x3e\r\n        \x3coption value\x3d"average"\x3e${nls.averageOption}\x3c/option\x3e\r\n        \x3coption value\x3d"min"\x3e${nls.minOption}\x3c/option\x3e\r\n        \x3coption value\x3d"max"\x3e${nls.maxOption}\x3c/option\x3e\r\n      \x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item value-fields-section-item feature-mode category-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.valueFields}\x3c/div\x3e\r\n      \x3cdiv\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"valueFields" data-dojo-type\x3d"jimu/dijit/_DataFields" data-dojo-attach-event\x3d"change:_onValueFieldsChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"section display-section" data-dojo-attach-point\x3d"displaySection"\x3e\r\n    \x3cdiv class\x3d"section-item column-type bar-type pie-type line-type average-align"\x3e\r\n      \x3cdiv\x3e${nls.backgroundColor}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"bgColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onBgColorChanged"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item column-type bar-type pie-type line-type average-align"\x3e\r\n      \x3cdiv\x3e${nls.chartColor}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"chartColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onChartColorChanged"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"legendTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"legendTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onLegendTextColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"horTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"horTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onHorColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"verTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"verTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onVerColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"dataLabelTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dataLabelTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onDataLabelColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/on dojo/query dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./BaseDijitSetting dijit/_WidgetsInTemplateMixin dojo/text!./ChartDijitSetting.html jimu/DataSourceManager jimu/LayerInfos/LayerInfos jimu/dijit/TabContainer3 ./_dijits/TogglePocket ./_dijits/ChartColorSetting jimu/utils jimu/dijit/_DataFields dijit/form/Select".split(" "),function(f,l,c,g,e,m,n,p,q,r,t,u,h){return m([n,p],{templateString:q,type:"chart",baseClass:"infographic-chart-dijit-setting",layerDefinition:null,
_webMapLayerId:null,highLightColor:"#ff0000",oidFieldType:"esriFieldTypeOID",_stringFieldType:"esriFieldTypeString",_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_dateFieldType:"esriFieldTypeDate",ignoreChangeEvents:!1,layerInfosObj:null,dataSourceManager:null,dataSourceType:"",allAvailableValueFields:null,tabContainer:null,postCreate:function(){this.inherited(arguments);this.layerInfosObj=t.getInstanceSync();this.dataSourceManager=
r.getInstance();this._setDefaultValueForConfig();this._initSelf()},_initSelf:function(){this.tabContainer=new u({average:!0,tabs:[{title:this.nls.data,content:this.dataSection},{title:this.nls.display,content:this.displaySection}]});this.legendTogglePocket=new h({title:this.nls.legend,content:this.legendTogglePocketContent,className:"section-item column-type bar-type line-type pie-type"});this.own(f(this.legendTogglePocket,"change",c.hitch(this,this._onLegendTogglePocketChanged)));this.legendTogglePocket.placeAt(this.displaySection);
this.horTogglePocket=new h({title:this.nls.horizontalAxis,content:this.horTogglePocketContent,className:"section-item column-type bar-type line-type"});this.own(f(this.horTogglePocket,"change",c.hitch(this,this._onHorTogglePocketChanged)));this.horTogglePocket.placeAt(this.displaySection);this.verTogglePocket=new h({title:this.nls.verticalAxis,content:this.verTogglePocketContent,className:"section-item column-type bar-type line-type"});this.own(f(this.verTogglePocket,"change",c.hitch(this,this._onVerTogglePocketChanged)));
this.verTogglePocket.placeAt(this.displaySection);this.dataLabelTogglePocket=new h({title:this.nls.dataLabels,content:this.dataLabelTogglePocketContent,className:"section-item pie-type"});this.own(f(this.dataLabelTogglePocket,"change",c.hitch(this,this._onDataLabelsTogglePocketChanged)));this.dataLabelTogglePocket.placeAt(this.displaySection);this.tabContainer.placeAt(this.domNode);this.ignoreChangeEvents=!0;this._clear();this.ignoreChangeEvents=!1;this._onChartModeChnaged();this._updateDijitBackgroundColor()},
_setDefaultValueForConfig:function(){this.config&&(this.config.backgroundColor||(this.config.backgroundColor="#ffffff"),this.config.legendTextColor||(this.config.legendTextColor="#000000"),"pie"===this.config.type?this.config.dataLabelColor||(this.config.dataLabelColor="#000000"):(this.config.horizontalAxisTextColor||(this.config.horizontalAxisTextColor="#000000"),this.config.verticalAxisTextColor||(this.config.verticalAxisTextColor="#000000")))},setDataSource:function(a){this.inherited(arguments);
this.dataSourceType="";this.categoryFieldSelect.set("disabled",!1);if(a.layerId)this._setDataSourceForLayerId(a);else if(a.frameWorkDsId){var b=a.frameWorkDsId;this.dataSourceManager.parseDataSourceId(b)&&(b=(this.appConfig.dataSource&&this.appConfig.dataSource.dataSources)[b],"Features"===b.type?this._setDataSourceForFrameworkFeatures(b):"FeatureStatistics"===b.type&&this._setDataSourceForFeatureStatistics(b))}},_setDataSourceForLayerId:function(a){this.dataSourceType="CLIENT_FEATURES";(a=this.layerInfosObj.getLayerInfoById(a.layerId))&&
a._getServiceDefinition().then(c.hitch(this,function(a){this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(a):this._resetByNewLayerDefinition(a);setTimeout(c.hitch(this,function(){this.ignoreChangeEvents=!1}),200)}))},_setDataSourceForFrameworkFeatures:function(a){this.dataSourceType="FRAMEWORK_FEATURES";a=c.clone(a.dataSchema);this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(a):this._resetByNewLayerDefinition(a);setTimeout(c.hitch(this,function(){this.ignoreChangeEvents=
!1}),200)},_setDataSourceForFeatureStatistics:function(a){this.dataSourceType="FRAMEWORK_STATISTICS";var b={type:"Table",fields:[]};a=c.clone(a.dataSchema);var d=a.groupByFields||[];this.allAvailableValueFields=e.filter(a.fields,c.hitch(this,function(a){return 0>d.indexOf(a.name)}));b.fields=a.fields;this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(b):this._resetByNewLayerDefinition(b);this.chartModeSelect.removeOption("feature");0<d.length?(this.chartModeSelect.removeOption("field"),
this.config.mode||(this.categoryFieldSelect.set("value",d[0]),this.categoryFieldSelect.set("disabled",!0))):(this.chartModeSelect.removeOption("count"),this.chartModeSelect.removeOption("category"));setTimeout(c.hitch(this,function(){this.ignoreChangeEvents=!1}),200)},getConfig:function(){if(this.config){var a={mode:"",type:""};if(!this.layerDefinition)return null;var b=this.chartModeSelect.get("value");if(!b)return null;a.mode=b;var d=this.valueFields.getSelectedFieldNames();if("feature"===b){b=
{labelField:"",valueFields:[],sortOrder:"asc"};if(0===d.length)return null;b.labelField=this.labelFieldSelect.get("value");b.valueFields=d;c.mixin(a,b)}else if("category"===b){b={categoryField:"",operation:"",valueFields:[],sortOrder:"asc"};if(0===d.length)return null;b.categoryField=this.categoryFieldSelect.get("value");b.operation=this.operationSelect.get("value");b.valueFields=d;c.mixin(a,b)}else if("count"===b)d={categoryField:"",sortOrder:"asc"},d.categoryField=this.categoryFieldSelect.get("value"),
c.mixin(a,d);else if("field"===b){b={operation:"",valueFields:[]};if(0===d.length)return null;b.operation=this.operationSelect.get("value");b.valueFields=d;c.mixin(a,b)}a.type=this.config.type;a.backgroundColor=this.bgColor.getSingleColor();a.colors=this.chartColor.getColors();a.showLegend=this.legendTogglePocket.getState();a.legendTextColor=this.legendTextColor.getSingleColor();"pie"===a.type?(a.showDataLabel=this.dataLabelTogglePocket.getState(),a.dataLabelColor=this.dataLabelTextColor.getSingleColor()):
(a.showHorizontalAxis=this.horTogglePocket.getState(),a.horizontalAxisTextColor=this.horTextColor.getSingleColor(),a.showVerticalAxis=this.verTogglePocket.getState(),a.verticalAxisTextColor=this.verTextColor.getSingleColor());return a}},_resetByConfig:function(a){a&&(this._resetByNewLayerDefinition(a),this.chartModeSelect.set("value",this.config.mode),this.config.labelField&&this.labelFieldSelect.set("value",this.config.labelField),this.config.categoryField&&this.categoryFieldSelect.set("value",this.config.categoryField),
this.config.valueFields&&this.valueFields.selectFields(this.config.valueFields),this.config.operation&&this.operationSelect.set("value",this.config.operation))},_resetByNewLayerDefinition:function(a){a&&(this._addAliasForLayerInfo(a),this._clear(),this.layerDefinition=a,this._resetFieldsDijitsByLayerInfo(this.layerDefinition))},_clear:function(){this.allAvailableValueFields=this.layerDefinition=null;this.dijit.clearChart();this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());this.categoryFieldSelect.set("disabled",
!1);this.labelFieldSelect.removeOption(this.labelFieldSelect.getOptions());this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());this.operationSelect.set("value","sum");this.valueFields.clear();this._checkPieValueFields();this._updateChartTypes();this.bgColor.setSingleColor(this.config.backgroundColor);this.chartColor.setColorsAutomatically(this.config.colors);this.legendTextColor.setSingleColor(this.config.legendTextColor);this.horTextColor.setSingleColor(this.config.horizontalAxisTextColor);
this.verTextColor.setSingleColor(this.config.verticalAxisTextColor);this.dataLabelTextColor.setSingleColor(this.config.dataLabelColor);this.legendTogglePocket.setState(!!this.config.showLegend);this.horTogglePocket.setState(!!this.config.showHorizontalAxis);this.verTogglePocket.setState(!!this.config.showVerticalAxis);this.dataLabelTogglePocket.setState(!!this.config.showDataLabel)},_resetFieldsDijitsByLayerInfo:function(a){this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());if(this._hasNumberFields(a)){this.chartModeSelect.addOption({value:"feature",
label:this.nls.featureOption});this.chartModeSelect.addOption({value:"category",label:this.nls.categoryOption});this.chartModeSelect.addOption({value:"count",label:this.nls.countOption});this.chartModeSelect.addOption({value:"field",label:this.nls.fieldOption});var b=this.chartModeSelect.getOptions()[0];this.chartModeSelect.set("value",b.value)}else this.chartModeSelect.addOption({value:"count",label:this.nls.countOption}),this.chartModeSelect.set("value","count");var d=a.displayField;a=c.clone(a.fields);
var k=[this._stringFieldType,this._dateFieldType],k=k.concat(c.clone(this._numberFieldTypes)),b=e.filter(a,c.hitch(this,function(a){return 0<=k.indexOf(a.type)}));this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());var f="";e.forEach(b,c.hitch(this,function(a){this.categoryFieldSelect.addOption({value:a.name,label:a.alias});a.name===d&&(f=d)}));this.categoryFieldSelect.set("value",f);var v=[this._stringFieldType,this.oidFieldType,this._dateFieldType].concat(c.clone(this._numberFieldTypes)),
b=e.filter(a,c.hitch(this,function(a){return 0<=v.indexOf(a.type)}));this.labelFieldSelect.removeOption(this.labelFieldSelect.getOptions());var g="";e.forEach(b,c.hitch(this,function(a){var b={value:a.name,label:a.name||a.alias};d?a.name===d&&(g=a.name):a.type===this.oidFieldType&&(g=a.name);this.labelFieldSelect.addOption(b)}));this.labelFieldSelect.set("value",g);a=e.filter(a,c.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)}));this.valueFields.setFields(a)},_addAliasForLayerInfo:function(a){a&&
a.fields&&0<a.fields.length&&e.forEach(a.fields,c.hitch(this,function(a){a.name&&!a.alias&&(a.alias=a.name)}))},_hasNumberFields:function(a){var b=!1;(a=a.fields)&&0<a.length&&(b=e.some(a,c.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)})));return b},_checkPieValueFields:function(){var a=this.chartModeSelect.get("value");"feature"!==a&&"category"!==a||!this.config||"pie"!==this.config.type?this.valueFields.setMultipleMode():this.valueFields.setSingleMode()},_onChartModeChnaged:function(){this._checkPieValueFields();
var a=(this.chartModeSelect.get("value")||"")+"-mode",b=l(".section-item",this.dataSection);e.forEach(b,c.hitch(this,function(b){g.hasClass(b,a)?this._showSectionItem(b):this._hideSectionItem(b)}));this._updateChartTypes();this._onChartConfigDijitsChanged()},_onLabelFieldChanged:function(){this._onChartConfigDijitsChanged()},_onCategoryFieldChanged:function(){this._onChartConfigDijitsChanged()},_onOperationSelectChanged:function(){this._onChartConfigDijitsChanged()},_onValueFieldsChanged:function(){this._updateChartTypes();
this._onChartConfigDijitsChanged()},_onBgColorChanged:function(){this._updateDijitBackgroundColor();this._onChartConfigDijitsChanged()},_updateDijitBackgroundColor:function(){var a=this.bgColor.getSingleColor();this.dijit.setBackgroundColor(a)},_onChartColorChanged:function(){this._onChartConfigDijitsChanged()},_onLegendTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onLegendTextColorChanged:function(){this._onChartConfigDijitsChanged()},_onHorTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},
_onHorColorChanged:function(){this._onChartConfigDijitsChanged()},_onVerTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onVerColorChanged:function(){this._onChartConfigDijitsChanged()},_onDataLabelsTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onDataLabelColorChanged:function(){this._onChartConfigDijitsChanged()},_onChartConfigDijitsChanged:function(){this.ignoreChangeEvents||this.getConfig()&&this._tryUpdatePreview()},_updateChartTypes:function(){var a=this.valueFields.getSelectedFieldNames().length,
b=this.chartModeSelect.get("value"),d=this.config.type,f=d+"-type",h=l(".section-item",this.displaySection);e.forEach(h,c.hitch(this,function(a){g.hasClass(a,f)?this._showSectionItem(a):this._hideSectionItem(a)}));"pie"===d?this.chartColor.setMode(!1):"feature"===b||"category"===b?1===a?this.chartColor.setMode(!0):this.chartColor.setMode(!1):this.chartColor.setMode(!0)},_showSectionItem:function(a){g.removeClass(a,"hide")},_hideSectionItem:function(a){g.addClass(a,"hide")},_tryUpdatePreview:function(){var a=
this.getConfig();this.dijit.setConfig(a)},_getDefStatus:function(a){return a?a.isFulfilled()?a.isResolved()?2:-1:1:0}})});