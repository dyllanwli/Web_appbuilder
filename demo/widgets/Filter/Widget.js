// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojo/NodeList":function(){define(["./query"],function(h){return h.NodeList})},"widgets/Filter/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Filter/Widget.html":'\x3cdiv\x3e\r\n  \x3cul class\x3d"filter-list" data-dojo-attach-point\x3d"filterList"\x3e\x3c/ul\x3e\r\n\x3c/div\x3e',"url:widgets/Filter/css/style.css":".jimu-widget-filter {width: 100%; height: 100%; position: relative;}.jimu-widget-filter .filter-list,.jimu-widget-filter .filter-list li {margin: 0; padding: 0;}.jimu-widget-filter .filter-list li {list-style: none;}.jimu-widget-filter .filter-list .filter-item{border-bottom: 1px solid #d7d7d7; font-size: 12px; overflow: hidden;}.jimu-widget-filter .filter-list .filter-item .header{vertical-align: middle; padding-top: 12px; padding-bottom: 12px; min-height: 40px; cursor: pointer; position: relative;}.jimu-widget-filter .filter-list .filter-item .header:hover{background-color: #eee;}.jimu-widget-filter .filter-list .filter-item.config-parameters .header .item-title{font-family: 'Avenir Medium', Verdana, Geneva, sans-serif;}.jimu-widget-filter .filter-list .filter-item .body{display: none;}.jimu-widget-filter .filter-list .filter-item.config-parameters .body{display: block;}.jimu-widget-filter .filter-list .filter-item .header\x3e*{display: inline-block; vertical-align: middle; word-break: break-word;}.jimu-widget-filter .filter-list .filter-item .header\x3e.icon{vertical-align: top;}.jimu-widget-filter .filter-list .filter-item .header:after{content: \"\"; height: 100%; min-height: 16px; vertical-align: top; display: inline-block;}.jimu-widget-filter .filter-list .filter-item .header .icon{width: 16px; height: 16px;}.jimu-widget-filter .filter-list .filter-item .header .icon img{width: 100%; height: 100%;}.jimu-widget-filter .filter-list .filter-item .header .setting,.jimu-widget-filter .filter-list .filter-item .header .done{width: 16px; min-height: 16px; display: none; position: absolute; top: 12px;}.jimu-widget-filter .filter-list .filter-item .header .done{right: 0px;}.jimu-rtl .jimu-widget-filter .filter-list .filter-item .header .done{right: auto; left: 0px;}.jimu-widget-filter .filter-list .filter-item .header .setting{background: url('./images/setting_normal.svg') no-repeat center; z-index: 10; right: 22px;}.jimu-widget-filter .filter-list .filter-item .header .setting:hover{background: url('./images/setting_hover.svg') no-repeat center;}.jimu-rtl .jimu-widget-filter .filter-list .filter-item .header .setting{right: auto; left: 22px;}.jimu-widget-filter .filter-list .filter-item .header:hover .setting,.jimu-widget-filter .filter-list .filter-item.config-parameters .setting{display: block;}.jimu-widget-filter .filter-list .filter-item .header:hover .setting{background-color: transparent;}.jimu-widget-filter .filter-list .filter-item .header .done,.jimu-widget-filter .filter-list .filter-item .header .setting{-webkit-animation: none; -moz-animation: none; -ms-animation: none; -o-animation: none; animation: none; -webkit-transform: none; -moz-transform: none; -ms-transform: none; -o-transform: none; transform: none;}.jimu-widget-filter .filter-list .filter-item .header .done{background: url('./images/done.svg') no-repeat center;}@-webkit-keyframes load8 {0% {-webkit-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); transform: rotate(360deg);}}@-moz-keyframes load8 {0% {-moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-moz-transform: rotate(360deg); transform: rotate(360deg);}}@-ms-keyframes load8 {0% {-ms-transform: rotate(0deg); transform: rotate(0deg);} 100% {-ms-transform: rotate(360deg); transform: rotate(360deg);}}@keyframes load8 {0% {-webkit-transform: rotate(0deg); -ms-transform: rotate(0deg); -moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); -ms-transform: rotate(360deg); -moz-transform: rotate(360deg); transform: rotate(360deg);}}.jimu-widget-filter .filter-list .filter-item.applying .header .done,.jimu-widget-filter .filter-list .filter-item.requesting .header .setting{content: ''; border-radius: 50%; position: absolute; width: 16px; height: 16px; top: 12px; text-indent: -9999em; background: none; border-top: 2.2px solid #d6d6d6; border-right: 2.2px solid #d6d6d6; border-bottom: 2.2px solid #d6d6d6; border-left: 2.2px solid #4A4A4A; -webkit-animation: load8 1.1s infinite linear; -moz-animation: load8 1.1s infinite linear; -ms-animation: load8 1.1s infinite linear; -o-animation: load8 1.1s infinite linear; animation: load8 1.1s infinite linear; -webkit-transform: translateZ(0); -moz-transform: translateZ(0); -ms-transform: translateZ(0); -o-transform: translateZ(0); transform: translateZ(0);}.jimu-widget-filter .filter-list .filter-item.applying .header .done,.jimu-widget-filter .filter-list .filter-item.applied .header .done,.jimu-widget-filter .filter-list .filter-item.requesting .header .setting{display: block;}.jimu-widget-filter .filter-list .filter-item .body .parameters{margin: 0 30px;}.jimu-widget-filter .filter-list .filter-item .body .jimu-btn{background: #fff; border-radius: 0; width: 82px; border: 1px solid #c7c7c7; color: #000; font-size: 12px; margin-bottom: 15px;}.jimu-widget-filter .filter-list .filter-item .body .jimu-btn:hover{border: 1px solid #000;}.jimu-widget-filter .jimu-loading-shelter .loading-container{width: auto;}",
"*now":function(h){h(['dojo/i18n!*preload*widgets/Filter/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/_base/lang dojo/query dojo/on dijit/_WidgetsInTemplateMixin jimu/utils jimu/BaseWidget jimu/filterUtils jimu/dijit/FilterParameters jimu/LayerInfos/LayerInfos jimu/FilterManager esri/request dojo/NodeList dojo/NodeList-dom".split(" "),function(h,l,f,e,g,k,m,n,p,q,r,t,u,v){return h([p,m],{name:"Filter",baseClass:"jimu-widget-filter",_itemTemplate:'\x3cli class\x3d"filter-item" data-index\x3d"${index}"\x3e\x3cdiv class\x3d"header jimu-leading-padding1" \x3e\x3cspan class\x3d"icon jimu-trailing-margin05"\x3e\x3cimg src\x3d"${icon}" /\x3e\x3c/span\x3e\x3cspan class\x3d"item-title"\x3e${title}\x3c/span\x3e\x3cspan class\x3d"done jimu-float-trailing jimu-leading-margin1"\x3e\x3c/span\x3e\x3cspan class\x3d"setting jimu-float-trailing" title\x3d"${toggleTip}" style\x3d"display:${hasValue}"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"body"\x3e\x3cdiv class\x3d"parameters"\x3e\x3c/div\x3e\x3cspan class\x3d"jimu-btn apply jimu-float-trailing jimu-trailing-margin25"\x3e${apply}\x3c/span\x3e\x3c/div\x3e\x3c/li\x3e',
_store:null,postCreate:function(){this.inherited(arguments);this._store={};this.layerInfosObj=t.getInstanceSync();this.filterUtils=new q;this.filterManager=u.getInstance();l.forEach(this.config.filters,function(a,d){var b=this.filterUtils.isAskForValues(a.filter),b={icon:a.icon?n.processUrlInWidgetConfig(a.icon,this.folderUrl):this.folderUrl+"/css/images/default_task_icon.png",index:d,title:a.name,toggleTip:this.nls.toggleTip,hasValue:b?window.appInfo.isRunInMobile?"block !important":"":"none",isAskForValue:b,
apply:e.getObject("jimuNls.common.apply",!1,window)||"Apply"};this._store[a.layerId]||(this._store[a.layerId]={mapFilterControls:{}});var c=e.replace(this._itemTemplate,b,/\$\{([^\}]+)\}/ig),c=f.toDom(c);f.place(c,this.filterList);this.own(g(".header",c).on("click",e.hitch(this,"enableFilter",c,a,b)));"none"!==b.hasValue&&(this.own(g(".setting",c).on("click",e.hitch(this,"configFilter",c,a))),this.own(g(".apply",c).on("click",e.hitch(this,"applyFilterValues",c,a))),f.addClass(c,"requesting"),this.configFilter(c,
a))},this)},startup:function(){this.inherited(arguments);this.resize()},_getPriorityOfMapFilter:function(a){a=e.getObject(a+".mapFilterControls",!1,this._store);var d=0,b;for(b in a){var c=a[b];c.priority>d&&(d=c.priority)}return d},_getMapFilterControl:function(a){a=e.getObject(a+".mapFilterControls",!1,this._store);var d=!0,b;for(b in a){var c=a[b];0<c.priority&&(d=!!c.enable)}return d},_setItemFilter:function(a,d,b,c){this._store[a]["filter_item_"+d]=b;b=this._getPriorityOfMapFilter(a);e.setObject(a+
".mapFilterControls.filter_item_"+d,{enable:c,priority:b+1},this._store)},_removeItemFilter:function(a,d){delete this._store[a]["filter_item_"+d];delete this._store[a].mapFilterControls["filter_item_"+d]},_getExpr:function(a){if(!this._store[a])return null;var d=[];a=this._store[a];for(var b in a){var c=a[b];c&&"mapFilterControls"!==b&&d.push("("+c+")")}return d.join(" AND ")},_bindMapUpdateEvents:function(a,d){k.once(this.map,"update-start",e.hitch(this,function(){f.addClass(a,"applying")}));k.once(this.map,
"update-end",e.hitch(this,function(){d?f.addClass(a,"applied"):f.removeClass(a,"applied");f.removeClass(a,"applying")}))},enableFilter:function(a,d,b){if(!f.hasClass(a,"config-parameters")||a.filterParams&&a.filterParams.getFilterExpr())if(!b.isAskForValue||a.filterParams&&a.filterParams.getFilterExpr()){b=d.layerId;var c=f.getAttr(a,"data-index"),e=null,g=this.layerInfosObj.getLayerInfoById(b),e=f.hasClass(a,"applied");g.isShowInMap()&&g.isInScale()?this._bindMapUpdateEvents(a,e?!1:!0):e?f.removeClass(a,
"applied"):f.addClass(a,"applied");g=null;e?this._removeItemFilter(b,c):this._setItemFilter(b,c,a.filterParams?a.filterParams.getFilterExpr():d.filter.expr,d.enableMapFilter);e=this._getExpr(b);g=this._getMapFilterControl(b);this.filterManager.applyWidgetFilter(b,this.id,e,g)}else this.configFilter(a,d)},configFilter:function(a,d,b){a.filterParams?f.hasClass(a,"config-parameters")?(f.removeClass(a,"config-parameters"),this._changeItemTitleWidth(a,window.appInfo.isRunInMobile?60:45)):(f.addClass(a,
"config-parameters"),this._changeItemTitleWidth(a,60)):v({url:d.url,content:{f:"json"},handleAs:"json",callbackPrams:"callback"}).then(e.hitch(this,function(b){f.addClass(a,"config-parameters");f.removeClass(a,"requesting");var c=g(".parameters",a)[0];a.handles=[];a.filterParams=new r;var h=e.clone(d.filter);a.filterParams.build(d.url,b,h);this.own(k(a.filterParams,"change",e.hitch(this,function(b){b?(g(".apply",a).removeClass("disable-apply"),a.expr=b):(delete a.expr,g(".apply",a).addClass("disable-apply"))})));
a.expr=a.filterParams.getFilterExpr();a.expr?g(".apply",a).removeClass("disable-apply"):(delete a.expr,g(".apply",a).addClass("disable-apply"));a.filterParams.placeAt(c);this._changeItemTitleWidth(a,60)}));b&&b.target&&b.stopPropagation()},applyFilterValues:function(a,d,b){var c=a.filterParams&&(a.expr||a.filterParams.getFilterExpr());if(c){a.expr=c;var c=d.layerId,e=f.getAttr(a,"data-index"),g=this.layerInfosObj.getLayerInfoById(c);g.isShowInMap()&&g.isInScale()?this._bindMapUpdateEvents(a,!0):f.addClass(a,
"applied");this._setItemFilter(c,e,a.expr,d.enableMapFilter);a=this._getExpr(c);d=this._getMapFilterControl(c);this.filterManager.applyWidgetFilter(c,this.id,a,d)}b.stopPropagation()},resize:function(){this.inherited(arguments);this._changeItemTitleWidth(this.domNode,window.appInfo.isRunInMobile?60:45)},_changeItemTitleWidth:function(a,d){var b=g(".header",a)[0];b&&(b=f.getContentBox(b).w-d,0<b&&g(".header .item-title",a).style({maxWidth:b+"px"}))},destroy:function(){g(".filter-item",this.filterList).forEach(function(a){delete a.filterParams;
delete a.expr});if(this._store)for(var a in this._store)a&&this.filterManager.applyWidgetFilter(a,this.id,"",null);this.inherited(arguments)}})});